---
title: Использование облачных служб с расширенной поддержкой (предварительная версия)
description: Дополнительные сведения о создании и развертывании облачных служб (Расширенная поддержка) с помощью Azure Resource Manager с Visual Studio
author: ghogen
manager: jmartens
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: how-to
ms.date: 01/25/2021
ms.author: ghogen
monikerRange: '>=vs-2019'
ms.openlocfilehash: 39a76f4c76afb2ed0c738adfc477807eebfdbc61
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99841137"
---
# <a name="create-and-deploy-to-cloud-services-extended-support-in-visual-studio-preview"></a>Создание и развертывание в облачных службах (Расширенная поддержка) в Visual Studio (Предварительная версия)

Начиная с [Visual Studio 2019 версии 16,9](https://visualstudio.microsoft.com/vs/preview) (в настоящее время предварительная версия) вы можете работать с облачными службами с помощью Azure Resource Manager, что значительно упрощает и модернизирована обслуживание ресурсов Azure и управление ими. Это можно включить с помощью новой службы Azure, называемой *облачными службами (Расширенная поддержка)*. Вы можете опубликовать существующую облачную службу в Облачных службах (расширенная поддержка). Сведения об этой службе Azure см. в документации по [Облачным службам (расширенная поддержка)](/azure/cloud-services-extended-support/overview).

## <a name="publish-to-cloud-services-extended-support"></a>Публикация в облачных службах (Расширенная поддержка)

При публикации существующего проекта облачной службы Azure в облачные службы (Расширенная поддержка) сохраняется возможность публикации в классической облачной службе Azure. В Visual Studio 2019 версии 16,9 Preview 3 и более поздних версиях классические проекты облачных служб имеют специальную версию команды **публикации** , **Publish (Расширенная поддержка)**. Эта команда отображается в контекстном меню **Обозреватель решений**.

При публикации в облачные службы (Расширенная поддержка) существуют некоторые различия. Например, вы не запрашиваете публикацию в **промежуточной** или **рабочей среде**, так как эти слоты развертывания не являются частью модели публикации расширенной поддержки. Вместо этого в облачных службах (Расширенная поддержка) можно настроить несколько развертываний и переключить развертывания в портал Azure. Хотя средства Visual Studio позволяют установить это 16,9 в предварительной версии 3, функция переключения не будет включена до последующего выпуска облачных служб (Расширенная поддержка) и может привести к сбою во время развертывания в течение предварительной версии.

Перед публикацией классической облачной службы Azure в облачные службы (Расширенная поддержка) Проверьте учетные записи хранения, используемые в проекте, и убедитесь, что они имеют учетные записи хранения v1 или v2. Классические типы учетных записей хранения будут завершаться с сообщением об ошибке во время развертывания. Обязательно проверьте учетную запись хранения, используемую системой диагностики. Чтобы проверить учетную запись хранения диагностики, см. статью [Настройка диагностики для облачных служб и виртуальных машин Azure](vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines.md). Если служба использует классическую учетную запись хранения, ее можно обновить. см. статью [обновление до учетной записи хранения общего назначения версии 2](/azure/storage/common/storage-account-upgrade?tabs=azure-portal).  Общие сведения о типах учетных записей хранения см. в разделе [Общие сведения об учетной записи хранения](/azure/storage/common/storage-account-overview).

### <a name="to-publish-a-classic-azure-cloud-service-project-to-cloud-services-extended-support"></a>Публикация проекта классической облачной службы Azure в облачные службы (Расширенная поддержка)

1. Облачные службы (расширенная поддержка) сейчас предоставляются в предварительной версии. Зарегистрируйте функцию для своей подписки следующим образом:

   ```azurepowershell-interactive
   Register-AzProviderFeature -FeatureName CloudServices -ProviderNamespace Microsoft.Compute
   ```

1. Щелкните правой кнопкой мыши узел проекта в проекте облачной службы (классическая модель) Azure и выберите **опубликовать (Расширенная поддержка)**... **Мастер публикации** откроется на первом экране.

   ![В меню выберите Опубликовать (Расширенная поддержка).](./media/cloud-services-extended-support/publish-commands-on-menu.png)

   Откроется мастер **публикации** .

   ![Страница входа](./media/cloud-services-extended-support/publish-step1.png)

1. **Учетная запись**: в раскрывающемся списке учетных записей выберите учетную запись или пункт **Добавить учетную запись**.

1. **Выбор подписки**: выберите подписку, которую следует использовать для развертывания.

1. Нажмите **Далее**, чтобы перейти на страницу **Параметры**.

   ![Общие параметры](./media/cloud-services-extended-support/publish-settings.png)

1. **Облачная служба (Расширенная поддержка)** . с помощью раскрывающегося списка выберите существующую облачную службу (расширенную поддержку) или щелкните Создать и создайте **новую**. Центр обработки данных отображается в круглых скобках для каждой облачной службы (Расширенная поддержка). Рекомендуется, чтобы расположение центра обработки данных для облачной службы (Расширенная поддержка) совпадало с расположением центра обработки данных для учетной записи хранения.

   Если вы решили создать новую службу, появится диалоговое окно **Создание облачной службы (Расширенная поддержка)** . Укажите расположение и группу ресурсов, которые будут использоваться для облачной службы (Расширенная поддержка).

   ![Создание облачной службы (Расширенная поддержка)](./media/cloud-services-extended-support/extended-support-dialog.png)

1. **Конфигурация сборки**: выберите **Отладка** или **Выпуск**.

1. **Конфигурация службы**: выберите **Облако** или **Локально**.

1. **Учетная запись хранения**: выберите учетную запись хранения для этого развертывания или выберите **Создать** и создайте учетную запись хранения. Рядом с каждой учетной записью хранения в скобках указывается регион. Рекомендуется, чтобы расположение центра обработки данных для учетной записи хранения и расположение центра обработки данных для облачной службы совпадали ("Общие параметры").

   В учетной записи хранения Azure содержится пакет для развертывания приложения.

1. **Хранилище ключей** — укажите хранилище ключей, содержащее секреты для этой облачной службы (Расширенная поддержка). Эта возможность включается, если включен удаленный рабочий стол или сертификаты добавляются в конфигурацию.

1. **Включить удаленный рабочий стол для всех ролей**: установите этот флажок, чтобы удаленно подключаться к службе. Вам будет предложено указать учетные данные.

   ![Параметры удаленного рабочего стола](./media/cloud-services-extended-support/remote-desktop-configuration.png)

1. Нажмите **Далее**, чтобы перейти на страницу **Параметры диагностики**.

   ![Параметры диагностики](./media/cloud-services-extended-support/diagnostics-settings.png)

   Диагностика позволяет устранять неполадки в облачной службе Azure (Расширенная поддержка). Дополнительные сведения о системе диагностики см. в статье [Настройка системы диагностики для облачных служб и виртуальных машин Azure](./vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines.md). Дополнительные сведения о службе Application Insights см. в статье [Что такое Azure Application Insights?](/azure/application-insights/app-insights-overview)

1. Щелкните **ОК**, чтобы перейти к странице **Сводка**.

   ![Итоги](./media/cloud-services-extended-support/publish-summary.png)

1. **Целевой профиль**: здесь вы можете создать профиль публикации на основе ранее выбранных параметров. Например, можно создать один профиль для тестовой среды, а другой — для рабочей. Чтобы сохранить профиль, выберите значок **Сохранить**. Мастер создаст профиль и сохранит его в проекте Visual Studio. Чтобы изменить имя профиля, откройте список **Целевой профиль**, а затем выберите **Управление**.

   > [!Note]
   > Профиль публикации отображается в обозреватель решений в Visual Studio, а параметры профиля записываются в файл с расширением *azurePubxml* . Параметры сохраняются как атрибуты XML-тегов.

1. Когда все параметры развертывания проекта настроены, нажмите кнопку **Опубликовать** в нижней части диалогового окна. Состояние этого процесса можно отслеживать в окне вывода **Журнал действий Azure** в Visual Studio. Щелкните ссылку **Открыть в портале** , чтобы 

Поздравляем! Вы опубликовали проект облачной службы (Расширенная поддержка) в Azure. Вы можете повторить публикацию с теми же параметрами, применив тот же профиль публикации, или повторить все действия для создания нового. Шаблон Azure Resource Manager (ARM) и параметры, используемые для развертывания, сохраняются в папке *bin/ \<configuration\> /Publish* .

## <a name="clean-up-azure-resources"></a>Очистка ресурсов Azure

Чтобы очистить ресурсы Azure, созданные в ходе работы с этим руководством, перейдите к [портал Azure](https://portal.azure.com), выберите **группы ресурсов**, найдите и откройте группу ресурсов, которая использовалась для создания облачной службы (Расширенная поддержка), и выберите **Удалить группу ресурсов**.

## <a name="next-steps"></a>Дальнейшие действия

Настройте непрерывную интеграцию (CI) с помощью кнопки **Настроить** на экране **Публикация**. Дополнительные сведения доступны в [документации по Azure Pipelines](/azure/devops/pipelines/?view=azure-devops&preserve-view=true).
