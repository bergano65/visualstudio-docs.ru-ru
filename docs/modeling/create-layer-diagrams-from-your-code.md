---
title: Создание схем зависимостей на основе кода
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- architecture, dependency diagrams
- dependency diagrams
- diagrams - modeling, layer
- constraints, architectural
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.prod: visual-studio-dev15
ms.openlocfilehash: 44b957f18061024278710683a63d250f16ae2e4d
ms.sourcegitcommit: 8b538eea125241e9d6d8b7297b72a66faa9a4a47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54761418"
---
# <a name="create-dependency-diagrams-from-your-code"></a>Создание схем зависимостей на основе кода

Для визуализации программного обеспечения системы высокоуровневой логической архитектуры, создайте *схема зависимостей* в Visual Studio. Чтобы удостовериться, что код соответствует этой структуре, проверьте его со схемой зависимостей. Можно создать схемы зависимостей для проектов Visual C# и Visual Basic. Чтобы узнать, какие выпуски Visual Studio поддерживают эту функцию, см. в разделе [Edition поддержка для инструментов моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools).

![Создать диаграмму зависимостей](../modeling/media/layerdiagramvisualizecode.png)

Диаграмма зависимостей вы можете упорядочить элементы решения Visual Studio в логические, абстрактные группы, называемые *слои*. Слои можно использовать для описания основных задач, выполняемых этими артефактами, или основных компонентов системы. Каждый слой может содержать другие слои, описывающие более подробные задачи. Можно также указать предполагаемые или существующие *зависимости* между слоями. Эти зависимости, представленные в виде стрелок, указывают, какие слои могут использовать или в настоящее время используют функциональные возможности, представленные другими слоями. Для поддержки архитектурного контроля кода добавьте предполагаемые зависимости в схему, а затем проверьте код по схеме.

[Видео. Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)

## <a name="CreateDiagram"></a> Создать диаграмму зависимостей

Прежде чем создавать диаграмму зависимостей, убедитесь, что решение содержит проект моделирования.

> [!IMPORTANT]
> Не добавить, перетаскивать или Копировать существующую схему зависимостей из одного проекта моделирования в другой проект моделирования или в другое место в решении. Это позволит сохранить ссылки из исходной схемы при изменении схемы. Кроме того, это может привести к тому, что проверка схемы будет работать неправильно, и к другим потенциальным проблемам, таким как отсутствующие элементы или другие ошибки при попытке открыть схему.
>
> Вместо этого добавьте новую схему зависимостей в проект моделирования. Скопируйте элементы из исходной схемы в новую схему. Сохраните проект моделирования и создать диаграмму зависимостей.

### <a name="add-a-new-dependency-diagram-to-a-modeling-project"></a>Добавьте новую схему зависимостей в проект моделирования

> [!NOTE]
> Схемы зависимостей не поддерживаются для проектов .NET Core в Visual Studio 2017.

1.  На **архитектура** меню, выберите **создать диаграмму зависимостей**.

2.  В разделе **шаблоны**, выберите **схема зависимостей**.

3.  Назовите схему.

4.  В **добавьте в проект моделирования**найдите и выделите существующий проект моделирования в решении.

     - или -

     Выберите **создайте новый проект моделирования** для добавления в решение новый проект моделирования.

    > [!NOTE]
    > Диаграмма зависимостей должна существовать внутри проекта моделирования. Однако ее можно связать с элементами в любом месте решения.

5.  Убедитесь в том, что для сохранения проекта моделирования и схеме зависимостей.

## <a name="drag-and-drop-or-copy-and-paste-from-a-code-map"></a>Перетаскивание, или скопируйте и вставьте из карты кода

1. Создать карту кода для решения с помощью **архитектура** меню.

2. Рассмотрите возможность применения фильтра карту кода для удаления папки решений и «Средства тестирования», если требуется только для принудительного применения зависимостей в коде продукта.

3. На карте созданный код удалите «External» узел или разверните его, чтобы показать внешние сборки, в зависимости от того, нужно ли применять зависимости пространства имен и необязательные сборок из карты кода.

4. Создайте новую схему зависимостей для решения с помощью **архитектура** меню

5. Выбор всех узлов на карте кода (использовать _Ctrl_ + _объект_, или использовать Выбор эластичного, нажав клавишу _Shift_ ключа перед нажмите кнопку, перетащите и отпустите.

6. Перетаскивание, или копирования и вставки, выбранных элементов в новую схему проверки зависимостей.

7. Это показывает текущую архитектуру приложения. Указать, должна быть архитектура и соответствующим образом изменить диаграмму зависимостей.

![Диаграмма зависимостей, создаваемые на карте кода](media/dependency-validation-01.png)

## <a name="CreateLayers"></a> Создать слои из артефактов
 Слои можно создать из элементов решения Visual Studio, таких как проекты, файлы кода, пространства имен, классы и методы. При этом автоматически создаются связи между слоями и элементами, которые включаются в процесс проверки слоев.

 Слои также можно связывать с элементами, которые не поддерживают проверку, такими как документы Word или презентации PowerPoint, чтобы можно было связать слой со спецификациями или планами. Кроме того, слои можно связать с файлами в проектах, которые являются общими для нескольких приложений, но в процесс проверки не войдут слои, которые отображаются с универсальными именами, например "Уровень 1" и "Уровень 2".

 Чтобы узнать, если связанный элемент проводить проверку, откройте **обозреватель слоев** и изучите **поддерживает проверку** свойства элемента. См. в разделе [управление ссылками на артефакты](#Managing).

|**Задача**|**Выполните следующие действия**|
|-|-|
|Создать слой для одного артефакта|<ol><li>Перетащите элемент на диаграмму зависимостей из следующих источников:<br /><br /> <ul><li>**Обозреватель решений**<br /><br />         Например, можно перетаскивать файлы или проекты.</li><li>Карты кода<br /><br />         См. в разделе [сопоставление зависимостей в решениях](../modeling/map-dependencies-across-your-solutions.md) и [использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md).</li><li>**Представление классов** или **обозреватель объектов**</li></ul><br />     Слой отображается на схеме и связан с артефактом.</li><li>Переименуйте слой, чтобы отразить обязанности связанного кода или артефактов.</li></ol> **Внимание!**  Перетаскивание двоичных файлов диаграмму зависимостей не добавляет их ссылки на проект моделирования автоматически. Необходимо вручную добавить двоичные файлы, которые нужно проверить, в проект моделирования. **Добавление двоичных файлов в проект моделирования** <ol><li>В **обозревателе решений**, откройте контекстное меню для проекта моделирования и выберите **добавить существующий элемент**.</li><li>В **добавить существующий элемент** диалоговом окне перейдите к двоичным файлам, выберите их и нажмите кнопку **ОК**.     Двоичные файлы отображаются в проекте моделирования.</li><li>В **обозревателе решений**, выберите двоичный файл, который вы добавили и нажмите клавишу **F4** открыть **свойства** окна.</li><li>Для каждого двоичного файла задайте **действие при построении** свойства **Validate**.</li></ol>|
|Создание единственного слоя для всех выбранных артефактов|Перетащите все артефакты в схему зависимостей в то же время.<br /><br /> Слой отображается в схеме и связан со всеми артефактами.|
|Создание слоя для каждого выбранного артефакта|Нажмите и удерживайте **SHIFT** ключа, одновременно перетаскивая все артефакты на диаграмму зависимостей. **Примечание.**  Если вы используете **SHIFT** ключ для выбора диапазона элементов отпустите клавишу после выбора артефактов. Нажмите и удерживайте ее снова при перетаскивании артефактов в схему. <br /><br /> Слой для каждого артефакта отображается в схеме и связан с каждым артефактом.|
|Добавление артефакта в слой|Перетащите артефакт в слой.|
|Создание нового несвязанного слоя|В **элементов**, разверните **схема зависимостей** раздела, а затем перетащите **слой** к схеме зависимостей.<br /><br /> Чтобы добавить несколько слоев, дважды щелкните средство. Когда вы закончите, нажмите кнопку **указатель** средство или нажмите клавишу **ESC** ключ.<br /><br /> -или-<br /><br /> Откройте контекстное меню на схеме зависимостей, выберите **добавить**, а затем выберите **слой**.|
|Создание вложенных слоев|Перетащите существующий слой в другой слой.<br /><br /> -или-<br /><br /> Откройте контекстное меню слоя, выберите **добавить**, а затем выберите **слой**.|
|Создание нового слоя, который содержит два или более существующих слоев|Выберите слои, откройте контекстное меню для выбранного элемента и нажмите кнопку **группы**.|
|Изменение цвета слоя|Задайте его **цвет** свойства нужного цвета.|
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве слоя **Запрещенные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве слоя **Запрещенные зависимости пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве слоя **обязательные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|

 Число на слое обозначает количество артефактов, связанных со слоем. Однако при считывании этого числа учитывайте следующее.

-   Если слой связан с артефактом, содержащим другие артефакты, но слой не связан с другими артефактами напрямую, то число включает только связанный артефакт. Однако для анализа в ходе проверки слоя включаются другие артефакты.

     Например, если слой связан с одним пространством имен, то число связанных артефактов равно 1, даже если пространство имен содержит классы. Если слой также связан с каждым классом в пространстве имен, то число будет включать эти связанные классы.

-   Если слой содержит другие слои, связанные с артефактами, то слой-контейнер также связан с этими артефактами, даже если число в слое-контейнере не включает эти артефакты.

## <a name="Managing"></a> Управление ссылками между слоями и артефактами

1.  На схеме зависимостей, откройте контекстное меню слоя и выберите **Просмотр ссылок**.

     **Обозреватель слоев** показывает ссылки артефакта для выбранного слоя.

2.  Для управления этими ссылками можно использовать следующие задачи:

|**Задача**|**В обозревателе слоев**|
|-|-|
|Удалить ссылку между слоем и артефактом|Откройте контекстное меню связи артефакта, а затем выберите **удалить**.|
|Переместить ссылку из одного слоя в другой|Перетащите ссылку артефакта в существующий слой на схеме.<br /><br /> -или-<br /><br /> 1.  Откройте контекстное меню связи артефакта, а затем выберите **Вырезать**.<br />2.  На схеме зависимостей, откройте контекстное меню слоя и выберите **вставить**.|
|Скопировать ссылку из одного слоя в другой|1.  Откройте контекстное меню связи артефакта, а затем выберите **копирования**.<br />2.  На схеме зависимостей, откройте контекстное меню слоя и выберите **вставить**.|
|Создать новый слой из существующей ссылки артефакта|Перетащите ссылку артефакта в пустую область на схеме.|
|Убедитесь, что связанный артефакт поддерживает проверку относительно схемы зависимостей.|Рассмотрим **поддержка проверки** столбец связи артефакта.|

## <a name="Discovering"></a> Реконструирование существующих зависимостей
 Зависимости существуют там, где артефакт, связанный с одним слоем, ссылается на артефакт, связанный с другим слоем. Например, класс в одном слое объявляет переменную, которая имеет класс в другом слое. Реконструировать существующие зависимости можно для артефактов, связанных со слоями в схеме.

> [!NOTE]
> Для определенных видов артефактов реконструировать зависимости невозможно. Например, зависимости не могут быть реконструированы из или в слой, связанный с текстовым файлом. Чтобы увидеть, какие артефакты имеют зависимости, которые можно реконструировать, откройте контекстное меню для одного или нескольких слоев и выберите **Просмотр ссылок**. В **обозреватель слоев**, изучите **поддержка проверки** столбца. Зависимости не будут реконструированы для артефактов, для которых в этом столбце отображается **False**.

- Выберите один или несколько слоев, откройте контекстное меню выбранного слоя и затем выберите **создать зависимости**.

  Как правило, на этом этапе можно увидеть некоторые зависимости, которых быть не должно. Эти зависимости можно изменить для соответствия предполагаемой структуре.

## <a name="EditDependencies"></a> Изменение слоев и зависимостей для отображения предполагаемой структуры
 Чтобы описать изменения, которые планируется внести в систему или предполагаемую архитектуру, измените диаграмму зависимостей.

|**Задача**|**Выполните следующие действия**|
|-|-|
|Изменить или ограничить направление зависимости|Задайте его **направление** свойство.|
|Создать новые зависимости|Используйте **зависимостей** и **Двунаправленная зависимость** средства.<br /><br /> Чтобы нарисовать несколько зависимостей, дважды щелкните средство. Когда вы закончите, нажмите кнопку **указатель** средство или нажмите клавишу **ESC** ключ.|
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве слоя **Запрещенные зависимости пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве слоя **Запрещенные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве слоя **обязательные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|

## <a name="EditLayout"></a> Изменение внешнего вида элементов на схеме
 Можно изменить размер, фигуру, цвет, положение слоев или цвет зависимостей, изменив их свойства.

## <a name="Codemaps"></a> Обнаружение закономерностей и зависимостей на карте кода
 При создании схемы зависимостей, можно также создать **карты кода**. Они помогают обнаружить закономерности и зависимости при анализе кода. Воспользуйтесь обозревателем решений, представлением классов или обозревателем объектов, чтобы изучить сборки, пространства имен и классы, которые часто находятся в точном соответствии с существующими слоями. Подробнее о картах кода читайте в следующих разделах:

-   [Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)

-   [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)

-   [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)

## <a name="see-also"></a>См. также

- [Поддержка выпуска для инструментов моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools)
- [Видео. Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)
- [Схемы зависимостей: Справочник по](../modeling/layer-diagrams-reference.md)
- [Схемы зависимостей: Рекомендации](../modeling/layer-diagrams-guidelines.md)
- [Проверка кода по схемам зависимостей](../modeling/validate-code-with-layer-diagrams.md)
- [Визуализация кода](../modeling/visualize-code.md)
