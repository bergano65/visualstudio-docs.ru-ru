---
title: Карты кода
description: Узнайте, как с помощью карт кода можно увидеть, как код соответствует друг другу, не считывая файлы и строки кода.
ms.custom: SEO-VS-2020
ms.date: 05/16/2018
ms.topic: how-to
f1_keywords:
- vs.progression.codemap
- vs.progression.standardgraphsdialog
helpviewer_keywords:
- DGML
- graph documents
- code visualization [Visual Studio]
- dependencies, visualizing
- dependency graphs
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 9723fd44aedf4950b99a49b62d421230b43d55fc
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99946531"
---
# <a name="map-dependencies-with-code-maps"></a>Сопоставление зависимостей с картами кода

Можно визуализировать зависимости в коде, создавая карту кода. Карты кода помогают увидеть, как код объединяется, не считывая файлы и строки кода.

![Просмотр зависимостей с помощью карт кода в Visual Studio](../modeling/media/codemapsmainintro.png)

Для создания и редактирования карт кода требуется Visual Studio Enterprise Edition. В выпусках Visual Studio Community и Professional можно открывать схемы, созданные в выпуске Enterprise Edition, но нельзя изменять их.

> [!NOTE]
> Перед предоставлением общего доступа к картам, созданным в Visual Studio Enterprise с другими пользователями, которые используют Visual Studio Professional, убедитесь, что все элементы на карте (такие как скрытые элементы, развернутые группы и связи между группами) видимы.

Сопоставлять зависимости в коде можно на следующих языках:

- Visual C# или Visual Basic в решении или сборках (*. dll* или *. exe*)

- Машинный или управляемый код C или C++ в Visual C++ проектах, файлах заголовков (*. h* или `#include` ) или двоичных файлах

- проекты и сборки X++, созданные из модулей .NET для Microsoft Dynamics AX.

> [!NOTE]
> Для проектов, отличных от C# или Visual Basic, существует меньше параметров для запуска карт кода или добавления элементов в существующую карту кода. Например, нельзя щелкнуть объект правой кнопкой мыши в редакторе текста проекта C++ и добавить его на карту кода. Однако можно перетаскивать отдельные элементы кода или файлы из **Обозреватель решений**, **представление классов** и **обозревателя объектов**.

## <a name="install-code-map-and-live-dependency-validation"></a>Установить карту кода и динамическую проверку зависимостей

Чтобы создать карту кода в Visual Studio, сначала установите компоненты " **Таблица кода** " и " **Динамическая проверка зависимостей** ":

1. Откройте **Visual Studio Installer**. Его можно открыть из меню "Пуск" Windows или в Visual Studio, выбрав **инструменты**  >  **получить средства и компоненты**.

1. Откройте вкладку **Отдельные компоненты**.

1. Прокрутите вниз до раздела " **средства кода** " и выберите " **карту кода** " и " **Динамическая проверка зависимостей**".

   ![Компоненты "Таблица кода" и "Динамическая проверка зависимостей" в Visual Studio Installer](media/modeling-components.png)

1. Нажмите кнопку **Изменить**.

   Компоненты " **Таблица кода** " и " **Динамическая проверка зависимостей** " начинают устанавливаться. Возможно, вам будет предложено закрыть Visual Studio.

## <a name="add-a-code-map"></a>Добавить карту кода

Можно создать пустую карту кода и перетащить на нее элементы, в том числе ссылки на сборки, файлы и папки, или создать карту кода для всего или части решения.

Чтобы добавить пустую карту кода, сделайте следующее:

1. В **обозревателе решений** откройте контекстное меню верхнего узла решения. Выберите **Добавить**  >  **новый элемент**.

2. В диалоговом окне **Добавление нового элемента** в разделе **установленные** выберите категорию **Общие** .

3. Выберите шаблон **документ направленного графа (DGML)** и нажмите кнопку **Добавить**.

   > [!TIP]
   > Этот шаблон может не отображаться в алфавитном порядке, поэтому прокрутите список до нижней части списка шаблонов, если он не отображается.

   В папке **элементы решения** решения отобразится пустая схема.

Аналогичным образом можно создать новый файл с картой кода, не добавляя его в решение, выбрав **архитектура**  >  **создать карту кода** или **файл**  >  **создать**  >  **файл**.

## <a name="generate-a-code-map-for-your-solution"></a>Создать карту кода для вашего решения

Чтобы просмотреть все зависимости в решении, выполните следующие действия.

1. В строке меню выберите **архитектура**  >  **создать карту кода для решения**. Если код не изменился со времени последнего построения, можно выбрать **архитектура**  >  **создать карту кода для решения без сборки** .

   ![Команда "Создать карту кода"](../modeling/media/codemapsarchitecturemenu.png)

   Создается сопоставление, показывающее сборки верхнего уровня и Объединенные ссылки между ними. Чем шире совокупная связь, тем больше зависимостей она представляет.

2. Чтобы открыть список значков, обозначающих различные типы проектов (такие как тестовый, веб- или телефонный проект), элементов кода (таких как классы, методы и свойства) и типов отношений (таких как «Наследует от», «"Реализует» и «Вызывает»), нажмите кнопку **Условные обозначения** .

   ![Граф зависимостей сборок верхнего уровня](../modeling/media/dependencygraph_toplevelassemblies.png)

   Решение в этом примере включает папки решений (**Тесты** и **Компоненты**), тестовые проекты, веб-проекты и сборки. По умолчанию все отношения вложения представляются в виде *групп*, которые можно развернуть и свернуть. Группа **Внешние** содержит объекты вне решения, в том числе зависимости платформы. Во внешних сборках отображаются только используемые элементы. Для удобства системные базовые типы на карте по умолчанию скрыты.

3. Чтобы детализировать карту, разверните группы, представляющие проекты и сборки. Чтобы развернуть все компоненты, выделите все узлы нажатием клавиш **CTRL+A** , а затем последовательно выберите в контекстном меню пункты **Группа** и **Развернуть** .

   ![Развертывание всех групп на карте кода](../modeling/media/codemapsexpandallgroups.png)

4. В большом решении это не пригодится. Более того, если решение комплексное, ограничения памяти могут не позволить развернуть все группы. Вместо этого разворачивайте отдельные интересующие вас узлы. Наведите указатель мыши на верхнюю часть узла и нажмите на значок шеврона (стрелка вниз), когда он появится.

   ![Развертывание узла на карте кода](../modeling/media/dependencygraph_containment.png)

   Или используйте клавиатуру, выбрав элемент и нажав клавишу «плюс» ( **+** ). Чтобы изучить более глубокие уровни кода, проделайте то же самое для пространств имен, типов и членов.

   > [!TIP]
   > Дополнительные сведения о работе с картами кода с помощью мыши, клавиатуры и сенсорного экрана см. в разделе [Обзор и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md).

5. Чтобы упростить карту и выделить ее отдельные части, выберите **Фильтры** на панели элементов в карте кода и отметьте только те типы узлов и связей, которые вас интересуют. Например, можно скрыть все контейнеры папки решения и сборки.

   ![Упростить карту путем фильтрации контейнеров](../modeling/media/codemapsfilterfoldersassemblies.png)

   Карты можно также упростить, скрыв или удалив отдельные группы и элементы, но не меняя базовый код решения.

6. Чтобы просмотреть отношения между элементами, выберите их на карте. Цвета связей обозначают типы отношений, как показано на панели **Условные обозначения** .

   ![Просмотр зависимостей во всех решениях](../modeling/media/codemapsmainintro.png)

   В этом примере фиолетовые связи обозначают вызовы, пунктирные — ссылки, а голубые — доступ к полю. Зеленые связи могут представлять наследование, а также *совокупные связи* , обозначающие сразу несколько видов отношений (или *категорий*).

   > [!TIP]
   > Если отображается зеленая связь, это не обязательно означает наличие только отношения наследования. Это могут быть также вызовы методов, но они скрыты за отношением наследования. Чтобы просмотреть определенные типы ссылок, используйте флажки на панели " **фильтры** ", чтобы скрыть ненужные типы.

7. Для получения дополнительных сведений об элементе или связи наведите указатель на элемент или связь и дождитесь появления подсказки. Подсказка будет содержать подробные сведения об элементе кода или представляемых связью категориях.

   ![Показать категории связи](../modeling/media/codemapsshowlinkcatgories.png)

8. Чтобы проверить элементы и зависимости, представленные совокупной связью, выберите связь и откройте ее контекстное меню. Выберите пункт **Показать добавляющие ссылки** (или **Показать добавляющие ссылки на новой карте кода**). Программа развернет группы на обоих концах связи и отобразит только те элементы и зависимости, которые участвуют в связи.

9. Чтобы сосредоточиться на конкретных частях схемы, можно продолжить удалять ненужные элементы. Например, чтобы получить детализированное представление класса и его членов, просто отфильтруйте все узлы пространства имен на панели **Фильтры** .

   ![Детализация до уровня классов и членов](../modeling/media/dependencygraph_expandedselectedgroups_2012.png)

10. Еще один способ концентрации в комплексном решении — это создать новую карту с выбранными элементами существующей карты. Удерживайте клавишу **CTRL** при выборе элементов, на которых нужно сосредоточиться, откройте контекстное меню и выберите пункт **создать диаграмму из выделенного фрагмента**.

    ![Показать выбранные элементы на новой карте кода](../modeling/media/codemapsshowonnewmap.png)

11. Выбранные элементы будут добавлены в новую карту вместе с контекстом. Скрыть папки решений и другие контейнеры, которые не должны отображаться с помощью панели " **фильтры** ".

    ![Фильтрация контейнеров для упрощения просмотра](../modeling/media/codemapsexpandnewgroups.png)

12. Разверните группы и выберите элементы на карте, чтобы просмотреть отношения.

    ![Выберите элементы для просмотра связей](../modeling/media/codemapsviewnewrelationships.png)

См. также:

- [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
- [Настройка карт кода путем редактирования DGML-файлов](../modeling/customize-code-maps-by-editing-the-dgml-files.md)
- Поиск потенциальных проблем в коде путем [запуска анализатора](../modeling/find-potential-problems-using-code-map-analyzers.md)

## <a name="view-specific-dependencies-in-a-code-map"></a>Просмотр конкретных зависимостей в карте кода

Предположим, что у вас есть проверка кода для выполнения в некоторых файлах с ожидающими изменениями. Чтобы просмотреть зависимости в этих изменениях, создайте карту кода на основе этих файлов.

   ![Показать конкретные зависимости на карте кода](../modeling/media/codemapsspecificdependenciesintro.png)

1. В **Обозреватель решений** выберите проекты, ссылки на сборки, папки, файлы, типы или элементы, которые необходимо сопоставлять.

   ![Выберите элементы, которые необходимо сопоставить](../modeling/media/codemapsselectinsolutionexplorer.png)

1. На панели инструментов **Обозреватель решений** нажмите кнопку **отобразить на карте кода** ![ создать новый граф из выбранных узлов ](../modeling/media/createnewgraphfromselectedbutton.gif) . Также можно открыть контекстное меню для одной или группы элементов и выбрать команду « **отобразить на карте кода**».

   Кроме того, можно перетаскивать элементы из **Обозреватель решений**, **представление классов** или **обозревателя объектов** в [новую](#add-a-code-map) или существующую карту кода. Чтобы включить родительскую иерархию для элементов, нажмите и удерживайте клавишу **CTRL** во время перетаскивания элементов или используйте кнопку **включить родителей** на панели инструментов карту кода, чтобы указать действие по умолчанию. Файлы сборки также можно перетаскивать извне Visual Studio, например из **проводника Windows**.

   > [!NOTE]
   > При добавлении элементов из проекта, который совместно используется несколькими приложениями, например Windows Phone или Microsoft Store, эти элементы отображаются на карте с активным проектом приложения. Если изменить контекст на другой проект приложения и добавить дополнительные элементы из общего проекта, эти элементы отобразятся на карте с новым активным проектом приложения. Операции, выполняемые с элементом на карте, применяются только к тем элементам, которые имеют общий контекст.

3. На картах кода выбранные элементы отображаются в сборках, частью которых они являются.

   ![Выбранные элементы показаны как группы на карте](../modeling/media/codemapsshowitemsfromsolnexplorer.png)

4. Для исследования элементов разверните их. Наведите указатель мыши на элемент и щелкните значок шеврона (стрелка вниз), когда он появится.

   ![Развертывание узла в карте кода](../modeling/media/dependencygraph_containment.png)

   Чтобы развернуть все элементы, выделите их с помощью **клавиши CTRL** + **A**, а затем откройте контекстное меню для этой схемы и выберите пункт **Группа**  >  **развернуть**. Этот параметр недоступен, если при развертывании всех групп карта кода станет непригодна к использованию или возникнут проблемы с памятью.

5. Продолжайте развертывать интересующие вас элементы, если это необходимо, на уровне класса и члена.

   ![Развернуть группы до уровня классов и членов](../modeling/media/codemapsexpandtoclassandmember.png)

   Чтобы просмотреть элементы, которые находятся в коде, но не отображаются на карте, щелкните значок повторно извлечь **дочерние элементы значок** повторной ![ выборки потомков ](../modeling/media/dependencygraph_deletednodesicon.png) в левом верхнем углу группы.

6. Для просмотра дополнительных элементов, связанных с элементами на карте, выделите нужный элемент и выберите команду **Показать связанные** на панели инструментов карты кода. После этого выберите тип связанных элементов, которые нужно добавить на карту. Кроме того, можно выбрать один или несколько элементов, открыть контекстное меню и выбрать параметр **Показывать** для типа связанных элементов, добавляемых на карту. Пример:

    Для **сборки** выберите пункт:

    |Параметр|Описание|
    |-|-|
    |**Показать сборки, на которые ссылается эта сборка**|Добавьте сборки, на которые ссылается данная сборка. Внешние сборки приводятся в группе **Внешние** .|
    |**Показать сборки, которые ссылаются на эту сборку**|Добавьте в решение сборки, которые ссылаются на данную сборку.|

    Для **пространства имен** выберите пункт **Показать содержащую сборку**, если она еще не открыта.

    Для **класса** или **интерфейса** выберите пункт:

    |Параметр|Описание|
    |-|-|
    |**Показать базовые типы**|Для класса добавьте базовый класс и реализованные интерфейсы.<br /><br /> Для интерфейса добавьте базовые интерфейсы.|
    |**Показать производные типы**|Для класса добавьте производные классы.<br /><br /> Для интерфейса добавьте производные интерфейсы и реализующие классы или структуры.|
    |**Показать типы, на которые ссылается этот тип**|Добавьте все классы и их члены, используемые данным классом.|
    |**Показать типы, которые ссылаются на этот тип**|Добавьте все классы и их члены, которые используют данный класс.|
    |**Показать содержащее пространство имен**|Добавьте родительское пространство имен.|
    |**Показать содержащие пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|
    |**Показать все базовые типы**|Рекурсивно добавьте иерархию базовых классов или интерфейсов.|
    |**Показать все производные типы**|Для класса рекурсивно добавьте все производные классы.<br /><br /> Для интерфейса рекурсивно добавьте все производные интерфейсы и реализующие классы или структуры.|

     Для **метода** выберите пункт:

    |Параметр|Описание|
    |-|-|
    |**Показать методы, вызываемые этим методом**|Добавьте методы, вызываемые данным методом.|
    |**Показать поля, на которые ссылается это поле**|Добавьте поля, на которые ссылается данный метод.|
    |**Показать содержащий тип**|Добавьте родительский тип.|
    |**Показать содержащие тип, пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|
    |**Показать переопределенные методы**|Для метода, переопределяющего другие методы или реализующего метод интерфейса, добавьте все абстрактные или виртуальные методы в переопределенные базовые классы и реализованный метод интерфейса (если имеется).|

     Для **поля** или **свойства** выберите пункт:

    |Параметр|Описание|
    |-|-|
    |**Показать содержащий тип**|Добавьте родительский тип.|
    |**Показать содержащие тип, пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|

    ![Показать методы, вызванные этим членом](../modeling/media/codemapsshowrelatedmethods.png)

7. На карте показаны отношения. В этом примере на карте показаны методы, вызываемые `Find` методом и их расположением в решении или извне.

   ![Показать конкретные зависимости на карте кода](../modeling/media/codemapsspecificdependenciesintro.png)

8. Чтобы упростить карту и выделить ее отдельные части, выберите **Фильтры** на панели элементов в карте кода и отметьте только те типы узлов и связей, которые вас интересуют. Например, отключите отображение папок решения, сборок и пространств имен.

   ![Используйте панель "Фильтр" для упрощения отображения.](../modeling/media/almcodemapfilterpane.png)

## <a name="see-also"></a>См. также раздел

- [Видео. Анализ разработки по коду через карты кода Visual Studio 2015](https://channel9.msdn.com/Events/Visual-Studio/Connect-event-2015/502)
- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)
- [Сопоставление методов в визуализации стека вызовов при отладке](../debugger/map-methods-on-the-call-stack-while-debugging-in-visual-studio.md)
- [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)
- [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
- [Настройка карт кода путем редактирования DGML-файлов](../modeling/customize-code-maps-by-editing-the-dgml-files.md)
