---
title: Карты кода
ms.date: 05/16/2018
ms.topic: conceptual
f1_keywords:
- vs.progression.codemap
- vs.progression.standardgraphsdialog
helpviewer_keywords:
- DGML
- graph documents
- code visualization [Visual Studio]
- dependencies, visualizing
- dependency graphs
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 30eb3183d261297295d9d6d3715f3683e4b6ee34
ms.sourcegitcommit: 21d667104199c2493accec20c2388cf674b195c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55950231"
---
# <a name="map-dependencies-with-code-maps"></a>Сопоставление зависимостей с помощью карт кода

Вы можете визуализировать зависимости в коде, создавая карты кода. Карты кода помогают увидеть, каким образом код сочетается друг с другом без чтения файлов и строк кода.

![Просмотр зависимостей с помощью карт кода в Visual Studio](../modeling/media/codemapsmainintro.png)

Создание и изменение карты кода, необходим выпуск Visual Studio Enterprise. В Visual Studio Community и Professional Edition можно открыть диаграммы, которые были созданы в выпуске Enterprise edition, но не позволяет их редактировать.

> [!NOTE]
> Перед предоставлением доступа карты, созданные в Visual Studio Enterprise с другими пользователями, которые используют Visual Studio Professional, убедитесь, что отображаются все элементы на карте (например, скрытые элементы, развернутые группы и связи между группами).

Можно сопоставить зависимости в коде на следующих языках:

- Visual C# или Visual Basic в решении или сборках (*.dll* или *.exe*)

- Машинный или управляемый код C или C++ в проектах Visual C++, файлы заголовков (*.h* или `#include`), или двоичные файлы

- проекты и сборки X++, созданные из модулей .NET для Microsoft Dynamics AX.

> [!NOTE]
> Для проектов, отличных от C# или Visual Basic доступно меньше способов создания карты кода или добавления элементов в существующую карту кода. Например, нельзя щелкнуть объект правой кнопкой мыши в редакторе текста проекта C++ и добавить его на карту кода. Тем не менее, можно перетащить и удаление отдельных элементов кода или файлы из **обозревателе решений**, **представление классов**, и **обозреватель объектов**.

## <a name="install-code-map-and-live-dependency-validation"></a>Схема установки кода и Динамическая проверка зависимостей

Чтобы создать карту кода в Visual Studio 2017, сначала нужно установить **карта кода** и **динамическую проверку зависимостей** компоненты:

1. Откройте **установщик Visual Studio**. Его можно открыть из меню Windows Пуск или в среде Visual Studio, выбрав **средства** > **получить средства и компоненты**.

1. Откройте вкладку **Отдельные компоненты**.

1. Прокрутите вниз до раздела **средства кода** и выберите **карта кода** и **динамическую проверку зависимостей**.

   ![Карта кода и динамическую проверку зависимостей компонентов в Visual Studio Installer](media/modeling-components.png)

1. Нажмите кнопку **Изменить**.

   **Карта кода** и **динамическую проверку зависимостей** компоненты начать установку. Может потребоваться закрыть Visual Studio.

## <a name="add-a-code-map"></a>Добавить карту кода

Можно создать пустой карты кода и перетащить элементы на него, включая ссылки на сборки, файлы и папки, или можно создать карту кода для всех или части вашего решения.

Чтобы добавить пустую карту кода:

1. В **обозревателе решений**откройте контекстное меню верхнего узла решения. Выберите **добавить** > **новый элемент**.

2. В **Добавление нового элемента** диалогового окна в разделе **установленные**, выберите **Общие** категории.

3. Выберите **направленный граф Document(.dgml)** шаблона, а затем выберите **добавить**.

   > [!TIP]
   > Поэтому этот шаблон может не отображаться в алфавитном порядке, прокрутите вниз до нижней части списка шаблонов, если вы не видите.

   Пустую карту кода появится в вашем решении **элементы решения** папки.

Аналогично, можно создать новый файл карты кода без добавления ее в решение, выбрав **архитектура** > **новой карте кода** или **файл**  >  **Новый** > **файл**.

## <a name="generate-a-code-map-for-your-solution"></a>Создать карту кода для решения

Для просмотра всех зависимостей в решении:

1. В строке меню выберите **архитектура** > **создать карту кода для решения**. Если код не изменился с момента последней сборки ее, вы можете выбрать **архитектура** > **создать карту кода для решения без сборки** вместо этого.

   ![Команда "Создать карту кода"](../modeling/media/codemapsarchitecturemenu.png)

   Схема будет создана, показывающий со сборками верхнего уровня и совокупными связями между ними. Чем шире совокупная связь, тем больше зависимостей она представляет.

2. Чтобы открыть список значков, обозначающих различные типы проектов (такие как тестовый, веб- или телефонный проект), элементов кода (таких как классы, методы и свойства) и типов отношений (таких как «Наследует от», «"Реализует» и «Вызывает»), нажмите кнопку **Условные обозначения** .

   ![Граф зависимостей сборок верхнего уровня](../modeling/media/dependencygraph_toplevelassemblies.png)

   Решение в этом примере включает папки решений (**Тесты** и **Компоненты**), тестовые проекты, веб-проекты и сборки. По умолчанию все отношения вложения представляются в виде *групп*, которые можно развернуть и свернуть. Группа **Внешние** содержит объекты вне решения, в том числе зависимости платформы. Во внешних сборках отображаются только используемые элементы. Для удобства системные базовые типы на карте по умолчанию скрыты.

3. Чтобы детализировать карту, разверните группы, представляющие проекты и сборки. Чтобы развернуть все компоненты, выделите все узлы нажатием клавиш **CTRL+A** , а затем последовательно выберите в контекстном меню пункты **Группа**и **Развернуть** .

   ![Развертывание всех групп на карте кода](../modeling/media/codemapsexpandallgroups.png)

4. В большом решении это не пригодится. Более того, если решение комплексное, ограничения памяти могут не позволить развернуть все группы. Вместо этого разворачивайте отдельные интересующие вас узлы. Наведите указатель мыши на верхнюю часть узла и нажмите на значок шеврона (стрелка вниз), когда он появится.

   ![Развертывание узла на карте кода](../modeling/media/dependencygraph_containment.png)

   Также можно выбрать нужный элемент с помощью клавиатуры и нажать клавишу **+**. Чтобы изучить более глубокие уровни кода, проделайте то же самое для пространств имен, типов и членов.

   > [!TIP]
   > Дополнительные сведения о работе с кодом сопоставляется с помощью мыши, клавиатуры и жестов см. раздел [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md).

5. Чтобы упростить карту и выделить ее отдельные части, выберите **Фильтры** на панели элементов в карте кода и отметьте только те типы узлов и связей, которые вас интересуют. Например, можно скрыть все контейнеры папки решения и сборки.

   ![Упростить карту путем фильтрации контейнеров](../modeling/media/codemapsfilterfoldersassemblies.png)

   Карты можно также упростить, скрыв или удалив отдельные группы и элементы, но не меняя базовый код решения.

6. Чтобы просмотреть отношения между элементами, выберите их на карте. Цвета связей обозначают типы отношений, как показано на панели **Условные обозначения** .

   ![Просмотр зависимостей во всех решениях](../modeling/media/codemapsmainintro.png)

   В этом примере фиолетовые связи обозначают вызовы, пунктирные — ссылки, а голубые — доступ к полю. Зеленые связи могут представлять наследование, а также *совокупные связи* , обозначающие сразу несколько видов отношений (или *категорий*).

   > [!TIP]
   > Если отображается зеленая связь, это не обязательно означает наличие только отношения наследования. Это могут быть также вызовы методов, но они скрыты за отношением наследования. Чтобы просмотреть определенные типы связей, используйте флажки в **фильтры** панели, чтобы скрыть типы, которые вас не интересуют.

7. Для получения дополнительных сведений об элементе или связи наведите указатель на элемент или связь и дождитесь появления подсказки. Подсказка будет содержать подробные сведения об элементе кода или представляемых связью категориях.

   ![Показать категории связи](../modeling/media/codemapsshowlinkcatgories.png)

8. Чтобы проверить элементы и зависимости, представленные совокупной связью, выберите связь и откройте ее контекстное меню. Выберите пункт **Показать добавляющие ссылки** (или **Показать добавляющие ссылки на новой карте кода**). Программа развернет группы на обоих концах связи и отобразит только те элементы и зависимости, которые участвуют в связи.

9. Сфокусироваться на определенных фрагментах карты, вы можете удалить элементы, которые вас не интересуют. Например, чтобы получить детализированное представление класса и его членов, просто отфильтруйте все узлы пространства имен на панели **Фильтры** .

   ![Детализация до уровня классов и членов](../modeling/media/dependencygraph_expandedselectedgroups_2012.png)

10. Еще один способ концентрации в комплексном решении — это создать новую карту с выбранными элементами существующей карты. Удерживайте **Ctrl** элементы, которые необходимо сосредоточиться на, откройте контекстное меню и выберите **новый граф по выделенному**.

    ![Показать выбранные элементы на новой карте кода](../modeling/media/codemapsshowonnewmap.png)

11. Выбранные элементы будут добавлены в новую карту вместе с контекстом. Скройте папки решений и другие контейнеры, вы не хотите см. в разделе с помощью **фильтры** области.

    ![Фильтрация контейнеров для упрощения просмотра](../modeling/media/codemapsexpandnewgroups.png)

12. Разверните группы и выберите элементы на карте, чтобы просмотреть отношения.

    ![Выберите элементы для просмотра связей](../modeling/media/codemapsviewnewrelationships.png)

См. также:

- [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
- [Настройка карт кода путем редактирования DGML-файлов](../modeling/customize-code-maps-by-editing-the-dgml-files.md)
- Поиск потенциальных проблем в коде, [работу анализатора](../modeling/find-potential-problems-using-code-map-analyzers.md)

## <a name="view-specific-dependencies-in-a-code-map"></a>Просмотр конкретных зависимостей в карте кода

Предположим, что у вас есть проверки кода для выполнения в некоторых файлах с ожидающими изменениями. Чтобы просмотреть зависимости в этих изменениях, создайте карту кода на основе этих файлов.

   ![Показать конкретные зависимости на карте кода](../modeling/media/codemapsspecificdependenciesintro.png)

1. В **обозревателе решений**, выберите проекты, ссылки на сборки, папки, файлы, типы или члены, которые необходимо сопоставить.

   ![Выберите элементы, которые необходимо сопоставить](../modeling/media/codemapsselectinsolutionexplorer.png)

1. На **обозревателе решений** панели инструментов выберите **Показать на карте кода** ![создать кнопка "создать граф из выбранных узлов"](../modeling/media/createnewgraphfromselectedbutton.gif). Или, откройте контекстное меню для одного или нескольких элементов и выберите **Показать на карте кода**.

   Можно также перетаскивать элементы из **обозревателе решений**, **представление классов**, или **обозреватель объектов**, в [новый](#add-a-code-map) или сопоставить существующего кода. Чтобы включить родительскую иерархию для элементов, нажмите и удерживайте **Ctrl** перетащите элементы, или нажмите **включить родительские элементы** кнопку на панели инструментов карты кода, чтобы указать действие по умолчанию. Можно также перетащить файлы сборки вне Visual Studio, такие как из **Windows Explorer**.

   > [!NOTE]
   > При добавлении элементов из проекта, который является общим для нескольких приложений, например Windows Phone или Microsoft Store, эти элементы отобразятся на карте с текущим активным проектом приложения. Если изменить контекст на другой проект приложения и добавить дополнительные элементы из общего проекта, эти элементы отобразятся на карте с новым активным проектом приложения. Операции, выполняемые с элементом на карте, применяются только к тем элементам, которые имеют общий контекст.

3. На картах кода выбранные элементы отображаются в сборках, частью которых они являются.

   ![Выбранные элементы показаны как группы на карте](../modeling/media/codemapsshowitemsfromsolnexplorer.png)

4. Для исследования элементов разверните их. Наведите указатель мыши на элемент и щелкните значок шеврона (стрелка вниз), когда он появится.

   ![Разверните узел на карте кода](../modeling/media/dependencygraph_containment.png)

   Чтобы развернуть все элементы, выберите их с помощью **Ctrl**+**объект**, затем откройте контекстное меню для карты и выберите **группы**  >   **Разверните**. Этот параметр недоступен, если при развертывании всех групп карта кода станет непригодна к использованию или возникнут проблемы с памятью.

5. По-прежнему разверните элементы, которые вас интересуют, вплоть до уровня классов и членов, при необходимости.

   ![Развернуть группы до уровня классов и членов](../modeling/media/codemapsexpandtoclassandmember.png)

   Чтобы просмотреть элементы, которые существуют в коде, но не отображаются на карте, щелкните **повторно извлечь дочерние элементы** значок ![повторно извлечь дочерние элементы значок](../modeling/media/dependencygraph_deletednodesicon.png) в левом верхнем углу группы.

6. Для просмотра дополнительных элементов, связанных с элементами на карте, выделите нужный элемент и выберите команду **Показать связанные** на панели инструментов карты кода. После этого выберите тип связанных элементов, которые нужно добавить на карту. Кроме того, выберите один или несколько элементов, откройте контекстное меню и выберите **Показать** параметр для типа связанных элементов для добавления к карте. Пример:

    Для **сборки**выберите пункт:

    |||
    |-|-|
    |**Показать сборки, на которые ссылается эта сборка**|Добавьте сборки, на которые ссылается данная сборка. Внешние сборки приводятся в группе **Внешние** .|
    |**Показать сборки, которые ссылаются на эту сборку**|Добавьте в решение сборки, которые ссылаются на данную сборку.|

    Для **пространства имен**выберите пункт **Показать содержащую сборку**, если она еще не открыта.

    Для **класса** или **интерфейса**выберите пункт:

    |||
    |-|-|
    |**Показать базовые типы**|Для класса добавьте базовый класс и реализованные интерфейсы.<br /><br /> Для интерфейса добавьте базовые интерфейсы.|
    |**Показать производные типы**|Для класса добавьте производные классы.<br /><br /> Для интерфейса добавьте производные интерфейсы и реализующие классы или структуры.|
    |**Показать типы, на которые ссылается этот тип**|Добавьте все классы и их члены, используемые данным классом.|
    |**Показать типы, которые ссылаются на этот тип**|Добавьте все классы и их члены, которые используют данный класс.|
    |**Показать содержащее пространство имен**|Добавьте родительское пространство имен.|
    |**Показать содержащие пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|
    |**Показать все базовые типы**|Рекурсивно добавьте иерархию базовых классов или интерфейсов.|
    |**Показать все производные типы**|Для класса рекурсивно добавьте все производные классы.<br /><br /> Для интерфейса рекурсивно добавьте все производные интерфейсы и реализующие классы или структуры.|

     Для **метода**выберите пункт:

    |||
    |-|-|
    |**Показать методы, вызываемые этим методом**|Добавьте методы, вызываемые данным методом.|
    |**Показать поля, на которые ссылается это поле**|Добавьте поля, на которые ссылается данный метод.|
    |**Показать содержащий тип**|Добавьте родительский тип.|
    |**Показать содержащие тип, пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|
    |**Показать переопределенные методы**|Для метода, переопределяющего другие методы или реализующего метод интерфейса, добавьте все абстрактные или виртуальные методы в переопределенные базовые классы и реализованный метод интерфейса (если имеется).|

     Для **поля** или **свойства**выберите пункт:

    |||
    |-|-|
    |**Показать содержащий тип**|Добавьте родительский тип.|
    |**Показать содержащие тип, пространство имен и сборку**|Добавьте родительскую иерархию контейнера.|

    ![Показать методы, вызванные этим членом](../modeling/media/codemapsshowrelatedmethods.png)

7. На карте показаны отношения. В этом примере на карте показаны методы, вызываемые `Find` метод и их расположение в решении или извне.

   ![Показать конкретные зависимости на карте кода](../modeling/media/codemapsspecificdependenciesintro.png)

8. Чтобы упростить карту и выделить ее отдельные части, выберите **Фильтры** на панели элементов в карте кода и отметьте только те типы узлов и связей, которые вас интересуют. Например, отключите отображение папок решения, сборок и пространств имен.

   ![Используйте панель "Фильтр" для упрощения отображения.](../modeling/media/almcodemapfilterpane.png)

## <a name="see-also"></a>См. также

- [Видео. Понимание разработки из кода с помощью карт кода Visual Studio 2015](https://channel9.msdn.com/Events/Visual-Studio/Connect-event-2015/502)]
- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)
- [Сопоставление методов в стеке вызовов при отладке](../debugger/map-methods-on-the-call-stack-while-debugging-in-visual-studio.md)
- [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)
- [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
- [Настройка карт кода путем редактирования DGML-файлов](../modeling/customize-code-maps-by-editing-the-dgml-files.md)
