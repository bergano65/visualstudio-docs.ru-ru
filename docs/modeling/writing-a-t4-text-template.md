---
title: Написание текстового шаблона T4
description: Сведения о текстовых шаблонах T4 и написании текстового шаблона, включающего директивы, текстовые блоки и управляющие блоки.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, syntax
- text templates, guide
- text templates, functions that generate text
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: eb988854cb1bc049e024bf204553dd715e652a4e
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99923988"
---
# <a name="writing-a-t4-text-template"></a>Написание текстового шаблона T4
Текстовый шаблон содержит текст, который будет создан на его основе. Например, шаблон, создающий веб-страницу, будет содержать " \<html> ..." и все остальные стандартные части HTML-страницы. В шаблон вставлены *управляющие блоки*, которые являются фрагментами программного кода. Блоки управления обеспечивают варьирующиеся значения и обеспечивают условность и повторяемость текста.

 Эта структура упрощает разработку шаблона, так как можно начать с прототипа созданного файла и постепенно вставлять блоки управления, которые будут обеспечивать изменение результата.

 Текстовые шаблоны состоят из следующих частей.

- **Директивы** — элементы, управляющие обработкой шаблона.

- **Текстовые блоки** — содержимое, которое копируется непосредственно в выходные данные.

- **Управляющие блоки** — программный код, который вставляет значения переменных в текст и управляет условными или повторяющимися частями текста.

Чтобы испытать примеры в этом разделе, скопируйте их в файл шаблона, как описано в статье [Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md). После редактирования файла шаблона сохраните его, а затем просмотрите файл Output **. txt** .

## <a name="directives"></a>Директивы
 Директивы текстовых шаблонов предоставляют общие инструкции модулю текстовых шаблонов в отношении порядка создания кода преобразования и выходного файла.

 Например, следующая директива указывает, что выходной файл должен иметь расширение .TXT.

```
<#@ output extension=".txt" #>
```

 Дополнительные сведения об директивах см. в разделе [директивы текстового шаблона T4](../modeling/t4-text-template-directives.md).

## <a name="text-blocks"></a>Текстовые блоки
 Текстовый блок вставляет текст непосредственно в выходной файл. Для текстовых блоков нет особых правил форматирования. Например, следующий текстовый шаблон создаст текстовый файл со словом "Hello":

```
<#@ output extension=".txt" #>
Hello
```

## <a name="control-blocks"></a>Блоки управления
 Блоки управления — это части программного кода, которые используются для преобразования шаблонов. Язык по умолчанию — C#, поэтому для использования [!INCLUDE[vbprvb](../code-quality/includes/vbprvb_md.md)] можно вставить в начало файла эту директиву:

```
<#@ template language="VB" #>
```

 Язык, на котором вы будете писать код в блоках управления, не связан с языком создаваемого текста.

### <a name="standard-control-blocks"></a>Стандартные блоки управления
 Стандартный блок управления представляет собой раздел программного кода, который создает часть выходного файла.

 В файле шаблона можно смешивать любое число блоков текста и стандартных блоков управления. При этом нельзя помещать один блок управления в другой. Каждый стандартный блок управления отделяется символами `<# ... #>`.

 Например, следующий блок управления и текстовый блок создают выходной файл, который содержит строку "0, 1, 2, 3, 4 Hello!":

```
<#
    for(int i = 0; i < 4; i++)
    {
        Write(i + ", ");
    }
    Write("4");
#> Hello!
```

 Вместо использования явных операторов `Write()`, можно чередовать текст и код. В следующем примере выводится текст "Hello!" четыре раза:

```
<#
    for(int i = 0; i < 4; i++)
    {
#>
Hello!
<#
    }
#>
```

 Можно вставить блок текста в любое место кода, где допускается вставка оператора `Write();`.

> [!NOTE]
> При внедрении текстового блока в составной оператор, такой как цикл или условный, всегда используйте фигурные скобки {...} для размещения текстового блока.

### <a name="expression-control-blocks"></a>Блоки управления выражениями
 Блок управления выражением оценивает выражение и преобразует его в строку, которая вставляется в выходной файл.

 Блоки управления выражениями разделяются символами `<#= ... #>`

 Например, следующий блок управления задает, что выходной файл будет содержать "5":

```
<#= 2 + 3 #>
```

 Обратите внимание, что открывающий символ содержит три символа "< # =".

 Это выражение может включать любую переменную в области. Например, этот блок печатает строки цифр:

```
<#@ output extension=".txt" #>
<#
    for(int i = 0; i < 4; i++)
    {
#>
This is hello number <#= i+1 #>: Hello!
<#
    }
#>
```

### <a name="class-feature-control-blocks"></a>Блоки управления возможностями класса
 Блок управления возможностями класса определяет свойства, методы или другой код, который не должен включаться в основное преобразование. Блоки возможностей класса часто используются для написания возможностей вспомогательных приложений.  Как правило, блоки функций класса помещаются в отдельные файлы, чтобы их можно было [включать](#Include) в более чем один текстовый шаблон.

 Блоки управления возможностями класса разделяются символами `<#+ ... #>`.

 Например, следующий файл шаблона объявляет и использует метод:

```
<#@ output extension=".txt" #>
Squares:
<#
    for(int i = 0; i < 4; i++)
    {
#>
    The square of <#= i #> is <#= Square(i+1) #>.
<#
    }
#>
That is the end of the list.
<#+   // Start of class feature block
private int Square(int i)
{
    return i*i;
}
#>
```

 Возможности класса необходимо помещать в конец файла, в котором они написаны. Однако можно включить файл (используя `<#@include#>`), содержащий возможность класса, даже если за директивой `include` следует текст и стандартные блоки.

 Дополнительные сведения о блоках управления см. в разделе [блоки управления текстовыми шаблонами](../modeling/text-template-control-blocks.md).

### <a name="class-feature-blocks-can-contain-text-blocks"></a>Блоки возможностей класса могут содержать текстовые блоки
 Вы можете написать метод, создающий текст. Пример:

```
List of Squares:
<#
   for(int i = 0; i < 4; i++)
   {  WriteSquareLine(i); }
#>
End of list.
<#+   // Class feature block
private void WriteSquareLine(int i)
{
#>
   The square of <#= i #> is <#= i*i #>.
<#+
}
#>
```

 Особенно полезным будет поместить метод, создающий текст, в отдельный файл, который можно будет включить в несколько шаблонов.

## <a name="using-external-definitions"></a>Использование внешних определений

### <a name="assemblies"></a>Сборки
 Блоки кода шаблона могут использовать типы, определенные в наиболее часто используемых сборках .NET, таких как System.dll. Кроме того, можно добавить ссылку на другие сборки .NET или ваши собственные. Можно предоставить путь или строгое имя сборки:

```
<#@ assembly name="System.Xml" #>
```

 Необходимо использовать абсолютные пути или стандартные имена макросов в пути. Пример:

```
<#@ assembly name="$(SolutionDir)library\MyAssembly.dll" #>
```

 Директива assembly не влияет на [предварительно обработанный текстовый шаблон](../modeling/run-time-text-generation-with-t4-text-templates.md).

 Дополнительные сведения см. в разделе [директива сборки T4](../modeling/t4-assembly-directive.md).

### <a name="namespaces"></a>Пространства имен
 Директива import соответствует выражению `using` в C# или выражению `imports` в Visual Basic. Она позволяет ссылаться на типы в коде, не используя полное имя:

```
<#@ import namespace="System.Xml" #>
```

 Число используемых директив `assembly` и `import` не ограничено. Их нужно размещать до блоков управления и текста.

 Дополнительные сведения см. в разделе [Директива импорта T4](../modeling/t4-import-directive.md).

### <a name="including-code-and-text"></a><a name="Include"></a> Включение кода и текста
 Директива `include` вставляет текст из другого файла шаблона. Например, эта директива вставляет содержимое файла `test.txt`:

```
<#@ include file="c:\test.txt" #>
```

 Включенное содержимое обрабатывается почти так же, как если бы оно было частью включающего текстового шаблона. При этом можно включить файл, содержащий блок возможностей класса `<#+...#>`, даже если за директивой include следуют обычный текст и стандартные блоки управления.

 Дополнительные сведения см. в разделе [директива T4 include](../modeling/t4-include-directive.md).

### <a name="utility-methods"></a>Служебные методы
 Существует несколько методов, таких как `Write()`, которые всегда можно использовать в блоке управления. Они включают методы, помогающие создать отступы для вывода или отчеты об ошибках.

 Кроме того, вы можете создать собственный набор служебных методов.

 Дополнительные сведения см. в разделе [служебные методы для текстовых шаблонов](../modeling/text-template-utility-methods.md).

## <a name="transforming-data-and-models"></a>Преобразование данных и моделей
 Наиболее полезная сфера применения текстовых шаблонов — создание материалов на основе содержимого источника, такого как модель, база данных или файл данных. Шаблон извлекает данные и изменяет их формат. Коллекция шаблонов может преобразовать подобный источник в несколько файлов.

 Существует несколько способов считывания исходного файла.

 **Считывает файл в текстовом шаблоне**. Это самый простой способ получения данных в шаблоне:

```
<#@ import namespace="System.IO" #>
<# string fileContent = File.ReadAllText(@"C:\myData.txt"); ...
```

 **Загрузка файла в качестве модели с возможностью навигации**. Более эффективный способ — это чтение данных как модели, по которой может перемещаться код текстового шаблона. Например, можно загрузить XML-файл и выполнять навигацию по этому файлу с помощью выражений XPath. Можно также использовать [xsd.exe](/dotnet/standard/serialization/xml-schema-definition-tool-xsd-exe) для создания набора классов, с помощью которых можно считывать XML-данные.

 **Измените файл модели на диаграмме или в форме.** [!INCLUDE[dsl](../modeling/includes/dsl_md.md)] предоставляет средства, позволяющие изменять модель в виде диаграммы или формы Windows. Это упрощает обсуждение модели с пользователями созданного приложения. [!INCLUDE[dsl](../modeling/includes/dsl_md.md)] также создает набор строго типизированных классов, отражающих структуру модели. Дополнительные сведения см. в разделе [Создание кода на основе языка Domain-Specific](../modeling/generating-code-from-a-domain-specific-language.md).

### <a name="relative-file-paths-in-design-time-templates"></a>Относительные пути файлов в шаблонах времени разработки
 В [текстовом шаблоне времени разработки](../modeling/design-time-code-generation-by-using-t4-text-templates.md), если требуется сослаться на файл в расположении относительно текстового шаблона, используйте `this.Host.ResolvePath()` . Кроме того, необходимо задать выражение `hostspecific="true"` в директиве `template`:

```
<#@ template hostspecific="true" language="C#" #>
<#@ output extension=".txt" #>
<#@ import namespace="System.IO" #>
<#
 // Find a path within the same project as the text template:
 string myFile = File.ReadAllText(this.Host.ResolvePath("MyFile.txt"));
#>
Content of MyFile.txt is:
<#= myFile #>
```

Можно также получить другие службы, предоставляемые узлом. Дополнительные сведения см. в разделе [доступ к Visual Studio или другим узлам из шаблона](/previous-versions/visualstudio/visual-studio-2010/gg604090\(v\=vs.100\)).

### <a name="design-time-text-templates-run-in-a-separate-appdomain"></a>Текстовые шаблоны времени разработки выполняются в отдельном домене приложения

 Следует иметь в виду, что [текстовый шаблон времени разработки](../modeling/design-time-code-generation-by-using-t4-text-templates.md) выполняется в домене приложения, отдельном от основного приложения. В большинстве случаев это неважно, однако вы можете столкнуться с ограничениями в некоторых сложных случаях. Например, если нужно передать данные в шаблон или из него, используя отдельную службу, эта служба должна предоставить сериализуемый API.

 (Это не верно для [текстового шаблона времени выполнения](../modeling/run-time-text-generation-with-t4-text-templates.md), который предоставляет код, компилируемый вместе с остальной частью кода.)

## <a name="editing-templates"></a>Редактирование шаблонов
 Специализированные редакторы текстовых шаблонов можно загрузить из каталога диспетчера расширений в Интернете. В меню **Сервис** выберите пункт **Диспетчер расширений**. Щелкните **Интернет-коллекция** и воспользуйтесь средством поиска.

## <a name="related-topics"></a>Связанные разделы

|Задача|Раздел|
|-|-|
|Создание шаблона.|[Рекомендации по написанию текстовых шаблонов T4](../modeling/guidelines-for-writing-t4-text-templates.md)|
|Создание текста с помощью программного кода.|[Структура текстового шаблона](../modeling/writing-a-t4-text-template.md)|
|Создание файлов в решении Visual Studio.|[Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md)|
|Выполняйте создание текста за пределами Visual Studio.|[Создание файлов с помощью служебной программы TextTransform](../modeling/generating-files-with-the-texttransform-utility.md)|
|Преобразование данных в форме доменного языка.|[Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md)|
|Написание процессоров директив для преобразования собственных источников данных.|[Настройка преобразования текста T4](../modeling/customizing-t4-text-transformation.md)|
