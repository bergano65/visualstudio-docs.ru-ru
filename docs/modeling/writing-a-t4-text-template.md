---
title: "Написание текстового шаблона T4 | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- text templates, syntax
- text templates, guide
- text templates, functions that generate text
author: gewarren
ms.author: gewarren
manager: ghogen
ms.workload: multiple
ms.openlocfilehash: ee218f119d8c996c1be72ff911735c271df44e98
ms.sourcegitcommit: f89ed5fc2e5078213e30a6ade4604e34df48181f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2018
---
# <a name="writing-a-t4-text-template"></a>Написание текстового шаблона T4
Текстовый шаблон содержит текст, который будет создан на его основе. Например, шаблон, создающий веб-страницы будет содержать "\<html > …» и все прочие стандартные части HTML-страницы. Вставляемые в шаблон, *блоки управления*, они являются фрагментами программного кода. Блоки управления обеспечивают варьирующиеся значения и обеспечивают условность и повторяемость текста.  
  
 Эта структура упрощает разработку шаблона, так как можно начать с прототипа созданного файла и постепенно вставлять блоки управления, которые будут обеспечивать изменение результата.  
  
 Текстовые шаблоны состоят из следующих частей.  
  
-   **Директивы** -элементы, определяющие способ обработки шаблона.  
  
-   **Текстовые блоки** - содержимого, который копируется напрямую в выходных данных.  
  
-   **Блоки управления** -программный код, который вставляет значения переменных в текст и контролирует условные или повторяемые части текста.  
  
 Чтобы испытать в примерах в этом разделе, скопируйте их в файл шаблона, как описано в [создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md). После редактирования файла шаблона, сохраните его и затем просмотрите выходные данные **.txt** файла.  
  
## <a name="directives"></a>Директивы  
 Директивы текстовых шаблонов предоставляют общие инструкции модулю текстовых шаблонов в отношении порядка создания кода преобразования и выходного файла.  
  
 Например, следующая директива указывает, что выходной файл должен иметь расширение .TXT.  
  
```  
  
<#@ output extension=".txt" #>  
```  
  
 Дополнительные сведения о директивах см. в разделе [директивы текстовых шаблонов T4](../modeling/t4-text-template-directives.md).  
  
## <a name="text-blocks"></a>Текстовые блоки  
 Текстовый блок вставляет текст непосредственно в выходной файл. Для текстовых блоков нет особых правил форматирования. Например, следующий текстовый шаблон создаст текстовый файл со словом "Hello":  
  
```  
<#@ output extension=".txt" #>  
Hello  
```  
  
## <a name="control-blocks"></a>Блоки управления  
 Блоки управления — это части программного кода, которые используются для преобразования шаблонов. Язык по умолчанию — C#, поэтому для использования [!INCLUDE[vbprvb](../code-quality/includes/vbprvb_md.md)] можно вставить в начало файла эту директиву:  
  
```  
<#@ template language="VB" #>  
```  
  
 Язык, на котором вы будете писать код в блоках управления, не связан с языком создаваемого текста.  
  
### <a name="standard-control-blocks"></a>Стандартные блоки управления  
 Стандартный блок управления представляет собой раздел программного кода, который создает часть выходного файла.  
  
 В файле шаблона можно смешивать любое число блоков текста и стандартных блоков управления. При этом нельзя помещать один блок управления в другой. Каждый стандартный блок управления отделяется символами `<# ... #>`.  
  
 Например, следующий блок управления и текстовый блок создают выходной файл, который содержит строку "0, 1, 2, 3, 4 Hello!":  
  
```  
  
      <#  
    for(int i = 0; i < 4; i++)  
    {  
        Write(i + ", ");  
    }  
    Write("4");  
#> Hello!  
```  
  
 Вместо использования явных операторов `Write()`, можно чередовать текст и код. В следующем примере выводится «Hello!» четыре раза:  
  
```  
<#  
    for(int i = 0; i < 4; i++)  
    {  
#>  
Hello!  
<#  
    }   
#>  
```  
  
 Можно вставить блок текста в любое место кода, где допускается вставка оператора `Write();`.  
  
> [!NOTE]
>  При внедрении блока текста в составной оператор, такой как цикл или условный, всегда используйте фигурные скобки {...} Чтобы задать текстового блока.  
  
### <a name="expression-control-blocks"></a>Блоки управления выражениями  
 Блок управления выражением оценивает выражение и преобразует его в строку, которая вставляется в выходной файл.  
  
 Блоки управления выражениями разделяются символами `<#= ... #>`  
  
 Например, следующий блок управления задает, что выходной файл будет содержать "5":  
  
```  
<#= 2 + 3 #>  
```  
  
 Обратите внимание, что открывающий символ включает три знака: "<#=".  
  
 Это выражение может включать любую переменную в области. Например, этот блок печатает строки цифр:  
  
```  
<#@ output extension=".txt" #>  
<#  
    for(int i = 0; i < 4; i++)  
    {  
#>  
This is hello number <#= i+1 #>: Hello!  
<#  
    }   
#>  
```  
  
### <a name="class-feature-control-blocks"></a>Блоки управления возможностями класса  
 Блок управления возможностями класса определяет свойства, методы или другой код, который не должен включаться в основное преобразование. Блоки возможностей класса часто используются для написания возможностей вспомогательных приложений.  Как правило, блоки возможностей класса помещаются в отдельные файлы, чтобы их можно было [включены](#Include) в несколько текстовых шаблонов.  
  
 Блоки управления возможностями класса разделяются символами `<#+ ... #>`.  
  
 Например, следующий файл шаблона объявляет и использует метод:  
  
```  
<#@ output extension=".txt" #>  
Squares:  
<#  
    for(int i = 0; i < 4; i++)  
    {  
#>  
    The square of <#= i #> is <#= Square(i+1) #>.  
<#  
    }   
#>  
That is the end of the list.  
<#+   // Start of class feature block  
private int Square(int i)  
{  
    return i*i;  
}  
#>  
```  
  
 Возможности класса необходимо помещать в конец файла, в котором они написаны. Однако можно включить файл (используя `<#@include#>`), содержащий возможность класса, даже если за директивой `include` следует текст и стандартные блоки.  
  
 Дополнительные сведения об управляющих блоках см. в разделе [управляющие блоки текстовых шаблонов](../modeling/text-template-control-blocks.md).  
  
### <a name="class-feature-blocks-can-contain-text-blocks"></a>Блоки возможностей класса могут содержать текстовые блоки  
 Вы можете написать метод, создающий текст. Например:  
  
```  
List of Squares:  
<#  
   for(int i = 0; i < 4; i++)  
   {  WriteSquareLine(i); }  
#>  
End of list.  
<#+   // Class feature block  
private void WriteSquareLine(int i)  
{  
#>  
   The square of <#= i #> is <#= i*i #>.  
<#+     
}  
#>  
```  
  
 Особенно полезным будет поместить метод, создающий текст, в отдельный файл, который можно будет включить в несколько шаблонов.  
  
## <a name="using-external-definitions"></a>Использование внешних определений  
  
### <a name="assemblies"></a>Сборки  
 Блоки кода шаблона могут использовать типы, определенные в наиболее часто используемых сборках .NET, таких как System.dll. Кроме того, можно добавить ссылку на другие сборки .NET или ваши собственные. Можно предоставить путь или строгое имя сборки:  
  
```  
<#@ assembly name="System.Xml" #>  
```  
  
 Необходимо использовать абсолютные пути или стандартные имена макросов в пути. Пример:  
  
```  
<#@ assembly name="$(SolutionDir)library\MyAssembly.dll" #>  
```  
  
 Директива assembly не оказывает влияния в [предварительно преобразованном текстовом шаблоне](../modeling/run-time-text-generation-with-t4-text-templates.md).  
  
 Дополнительные сведения см. в разделе [директива Assembly T4](../modeling/t4-assembly-directive.md).  
  
### <a name="namespaces"></a>Пространства имен  
 Директива import соответствует выражению `using` в C# или выражению `imports` в Visual Basic. Она позволяет ссылаться на типы в коде, не используя полное имя:  
  
```  
<#@ import namespace="System.Xml" #>  
```  
  
 Число используемых директив `assembly` и `import` не ограничено. Их нужно размещать до блоков управления и текста.  
  
 Дополнительные сведения см. в разделе [директива Import T4](../modeling/t4-import-directive.md).  
  
###  <a name="Include"></a>Включение кода и текста  
 Директива `include` вставляет текст из другого файла шаблона. Например, эта директива вставляет содержимое файла `test.txt`:  
  
 `<#@ include file="c:\test.txt" #>`  
  
 Включенное содержимое обрабатывается почти так же, как если бы оно было частью включающего текстового шаблона. При этом можно включить файл, содержащий блок возможностей класса `<#+...#>`, даже если за директивой include следуют обычный текст и стандартные блоки управления.  
  
 Дополнительные сведения см. в разделе [директива Include T4](../modeling/t4-include-directive.md).  
  
### <a name="utility-methods"></a>Служебные методы  
 Существует несколько методов, таких как `Write()`, которые всегда можно использовать в блоке управления. Они включают методы, помогающие создать отступы для вывода или отчеты об ошибках.  
  
 Кроме того, вы можете создать собственный набор служебных методов.  
  
 Дополнительные сведения см. в разделе [служебные методы для текстовых шаблонов](../modeling/text-template-utility-methods.md).  
  
## <a name="transforming-data-and-models"></a>Преобразование данных и моделей  
 Наиболее полезная сфера применения текстовых шаблонов — создание материалов на основе содержимого источника, такого как модель, база данных или файл данных. Шаблон извлекает данные и изменяет их формат. Коллекция шаблонов может преобразовать подобный источник в несколько файлов.  
  
 Существует несколько способов считывания исходного файла.  
  
 **Прочитать файл в текстовом шаблоне**. Это самый простой способ получения данных в шаблоне:  
  
```  
<#@ import namespace="System.IO" #>  
<# string fileContent = File.ReadAllText(@"C:\myData.txt"); ...  
```  
  
 **Загрузка файла в виде модели с поддержкой перемещения**. Более эффективный способ — это чтение данных как модели, по которой может перемещаться код текстового шаблона. Например, можно загрузить XML-файл и выполнять навигацию по этому файлу с помощью выражений XPath. Можно также использовать [xsd.exe](http://go.microsoft.com/fwlink/?LinkId=178765) для создания набора классов, с помощью которых можно считывать данные XML.  
  
 **Редактирование файла модели в схему или форму.** [!INCLUDE[dsl](../modeling/includes/dsl_md.md)]предоставляет средства, которые позволяют редактировать модель как схему или форму Windows. Это упрощает обсуждение модели с пользователями созданного приложения. [!INCLUDE[dsl](../modeling/includes/dsl_md.md)] также создает набор строго типизированных классов, отражающих структуру модели. Дополнительные сведения см. в разделе [формирование кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md).  
  
### <a name="relative-file-paths-in-design-time-templates"></a>Относительные пути файлов в шаблонах времени разработки  
 В [текстового шаблона времени разработки](../modeling/design-time-code-generation-by-using-t4-text-templates.md), чтобы ссылаться на файл в расположении, относительном к текстовому шаблону, используйте `this.Host.ResolvePath()`. Кроме того, необходимо задать выражение `hostspecific="true"` в директиве `template`:  
  
```csharp  
<#@ template hostspecific="true" language="C#" #>  
<#@ output extension=".txt" #>  
<#@ import namespace="System.IO" #>  
<#  
 // Find a path within the same project as the text template:  
 string myFile = File.ReadAllText(this.Host.ResolvePath("MyFile.txt"));  
#>  
Content of MyFile.txt is:  
<#= myFile #>  
  
```  
  
 Можно также получить другие службы, предоставляемые узлом. Дополнительные сведения см. в разделе [доступ к Visual Studio или другим основным приложениям из шаблона](http://msdn.microsoft.com/en-us/0556f20c-fef4-41a9-9597-53afab4ab9e4).  
  
### <a name="design-time-text-templates-run-in-a-separate-appdomain"></a>Текстовые шаблоны времени разработки выполняются в отдельном домене приложения  
 Следует иметь в виду, [текстового шаблона времени разработки](../modeling/design-time-code-generation-by-using-t4-text-templates.md) выполняется в домене приложения, отдельном от основного приложения. В большинстве случаев это неважно, однако вы можете столкнуться с ограничениями в некоторых сложных случаях. Например, если нужно передать данные в шаблон или из него, используя отдельную службу, эта служба должна предоставить сериализуемый API.  
  
 (Это замечание не относится к [текстовый шаблон времени выполнения](../modeling/run-time-text-generation-with-t4-text-templates.md), которые предоставляют код, компилируемый вместе с остальным кодом.)  
  
## <a name="editing-templates"></a>Редактирование шаблонов  
 Специализированные редакторы текстовых шаблонов можно загрузить из каталога диспетчера расширений в Интернете. На **средства** меню, нажмите кнопку **Диспетчер расширений**. Нажмите кнопку **в Интернете**, а затем использовать средство для поиска.  
  
## <a name="related-topics"></a>См. также  
  
|Задача|Раздел|  
|----------|-----------|  
|Создание шаблона.|[Рекомендации по написанию текстовых шаблонов T4](../modeling/guidelines-for-writing-t4-text-templates.md)|  
|Создание текста с помощью программного кода.|[Структура шаблона текста](../modeling/writing-a-t4-text-template.md)|  
|Создание файлов в решении [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].|[Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md)|  
|Запуск создания текста за пределами [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].|[Создание файлов с помощью служебной программы TextTransform](../modeling/generating-files-with-the-texttransform-utility.md)|  
|Преобразование данных в форме доменного языка.|[Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md)|  
|Написание процессоров директив для преобразования собственных источников данных.|[Настройка преобразования текста T4](../modeling/customizing-t4-text-transformation.md)|
