---
title: Определение доменного языка
description: Узнайте, как создать решение Visual Studio на основе шаблона для определения доменного языка (DSL).
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
f1_keywords:
- vs.dsltools.dsldesigner.domainrelationship
- vs.dsltools.dsldesigner.domainclass
- vs.dsltools.dsldesigner.domaintype
helpviewer_keywords:
- Domain-Specific Language, domain class
- Domain-Specific Language, external types
- Domain-Specific Language, relationships
- Domain-Specific Language, domain properties
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 440d2f42fb7967ebbcb97433c3faa55e2d91ca0e
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99903930"
---
# <a name="how-to-define-a-domain-specific-language"></a>Определение доменного языка
Чтобы определить доменный язык (DSL), создайте решение Visual Studio на основе шаблона. Ключевой частью решения является схема определения DSL, которая хранится в файле DslDefinition.dsl. Определение DSL определяет классы и фигуры DSL. После внесения изменений и добавления элементов можно добавить программный код для более детальной настройки DSL.

Если вы не знакомы с доменным DSL, мы рекомендуем вам работать с **лабораториями средств DSL**, которые можно найти на этом сайте: [SDK визуализации и моделирования](https://code.msdn.microsoft.com/Visualization-and-Modeling-313535db) .

## <a name="selecting-a-template-solution"></a><a name="templates"></a> Выбор шаблона решения

Для определения доменного языка необходимо установить следующие компоненты.

- Visual Studio
- Рабочая нагрузка разработки расширений Visual Studio (включает пакет SDK для Visual Studio)
- Пакет SDK для моделирования (установка в качестве отдельного компонента в Visual Studio)

[!INCLUDE[modeling_sdk_info](includes/modeling_sdk_info.md)]

Чтобы создать новый доменный язык, создайте новое решение Visual Studio с помощью шаблона проекта Domain-Specific язык.

### <a name="to-create-a-dsl-solution"></a>Создание решения DSL

1. Создайте новый проект **доменного языка** .

   ::: moniker range="vs-2017"

    ![Создание диалогового окна DSL](../modeling/media/create_dsldialog.png)

   ::: moniker-end

    Откроется **Мастер доменного языка** , в котором будет отображен список решений DSL для шаблонов.

2. Нажмите на каждый шаблон, чтобы увидеть его описание. Выберите решение, максимально соответствующее тому, что вы хотите создать.

    Каждый шаблон DSL определяет основной рабочий DSL. Этот DSL можно отредактировать в соответствии с вашими требованиями.

    Нажмите на каждый образец, чтобы получить дополнительную информацию.

   - Выберите **последовательность задач** , чтобы создать DSL с дорожками. Дорожки — это вертикальные или горизонтальные разделы схемы.

   - Выберите **модели компонентов** , чтобы создать DSL с портами. Порты — это небольшие фигуры на краю более крупной фигуры.

   - Выберите **схемы классов** , чтобы определить DSL с фигурами секций. Фрагменты фигур содержат списки элементов.

   - Выберите **Минимальный язык** в других случаях или, если вы не уверены.

   - Выберите **минимальный конструктор WinForm** или **минимальный конструктор WPF** , чтобы создать DSL, отображаемое на Windows Forms или в области WPF. Вам нужно будет написать код для определения редактора. Дополнительные сведения см. в следующих разделах:

        [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)

        [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)

3. Введите расширение имени файла для DSL на соответствующей странице мастера. Это расширение будут использовать файлы, содержащие экземпляры DSL.

   - Выберите расширение имени файла, не связанное ни с одним другим приложением на вашем или другом компьютере, где планируется устанавливать DSL. Например, **docx** и **htm** будут неприемлемыми расширениями имен файлов.

   - Мастер предупредит, если расширение уже используется в качестве DSL. В этом случае выберите другое расширение имени файла. Можно также сбросить экземпляр экспериментального пакета SDK для Visual Studio, чтобы удалить старые экспериментальные конструкторы. Нажмите кнопку **Пуск**, выберите пункт **все программы**, **Microsoft Visual Studio пакет SDK 2010**, **средства**, а затем выполните **Сброс экспериментального экземпляра Microsoft Visual Studio 2010**.

4. Также можно изменить настройки на других страницах или оставить значения по умолчанию.

5. Нажмите кнопку **Готово**.

    Мастер создаст решение, содержащее два или три проекта, и сгенерирует код из определения DSL.

   После этого пользовательский интерфейс примет следующий вид:

   ![конструктор dsl](../modeling/media/dsl_designer.png)

   Данное решение определяет доменный язык. Дополнительные сведения см. [в разделе Обзор пользовательского интерфейса средств языка Domain-Specific](../modeling/overview-of-the-domain-specific-language-tools-user-interface.md).

### <a name="test-the-solution"></a>Тестирование решения
 Шаблон решения предоставляет рабочий DSL, который можно изменить или использовать как есть.

 Чтобы протестировать решение нажмите клавишу F5 или комбинацию клавиш CTRL + F5. Новый экземпляр Visual Studio открывается в экспериментальном режиме.

 В новом экземпляре Visual Studio в обозреватель решений откройте пример файла. Он откроется в виде схемы с панелью элементов.

 Если вы запустите решение, созданное на основе шаблона с **минимальным языком** , экспериментальная версия Visual Studio будет выглядеть следующим образом:

 ![Пример дерева для доменного языка в Visual Studio](../modeling/media/dsl_min.png)

 Работа с инструментами Создайте элементы и соедините их.

 Закройте экспериментальный экземпляр Visual Studio.

> [!NOTE]
> После изменения DSL фигуры больше не будут отображаться в тестовом файле Sample. При этом возможность создавать новые элементы сохранится.

### <a name="modifying-the-template-dsl"></a>Изменение шаблона DSL
 Переименуйте и оставьте некоторые или все классы доменов и фигур в шаблоне определения DSL. Новые имена классов должны быть действительными CLR-именами без пробелов и знаков препинания.

 Рекомендуем сохранить следующие классы:

- Корневой класс отображается в левом верхнем углу схемы определения DSL в разделе **классы и связи**. Присвойте ему другое имя, которое будет отличаться от имени DSL. Например, домен DSL с именем **мусиклибрари** может иметь корневой класс с именем **Music**.

- Класс схемы отображается в нижней правой части схемы определения DSL в столбце **элементы схемы** . Возможно, чтобы его увидеть, экран придется прокрутить вправо. Обычно это называется **схемой** _йоурдсл_.

- Если вы использовали шаблон **потока задач** и хотите создать диаграммы с дорожками, следует удерживать и переименовать класс субъекта и форму акторсвимлане.

  Удалите или переименуйте другие классы в соответствии со своими потребностями.

## <a name="patterns-for-defining-a-dsl"></a><a name="patterns"></a> Шаблоны для определения DSL
 Рекомендуем разрабатывать DSL путем добавления или настройки одного или двух функций за один раз. Добавьте функцию, запустите DSL и протестируйте его работу, затем добавьте еще одну или несколько функций. В число типовых функций DSL входят следующие.

- Класс домена, отношение внедрения, соединяющее элемент с моделью, фигура, предназначенная для отображения элементов класса на схеме, и средство элемента, позволяющее пользователям создавать элементы.

- Свойства домена того или иного класса и декораторы, отображающие их на схеме.

- Ссылочное отношение и соединитель, который отображает его на схеме, а также инструмент соединителя, который позволяет пользователям создавать связи.

- Настройка, требующая программного кода, например проверка ограничений или команда меню.

  В следующих разделах описывается, как построить наиболее полезные виды функций DSL. Существуют много других шаблонов, с помощью которых может быть создан DSL, но эти используются наиболее часто.

> [!NOTE]
> После добавления функции не забудьте нажать кнопку **преобразовать все шаблоны** на панели инструментов Обозреватель решений перед созданием и запуском DSL.

 На следующем рисунке показаны классы и отношения, которые являются частью DSL и используются в качестве примера в данном разделе.

 ![Внедрение связей и установка ссылок на них](../modeling/media/music_classes.png)

 Следующий рисунок является примером модели данного DSL:

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png)

> [!NOTE]
> "Модель" означает экземпляр DSL, который создается пользователем и обычно отображается в виде схемы. В данном разделе рассматривается как схема определения DSL, так и схемы модели, которые отображаются при использовании DSL.

## <a name="defining-domain-classes"></a><a name="classes"></a> Определение доменных классов
 Классы доменов представляют собой концепции DSL. Экземпляры являются *элементами модели*. Например, в **мусиклибрари** DSL могут существовать классы доменов с именами " **альбом** " и " **песня**".

 Чтобы создать доменный класс, можно перетащить его из средства **именованного доменного класса** на схему, а затем переименовать класс.

 Дополнительные сведения см. в разделе [Свойства доменных классов](../modeling/properties-of-domain-classes.md).

### <a name="create-an-embedding-relationship-for-each-domain-class"></a>Создание отношения внедрения для каждого класса домена
 Каждый класс домена, кроме корневого, должен быть целевым объектом хотя бы одного отношения внедрения или наследоваться от класса, который является таким целевым объектом.

 В модели каждый элемент является узлом в едином дереве отношений внедрения. Источник и целевой объект отношения внедрения часто называют родительским и дочерним элементами.

 Выбор родительского элемента для класса домена зависит от того, как зависит время жизни этих элементов от других элементов. Если узел дерева удаляется, его поддерево обычно удаляется вместе с ним. Классы элемента, существующего независимо, встроены напрямую в корневой класс.

 Обычно если вы отображаете элемент внутри другого элемента, то показываете и его отношение к владельцу. В данном случае наиболее соответствующий родительский класс — это класс контейнера. Исключение имеет место, когда элемент внутри контейнера на самом деле является ссылкой на независимый элемент. В этом случае при удалении контейнера удаляется ссылка, но не объект, на который она указывает.

 В шаблонах определения DSL, описанных в данном разделе, будем предполагать, что элементы, отображаемые внутри контейнера, при удалении контейнера также будут удалены. Возможны и более сложные схемы, которые создаются путем определения ролей.

|Отображение элемента|Родительский класс (класс внедрения)|Пример в шаблоне решения DSL|
|-|-|-|
|Фигура на схеме<br /><br /> Дорожка|Корневой класс DSL|Минимальный язык<br /><br /> Поток задач: класс субъекта.|
|Фигура в дорожке|Класс домена элементов, который отображаются в качестве дорожек.|Поток задач: класс задачи.|
|Элемент в списке в фигуре, удаляемый при удалении контейнера<br /><br /> Порт на краю фигуры|Класс домена, сопоставленный с фигурой контейнера|Схема классов: класс атрибута.<br /><br /> Схема компонента: класс порта.|
|Элемент в списке, не удаляемый при удалении контейнера|Корневой класс DSL<br /><br /> Список с указанием связей и отношений||
|Не отображается напрямую|Класс, часть которого он формирует||

 В примере Music Library, альбомы (Album) отображаются как прямоугольники, в которых перечислены названия песен (Song). Следовательно, родителем элемента Album является корневой класс Music (Музыка), а родителем элемента Song (Песня) — класс Album (Альбом).

 Чтобы создать доменный класс и его внедрение одновременно, щелкните инструмент **отношение внедрения** , затем щелкните родительский класс, а затем щелкните пустую часть диаграммы.

 Как правило, изменять имя отношения внедрения и его ролей не обязательно, так как они будут отслеживать имена классов автоматически.

 Дополнительные сведения см. в разделе [Свойства доменных отношений](../modeling/properties-of-domain-relationships.md) и [Свойства ролей домена](../modeling/properties-of-domain-roles.md).

> [!NOTE]
> Внедрение не является наследованием. Дочерние элементы в отношении внедрения не наследуют свойства родительских элементов.

### <a name="add-domain-properties-to-each-domain-class"></a>Добавление свойств домена в каждый класс домена
 Свойства доменов хранят значения. Примеры: имя, заголовок, Дата публикации.

 Щелкните **свойства домена** в классе, нажмите клавишу ВВОД, а затем введите имя свойства. Тип свойства домена по умолчанию — строка. Если вы хотите изменить тип, выберите свойство Domain и задайте **тип** в окне **свойства** . Если нужный тип отсутствует в раскрывающемся списке, см. раздел [Добавление типов свойств](#addTypes).

 **Установите свойство "Имя элемента".** Выберите свойство домена, которое может использоваться для определения элементов в Обозревателе языка. Например, в классе домена Song (Песня) можно выбрать свойство домена "Название". В окне **Свойства** задайте для параметра **имя элемента** значение `true` .

### <a name="create-derived-domain-classes"></a>Создание производных классов доменов
 Если у классов доменов должны быть экземпляры, которые наследуют его свойства и отношения, можно создать классы, которые являются производными от него. Например, класс Album (Альбом) может иметь производные классы WMA и MP3.

 Создайте производный класс с помощью средства **доменный класс** .

 Щелкните инструмент **наследование** , щелкните производный класс, а затем щелкните базовый класс.

 Рекомендуется задать **абстрактный** **Модификатор наследования** базового класса. Если вам могут понадобиться экземпляры базового класса, создайте для них отдельные производные классы.

 Производные классы наследуют свойства и роли базовых классов.

### <a name="tidy-the-dsl-definition-diagram"></a>Чистка схемы определения DSL
 При добавлении отношений некоторые из классов появятся сразу в нескольких местах. Чтобы уменьшить количество представлений и сделать диаграмму шире, щелкните правой кнопкой мыши целевой класс связи и выберите пункт **переместить дерево здесь**. Для обратного воздействия щелкните правой кнопкой мыши целевой класс связи и выберите пункт **разделить дерево**. Если эти команды меню отсутствуют, убедитесь, что выбран только класс домена.

 Для перемещения классов доменов и фигур используйте сочетания клавиш CTRL + стрелка вверх и CTRL + стрелка вниз.

### <a name="test-the-domain-classes"></a>Проверка классов доменов

##### <a name="to-test-the-new-domain-classes"></a>Чтобы проверить новые классы доменов, сделайте следующее.

1. **Щелкните Преобразовать все шаблоны** на панели инструментов Обозреватель решений, чтобы создать код конструктора DSL. Этот шаг можно автоматизировать. Дополнительные сведения см. [в разделе Автоматизация преобразования всех шаблонов](/previous-versions/visualstudio/visual-studio-2012/ff521399\(v\=vs.110\)).

2. **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением имени файла DSL.

3. **Откройте обозреватель.** На боковой стороне схемы находится окно обозревателя языков, которое обычно называется *вашязык* Explorer. Если вы не видите это окно, оно может быть на вкладке под Обозревателем решений. Если его не удается найти, в меню **вид** выберите **другие окна**, а затем щелкните **Обозреватель** *вашязык* .

     В обозревателе представлен вид модели в качестве дерева.

4. **Создание новых элементов.** Щелкните правой кнопкой мыши корневой узел вверху и выберите команду **Добавить новый**_йоуркласс_.

     Новый экземпляр класса появится в Обозревателе языка.

5. При создании новых экземпляров следите за тем, чтобы все экземпляры получали разные имена. Это произойдет только в том случае, если установлен флаг **является именем элемента** для свойства домена.

6. **Изучите свойства домена. Изучите окно свойств в выбранном экземпляре класса** . Оно должно показывать свойства домена, которые вы определили для данного класса домена.

7. **Сохраните файл, закройте его и снова откройте**. Все созданные экземпляры должны отобразиться в обозревателе, когда вы развернете узлы.

## <a name="defining-shapes-on-the-diagram"></a><a name="shapes"></a> Определение фигур на диаграмме
 Вы можете определить классы элементов, которые отображаются на схеме в виде прямоугольников, эллипсов или ярлыков.

#### <a name="to-define-a-class-of-elements-that-appear-as-shapes-on-a-diagram"></a>Определение класса элементов, которые отображаются на схеме в виде фигур

1. **Определите и протестируйте доменный класс, как описано в разделе**  [Определение доменных классов](#classes) **.**

   - Родителем класса должен быть корневой класс. Это значит, что между корневым классом и новым классом домена должно существовать отношение внедрения.

   - Если в схеме есть дорожки, то родителем может быть класс домена, сопоставленный с дорожкой. Перед продолжением этой процедуры см. раздел [Определение DSL с дорожками](#swimlanes).

2. **Добавьте класс Shape** для представления элементов на схеме модели. Перетащите один из следующих инструментов на схему определения DSL.

   - **Геометрическая фигура** содержит прямоугольник или эллипс.

   - В **фигуре изображения** отображается предоставленное изображение.

   - **Фигура секции** — это прямоугольник, содержащий один или несколько списков элементов.

     Переименуйте класс фигуры, который отображается в правой части схемы определения DSL под фигурами и соединителями.

3. **Определите изображение, если вы создали фигуру изображения**.

   1. Создайте файл изображения любого размера. Поддерживаются форматы BMP, JPEG, GIF и EMF.

   2. В Обозревателе решений добавьте файл в каталог решения Dsl\Resources.

   3. Вернитесь в схему определения DSL и выберите новый класс фигуры изображения.

   4. В окно свойств щелкните свойство **Image** .

   5. В диалоговом окне **Выбор изображения** в поле **имя файла** щелкните раскрывающееся меню и выберите изображение.

4. **Добавьте к фигуре декораторы текста, чтобы отобразить свойства домена.**

    Чтобы отобразить имя или название элемента модели, потребуется хотя бы один декоратор.

    Щелкните правой кнопкой мыши заголовок класса Shape, наведите указатель на пункт **Добавить** и выберите **текстовый декоратор**. Задайте имя декоратора и в окно свойств задайте его **Расположение**.

5. **Соедините каждую фигуру с картой элемента схемы с классом домена, который должен отображаться**.

    Щелкните инструмент " **схема элементов схемы** ", затем щелкните доменный класс, а затем выберите класс Shape.

6. **Сопоставьте свойства с текстовыми декораторами.**

   1. Выберите серую линию между классом домена и классом фигуры, которая представляет карту элементов схемы.

   2. В окне **сведения о DSL** перейдите на вкладку **карты декораторов** . Если окно **сведения о DSL** не отображается, в меню **вид** наведите указатель на пункт **другие окна** и щелкните **сведения о DSL**. Часто нужно поднять верхнюю часть окна, чтобы увидеть все его содержимое.

   3. Выберите имя декоратора. В разделе **свойство экрана** выберите имя свойства доменного класса. Повторите эти шаги для каждого декоратора.

       Если требуется отобразить свойство связанного элемента, щелкните раскрывающийся список в разделе **путь к отображаемому свойству**.

   4. Возле имени каждого декоратора должен быть установлен флажок.

      ![Сопоставление фигур и окно сведений DSL](../modeling/media/dsldetailswindow.png)

7. **Создайте элемент панели элементов для создания элементов класса домена.**

   1. В **обозревателе DSL** разверните узел **редактора** и все его дочерние узлы.

   2. Щелкните правой кнопкой мыши узел в разделе **вкладки области элементов** , имя которого совпадает с именем DSL, например мусиклибрари. Нажмите кнопку **Добавить элемент средство**.

       > [!NOTE]
       > Если щелкнуть правой кнопкой мыши узел **инструменты** , то **средство добавить элемент** не будет отображаться. Вместо этого необходимо щелкнуть узел на уровень выше.

   3. В окно свойств с выбранным инструментом "новый элемент" задайте **класс** в качестве класса домена, который вы недавно добавили.

   4. Задайте **заголовок** и **подсказку**.

   5. Установите **значок панели элементов** на значок, который будет отображаться на панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

        Чтобы создать новый значок, откройте Дсл\ресаурцес в **Обозреватель решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

        Вернитесь на схему определения DSL, выберите инструмент и в окно свойств щелкните значок **[...]** на **панели элементов**. В диалоговом окне **Выбор растрового изображения** выберите свой. BMP-файл из раскрывающегося меню.

   Дополнительные сведения см. в разделе [Свойства геометрических фигур](../modeling/properties-of-geometry-shapes.md) и [свойств фигур изображений](../modeling/properties-of-image-shapes.md).

#### <a name="to-test-shapes"></a>Тестирование Фигур

1. **Щелкните Преобразовать все шаблоны** на панели инструментов Обозреватель решений, чтобы создать код конструктора DSL.

2. **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением имени файла DSL.

3. **Убедитесь, что средства элементов появились на панели элементов.**

4. **Создание фигур** путем перетаскивания из средства на схему модели.

5. **Убедитесь, что отображается каждый текстовый декоратор** и что:

   1. Его можно изменить, если только в свойстве домена не установлен флаг " **только чтение пользовательского интерфейса** ".

   2. в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

   После первого тестирования фигуры можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. [в разделе Настройка и расширение языка Domain-Specific](../modeling/customizing-and-extending-a-domain-specific-language.md).

## <a name="defining-reference-relationships"></a><a name="references"></a> Определение ссылочных отношений
 Между любым классом домена источника и классом домена целевого объекта можно определить ссылочное отношение. Ссылочные отношения обычно отображаются на схеме в виде соединителей — линий между фигурами.

 Например, если музыкальные альбомы (Album) и исполнители (Artist) отображаются в схеме в виде фигур, можно определить отношение с именем ArtistsAppearedOnAlbums, связывающее исполнителей и альбомы, в которых они участвуют. См. пример на рисунке.

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png)

 Ссылочные отношения могут также связывать элементы одного типа. Например, в DSL, представляющем собой генеалогическое древо, взаимосвязь между родительскими и дочерними элементами является ссылочным отношением между персонами.

### <a name="define-a-reference-relationship"></a>Определение ссылочного отношения
 Щелкните инструмент ссылочного отношения, затем класс домена источника отношения и, наконец, целевой класс домена. Целевой класс может быть таким же как и класс источника.

 Каждое отношение имеет две роли, представленные линией с каждой стороны окна отношений. Можно выбрать каждую роль и настроить ее свойства в окне "Свойства".

 **Рассмотрите возможность переименования ролей**. Например, в отношении между персонами можно изменить имена по умолчанию на "Родители" и "Дети", "Руководитель" и "Подчиненные", "Преподаватель" и "Студент" и т. д.

 При необходимости **Настройте кратность каждой роли**. Если у каждой персоны должно быть не больше одного Руководителя, укажите для параметра кратности под ярлыком "Руководитель" в схеме значение "0..1".

 **Добавьте в отношение свойства домена.** На рисунке отношение между исполнителем и альбомом имеет свойство роли.

 **Установите свойство допускает повторение связи,** если между одной и той же парой элементов модели может существовать несколько ссылок одного и того же класса. Например, можно разрешить Преподавателю обучать одного и того же Студента нескольким Дисциплинам.

 ![Карты фигур для соединителей](../modeling/media/music_connector.png)

 Дополнительные сведения см. в разделе [Свойства доменных отношений](../modeling/properties-of-domain-relationships.md) и [Свойства ролей домена](../modeling/properties-of-domain-roles.md).

### <a name="define-a-connector-to-display-the-relationship"></a>Определение соединителя для отображения отношения
 Соединитель отображает линию между двумя фигурами в схеме модели.

 Перетащите инструмент **Connector** на схему определения DSL.

 Добавьте текстовые декораторы если необходимо отобразить ярлыки на соединителе. Установите их расположение. Чтобы позволить пользователю перемещать декоратор текста, установите свойство для свойства **перемещаемого** элемента.

 С помощью инструмента "схема **элементов схемы** " свяжите соединитель со ссылочной связью.

 Выбрав карту элементов схемы, откройте окно " **сведения о DSL** " и откройте вкладку " **карты декораторов** ".

 Выберите каждый **декоратор** и задайте для **Свойства отображение** правильное свойство домена.

 Убедитесь, что рядом с каждым элементом в списке **декораторов** отображается галочка.

### <a name="define-a-connection-builder-tool"></a>Определение средства построителя подключений
 В окне **обозревателя DSL** разверните узел **Редактор** и все его подузлы.

 Щелкните правой кнопкой мыши узел, имя которого совпадает с именем вашего DSL, и выберите команду **Добавить новое подключение**.

 Выбрав новый инструмент, в окне "Свойства":

- Задайте **заголовок** и **подсказку**.

- Щелкните **Построитель подключений** и выберите соответствующий конструктор для новой связи.

- Установите **значок панели элементов** на значок, который должен отображаться на панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Дсл\ресаурцес в **Обозреватель решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернитесь на схему определения DSL, выберите инструмент и в окно свойств щелкните значок **[...]** на **панели элементов**. В диалоговом окне **Выбор растрового изображения** выберите свой. BMP-файл из раскрывающегося меню.

##### <a name="to-test-a-reference-relationship-and-connector"></a>Тестирование ссылочного отношения и соединителя

1. **Щелкните Преобразовать все шаблоны** на панели инструментов Обозреватель решений, чтобы создать код конструктора DSL.

2. **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением имени файла DSL.

3. **Убедитесь, что средства подключений появились на панели элементов.**

4. **Создание фигур** путем перетаскивания из средства на схему модели.

5. **Создание соединений** между фигурами. Выберите соединитель, щелкните фигуру, а затем выберите другую фигуру.

6. **Убедитесь, что вы не можете создать соединения между несоответствующими классами.** Например, если установлено отношение между Альбомами и Исполнителями, убедитесь, что нельзя связать Исполнителей с Исполнителями.

7. **Проверьте правильность кратности. Например, убедитесь, что невозможно подключить пользователя к нескольким руководителям.**

8. **Убедитесь, что отображается каждый текстовый декоратор** и что:

   1. Его можно изменить, если только в свойстве домена не установлен флаг " **только чтение пользовательского интерфейса** ".

   2. в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

   После первого тестирования соединителя можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. [в разделе Настройка и расширение языка Domain-Specific](../modeling/customizing-and-extending-a-domain-specific-language.md).

## <a name="defining-shapes-that-contain-lists-compartment-shapes"></a><a name="compartments"></a> Определение фигур, содержащих списки: фигуры секций
 Фигура секции содержит один или несколько списков элементов. Например, в DSL Music Library можно использовать фигуру секции для представления музыкальных Альбомов. В каждом Альбоме есть список Песен.

 ![Фигура секции](../modeling/media/compartmentshape.png)

 Самый простой способ добиться этого эффекта в определении DSL — это определить один класс домена для контейнера и один класс домена для каждого списка. Класс контейнера сопоставлен с фигурой секции.

 ![Карта фигур](../modeling/media/music_mapcomp.png)

 Дополнительные сведения см. в разделе [Свойства фигур секций](../modeling/properties-of-compartment-shapes.md).

#### <a name="to-define-a-compartment-shape"></a>Определение фигуры секции

1. **Создайте доменный класс контейнера**. Щелкните инструмент **отношение внедрения** , щелкните корневой класс модели, а затем щелкните пустую часть схемы определения DSL. Это создаст класс домена, который на рисунке примера называется Album.

     В качестве альтернативы вместо встраивания в корневой класс можно встроить контейнер в класс домена, сопоставленный с дорожкой.

     Добавьте в класс свойство домена, например Name, и установите в окно свойств флаг **Name элемента** .

2. **Создайте доменный класс элемента списка**. Щелкните инструмент **отношение внедрения** , щелкните класс контейнера (альбом) и выберите пустую часть диаграммы. Это создаст класс домена, который на рисунке примера называется Song (Песня).

     Добавьте в класс свойство домена, например Title, и установите для него флаг **— имя элемента** .

     Добавьте другие свойства домена.

     Добавьте по классу домена для каждого списка элементов, который необходимо отобразить.

3. **Чтобы смешать несколько типов элементов в списке**, создайте классы, которые наследуются от класса List. Сделайте класс списка абстрактным, установив его **Модификатор наследования**.

     Например, если вы хотите, чтобы классическая музыка сортировалась по композитору, а не по исполнителю, можно создать в классе Song (Песня) два подкласса: ClassicalSong (Классические) и NonClassicalSong (Не классические).

4. **Создайте фигуру секции**. Перетащите инструмент « **фигура секции** » на схему определения DSL.

     Добавьте текстовый декоратор и укажите для него имя.

     Добавьте секцию и укажите для нее имя.

5. Чтобы позволить пользователю скрыть секции списка, щелкните правой кнопкой мыши класс Shape, наведите указатель на пункт **Добавить**, а затем выберите **развернуть или свернуть декоратор**. В окне "Свойства" задайте расположение декоратора.

6. Щелкните инструмент " **схема элементов схемы** ", щелкните доменный класс контейнера, а затем щелкните фигуру секции.

7. Выберите связь карты элемента схемы между классом домена и фигурой. В окне **сведения о DSL** выполните следующие действия.

    1. Перейдите на вкладку **декораторы** . Щелкните имя декоратора и выберите соответствующий элемент в разделе **отображаемое свойство**. Убедитесь, что возле имени каждого декоратора установлен флажок.

    2. Перейдите на вкладку **карты секций** .

         Выберите имя секции.

         В разделе **отображаемый путь коллекции элементов** перейдите к классу элементов списка (песня). Щелкните стрелку раскрывающегося меню, чтобы воспользоваться инструментом навигации.

         В разделе **свойство отображения** выберите свойство, которое должно отображаться в списке. В этом примере это свойство — Название.

> [!NOTE]
> Используя поля "Путь" в карте декораторов и полях в карте секций, установите более сложные отношения между классами доменов и фигурой секции.

#### <a name="to-define-a-tool-for-creating-the-shape"></a>Определение инструмента для создания фигуры

1. **Создайте элемент панели элементов для создания элементов класса домена.**

2. В **обозревателе DSL** разверните узел **редактора** и все его дочерние узлы.

3. Щелкните правой кнопкой мыши узел в разделе **вкладки области элементов** , имя которого совпадает с именем DSL, например мусиклибрари. Нажмите кнопку **Добавить элемент средство**.

    > [!NOTE]
    > Если щелкнуть правой кнопкой мыши узел **инструменты** , то **средство добавить элемент** не будет отображаться. Вместо этого необходимо щелкнуть узел на уровень выше.

4. В окно свойств с выбранным инструментом "новый элемент" задайте **класс** в качестве класса домена, который вы недавно добавили.

5. Задайте **заголовок** и **подсказку**.

6. Установите **значок панели элементов** на значок, который будет отображаться на панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Дсл\ресаурцес в **Обозреватель решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернитесь на схему определения DSL, выберите инструмент и в окно свойств щелкните значок **[...]** на **панели элементов**. В диалоговом окне **Выбор растрового изображения** в раскрывающемся меню выберите НУЖНЫЙ файл BMP.

#### <a name="to-test-a-compartment-shape"></a>Тестирование фигуры сегмента

1. **Щелкните Преобразовать все шаблоны** на панели инструментов Обозреватель решений, чтобы создать код конструктора DSL.

2. **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением имени файла DSL.

3. **Убедитесь, что инструмент появился на панели элементов.**

4. Перетащите инструмент в схему модели. Будет создана новая фигура.

    Убедитесь, что имя элемента отображается и автоматически получает значение по умолчанию.

5. Щелкните правой кнопкой мыши заголовок новой фигуры и выберите команду Добавить *элемент списка.* В этом примере используется команда "Добавить песню".

    Убедитесь, что элемент отображается в списке под новым именем.

6. Щелкните один из элементов списка и проверьте окно "Свойства". В нем должны появиться свойства элементов списка.

7. Откройте Обозреватель языка. Убедитесь, что узлы контейнера содержат узлы элементов списка.

   ![Созданный обозреватель DSL](../modeling/media/music_explorer.png)

   После первого тестирования фигуры секции можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. [в разделе Настройка и расширение языка Domain-Specific](../modeling/customizing-and-extending-a-domain-specific-language.md).

### <a name="displaying-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции
 Обычно элемент, который отображается в секции, является дочерним для элемента, который представлен фигурой фрагмента. Однако в некоторых случаях можно отобразить элемент, который связан с ним ссылочным отношением.

 Например, можно добавить вторую секцию в элемент AlbumShape, отображающий список Исполнителей, которые связаны с Альбомом.

 В этом случае секция должна отображать связь вместо элемента, на который она ссылается. Это связано с тем, что, когда пользователь выбирает элемент в секции и нажимает клавишу DELETE, должна удаляться связь, а не элемент, на который создана ссылка.

 Тем не менее можно сделать так, чтобы имя элемента, на который создана ссылка, отображалось в секции.

 Следующая процедура предполагает, что вы уже создали класс домена, ссылочное отношение, фигуру секции и карту элементов схемы, как описано выше в этом разделе.

##### <a name="to-display-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции

1. **Добавьте секцию в фигуру секции**. На схеме определения DSL щелкните правой кнопкой мыши класс Shape, наведите указатель на пункт **Добавить**, а затем выберите пункт **Секция**.

2. Установите **отображаемый путь коллекции элементов** для перехода к ссылке, а не к ее целевому элементу. Откройте раскрывающееся меню и выберите в представлении дерева вместо цели ссылочное отношение. В примере это связь **артистаппеаредоналбумс**.

3. Задайте **для параметра путь значение отображаемое свойство** , чтобы перейти от ссылки к целевому элементу. В этом примере это **исполнитель**.

4. Задайте для **Свойства отображение** соответствующее свойство целевого элемента, например **имя**.

5. **Преобразование всех шаблонов**, сборка и запуск DSL, а также открытие тестовой модели.

6. В схеме модели создайте соответствующие классы фигур, присвойте им имена и создайте связь между ними. В фигуре секции должны появиться имена связанных элементов.

7. Выберите связь или элемент в фигуре секции. Связь и элемент должны исчезнуть.

## <a name="defining-ports-on-the-boundary-of-another-shape"></a><a name="ports"></a> Определение портов на границе другой фигуры
 Порт — это фигура, которая находится на границе с другой фигурой.

 Порты могут также использоваться для предоставления фиксированной точки соединения с другой фигурой, для которой пользователь может нарисовать соединители. В данном случае фигуру порта можно сделать прозрачной.

 Чтобы просмотреть пример, использующий порты, выберите шаблон **Схема компонентов** при создании нового решения DSL. В данном примере показаны основные точки, которые можно использовать при определении портов.

- Класс домена, который представляет контейнер портов (`Component`).

- Класс домена, который представляет порты. В нашем примере это `ComponentPort`.

- Отношение внедрения между классом домена контейнера и классом домена порта. Дополнительные сведения см. в разделе [Определение доменных классов](#classes).

- Если в одном контейнере нужно смешать разные типы портов, можно создать подклассы класса домена порта. В данном примере `InPort` и `OutPort` наследуются от `ComponentPort`.

- Класс домена контейнера может быть сопоставлен с любым видом фигуры. В этом примере используется `ComponentShape`. Дополнительные сведения см. в разделе [Определение фигур](#shapes).

- Классы доменов портов сопоставлены с фигурами портов. Можно сопоставить либо производные классы с отдельными классами фигур портов, либо базовый класс с одним классом фигуры порта.

  В других отношениях формы порта ведут себя так, как описано в разделе [Определение фигур](#shapes).

  Дополнительные сведения см. в разделе [Свойства фигур порта](../modeling/properties-of-port-shapes.md).

## <a name="defining-a-dsl-that-has-swimlanes"></a><a name="swimlanes"></a> Определение DSL с дорожками
 Дорожки — это вертикальные или горизонтальные разделения схемы. Каждая дорожка соответствует элементу модели. Определение DSL требует одного класса домена для элементов дорожек.

 Лучший способ создать DSL с дорожками — это создать новое решение DSL и выбрать шаблон решения "Поток задач". В определении DSL класс субъекта является классом домена, сопоставленным с дорожкой. Переименуйте его и другие классы в соответствии со своим проектом.

 Чтобы добавить класс, который будет отображаться как фигура внутри дорожки, создайте отношение внедрения между классом дорожки и новым классом. Пользователи смогут перетаскивать элементы из одной дорожки в другую, но каждый элемент всегда будет находиться внутри конкретной дорожки. В шаблоне решения "Поток задач", FlowElement является дочерним классом класса дорожки.

 Чтобы добавить класс, который будет отображаться как фигура, независимая от дорожки, создайте отношение внедрения между корневым и новым классами. Пользователи смогут размещать эти фигуры в любом месте схемы, в т. ч. на границах и за пределами дорожек. В шаблоне решения "Поток задач", Comment является дочерним классом класса дорожки.

 Дополнительные сведения см. в разделе [Свойства дорожек](../modeling/properties-of-swimlanes.md).

## <a name="adding-property-types"></a><a name="addTypes"></a> Добавление типов свойств

### <a name="domain-enumerations-and-literals"></a>Доменные перечисления и литералы
 Доменное перечисление — это тип с несколькими значениями литералов.

 Чтобы добавить перечисление доменов, щелкните правой кнопкой мыши корень модели в **обозревателе DSL** и выберите **Добавить новое перечисление доменов**. Элемент появится в **обозревателе DSL** в узле **типы домена** . Этот элемент не отображается в схеме.

 Чтобы добавить литералы перечисления в перечисление доменов, щелкните правой кнопкой мыши перечисление доменов в **обозревателе DSL** и выберите команду **Добавить новый литерал перечисления**.

 По умолчанию свойство, которое имеет тип перечисления, может иметь только одно значение перечисления за раз. Если вы хотите, чтобы пользователи и программисты могли задавать любое сочетание значений — "битовое поле", установите свойство "свойства- **Флаги** " перечисления.

### <a name="external-types"></a>Внешние типы
 При задании типа свойства домена, если нужный тип не найден в раскрывающемся списке **тип** , можно добавить внешний тип. Например, можно добавить тип **System. Drawing. Color** в список.

 Чтобы добавить тип, щелкните правой кнопкой мыши корень модели в обозревателе DSL и выберите команду **Добавить новый внешний тип**. В окно свойств задайте для имени значение **Color** , а для пространства имен — **System. Drawing**. Этот тип теперь отображается в обозревателе DSL в разделе **типы доменов**. и будет доступен для выборе при установке типа свойства домена.

## <a name="customizing-the-dsl"></a><a name="custom"></a> Настройка DSL
 Используя техники, описанные в этом разделе, можно быстро создать DSL со схематическим представлением, читаемой формой XML и основными инструментами, необходимыми для генерирования кода или других артефактов.

 Существуют два метода расширения определения DSL.

1. Точная настройка DSL с использованием многочисленных функций определения DSL. Например, можно сделать единое средство подключения, способное создавать несколько типов соединителей, и настроить правила, по которым удаление одного элемента ведет к удалению связанных элементов. Большинство этих техник требуют установки значений в определении DSL, а некоторые — написания нескольких строк программного кода.

     Дополнительные сведения см. [в разделе Настройка и расширение языка Domain-Specific](../modeling/customizing-and-extending-a-domain-specific-language.md).

2. Расширение инструментов моделирования с помощью программного кода для достижения более сложных эффектов. Например, можно создать команды меню, способные изменять модель, а также инструменты, соединяющие в себе два и более DSL. VMSDK разработан специально для того, чтобы облегчить интеграцию расширений с кодом, который генерируется из определения DSL.  Дополнительные сведения см. [в разделе Написание кода для настройки языка Domain-Specific](../modeling/writing-code-to-customise-a-domain-specific-language.md).

### <a name="changing-the-dsl-definition"></a>Изменение определения DSL
 При создании любого элемента в определении DSL многие значения устанавливаются автоматически. Установленные значения можно изменять. Это упрощает разработку DSL и в то же время позволяет осуществлять значительные настройки.

 Например, когда фигура сопоставляется с элементом, путь родительского элемента сопоставления автоматически устанавливается согласно отношению внедрения соответствующего класса домена. Если же впоследствии отношение внедрения корректируется, путь родительского элемента автоматически не изменяется.

 Следовательно, необходимо знать, что при изменении некоторых взаимосвязей в определении DSL нет ничего необычного в том, что при сохранении определения или трансформации всех шаблонов будут выдаваться сообщения об ошибках. Большинство этих ошибок легко исправить. Откройте сообщение об ошибке двойным щелчком кнопки мыши, чтобы найти расположение ошибки.

 См. также [руководство. изменение пространства имен Domain-Specific языка](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md).

## <a name="troubleshooting"></a><a name="trouble"></a> Устранение неполадок
 В следующей таблице перечислено большинство стандартных проблем, возникающих при разработке DSL, а также предложения по их решению. Дополнительные советы доступны на форуме по [расширению средств визуализации](https://social.msdn.microsoft.com/Forums/vstudio/en-US/home?forum=dslvsarchx).

| Проблема | Предложение |
|-|-|
| Изменения, внесенные в файл определения DSL, не работают. | Щелкните **преобразовать все шаблоны** на панели инструментов, расположенной выше Обозреватель решений, а затем перестройте решение. |
| Фигуры показывают имя декоратора вместо значения свойства. | Настройте сопоставление декоратора. В схеме определения DSL щелкните карту элементов схемы — это серая линия между классом домена и классом фигуры.<br /><br /> Откройте окно **сведения о DSL** . Если вы не видите его, в меню Вид выберите **другие окна**, а затем щелкните **сведения о DSL**.<br /><br /> Перейдите на вкладку **карты декораторов** . Выберите имя декоратора. Убедитесь, что флажок рядом с ним установлен. В разделе **свойство экрана** выберите имя свойства домена.<br /><br /> Дополнительные сведения см. [в разделе фигуры на схеме](#shapes). |
| В Обозревателе DSL не удается добавить коллекцию. Например, при щелчке правой кнопкой мыши по пункт "Инструменты" в меню не отображается команда "Добавить инструмент".<br /><br /> В Обозревателе DSL не удается добавить элемент в список. | Щелкните элемент над интересующим вас узлом правой кнопкой мыши. Если вы хотите добавить элемент в список, ищите команду "Добавить" не в узле списка, а во владельце. |
| Я создал класс домена, но не могу создать экземпляры в Обозревателе языка. | Каждый класс домена, кроме корневого, должен быть целевым объектом отношения внедрения. |
| В Обозревателе DSL элементы отображаются только с именами их типов. | В определении DSL выберите свойство домена класса и в окно свойств задайте для параметра **имя элемента** значение true. |
| DSL всегда открывается в XML-редакторе. | Это происходит из-за ошибки чтения файла. Даже если вы исправите эту ошибку, необходимо будет специально сбросить редактор, чтобы он больше не выступал в качестве конструктора DSL.<br /><br /> Щелкните правой кнопкой мыши элемент проекта, выберите команду **Открыть с помощью** и выберите * Вашязык ***Designer (по умолчанию)**. |
| Панель элементов в DSL не отображается после изменения имен сборки. | Просмотрите и обновите **дслпаккаже\женератедкоде\паккаже.ТТ** . Дополнительные сведения см. в разделе [как изменить пространство имен Domain-Specific языке](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md). |
| Панель элементов в DSL не отображается, хотя имя сборки не изменялось.<br /><br /> Либо появляется сообщение о невозможности загрузить расширение. | Сбросьте экспериментальный экземпляр и выполните сборку решения заново.<br /><br /> 1. в меню Пуск Windows в разделе **все программы** разверните [!INCLUDE[vssdk_current_long](../misc/includes/vssdk_current_long_md.md)] , затем **инструменты** и щелкните **сбросить Microsoft Visual Studio экспериментальный экземпляр**.<br />2. в меню **Сборка** выберите пункт **Перестроить решение**. |

## <a name="see-also"></a>См. также раздел

- [Начало работы с доменными языками](../modeling/getting-started-with-domain-specific-languages.md)
- [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)
- [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)
