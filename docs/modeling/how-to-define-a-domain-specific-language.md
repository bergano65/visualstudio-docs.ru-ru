---
title: Определение доменного языка
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.dsltools.dsldesigner.domainrelationship
- vs.dsltools.dsldesigner.domainclass
- vs.dsltools.dsldesigner.domaintype
helpviewer_keywords:
- Domain-Specific Language, domain class
- Domain-Specific Language, external types
- Domain-Specific Language, relationships
- Domain-Specific Language, domain properties
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.prod: visual-studio-dev15
ms.technology: vs-ide-modeling
ms.openlocfilehash: 56381b86b367d7ca93c43b2918d98eb0fdc092bb
ms.sourcegitcommit: ad5fb20f18b23eb8bd2568717f61edc6b7eee5e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47860489"
---
# <a name="how-to-define-a-domain-specific-language"></a>Определение доменного языка
Для определения доменного языка (DSL), создается решение Visual Studio на основе шаблона. Ключевой частью решения является схема определения DSL, которая хранится в файле DslDefinition.dsl. Определение DSL определяет классы и фигуры DSL. После внесения изменений и добавления элементов можно добавить программный код для более детальной настройки DSL.

Если вы не знакомы с DSL впервые, мы советуем работать через **лаборатории средства DSL**, который можно найти на этом сайте: [пакет и пакет SDK моделирования](http://go.microsoft.com/fwlink/?LinkID=186128)

## <a name="templates"></a> Выбор шаблона решения
 Для определения доменного языка необходимо установить следующие компоненты.

|||
|-|-|
|Visual Studio|[http://go.microsoft.com/fwlink/?LinkId=185579](http://go.microsoft.com/fwlink/?LinkId=185579)|
|[!INCLUDE[vssdk_current_short](../modeling/includes/vssdk_current_short_md.md)]|[http://go.microsoft.com/fwlink/?LinkId=185580](http://go.microsoft.com/fwlink/?LinkId=185580)|
|Пакет SDK для визуализации и моделирования в Visual Studio||


[!INCLUDE[modeling_sdk_info](includes/modeling_sdk_info.md)]


 Чтобы создать новый доменный язык, создайте новое решение Visual Studio с помощью шаблона проекта доменного языка.

#### <a name="to-create-a-dsl-solution"></a>Создание решения DSL

1.  Создайте решение при помощи **доменный язык** шаблон, который можно найти в разделе **другие типы и расширения проекта** в **новый проект** диалоговое окно.

     ![Создание диалогового окна DSL](../modeling/media/create_dsldialog.png)

     При нажатии кнопки **ОК**, **мастер доменного языка** открывает и отображает список шаблонов решений DSL.

2.  Нажмите на каждый шаблон, чтобы увидеть его описание. Выберите решение, максимально соответствующее тому, что вы хотите создать.

     Каждый шаблон DSL определяет основной рабочий DSL. Этот DSL можно отредактировать в соответствии с вашими требованиями.

     Нажмите на каждый образец, чтобы получить дополнительную информацию.

    -   Выберите **Task Flow** для создания DSL с дорожками. Дорожки — это вертикальные или горизонтальные разделы схемы.

    -   Выберите **модели компонентов** для создания DSL с портами. Порты — это небольшие фигуры на краю более крупной фигуры.

    -   Выберите **схем классов** для создания DSL с фрагментами фигур. Фрагменты фигур содержат списки элементов.

    -   Выберите **минимальный язык** в других случаях или если вы не уверены.

    -   Выберите **минимальный конструктор WinForm** или **минимальный конструктор WPF** для создания DSL, который отображается в рабочей области Windows Forms или WPF. Вам нужно будет написать код для определения редактора. Дополнительные сведения см. в следующих разделах:

         [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)

         [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)

3.  Введите расширение имени файла для DSL на соответствующей странице мастера. Это расширение будут использовать файлы, содержащие экземпляры DSL.

    -   Выберите расширение имени файла, не связанное ни с одним другим приложением на вашем или другом компьютере, где планируется устанавливать DSL. Например **docx** и **htm** использовать нельзя расширений.

    -   Мастер предупредит, если расширение уже используется в качестве DSL. В этом случае выберите другое расширение имени файла. Можно также сбросить экземпляр экспериментального пакета SDK для Visual Studio, чтобы удалить старые экспериментальные конструкторы. Нажмите кнопку **запустить**, нажмите кнопку **все программы**, **Microsoft Visual Studio 2010 SDK**, **средства**, а затем **Сброс Microsoft Visual Studio 2010 экспериментальный экземпляр**.

4.  Также можно изменить настройки на других страницах или оставить значения по умолчанию.

5.  Нажмите кнопку **Готово**.

     Мастер создаст решение, содержащее два или три проекта, и сгенерирует код из определения DSL.

 После этого пользовательский интерфейс примет следующий вид:

 ![конструктор dsl](../modeling/media/dsl_designer.png)

 Данное решение определяет доменный язык. Дополнительные сведения см. в разделе [Обзор пользовательского интерфейса средства доменного языка](../modeling/overview-of-the-domain-specific-language-tools-user-interface.md).

### <a name="test-the-solution"></a>Тестирование решения
 Шаблон решения предоставляет рабочий DSL, который можно изменить или использовать как есть.

 Чтобы протестировать решение нажмите клавишу F5 или комбинацию клавиш CTRL + F5. Новый экземпляр Visual Studio откроется в экспериментальном режиме.

 В новом экземпляре Visual Studio в обозревателе решений откройте файл образца. Он откроется в виде схемы с панелью элементов.

 При запуске решения, созданные на **минимальный язык** шаблона, в экспериментальном экземпляре Visual Studio будет выглядеть следующим образом:

 ![](../modeling/media/dsl_min.png)

 Работа с инструментами Создайте элементы и соедините их.

 Закройте экспериментальный экземпляр Visual Studio.

> [!NOTE]
>  После изменения DSL фигуры больше не будут отображаться в тестовом файле Sample. При этом возможность создавать новые элементы сохранится.

### <a name="modifying-the-template-dsl"></a>Изменение шаблона DSL
 Переименуйте и оставьте некоторые или все классы доменов и фигур в шаблоне определения DSL. Новые имена классов должны быть действительными CLR-именами без пробелов и знаков препинания.

 Рекомендуем сохранить следующие классы:

-   Корневой класс отображается в левом верхнем углу части схемы определения DSL, в разделе **классы и отношения**. Присвойте ему другое имя, которое будет отличаться от имени DSL. Например, DSL с именем **MusicLibrary** может иметь корневой класс с именем **музыки**.

-   Класс схемы отображается в нижней правой части схемы определения DSL, в **элементов схемы** столбца. Возможно, чтобы его увидеть, экран придется прокрутить вправо. Обычно он называется _YourDsl_**схеме**.

-   Если вы использовали **Task Flow** шаблона и вы хотите создать схемы с дорожками, оставьте и переименуйте класс домена Actor и фигуру ActorSwimlane.

 Удалите или переименуйте другие классы в соответствии со своими потребностями.

## <a name="patterns"></a> Образцы определения DSL
 Рекомендуем разрабатывать DSL путем добавления или настройки одного или двух функций за один раз. Добавьте функцию, запустите DSL и протестируйте его работу, затем добавьте еще одну или несколько функций. В число типовых функций DSL входят следующие.

-   Класс домена, отношение внедрения, соединяющее элемент с моделью, фигура, предназначенная для отображения элементов класса на схеме, и средство элемента, позволяющее пользователям создавать элементы.

-   Свойства домена того или иного класса и декораторы, отображающие их на схеме.

-   Ссылочное отношение и соединитель, который отображает его на схеме, а также инструмент соединителя, который позволяет пользователям создавать связи.

-   Настройка, требующая программного кода, например проверка ограничений или команда меню.

 В следующих разделах описывается, как построить наиболее полезные виды функций DSL. Существуют много других шаблонов, с помощью которых может быть создан DSL, но эти используются наиболее часто.

> [!NOTE]
>  После добавления функции, не забудьте нажать **преобразовать все шаблоны** на панели инструментов в обозревателе решений перед построением и запуском DSL.

 На следующем рисунке показаны классы и отношения, которые являются частью DSL и используются в качестве примера в данном разделе.

 ![Внедрение связей и установка ссылок на них](../modeling/media/music_classes.png)

 Следующий рисунок является примером модели данного DSL:

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png)

> [!NOTE]
>  "Модель" означает экземпляр DSL, который создается пользователем и обычно отображается в виде схемы. В данном разделе рассматривается как схема определения DSL, так и схемы модели, которые отображаются при использовании DSL.

## <a name="classes"></a> Определение классов доменов
 Классы доменов представляют собой концепции DSL. Экземпляры *элементам модели*. В примере **MusicLibrary** DSL могут существовать классы доменов, которые с именем **альбома** и **песни**.

 Чтобы создать класс домена, можно перетащить из **именованный класс домена** инструмент в схему, а затем переименуйте класс.

 Дополнительные сведения см. в разделе [свойства доменных классов](../modeling/properties-of-domain-classes.md).

### <a name="create-an-embedding-relationship-for-each-domain-class"></a>Создание отношения внедрения для каждого класса домена
 Каждый класс домена, кроме корневого, должен быть целевым объектом хотя бы одного отношения внедрения или наследоваться от класса, который является таким целевым объектом.

 В модели каждый элемент является узлом в едином дереве отношений внедрения. Источник и целевой объект отношения внедрения часто называют родительским и дочерним элементами.

 Выбор родительского элемента для класса домена зависит от того, как зависит время жизни этих элементов от других элементов. Если узел дерева удаляется, его поддерево обычно удаляется вместе с ним. Классы элемента, существующего независимо, встроены напрямую в корневой класс.

 Обычно если вы отображаете элемент внутри другого элемента, то показываете и его отношение к владельцу. В данном случае наиболее соответствующий родительский класс — это класс контейнера. Исключение имеет место, когда элемент внутри контейнера на самом деле является ссылкой на независимый элемент. В этом случае при удалении контейнера удаляется ссылка, но не объект, на который она указывает.

 В шаблонах определения DSL, описанных в данном разделе, будем предполагать, что элементы, отображаемые внутри контейнера, при удалении контейнера также будут удалены. Возможны и более сложные схемы, которые создаются путем определения ролей.

|Отображение элемента|Родительский класс (класс внедрения)|Пример в шаблоне решения DSL|
|------------------------------|--------------------------------|--------------------------------------|
|Фигура на схеме<br /><br /> Дорожка|Корневой класс DSL|Минимальный язык<br /><br /> Поток задач: Класс субъектов|
|Фигура в дорожке|Класс домена элементов, который отображаются в качестве дорожек.|Поток задач: Класс задач|
|Элемент в списке в фигуре, удаляемый при удалении контейнера<br /><br /> Порт на краю фигуры|Класс домена, сопоставленный с фигурой контейнера|Схема классов: класс атрибута.<br /><br /> Схема компонентов: порт класса.|
|Элемент в списке, не удаляемый при удалении контейнера|Корневой класс DSL<br /><br /> Список с указанием связей и отношений||
|Не отображается напрямую|Класс, часть которого он формирует||

 В примере Music Library, альбомы (Album) отображаются как прямоугольники, в которых перечислены названия песен (Song). Следовательно, родителем элемента Album является корневой класс Music (Музыка), а родителем элемента Song (Песня) — класс Album (Альбом).

 Чтобы создать класс домена и его внедрение одновременно, щелкните **отношение внедрения** средство, а затем выберите родительский класс и нажмите кнопку на пустую часть схемы.

 Как правило, изменять имя отношения внедрения и его ролей не обязательно, так как они будут отслеживать имена классов автоматически.

 Дополнительные сведения см. в разделе [свойства доменных связей](../modeling/properties-of-domain-relationships.md) и [свойства доменных ролей](../modeling/properties-of-domain-roles.md).

> [!NOTE]
>  Внедрение не является наследованием. Дочерние элементы в отношении внедрения не наследуют свойства родительских элементов.

### <a name="add-domain-properties-to-each-domain-class"></a>Добавление свойств домена в каждый класс домена
 Свойства доменов хранят значения. Примерами являются: имя, название, дата публикации.

 Нажмите кнопку **свойства домена** в классе, нажмите клавишу ВВОД и введите имя свойства. Тип свойства домена по умолчанию — строка. Если вы хотите изменить тип, выберите свойство домена и задайте **тип** в **свойства** окна. Если нужный тип отсутствует в раскрывающемся списке, см. в разделе [Добавление типов свойств](#addTypes).

 **Установите свойство имени элемента.** Выберите свойство домена, которое может использоваться для определения элементов в Обозревателе языка. Например, в классе домена Song (Песня) можно выбрать свойство домена "Название". В **свойства** окне **имя элемента** для `true`.

### <a name="create-derived-domain-classes"></a>Создание производных классов доменов
 Если у классов доменов должны быть экземпляры, которые наследуют его свойства и отношения, можно создать классы, которые являются производными от него. Например, класс Album (Альбом) может иметь производные классы WMA и MP3.

 Создайте производный класс при помощи **доменного класса** средство.

 Нажмите кнопку **наследования** инструмент, выберите сначала производный, а также выберите базовый класс.

 Попробуйте задать **модификатор наследования** базового класса для **абстрактный**. Если вам могут понадобиться экземпляры базового класса, создайте для них отдельные производные классы.

 Производные классы наследуют свойства и роли базовых классов.

### <a name="tidy-the-dsl-definition-diagram"></a>Чистка схемы определения DSL
 При добавлении отношений некоторые из классов появятся сразу в нескольких местах. Чтобы снизить количество появлений и сделать схему шире, щелкните правой кнопкой мыши целевой класс отношения и нажмите кнопку **перенести дерево сюда**. Обратный эффект, щелкните правой кнопкой мыши целевой класс отношения и нажмите кнопку **разделить дерево**. Если эти команды меню отсутствуют, убедитесь, что выбран только класс домена.

 Для перемещения классов доменов и фигур используйте сочетания клавиш CTRL + стрелка вверх и CTRL + стрелка вниз.

### <a name="test-the-domain-classes"></a>Проверка классов доменов

##### <a name="to-test-the-new-domain-classes"></a>Чтобы проверить новые классы доменов, сделайте следующее.

1.  **Щелкните преобразовать все шаблоны** на панели инструментов в обозревателе решений, чтобы сгенерировать код конструктора DSL. Этот шаг можно автоматизировать. Дополнительные сведения см. в разделе [как автоматизировать преобразовать все шаблоны](http://msdn.microsoft.com/b63cfe20-fe5e-47cc-9506-59b29bca768a).

2.  **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением вашего DSL.

3.  **Откройте обозреватель.** AT части схемы находится окно обозревателя языка, который обычно называется *ваш язык* Explorer. Если вы не видите это окно, оно может быть на вкладке под Обозревателем решений. Если не удается найти ее, на **представление** последовательно выберите пункты **Other Windows**, а затем нажмите кнопку *ваш язык* **Explorer**.

     В обозревателе представлен вид модели в качестве дерева.

4.  **Создание новых элементов.** Щелкните правой кнопкой мыши корневой узел в верхней, а затем нажмите кнопку **Add New**_Вашкласс_.

     Новый экземпляр класса появится в Обозревателе языка.

5.  При создании новых экземпляров следите за тем, чтобы все экземпляры получали разные имена. Это происходит только в том случае, если вы задали **имя элемента** флаг в свойствах домена.

6.  **Проверьте свойства домена. С помощью экземпляра выбранного класса** проверить в окне «Свойства». Оно должно показывать свойства домена, которые вы определили для данного класса домена.

7.  **Сохраните файл, закройте его и снова открыть его**. Все созданные экземпляры должны отобразиться в обозревателе, когда вы развернете узлы.

## <a name="shapes"></a> Определение фигур на схеме
 Вы можете определить классы элементов, которые отображаются на схеме в виде прямоугольников, эллипсов или ярлыков.

#### <a name="to-define-a-class-of-elements-that-appear-as-shapes-on-a-diagram"></a>Определение класса элементов, которые отображаются на схеме в виде фигур

1.  **Определите и протестируйте класс домена, как описано в разделе**[определение классов доменов](#classes) **.** 

    -   Родителем класса должен быть корневой класс. Это значит, что между корневым классом и новым классом домена должно существовать отношение внедрения.

    -   Если в схеме есть дорожки, то родителем может быть класс домена, сопоставленный с дорожкой. Прежде чем продолжить с этой процедурой, см. в разделе [Определение DSL с дорожками](#swimlanes).

2.  **Добавьте класс фигуры** чтобы представить элементы на схеме модели. Перетащите один из следующих инструментов на схему определения DSL.

    -   **Геометрическая фигура** дает прямоугольник или эллипс.

    -   **Фигура изображения** отображает изображение, указываемое вами.

    -   **Фигура секции** представляет собой прямоугольник, содержащий один или несколько списков элементов.

     Переименуйте класс фигуры, который отображается в правой части схемы определения DSL под фигурами и соединителями.

3.  **Определите изображение, в том случае, если вы создали фигуру изображения**.

    1.  Создайте файл изображения любого размера. Поддерживаются форматы BMP, JPEG, GIF и EMF.

    2.  В Обозревателе решений добавьте файл в каталог решения Dsl\Resources.

    3.  Вернитесь в схему определения DSL и выберите новый класс фигуры изображения.

    4.  В окне «Свойства» щелкните **изображение** свойство.

    5.  В **Выбор изображения** диалогового окна щелкните стрелку раскрывающегося меню в разделе **имя файла**и выберите образ.

4.  **Добавьте текстовые декораторы в фигуру, чтобы отобразить свойства домена.**

     Чтобы отобразить имя или название элемента модели, потребуется хотя бы один декоратор.

     Щелкните заголовок класса фигуры правой кнопкой мыши **добавить**, а затем нажмите кнопку **текстовый декоратор**. Задайте имя декоратора, а также в наборе свойств окна его **позиции**.

5.  **Соедините все фигуры с карту элементов схемы в класс домена, которые они должны отображать**.

     Нажмите кнопку **карту элементов схемы** средство, а затем выберите класс домена, а затем щелкните класс фигуры.

6.  **Сопоставление свойств с текстовыми декораторами.**

    1.  Выберите серую линию между классом домена и классом фигуры, которая представляет карту элементов схемы.

    2.  В **подробные сведения о DSL** окно, нажмите кнопку **сопоставления декораторов** вкладки. Если вы не видите **подробные сведения о DSL** окна на **представление** последовательно выберите пункты **Other Windows** и нажмите кнопку **подробные сведения о DSL**. Часто нужно поднять верхнюю часть окна, чтобы увидеть все его содержимое.

    3.  Выберите имя декоратора. В разделе **отображаемое свойство**, выберите имя свойства класса домена. Повторите эти шаги для каждого декоратора.

         Если вы хотите отобразить свойство связанного элемента, нажмите кнопку раскрывающегося списка навигатор дерева на вкладке **путь к отображаемому свойству**.

    4.  Возле имени каждого декоратора должен быть установлен флажок.

     ![Сопоставление фигур и окно сведений DSL](../modeling/media/dsldetailswindow.png)

7.  **Создайте элемент панели элементов для создания элементов класса домена.**

    1.  В **обозреватель DSL**, разверните **редактор** узел и все его подузлы.

    2.  Щелкните правой кнопкой мыши узел в разделе **вкладки панели элементов** , имеет имя, совпадающее с именем вашего DSL, например MusicLibrary. Нажмите кнопку **добавить средство элемента**.

        > [!NOTE]
        >  Если щелкнуть правой кнопкой мыши **средства** узла, вы не увидите **Добавить инструмент элемента**. Вместо этого необходимо щелкнуть узел на уровень выше.

    3.  В окне "Свойства" с выбранным новым инструментом элемента задайте **класс** в недавно добавленный класс домена.

    4.  Задайте **заголовок** и **подсказки**.

    5.  Задайте **значок панели элементов** в значок, который будет отображаться в панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

         Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

         Вернитесь в схему определения DSL, выберите инструмент и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **Выбор точечного рисунка** диалоговое окно, выберите ваш. BMP-файл в раскрывающемся меню.

 Дополнительные сведения см. в разделе [свойства геометрических фигур](../modeling/properties-of-geometry-shapes.md) и [свойства фигур изображений](../modeling/properties-of-image-shapes.md).

#### <a name="to-test-shapes"></a>Тестирование Фигур

1.  **Щелкните преобразовать все шаблоны** на панели инструментов в обозревателе решений, чтобы сгенерировать код конструктора DSL.

2.  **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением вашего DSL.

3.  **Убедитесь, что средства элементов появились на панели элементов.**

4.  **Создание фигур** путем перетаскивания с помощью инструмента в схему модели.

5.  **Убедитесь, что появился каждый текстовый декоратор,** и что:

    1.  Его можно изменить, если не было выбрано **только для чтения** флаг в свойстве домена.

    2.  в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

 После первого тестирования фигуры можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [Настройка и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

## <a name="references"></a> Определение ссылочных отношений
 Между любым классом домена источника и классом домена целевого объекта можно определить ссылочное отношение. Ссылочные отношения обычно отображаются на схеме в виде соединителей — линий между фигурами.

 Например, если музыкальные альбомы (Album) и исполнители (Artist) отображаются в схеме в виде фигур, можно определить отношение с именем ArtistsAppearedOnAlbums, связывающее исполнителей и альбомы, в которых они участвуют. См. пример на рисунке.

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png)

 Ссылочные отношения могут также связывать элементы одного типа. Например, в DSL, представляющем собой генеалогическое древо, взаимосвязь между родительскими и дочерними элементами является ссылочным отношением между персонами.

### <a name="define-a-reference-relationship"></a>Определение ссылочного отношения
 Щелкните инструмент ссылочного отношения, затем класс домена источника отношения и, наконец, целевой класс домена. Целевой класс может быть таким же как и класс источника.

 Каждое отношение имеет две роли, представленные линией с каждой стороны окна отношений. Можно выбрать каждую роль и настроить ее свойства в окне "Свойства".

 **Роли следует переименовать**. Например, в отношении между персонами можно изменить имена по умолчанию на "Родители" и "Дети", "Руководитель" и "Подчиненные", "Преподаватель" и "Студент" и т. д.

 **Настройте кратность каждой роли**, если это необходимо. Если у каждой персоны должно быть не больше одного Руководителя, укажите для параметра кратности под ярлыком "Руководитель" в схеме значение "0..1".

 **Добавьте в отношение свойства домена.** На рисунке отношение между исполнителем и альбомом имеет свойство роли.

 **Установите свойство отношения, разрешить дубликаты** Если между одной парой элементов модели может существовать несколько связей одного класса. Например, можно разрешить Преподавателю обучать одного и того же Студента нескольким Дисциплинам.

 ![Карты фигур для соединителей](../modeling/media/music_connector.png)

 Дополнительные сведения см. в разделе [свойства доменных связей](../modeling/properties-of-domain-relationships.md) и [свойства доменных ролей](../modeling/properties-of-domain-roles.md).

### <a name="define-a-connector-to-display-the-relationship"></a>Определение соединителя для отображения отношения
 Соединитель отображает линию между двумя фигурами в схеме модели.

 Перетащите **соединитель** инструмент в схему определения DSL.

 Добавьте текстовые декораторы если необходимо отобразить ярлыки на соединителе. Установите их расположение. Чтобы разрешить пользователю двигать текстовый декоратор, установите его **допускается перемещение** свойство.

 Используйте **карту элементов схемы** средство, чтобы связать соединитель со ссылочным отношением.

 С выбранной картой элементов схемы откройте **подробные сведения о DSL** окна и открыть **сопоставления декораторов** вкладки.

 Выберите каждую **декоратор** и задайте **отображаемое свойство** в соответствующее свойство домена.

 Убедитесь, что флажок возле каждого элемента в **декораторы** списка.

### <a name="define-a-connection-builder-tool"></a>Определение средства построителя подключений
 В **обозреватель DSL** окне разверните **редактор** узел и все его подузлы.

 Щелкните правой кнопкой мыши узел, имеющий имя, совпадающее с именем вашего DSL, а затем нажмите кнопку **добавить новое средство подключения**.

 Выбрав новый инструмент, в окне "Свойства":

-   Задайте **заголовок** и **подсказки**.

-   Нажмите кнопку **построитель подключения** и выберите соответствующий построитель для нового отношения.

-   Задайте **значок панели элементов** значка, который будет отображаться на панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернитесь в схему определения DSL, выберите инструмент и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **Выбор точечного рисунка** диалоговое окно, выберите ваш. BMP-файл в раскрывающемся меню.

##### <a name="to-test-a-reference-relationship-and-connector"></a>Тестирование ссылочного отношения и соединителя

1.  **Щелкните преобразовать все шаблоны** на панели инструментов в обозревателе решений, чтобы сгенерировать код конструктора DSL.

2.  **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением вашего DSL.

3.  **Убедитесь, что средства подключений появились на панели элементов.**

4.  **Создание фигур** путем перетаскивания с помощью инструмента в схему модели.

5.  **Создание подключений** между фигурами. Выберите соединитель, щелкните фигуру, а затем выберите другую фигуру.

6.  **Убедитесь, что не можете создать соединения между несоответствующими классами.** Например, если установлено отношение между Альбомами и Исполнителями, убедитесь, что нельзя связать Исполнителей с Исполнителями.

7.  **Проверьте правильность кратности. Например убедитесь, что персону нельзя соединить более чем одному менеджеру.**

8.  **Убедитесь, что появился каждый текстовый декоратор,** и что:

    1.  Его можно изменить, если не было выбрано **только для чтения** флаг в свойстве домена.

    2.  в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

 После первого тестирования соединителя можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [Настройка и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

## <a name="compartments"></a> Определение фигур, содержащих списки: фигуры Compartment.
 Фигура секции содержит один или несколько списков элементов. Например, в DSL Music Library можно использовать фигуру секции для представления музыкальных Альбомов. В каждом Альбоме есть список Песен.

 ![Фигура секции](../modeling/media/compartmentshape.png)

 Самый простой способ добиться этого эффекта в определении DSL — это определить один класс домена для контейнера и один класс домена для каждого списка. Класс контейнера сопоставлен с фигурой секции.

 ![Карта фигур](../modeling/media/music_mapcomp.png)

 Дополнительные сведения см. в разделе [свойства фигуры секций](../modeling/properties-of-compartment-shapes.md).

#### <a name="to-define-a-compartment-shape"></a>Определение фигуры секции

1.  **Создать класс домена контейнера**. Нажмите кнопку **отношение внедрения** инструмент, щелкните корневой класс модели, а затем щелкните пустую часть схемы определения DSL. Это создаст класс домена, который на рисунке примера называется Album.

     В качестве альтернативы вместо встраивания в корневой класс можно встроить контейнер в класс домена, сопоставленный с дорожкой.

     Добавьте к классу свойство домена, например имя и задайте его **имя элемента** флага в окне «Свойства».

2.  **Создать класс домена элементов списка**. Нажмите кнопку **отношение внедрения** инструмент, щелкните класс контейнера (Album), а затем щелкните пустую область схемы. Это создаст класс домена, который на рисунке примера называется Song (Песня).

     Добавьте свойство домена, например заголовка к классу и задайте его **имя элемента** флаг.

     Добавьте другие свойства домена.

     Добавьте по классу домена для каждого списка элементов, который необходимо отобразить.

3.  **Чтобы смешать несколько типов элемента в списке**, создавать классы, наследующие от класса list. Сделайте класс списка абстрактным, задав его **модификатор наследования**.

     Например, если вы хотите, чтобы классическая музыка сортировалась по композитору, а не по исполнителю, можно создать в классе Song (Песня) два подкласса: ClassicalSong (Классические) и NonClassicalSong (Не классические).

4.  **Создайте фигуру секции**. Перетащите из **фигуры секции** инструмент в схему определения DSL.

     Добавьте текстовый декоратор и укажите для него имя.

     Добавьте секцию и укажите для нее имя.

5.  Чтобы позволить пользователю скрывать секции списка, щелкните класс фигуры секции правой кнопкой мыши, наведите указатель на **добавить**, а затем нажмите кнопку **развернуть/свернуть декоратор**. В окне "Свойства" задайте расположение декоратора.

6.  Нажмите кнопку **карту элементов схемы** средство, щелкните класс домена контейнера и нажмите кнопку фигуры секции.

7.  Выберите связь карты элемента схемы между классом домена и фигурой. В **подробные сведения о DSL** окна:

    1.  Нажмите кнопку **декораторы** вкладки. Выберите имя декоратора, а затем выберите соответствующий элемент в разделе **отображаемое свойство**. Убедитесь, что возле имени каждого декоратора установлен флажок.

    2.  Нажмите кнопку **карты секций** вкладки.

         Выберите имя секции.

         В разделе **путь коллекции отображенных элементов**, перейдите к класс списка элементов (Song). Щелкните стрелку раскрывающегося меню, чтобы воспользоваться инструментом навигации.

         В разделе **отображаемое свойство**, выберите свойство, которое должно отображаться в списке. В этом примере это свойство — Название.

> [!NOTE]
>  Используя поля "Путь" в карте декораторов и полях в карте секций, установите более сложные отношения между классами доменов и фигурой секции.

#### <a name="to-define-a-tool-for-creating-the-shape"></a>Определение инструмента для создания фигуры

1.  **Создайте элемент панели элементов для создания элементов класса домена.**

2.  В **обозреватель DSL**, разверните **редактор** узел и все его подузлы.

3.  Щелкните правой кнопкой мыши узел в разделе **вкладки панели элементов** , имеет имя, совпадающее с именем вашего DSL, например MusicLibrary. Нажмите кнопку **добавить средство элемента**.

    > [!NOTE]
    >  Если щелкнуть правой кнопкой мыши **средства** узла, вы не увидите **Добавить инструмент элемента**. Вместо этого необходимо щелкнуть узел на уровень выше.

4.  В окне "Свойства" с выбранным новым инструментом элемента задайте **класс** в недавно добавленный класс домена.

5.  Задайте **заголовок** и **подсказки**.

6.  Задайте **значок панели элементов** в значок, который будет отображаться в панели элементов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернитесь в схему определения DSL, выберите инструмент и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **Выбор точечного рисунка** диалоговом окне выберите BMP-файл в раскрывающемся меню.

#### <a name="to-test-a-compartment-shape"></a>Тестирование фигуры сегмента

1.  **Щелкните преобразовать все шаблоны** на панели инструментов в обозревателе решений, чтобы сгенерировать код конструктора DSL.

2.  **Постройте и запустите DSL.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением вашего DSL.

3.  **Убедитесь, что инструмент появился на панели элементов.**

4.  Перетащите инструмент в схему модели. Будет создана новая фигура.

     Убедитесь, что имя элемента отображается и автоматически получает значение по умолчанию.

5.  Щелкните правой кнопкой мыши заголовок новой фигуры, а затем нажмите кнопку Добавить *элемент списка.* В этом примере используется команда "Добавить песню".

     Убедитесь, что элемент отображается в списке под новым именем.

6.  Щелкните один из элементов списка и проверьте окно "Свойства". В нем должны появиться свойства элементов списка.

7.  Откройте Обозреватель языка. Убедитесь, что узлы контейнера содержат узлы элементов списка.

 ![Созданный обозреватель DSL](../modeling/media/music_explorer.png)

 После первого тестирования фигуры секции можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [Настройка и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

### <a name="displaying-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции
 Обычно элемент, который отображается в секции, является дочерним для элемента, который представлен фигурой фрагмента. Однако в некоторых случаях можно отобразить элемент, который связан с ним ссылочным отношением.

 Например, можно добавить вторую секцию в элемент AlbumShape, отображающий список Исполнителей, которые связаны с Альбомом.

 В этом случае секция должна отображать связь вместо элемента, на который она ссылается. Это связано с тем, что, когда пользователь выбирает элемент в секции и нажимает клавишу DELETE, должна удаляться связь, а не элемент, на который создана ссылка.

 Тем не менее можно сделать так, чтобы имя элемента, на который создана ссылка, отображалось в секции.

 Следующая процедура предполагает, что вы уже создали класс домена, ссылочное отношение, фигуру секции и карту элементов схемы, как описано выше в этом разделе.

##### <a name="to-display-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции

1.  **Добавьте секцию в фигуру секции**. На схеме определения DSL щелкните класс фигуры секции правой кнопкой мыши **добавить**, а затем нажмите кнопку **секции**.

2.  Задайте **путь коллекции отображенных элементов** для перехода по ссылке, а не к целевому элементу. Откройте раскрывающееся меню и выберите в представлении дерева вместо цели ссылочное отношение. В примере связь является **ArtistAppearedOnAlbums**.

3.  Задайте **путь для отображения свойства** для перехода по ссылке в целевой элемент. В приведенном примере это **исполнителя**.

4.  Задайте **отображаемое свойство** соответствующее свойство целевого элемента, например **имя**.

5.  **Преобразовать все шаблоны**, построения и запустите DSL и откройте тестовую модель.

6.  В схеме модели создайте соответствующие классы фигур, присвойте им имена и создайте связь между ними. В фигуре секции должны появиться имена связанных элементов.

7.  Выберите связь или элемент в фигуре секции. Связь и элемент должны исчезнуть.

## <a name="ports"></a> Определение портов на границе другой фигуры
 Порт — это фигура, которая находится на границе с другой фигурой.

 Порты могут также использоваться для предоставления фиксированной точки соединения с другой фигурой, для которой пользователь может нарисовать соединители. В данном случае фигуру порта можно сделать прозрачной.

 Чтобы увидеть пример, использующий порты, выберите **схема компонентов** шаблона при создании нового решения DSL. В данном примере показаны основные точки, которые можно использовать при определении портов.

-   Класс домена, который представляет контейнер портов (`Component`).

-   Класс домена, который представляет порты. В этом примере используется класс `ComponentPort`.

-   Отношение внедрения между классом домена контейнера и классом домена порта. Дополнительные сведения см. в разделе [определение классов доменов](#classes).

-   Если в одном контейнере нужно смешать разные типы портов, можно создать подклассы класса домена порта. В данном примере `InPort` и `OutPort` наследуются от `ComponentPort`.

-   Класс домена контейнера может быть сопоставлен с любым видом фигуры. В этом примере используется `ComponentShape`. Дополнительные сведения см. в разделе [определение фигур](#shapes).

-   Классы доменов портов сопоставлены с фигурами портов. Можно сопоставить либо производные классы с отдельными классами фигур портов, либо базовый класс с одним классом фигуры порта.

 В остальном фигуры портов ведут себя как описано в разделе [определение фигур](#shapes).

 Дополнительные сведения см. в разделе [свойства фигур портов](../modeling/properties-of-port-shapes.md).

## <a name="swimlanes"></a> Определение DSL с дорожками
 Дорожки — это вертикальные или горизонтальные разделения схемы. Каждая дорожка соответствует элементу модели. Определение DSL требует одного класса домена для элементов дорожек.

 Лучший способ создать DSL с дорожками — это создать новое решение DSL и выбрать шаблон решения "Поток задач". В определении DSL класс субъекта является классом домена, сопоставленным с дорожкой. Переименуйте его и другие классы в соответствии со своим проектом.

 Чтобы добавить класс, который будет отображаться как фигура внутри дорожки, создайте отношение внедрения между классом дорожки и новым классом. Пользователи смогут перетаскивать элементы из одной дорожки в другую, но каждый элемент всегда будет находиться внутри конкретной дорожки. В шаблоне решения "Поток задач", FlowElement является дочерним классом класса дорожки.

 Чтобы добавить класс, который будет отображаться как фигура, независимая от дорожки, создайте отношение внедрения между корневым и новым классами. Пользователи смогут размещать эти фигуры в любом месте схемы, в т. ч. на границах и за пределами дорожек. В шаблоне решения "Поток задач", Comment является дочерним классом класса дорожки.

 Дополнительные сведения см. в разделе [свойства из дорожки](../modeling/properties-of-swimlanes.md).

## <a name="addTypes"></a> Добавление типов свойств

### <a name="domain-enumerations-and-literals"></a>Доменные перечисления и литералы
 Доменное перечисление — это тип с несколькими значениями литералов.

 Чтобы добавить доменное перечисление, щелкните правой кнопкой мыши корень модели в **обозреватель DSL** и нажмите кнопку **добавить новое доменное перечисление**. Элемент будет отображаться в **обозреватель DSL** под **типов домена** узла. Этот элемент не отображается в схеме.

 Чтобы добавить литералы в доменное перечисление, щелкните правой кнопкой мыши доменное перечисление в **обозреватель DSL** и нажмите кнопку **добавить новый литерал перечисления**.

 По умолчанию свойство, которое имеет тип перечисления, может иметь только одно значение перечисления за раз. Пользователям и программистам, чтобы иметь возможность устанавливать любую комбинацию значений: «битовое поле —» задайте **IsFlags** свойства перечисления.

### <a name="external-types"></a>Внешние типы
 При установке типа свойства домена, если не удается найти тип требуется **тип** стрелку раскрывающегося списка, можно добавить внешний тип. Например, можно добавить **System.Drawing.Color** типа в список.

 Чтобы добавить тип, щелкните правой кнопкой мыши корень модели в обозревателе DSL и нажмите кнопку **добавить новый внешний тип**. В окне свойств задайте имя **цвет** и пространство имен **System.Drawing**. Этот тип теперь появится в обозревателе DSL под узлом **типов домена**. и будет доступен для выборе при установке типа свойства домена.

## <a name="custom"></a> Настройка DSL
 Используя техники, описанные в этом разделе, можно быстро создать DSL со схематическим представлением, читаемой формой XML и основными инструментами, необходимыми для генерирования кода или других артефактов.

 Существуют два метода расширения определения DSL.

1.  Точная настройка DSL с использованием многочисленных функций определения DSL. Например, можно сделать единое средство подключения, способное создавать несколько типов соединителей, и настроить правила, по которым удаление одного элемента ведет к удалению связанных элементов. Большинство этих техник требуют установки значений в определении DSL, а некоторые — написания нескольких строк программного кода.

     Дополнительные сведения см. в разделе [Настройка и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

2.  Расширение инструментов моделирования с помощью программного кода для достижения более сложных эффектов. Например, можно создать команды меню, способные изменять модель, а также инструменты, соединяющие в себе два и более DSL. VMSDK разработан специально для того, чтобы облегчить интеграцию расширений с кодом, который генерируется из определения DSL.  Дополнительные сведения см. в разделе [написание кода для настройки доменного языка](../modeling/writing-code-to-customise-a-domain-specific-language.md).

### <a name="changing-the-dsl-definition"></a>Изменение определения DSL
 При создании любого элемента в определении DSL многие значения устанавливаются автоматически. Установленные значения можно изменять. Это упрощает разработку DSL и в то же время позволяет осуществлять значительные настройки.

 Например, когда фигура сопоставляется с элементом, путь родительского элемента сопоставления автоматически устанавливается согласно отношению внедрения соответствующего класса домена. Если же впоследствии отношение внедрения корректируется, путь родительского элемента автоматически не изменяется.

 Следовательно, необходимо знать, что при изменении некоторых взаимосвязей в определении DSL нет ничего необычного в том, что при сохранении определения или трансформации всех шаблонов будут выдаваться сообщения об ошибках. Большинство этих ошибок легко исправить. Откройте сообщение об ошибке двойным щелчком кнопки мыши, чтобы найти расположение ошибки.

 См. также [как: изменение пространства имен доменного языка](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md).

## <a name="trouble"></a> Устранение неполадок
 В следующей таблице перечислено большинство стандартных проблем, возникающих при разработке DSL, а также предложения по их решению. Дополнительные советы можно найти в [по расширению инструментов визуализации](http://go.microsoft.com/fwlink/?LinkId=186074).

|Проблема|Предложение|
|-------------|----------------|
|Изменения, внесенные в файл определения DSL, не работают.|Нажмите кнопку **преобразовать все шаблоны** на панели инструментов над обозревателе решений и перестройте решение.|
|Фигуры показывают имя декоратора вместо значения свойства.|Настройте сопоставление декоратора. В схеме определения DSL щелкните карту элементов схемы — это серая линия между классом домена и классом фигуры.<br /><br /> Откройте **подробные сведения о DSL** окна. Если вы не может его найти, в меню "Вид", выберите **Other Windows**, а затем нажмите кнопку **подробные сведения о DSL**.<br /><br /> Нажмите кнопку **сопоставления декораторов** вкладки. Выберите имя декоратора. Убедитесь, что флажок рядом с ним установлен. В разделе **отображаемое свойство**, выберите имя свойства домена.<br /><br /> Дополнительные сведения см. в разделе [фигур на схеме](#shapes).|
|В Обозревателе DSL не удается добавить коллекцию. Например, при щелчке правой кнопкой мыши по пункт "Инструменты" в меню не отображается команда "Добавить инструмент".<br /><br /> В Обозревателе DSL не удается добавить элемент в список.|Щелкните элемент над интересующим вас узлом правой кнопкой мыши. Если вы хотите добавить элемент в список, ищите команду "Добавить" не в узле списка, а во владельце.|
|Я создал класс домена, но не могу создать экземпляры в Обозревателе языка.|Каждый класс домена, кроме корневого, должен быть целевым объектом отношения внедрения.|
|В Обозревателе DSL элементы отображаются только с именами их типов.|В определении DSL выберите свойство домена класса и в окне свойств задайте окне **имя элемента** значение true.|
|DSL всегда открывается в XML-редакторе.|Это происходит из-за ошибки чтения файла. Даже если вы исправите эту ошибку, необходимо будет специально сбросить редактор, чтобы он больше не выступал в качестве конструктора DSL.<br /><br /> Щелкните правой кнопкой мыши элемент проекта, нажмите кнопку **открыть с помощью** и выберите _ваш язык_**конструктор (по умолчанию)**.|
|Панель элементов в DSL не отображается после изменения имен сборки.|Проверьте и обновите **DslPackage\GeneratedCode\Package.tt** Дополнительные сведения см. в разделе [как: изменение пространства имен доменного языка](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md).|
|Панель элементов в DSL не отображается, хотя имя сборки не изменялось.<br /><br /> Либо появляется сообщение о невозможности загрузить расширение.|Сбросьте экспериментальный экземпляр и выполните сборку решения заново.<br /><br /> 1.  В Windows меню "Пуск", в разделе **все программы**, разверните [!INCLUDE[vssdk_current_long](../misc/includes/vssdk_current_long_md.md)], затем **средства**, а затем нажмите кнопку **Сброс Microsoft Visual Studio экспериментального экземпляра**.<br />2.  На **построения** меню, щелкните **Перестроить решение**.|

## <a name="see-also"></a>См. также

- [Начало работы с доменными языками](../modeling/getting-started-with-domain-specific-languages.md)
- [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)
- [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)