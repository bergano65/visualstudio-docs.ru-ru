---
title: Пошаговое руководство. Запись графических сведений программными средствами | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
ms.assetid: a5adeff9-afaf-4047-b5ce-ef0aefe710eb
caps.latest.revision: 24
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: c1a5e5d8d33fed3c4e6348bcf2598f7093de5c98
ms.sourcegitcommit: 1fc6ee928733e61a1f42782f832ead9f7946d00c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2019
ms.locfileid: "60093115"
---
# <a name="walkthrough-capturing-graphics-information-programmatically"></a>Пошаговое руководство. Запись графических сведений программными средствами
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

С помощью диагностики графики [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] можно программно захватывать графические данные из приложения Direct3D.  
  
 Программный захват полезен в следующих сценариях.  
  
- Начните захват программным образом, когда приложение графики не использует имеющуюся цепочку буферов, например при отрисовке до текстуры.  
  
- Начните захват программным образом, если приложение вообще не выполняет отрисовку, например, когда оно использует DirectCompute для выполнения вычислений.  
  
- Вызывайте `CaptureCurrentFrame`в случаях, когда проблемы с отрисовкой трудно предугадать и выявить при ручном тестировании, но можно прогнозировать программно при помощи информации о состоянии приложения во время выполнения.  
  
## <a name="CaptureDX11_2"></a> Программный захват в Windows 8.1  
 В этой части пошагового руководства демонстрируется программный захват в приложениях, где применяется интерфейс API DirectX 11.2 в Windows 8.1, который использует метод надежного захвата. Информацию об использовании программного захвата в приложениях, в которых применяются более ранние версии DirectX в Windows 8.0, см. в разделе [Programmatic capture in Windows 8.0 and earlier](#CaptureDX11_1) далее в этом пошаговом руководстве.  
  
 В этом разделе рассмотрены следующие задачи:  
  
- подготовка приложения к использованию программного захвата;  
  
- получение интерфейса IDXGraphicsAnalysis;  
  
- Захват графической информации  
  
> [!NOTE]
>  В предыдущих реализациях программного захвата использовались инструменты удаленной отладки для [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] для предоставления функций захвата, Windows 8.1 поддерживает захват напрямую через Direct3D 11.2. Поэтому вам больше не нужно устанавливать инструменты удаленной отладки для программного захвата в Windows 8.1.  
  
### <a name="preparing-your-app-to-use-programmatic-capture"></a>подготовка приложения к использованию программного захвата;  
 Для использования программного захвата в приложении оно должно содержать необходимые заголовки. Эти заголовки являются частью пакета SDK для Windows 8.1.  
  
##### <a name="to-include-programmatic-capture-headers"></a>Включение заголовков программного захвата  
  
- Включите следующие заголовки в исходный файл, в котором будет определен интерфейс IDXGraphicsAnalysis:  
  
    ```  
    #include <DXGItype.h>  
    #include <dxgi1_2.h>  
    #include <dxgi1_3.h>  
    #include <DXProgrammableCapture.h>  
    ```  
  
    > [!IMPORTANT]
    >  Не включайте заголовок файла vsgcapture.h—which поддерживает программный захват в Windows 8.0 и более ранних версий, для выполнения программного захвата в приложениях Windows 8.1. Этот заголовок несовместим с DirectX 11.2. Если этот файл включен после заголовка d3d11_2.h включено, компилятор выдает предупреждение. Если vsgcapture.h включен перед d3d11_2.h, приложение не запустится.  
  
    > [!NOTE]
    >  Если пакет SDK DirectX от июня 2010 г. установлен на компьютере и путь включаемых файлов проекта содержит строку `%DXSDK_DIR%includex86`, переместите ее в конец пути включаемых файлов. Сделайте то же самое для пути к библиотеке.  
  
#### <a name="windows-phone-81"></a>Windows Phone 8.1  
 Поскольку пакет SDK для Windows Phone 8.1 не включает заголовок DXProgrammableCapture.h, необходимо определить `IDXGraphicsAnalysis` интерфейс самостоятельно, чтобы вы могли использовать `BeginCapture()` и `EndCapture()` методы. Включите другие заголовки, как описано в предыдущем разделе.  
  
###### <a name="to-define-the-idxgraphicsanalysis-interface"></a>Определение интерфейса IDXGraphicsAnalysis  
  
- Определите интерфейс IDXGraphicsAnalysis в том же файле, в который вы включили файлы заголовков.  
  
  ```  
  interface DECLSPEC_UUID("9f251514-9d4d-4902-9d60-18988ab7d4b5") DECLSPEC_NOVTABLE  
  IDXGraphicsAnalysis : public IUnknown  
  {  
      STDMETHOD_(void, BeginCapture)() PURE;  
      STDMETHOD_(void, EndCapture)() PURE;  
  };  
  ```  
  
  Для удобства эти действия можно выполнить в новом файле заголовка, а затем включить его в нужном месте в приложении.  
  
### <a name="getting-the-idxgraphicsanalysis-interface"></a>получение интерфейса IDXGraphicsAnalysis;  
 Чтобы получить возможность захватывать графические данные из DirectX 11.2, необходимо получить интерфейс отладки DXGI.  
  
> [!IMPORTANT]
>  При использовании программного захвата, необходимо запустить приложение в режиме диагностики графики (Alt + F5 в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]) или в разделе [программа командной строки для захвата](../debugger/command-line-capture-tool.md).  
  
##### <a name="to-get-the-idxgraphicsanalysis-interface"></a>Получение интерфейса IDXGraphicsAnalysis  
  
- Чтобы подключить интерфейс IDXGraphicsAnalysis к интерфейсу отладки DXGI, выполните указанный ниже код.  
  
    ```  
    IDXGraphicsAnalysis* pGraphicsAnalysis;  
    HRESULT getAnalysis = DXGIGetDebugInterface1(0, __uuidof(pGraphicsAnalysis), reinterpret_cast<void**>(&pGraphicsAnalysis));  
    ```  
  
     Проверьте значение `HRESULT` , возвращенное `DXGIGetDebugInterface1` , чтобы убедиться в том, что вы получили допустимый интерфейс перед тем, как его использовать.  
  
    ```  
    if (FAILED(getAnalysis))  
    {  
        // Abort program or disable programmatic capture in your app.  
    }  
    ```  
  
    > [!NOTE]
    >  Если файл `DXGIGetDebugInterface1` возвращает `E_NOINTERFACE` , (`error: E_NOINTERFACE No such interface supported`), убедитесь, что приложение запущено в диагностике графики (клавиши ALT+F5 в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]).  
  
### <a name="capturing-graphics-information"></a>Захват графической информации  
 Получив допустимый интерфейс `IDXGraphicsAnalysis` , можно использовать `BeginCapture` и `EndCapture` для захвата графических данных.  
  
##### <a name="to-capture-graphics-information"></a>Захват графических данных  
  
- Чтобы начать захват графических данных, используйте `BeginCapture`.  
  
    ```  
    ...  
    pGraphicsAnalysis->BeginCapture();  
    ...  
    ```  
  
     При вызове `BeginCapture` захват начинает выполняться немедленно, не дожидаясь начала следующего кадра. Захват заканчивается при выводе текущего кадра или при вызове `EndCapture`.  
  
    ```  
    ...  
    pGraphicsAnalysis->EndCapture();  
    ...  
    ```  
  
## <a name="CaptureDX11_1"></a> Programmatic capture in Windows 8.0 and earlier  
 В этой части пошагового руководства демонстрируется программный захват в приложениях для Windows 8.0 и более ранних версий, где применяется интерфейс API DirectX 11.1, использующий устаревший метод захвата. Сведения об использовании программного захвата в приложениях, в которых применяется DirectX 11.2 в Windows 8.1, см. в разделе [Программный захват в Windows 8.1](#CaptureDX11_2) ранее в этом пошаговом руководстве.  
  
 В этом разделе рассматриваются следующие задачи:  
  
- подготовка компьютера к использованию программного захвата;  
  
- подготовка приложения к использованию программного захвата;  
  
- настройка имени и расположения файла журнала графики;  
  
- использование API `CaptureCurrentFrame` .  
  
### <a name="preparing-your-computer-to-use-programmatic-capture"></a>подготовка компьютера к использованию программного захвата;  
 API программного захвата использует Инструменты удаленной отладки для [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] для предоставления функциональности захвата. На компьютере, на котором будет выполняться приложение, должны быть установлены Инструменты удаленной отладки, даже если программный захват используется на локальном компьютере. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] не следует запускать при выполнении программного захвата на локальном компьютере.  
  
 Для использования API удаленного захвата в приложении, которое работает на компьютере, необходимо сначала установить Инструменты удаленной отладки для [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] на этом компьютере. Разные версии Инструментов удаленной отладки поддерживают различные аппаратные платформы. Сведения о способах установки средств удаленной отладки см. на [странице скачивания средств удаленной отладки](http://go.microsoft.com/fwlink/p/?LinkId=246691) веб-сайта для скачивания файлов Майкрософт.  
  
 Кроме того, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] может устанавливать необходимые компоненты для выполнения удаленного захвата для 32-разрядных приложений.  
  
> [!NOTE]
>  Поскольку большинство классических приложений Windows, включая [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], не поддерживаются в [!INCLUDE[win8](../includes/win8-md.md)] для устройств ARM, использование Инструментов удаленной отладки для [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] вместе с API программного захвата является единственным способом захвата диагностики графики на устройствах ARM.  
  
### <a name="preparing-your-app-to-use-programmatic-capture"></a>подготовка приложения к использованию программного захвата;  
 Чтобы использовать средства диагностики графики, сначала нужно захватить графические данные для него. Их можно захватывать программно с помощью API `CaptureCurrentFrame` .  
  
##### <a name="to-prepare-your-app-to-capture-graphics-information-programmatically"></a>Подготовка приложения для программного захвата графических данных  
  
1. Убедитесь в том, что заголовок `vsgcapture.h` включен в исходный код приложения. Его можно включить только в одном месте, например в файле исходного кода, где будет вызываться API программного захвата, или в предварительно скомпилированном файле заголовка для вызова API из нескольких файлов исходного кода.  
  
2. Если нужно захватить остаток текущего кадра, в исходном коде приложения вызовите `g_pVsgDbg->CaptureCurrentFrame()`. Этот метод не принимает параметров и не возвращает значений.  
  
### <a name="configuring-the-name-and-location-of-the-graphics-log-file"></a>настройка имени и расположения файла журнала графики;  
 Журнал графики создается в расположении, которое определяется макросами `DONT_SAVE_VSGLOG_TO_TEMP` и `VSG_DEFAULT_RUN_FILENAME` .  
  
##### <a name="to-configure-the-name-and-location-of-the-graphics-log-file"></a>Настройка имени и расположения файла журнала графики  
  
- Чтобы предотвратить запись журнала графики во временный каталог, перед строкой `#include <vsgcapture.h>` добавьте следующий код:  
  
  ```  
  #define DONT_SAVE_VSGLOG_TO_TEMP  
  ```  
  
   С помощью этого значения можно задать запись журнала графики в расположение относительно рабочего каталога или по абсолютному пути, если определение `VSG_DEFAULT_RUN_FILENAME` — абсолютный путь.  
  
- Чтобы сохранить журнал графики в другое место или присвоить ему другое имя файла, перед строкой `#include <vsgcapture.h>` добавьте следующий код:  
  
  ```  
  #define VSG_DEFAULT_RUN_FILENAME <filename>  
  ```  
  
   Если не выполнить это действие, файл будет иметь имя default.vsglog. Если элемент `DONT_SAVE_VSGLOG_TO_TEMP`не определен, расположение файла является относительным к временному каталогу. В противном случае оно является относительным к рабочему каталогу или представляет собой другое расположение, если указано абсолютное имя файла.  
  
  Для [!INCLUDE[win8_appname_long](../includes/win8-appname-long-md.md)] приложения, расположение временного каталога для каждого пользователя и приложения и обычно находится в расположении, например C:\users\\*username*\AppData\Local\Packages\\ *имя семейства пакетов*\TempState\\. Для классических приложений расположение временного каталога, относится к каждому пользователю и обычно находится в расположении, например C:\Users\\*username*\AppData\Local\Temp\\.  
  
> [!NOTE]
>  Для записи в определенное расположение необходимо иметь разрешения на запись в него; в противном случае возникает ошибка. Имейте в виду, что приложения [!INCLUDE[win8_appname_long](../includes/win8-appname-long-md.md)] имеют больше ограничений, чем классические приложения, касающиеся того, куда они могут записывать данные. Для записи в некоторые расположения может потребоваться дополнительная настройка.  
  
### <a name="capturing-the-graphics-information"></a>Захват графических данных  
 Подготовив приложение для программного захвата и при необходимости настроив расположение и имя файла журнала графики, выполните сборку приложения, а затем запустите или отладьте его, чтобы захватить данные. Не запускайте диагностику графики из [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] при использовании API программного захвата. Журнал графики записывается в указанное расположение. Если нужно сохранить эту версию журнала, переместите ее в другое расположение. В противном случае она будет перезаписана при повторном запуске приложения.  
  
> [!TIP]
>  Во время программного захвата можно также захватывать графические данные вручную. Для этого нажмите клавишу **PRINT SCREEN**, когда приложение находится в фокусе. Этот прием можно использовать для захвата дополнительных графических данных, которые не захватываются с помощью API программного захвата.  
  
## <a name="next-steps"></a>Следующие шаги  
 В этом пошаговом руководстве было продемонстрировано, как захватывать графические данные программным путем. Далее можно перейти к рассмотрению следующего этапа.  
  
- Узнайте, как анализировать захваченные графические данные с помощью средств диагностики графики. См. в разделе [Обзор](../debugger/overview-of-visual-studio-graphics-diagnostics.md).  
  
## <a name="see-also"></a>См. также  
 [Пошаговое руководство: запись графических сведений](../debugger/walkthrough-capturing-graphics-information.md)   
 [Capturing Graphics Information](../debugger/capturing-graphics-information.md)   
 [Программа командной строки для захвата](../debugger/command-line-capture-tool.md)
