---
title: Интеграция Visual Studio (MSBuild) | Документы Майкрософт
ms.custom: ''
ms.date: 2018-06-30
ms.prod: visual-studio-dev14
ms.reviewer: ''
ms.suite: ''
ms.technology:
- vs-ide-sdk
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- MSBuild, reference resolution
- MSBuild, well-known target names
- MSBuild, hosting
- MSBuild, editing project files
- MSBuild, Visual Studio integration
- MSBuild, IntelliSense
- MSBuild, output groups
- MSBuild, in-process compilers
- MSBuild, design-time target execution
ms.assetid: 06cd6d7f-8dc1-4e49-8a72-cc9e331d7bca
caps.latest.revision: 26
author: mikejo5000
ms.author: mikejo
manager: ghogen
ms.openlocfilehash: f49afd0b0f613e2617c7533f85e4f6efdd2db7e3
ms.sourcegitcommit: 55f7ce2d5d2e458e35c45787f1935b237ee5c9f8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2018
ms.locfileid: "47568495"
---
# <a name="visual-studio-integration-msbuild"></a>Интеграция Visual Studio (MSBuild)
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Последнюю версию этого раздела можно найти в [интеграция с Visual Studio (MSBuild)](https://docs.microsoft.com/visualstudio/msbuild/visual-studio-integration-msbuild).  
  
  
[!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] размещается в Visual Studio для загрузки и сборки управляемых проектов. Поскольку [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] отвечает за проект, в [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] можно успешно использовать практически любой проект в формате [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], даже если проект был создан с помощью другого инструмента и участвует в процессе пользовательского построения.  
  
 В данном разделе рассматриваются специфические аспекты размещения [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] продуктом [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)], которые необходимо учитывать при настройке проектов и файлов в формате .targets, которые требуется загрузить и создать построение в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]. Это поможет вам обеспечить наличие в настраиваемом проекте таких функций [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], как IntelliSense и отладка.  
  
 Дополнительные сведения о проектах C++ см. в разделе [Файлы проекта](http://msdn.microsoft.com/library/5261cf45-3136-40a6-899e-dc1339551401).  
  
## <a name="project-file-name-extensions"></a>Расширения имени файла проекта  
 Файл MSBuild.exe распознает любое расширение имени файла проекта, если оно соответствует шаблону .*proj. Однако [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] распознает только подмножество расширений этих имен файлов проекта, определяющее языковую систему проекта, которая будет загружать проект. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] не имеет не зависящей от языка системы проекта, основанной на использовании [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)].  
  
 Например, система проекта [!INCLUDE[csprcs](../includes/csprcs-md.md)] загружает файлы формата .csproj, но [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] не может загрузить файл формата .xxproj. Файл проекта для исходных файлов на любом языке должен использовать то же самое расширение, что и файлы проектов [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] или [!INCLUDE[csprcs](../includes/csprcs-md.md)], чтобы их можно было загрузить в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)].  
  
## <a name="well-known-target-names"></a>Известные имена целевых файлов  
 При выборе команды **Построить** в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] происходит выполнение целевого файла, который используется в проекте по умолчанию. Этот целевой объект часто называется также `Build`. При выборе команды **Перестроить** или **Очистить** делается попытка выполнить целевой файл с тем же именем в проекте. При выборе команды **Опубликовать** происходит выполнение целевого файла с именем `PublishOnly` в проекте.  
  
## <a name="configurations-and-platforms"></a>Конфигурации и платформы  
 Конфигурации представлены в проектах [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] свойствами, сгруппированными в элемент `PropertyGroup`, который имеет атрибут `Condition`. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] анализирует эти условия, чтобы создать отображаемый список конфигураций и платформ проекта. Чтобы можно было успешно получить этот список, соответствующие условия должны иметь формат, аналогичный следующему:  
  
```  
Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' "  
Condition=" '$(Configuration)' == 'Release' "   
Condition=" '$(Something)|$(Configuration)|$(SomethingElse)' == 'xxx|Debug|yyy' "  
```  
  
 С этой целью [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] проверяет условия в `PropertyGroup`, `ItemGroup`, `Import`, свойствах и элементах объекта.  
  
## <a name="additional-build-actions"></a>Дополнительные действия при построении  
 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] дает возможность изменить имя типа элемента файла в проекте с помощью свойства **Действие при построении** в окне [Свойства файла](http://msdn.microsoft.com/en-us/013c4aed-08d6-4dce-a124-ca807ca08959). В этом меню всегда приводятся имена типов элементов`Compile`, `EmbeddedResource`, `Content`и `None` наряду со всеми другими именами типов элементов, которые уже используются в проекте. Чтобы быть уверенным в том, что в этом меню всегда будут доступны все пользовательские имена типов элементов, эти имена можно добавлять к типу элемента под названием `AvailableItemName`. Например, при добавлении следующих имен к файлу проекта одновременно будет добавлен пользовательский тип `JScript` к этому меню для всех проектов, которые его импортируют:  
  
```  
<ItemGroup>  
    <AvailableItemName Include="JScript"/>  
</ItemGroup>  
```  
  
> [!NOTE]
>  Некоторые имена типов элементов являются особыми для [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], но они не приводятся в раскрывающемся меню.  
  
## <a name="in-process-compilers"></a>Внутрипроцессные компиляторы  
 Если возможно, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] будет пытаться использовать внутрипроцессную версию компилятора [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] для повышения производительности. (Неприменимо к [!INCLUDE[csprcs](../includes/csprcs-md.md)].) Чтобы при этом была обеспечена правильная работа, должны быть выполнены следующие условия:  
  
-   Среди целевых объектов проекта должна быть задача под названием `Vbc` для проектов [!INCLUDE[vbprvb](../includes/vbprvb-md.md)].  
  
-   Для параметра `UseHostCompilerIfAvailable` этой задачи должно быть установлено значение "true".  
  
## <a name="design-time-intellisense"></a>Функция IntelliSense в режиме разработки  
 Чтобы получить поддержку IntelliSense в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] до того, как будет создана конечная сборка, должны выполняться следующие условия:  
  
-   Должен существовать целевой объект с именем `Compile`.  
  
-   Либо целевой объект `Compile` , либо одна из его зависимостей должны вызывать задачу компилятора для проекта, например `Csc` или `Vbc`.  
  
-   Либо целевой объект `Compile` , либо одна из его зависимостей должны инициировать получение компилятором всех необходимых параметров для IntelliSense, особенно всех ссылок.  
  
-   Должны удовлетворяться условия, указанные в разделе "Внутрипроцессные компиляторы".  
  
## <a name="building-solutions"></a>Построение решений  
 В пределах [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] управление файлом решения и заказом на построение проекта осуществляется самим продуктом [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]. Если построение решения осуществляется с помощью msbuild.exe в командной строке, то [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] выполняет синтаксический разбор файла решения и дает указание на выполнение построения проекта. В обоих случаях проекты строятся по отдельности в порядке зависимости, и взаимные ссылки между проектами не отслеживаются. В противоположность этому, при построении отдельных проектов с помощью msbuild.exe взаимные ссылки между проектами отслеживаются.  
  
 Если построение осуществляется внутри [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], свойству `$(BuildingInsideVisualStudio)` назначается значение `true`. Это можно использовать при работе с файлами проекта или с файлами в формате .targets, если нужно, чтобы построения вели себя по-разному.  
  
## <a name="displaying-properties-and-items"></a>Отображение свойств и элементов  
 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] распознает имена и значения некоторых свойств. Например, следующее свойство проекта вызывает появление названия **приложения Windows** в поле **Тип приложения** в **конструкторе проектов**.  
  
```  
<OutputType>WinExe</OutputType>  
```  
  
 Значение этого свойства можно изменить в **конструкторе проектов** и сохранить в файле проекта. Если такому свойству присвоено недопустимое значение при вводе вручную, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] выведет предупреждение при загрузке проекта и заменит недопустимое значение на значение по умолчанию.  
  
 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] распознает значения по умолчанию для некоторых свойств. Значения этих свойств будут вставляться в файл проекта только в том случае, если они отличаются от значений по умолчанию.  
  
 Свойства, имеющие произвольные имена, не отображаются в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]. Чтобы изменить произвольно заданное имя в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], нужно открыть файл проекта в XML-редакторе и вручную изменить его. Дополнительные сведения см. в разделе [Editing Project Files in Visual Studio](#BKMK_EditingProjects) ниже.  
  
 Элементы, определенные в проекте с произвольным именами типов элементов, по умолчанию отображаются в обозревателе решений в соответствующем узле проекта. Чтобы скрыть элемент, установите значение `Visible` метаданных `false`. Например, указанный ниже элемент будет участвовать в процессе построения, но не будет отображаться в обозревателе решений.  
  
```  
<ItemGroup>  
    <IntermediateFile Include="cache.temp">  
        <Visible>false</Visible>  
    </IntermediateFile>  
</ItemGroup>  
```  
  
 По умолчанию не отображаются элементы, которые объявлены в файлах, импортированных в проект. В обозревателе решений никогда не отображаются элементы, созданные в процессе построения.  
  
## <a name="conditions-on-items-and-properties"></a>Условия, накладываемые на элементы и свойства  
 В процессе построения полностью учитываются все условия.  
  
 При определении отображаемого значения свойства те свойства, которые продуктом [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] рассматриваются как зависящие от конфигурации, оцениваются не так, как свойства, которые считаются не зависящими от конфигурации. Для свойств, которые считаются зависящими от конфигурации, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] устанавливает соответствующие свойства `Configuration` и `Platform` и дает указание [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] еще раз оценить проект. Для свойств, которые считаются не зависящими от конфигурации, определенного способа оценки условий не предусмотрено.  
  
 Условные выражения с участием элементов всегда игнорируются, если надо решить, следует ли отображать данный элемент в обозревателе решений.  
  
## <a name="debugging"></a>Отладка  
 Чтобы найти и запустить выходную сборку с присоединением отладчика, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] требуется, чтобы были правильно заданы свойства `OutputPath`, `AssemblyName` и `OutputType`. Присоединение отладчика невозможно, если в процессе построения компилятор не создал файл .pdb.  
  
## <a name="design-time-target-execution"></a>Выполнение целевых объектов в режиме разработки  
 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] пытается запустить выполнение целевых объектов с определенными именами при загрузке проекта. Эти целевые объекты включают в себя `Compile`, `ResolveAssemblyReferences`, `ResolveCOMReferences`, `GetFrameworkPaths` и `CopyRunEnvironmentFiles`. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] запускает эти целевые объекты, что позволяет инициализировать компилятор, который обеспечивает функционирование IntelliSense. Возможна также инициализация отладчика и разрешение ссылок, отображаемых в обозревателе решений. Если эти целевые объекты отсутствуют, то загрузка и построение проекта будут выполняться правильно, но работа в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] в режиме разработки будет иметь функциональные ограничения.  
  
##  <a name="BKMK_EditingProjects"></a> Editing Project Files in Visual Studio  
 Чтобы изменить непосредственно проект [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)], можно открыть файл проекта в XML-редакторе Visual Studio.  
  
#### <a name="to-unload-and-edit-a-project-file-in-visual-studio"></a>Выгрузка и изменение файла проекта в Visual Studio  
  
1.  В **обозревателе решений**откройте контекстное меню для своего проекта и выберите **Выгрузить проект**.  
  
     К проекту добавляется пометка **(недоступный)**.  
  
2.  В **обозревателе решений** откройте контекстное меню для недоступного проекта и выберите **Изменить \<файл проекта>**.  
  
     В XML-редакторе Visual Studio открывается файл проекта.  
  
3.  Измените, сохраните и закройте файл проекта.  
  
4.  В **обозревателе решений**откройте контекстное меню для недоступного проекта и выберите **Перезагрузить проект**.  
  
## <a name="intellisense-and-validation"></a>IntelliSense и проверка  
 При использовании XML-редактора для изменения файлов проекта работой IntelliSense и функции проверки управляют файлы схемы [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)]. Они устанавливаются в кэш схемы, которые можно найти в *\<каталоге установки Visual Studio>* \Xml\Schemas\1033\MSBuild.  
  
 Типы ядра [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] определяются в Microsoft.Build.Core.xsd, а стандартные типы, используемые [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], определяются в Microsoft.Build.CommonTypes.xsd. Чтобы настроить схемы таким образом, чтобы выполнялась функция IntelliSense и проверка пользовательских имен типов элементов, а также свойств и задач, можно либо изменить Microsoft.Build.xsd, либо создать собственную схему, включающую схемы CommonTypes или Core. Если создается собственная схема, необходимо с помощью XML-редактора найти ее, используя окно **Свойства** .  
  
## <a name="editing-loaded-project-files"></a>Изменение загруженных файлов проектов  
 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] отправляет в кэш содержимое файлов проектов и файлов, импортированных файлами проекта. Если вы изменяете загруженный файл проекта, [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] автоматически напомнит еще раз загрузить проект, чтобы изменения вступили в силу. Однако, если вы изменяете файл, импортированный загруженным проектом, напоминание о перезагрузке не появится, и необходимо будет вручную выгрузить и еще раз загрузить проект, чтобы изменения вступили в силу.  
  
## <a name="output-groups"></a>Выходные группы  
 Имена некоторых целевых объектов, определенных в Microsoft.Common.targets, оканчиваются на `OutputGroups` или `OutputGroupDependencies`. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] вызывает эти целевые объекты, чтобы они получили особые списки выходных данных проекта. Например, целевой объект `SatelliteDllsProjectOutputGroup` создает список всех сопутствующих сборок, которые будут созданы в процессе построения. Эти выходные группы используются, например, такими функциями, как опубликование, развертывание и взаимные ссылки между проектами. Проекты, в которых они не определены, будут загружать и строить их в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], но при этом отдельные функции могут работать неправильно.  
  
## <a name="reference-resolution"></a>Разрешение ссылок  
 Разрешение ссылок — это процесс использования элементов ссылки, которые хранятся в файле проекта, для определения местоположения реальных сборок. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] должен инициировать разрешение ссылок, чтобы можно было отобразить подробные свойства для каждой ссылки в окне **Свойства**. В следующем списке описаны три типа ссылок и способы их разрешения.  
  
-   Ссылки на сборку:  
  
     Система проекта вызывает целевой объект с известным именем `ResolveAssemblyReferences`. Этот целевой объект должен создать элементы с именем типа элемента `ReferencePath`. Каждый из этих элементов должен иметь спецификацию элемента (значение атрибута `Include` элемента), которая содержит полный путь к ссылке. Эти элементы должны иметь все метаданные, полученные от входных элементов, и, кроме того, следующие новые метаданные.  
  
    -   `CopyLocal`, указывающие, следует ли скопировать данную сборку в выходную папку, для чего надо присвоить ей значение "true" или "false".  
  
    -   `OriginalItemSpec`, содержащую исходную спецификацию элемента ссылки.  
  
    -   `ResolvedFrom`, значение которого установлено "{TargetFrameworkDirectory}", если он был разрешен из каталога [!INCLUDE[dnprdnshort](../includes/dnprdnshort-md.md)].  
  
-   Ссылки COM:  
  
     Система проекта вызывает целевой объект с известным именем `ResolveCOMReferences`. Этот целевой объект должен создать элементы с именем типа элемента `ComReferenceWrappers`. Каждый из этих элементов должен иметь спецификацию элемента, которая содержит полный путь к ссылке взаимодействия для ссылки СОМ. Эти элементы должны иметь все метаданные, переданные от входных элементов, и, кроме того, новые метаданные с именем `CopyLocal`, указывающие, следует ли копировать данную сборку в выходную папку, для чего надо присвоить ей значение "true" или "false".  
  
-   Машинные ссылки  
  
     Система проекта вызывает целевой объект с известным именем `ResolveNativeReferences`. Этот целевой объект должен создать элементы с именем типа элемента `NativeReferenceFile`. Эти элементы должны иметь все метаданные, переданные от входных элементов, и, кроме того, новую порцию метаданных с именем `OriginalItemSpec`, содержащих спецификацию исходных элементов ссылки.  
  
## <a name="performance-shortcuts"></a>Ярлыки производительности  
 Если запустить отладку в пользовательском интерфейсе Visual Studio (с помощью клавиши F5 или пункта меню **Отладка**, **Начать отладку** ), для повышения производительности в процессе сборки будет использоваться быстрое обновление. В некоторых случаях, когда пользовательские построения создают файлы, которые в свою очередь также участвуют в построениях, быстрая проверка обновлений не может верно определить измененные файлы. В проектах, которые требуют более тщательных проверок обновлений, можно отключить быструю проверку, задав переменную среды `DISABLEFASTUPTODATECHECK=1`. Другой способ — задать ее в качестве свойства MSBuild в проекте или в файле, импортируемом в проект.  
  
 Для обычной сборки в Visual Studio быстрая проверка обновлений не применяется, и сборка проекта будет выполняться, как если бы сборка была вызвана из командной строки.  
  
## <a name="see-also"></a>См. также  
 [Практическое руководство. Расширение процесса построения Visual Studio](../msbuild/how-to-extend-the-visual-studio-build-process.md)   
 [Запуск построения из интегрированной среды разработки](../msbuild/starting-a-build-from-within-the-ide.md)   
 [Регистрация расширений платформы .NET Framework](../msbuild/registering-extensions-of-the-dotnet-framework.md)   
 [Основные понятия MSBuild](../msbuild/msbuild-concepts.md)   
 [Элемент Item (MSBuild)](../msbuild/item-element-msbuild.md)   
 [Элемент Property (MSBuild)](../msbuild/property-element-msbuild.md)   
 [Элемент Target (MSBuild)](../msbuild/target-element-msbuild.md)   
 [Задача Csc](../msbuild/csc-task.md)   
 [Задача Vbc](../msbuild/vbc-task.md)



