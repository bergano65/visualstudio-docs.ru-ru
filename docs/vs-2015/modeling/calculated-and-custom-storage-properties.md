---
title: Вычисляемые и пользовательские свойства хранилища | Документация Майкрософт
ms.custom: ''
ms.date: 2018-06-30
ms.prod: visual-studio-tfs-dev14
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- Domain-Specific Language, programming domain properties
ms.assetid: 42b785f9-2b0f-4f13-a6b4-246e5e0d477a
caps.latest.revision: 21
author: gewarren
ms.author: gewarren
manager: douge
ms.openlocfilehash: e11ae9833d61e2ff48341b577d6aa1cdbc54afc6
ms.sourcegitcommit: 55f7ce2d5d2e458e35c45787f1935b237ee5c9f8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2018
ms.locfileid: "47558706"
---
# <a name="calculated-and-custom-storage-properties"></a>Вычисляемые и пользовательские свойства хранилища
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Последнюю версию этого раздела можно найти в [вычисляемые и пользовательские свойства хранилища](https://docs.microsoft.com/visualstudio/modeling/calculated-and-custom-storage-properties).  
  
Все свойства домена в доменный язык (DSL) могут отображаться на диаграмме и в обозревателе языка, а также может осуществляться программным кодом. Однако свойства отличаются способом, что их значения будут храниться.  
  
## <a name="kinds-of-domain-properties"></a>Виды свойств домена  
 В определении DSL, можно задать **вид** свойства домена, как показано в следующей таблице:  
  
|Тип свойства домена|Описание|  
|--------------------------|-----------------|  
|**Стандартный** (по умолчанию)|Свойство домена, которое сохраняется в *хранения* и сериализован в файл.|  
|**Вычисляемый**|Свойство домена только для чтения, которое не сохраняется в хранилище, но вычисляется из других значений.<br /><br /> Например `Person.Age` может вычисляться из `Person.BirthDate`.<br /><br /> Вы должны предоставить код, который выполняет вычисление. Как правило значение из других свойств домена можно вычислить. Тем не менее можно также использовать внешние ресурсы.|  
|**Пользовательское хранилище**|Свойство домена, которое не сохраняется непосредственно в хранилище, но может быть get и set.<br /><br /> Вы должны предоставить методы, которые получают и задают значение.<br /><br /> Например `Person.FullAddress` могут храниться в `Person.StreetAddress`, `Person.City`, и `Person.PostalCode`.<br /><br /> Также можно получить доступ к внешним ресурсам, например для получения и задания значений из базы данных.<br /><br /> Ваш код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. См. в разделе [транзакции и пользовательские методы задания](#setters).|  
  
## <a name="providing-the-code-for-a-calculated-or-custom-storage-property"></a>Предоставив код для свойства вычисляемое или пользовательского хранилища  
 Если тип свойства домена присвоено Calculated и пользовательского хранилища, вы должны предоставить методы доступа. При построении решения отчет об ошибке сообщит, требования.  
  
#### <a name="to-define-a-calculated-or-custom-storage-property"></a>Для определения Calculated или пользовательские свойства хранилища  
  
1.  В файле DslDefinition.dsl, выберите свойство домена, в диаграмме или в **обозреватель DSL**.  
  
2.  В **свойства** окне **вид** поле **Calculated** или **пользовательского хранилища**.  
  
     Убедитесь, что вы указали также его **тип** вам необходимо.  
  
3.  Нажмите кнопку **преобразовать все шаблоны** на панели инструментов в **обозревателе решений**.  
  
4.  В меню **Сборка** выберите **Собрать решение**.  
  
     Вы получите следующее сообщение об ошибке: "*Вашкласс* содержит определения для Get*YourProperty*.»  
  
5.  Дважды щелкните сообщение об ошибке.  
  
     Dsl\GeneratedCode\DomainClasses.cs или DomainRelationships.cs открывается. Выше вызова метода выделенный комментарий предлагается предоставлять реализацию для Get*YourProperty*().  
  
    > [!NOTE]
    >  Этот файл создается из DslDefinition.dsl. Если изменить этот файл, изменения будут потеряны при очередном щелчке **преобразовать все шаблоны**. Вместо этого добавьте необходимый метод в отдельном файле.  
  
6.  Создайте или откройте файл класса в отдельную папку, например значение CustomCode\\*YourDomainClass*. cs.  
  
     Убедитесь, что пространство имен является таким же, как и в созданном коде.  
  
7.  В файле класса записи частичная реализация класса домена. В классе, создать определение для отсутствующих `Get` метод, аналогичный приведенному ниже:  
  
    ```  
    namespace Company.FamilyTree  
    {  public partial class Person  
       {  int GetAgeValue()  
          { return System.DateTime.Today.Year - this.BirthYear; }  
    }  }  
    ```  
  
8.  Если задать **вид** для **пользовательского хранилища**, вы также должны будете предоставить `Set` метод. Пример:  
  
    ```  
    void SetAgeValue(int value)  
    { if (!Store.InUndoRedoOrRollback)  
        this.BirthYear =   
            System.DateTime.Today.Year - value; }  
    ```  
  
     Ваш код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. См. в разделе [транзакции и пользовательские методы задания](#setters).  
  
9. Постройте и запустите это решение.  
  
10. Проверьте свойство. Убедитесь, что вы попытаетесь **отменить** и **повтора**.  
  
##  <a name="setters"></a> Транзакции и пользовательских методов задания  
 В метод Set свойства пользовательского хранилища у вас нет открыть транзакцию, так как метод обычно вызывается внутри активной транзакции.  
  
 Тем не менее метод Set может также называться Если пользователь вызывает операции отмены или повтора, или в том случае, если транзакция откатывается. Когда <xref:Microsoft.VisualStudio.Modeling.Store.InUndoRedoOrRollback%2A> имеет значение true, его следует ведут себя следующим образом:  
  
-   Не следует вносить изменения в хранилище, например для присвоения значений других свойств домена. Диспетчер отмены будет задать их значения.  
  
-   Тем не менее он должен быть обновлен любые внешние ресурсы, такие как базы данных, содержимое файла или объекты за пределами хранилища. Это будет убедитесь, что они хранятся в synchronism со значениями в хранилище.  
  
 Пример:  
  
```  
void SetAgeValue(int value)  
{   
  // If we are in Undo, no changes to Store objects:  
  if (!this.Store.InUndoRedoOrRollback)  
  {   
    this.BirthYear = System.DateTime.Today.Year - value;   
  }  
  // But always update external objects:  
  System.IO.File.WriteAllText(AgeFile, value);  
}  
```  
  
 Дополнительные сведения о транзакциях см. в разделе [перехода и обновления модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md).  
  
## <a name="see-also"></a>См. также  
 [Переход и обновление модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [Свойства доменных свойств](../modeling/properties-of-domain-properties.md)   
 [Определение доменного языка](../modeling/how-to-define-a-domain-specific-language.md)



