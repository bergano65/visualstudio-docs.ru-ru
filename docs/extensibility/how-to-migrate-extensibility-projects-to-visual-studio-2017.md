---
title: Перенос проектов расширяемости в Visual Studio 2017
titleSuffix: ''
ms.custom: SEO-VS-2020
ms.date: 11/09/2016
ms.topic: how-to
ms.assetid: 8ca07b00-a3ff-40ab-b647-c0a93b55e86a
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
monikerRange: vs-2017
ms.openlocfilehash: 52faf3f8b736be9791f1738662aef1bd1b65939c
ms.sourcegitcommit: 4ae5e9817ad13edd05425febb322b5be6d3c3425
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2020
ms.locfileid: "90038560"
---
# <a name="how-to-migrate-extensibility-projects-to-visual-studio-2017"></a>Руководство. Миграция проектов расширяемости в Visual Studio 2017

В этом документе объясняется, как обновить проекты расширяемости до Visual Studio 2017. Помимо описания способа обновления файлов проекта, в нем также описывается обновление манифеста расширения версии 2 (VSIX v2) до формата манифеста VSIX версии 3 (VSIX v3).

## <a name="install-visual-studio-2017-with-required-workloads"></a>Установка Visual Studio 2017 с требуемыми рабочими нагрузками

Убедитесь, что установка включает следующие рабочие нагрузки:

* Разработка классических приложений .NET
* Разработка расширений Visual Studio

## <a name="open-vsix-solution-in-visual-studio-2017"></a>Открытие решения VSIX в Visual Studio 2017

Для всех проектов VSIX потребуется обновление основной версии до Visual Studio 2017.

Файл проекта (например *, *. csproj*) будет обновлен:

* Минимумвисуалстудиоверсион — теперь установлено значение 15,0
* Олдтулсверсион (если ранее существует) — теперь установлено значение 14,0.

## <a name="update-the-microsoftvssdkbuildtools-nuget-package"></a>Обновление пакета NuGet Microsoft. VSSDK. BuildTools

> [!Note]
> Если решение не ссылается на пакет NuGet Microsoft. VSSDK. BuildTools, этот шаг можно пропустить.

Чтобы создать расширение в новом формате VSIX v3 (версия 3), решение должно быть создано с помощью новых средств сборки VSSDK. Он будет установлен с Visual Studio 2017, но расширение VSIX v2 может хранить ссылку на старую версию через NuGet. В этом случае необходимо вручную установить обновление пакета NuGet Microsoft. VSSDK. BuildTools для вашего решения.

Чтобы обновить ссылки NuGet на Microsoft. VSSDK. BuildTools, сделайте следующее:

* Щелкните решение правой кнопкой мыши и выберите пункт **Управление пакетами NuGet для решения**.
* Перейдите на вкладку **обновления** .
* Выберите **Microsoft. VSSDK. BuildTools (последняя версия)**.
* Нажмите кнопку **Обновить**.

![Средства сборки VSSDK](media/vssdk-build-tools.png)

## <a name="make-changes-to-the-vsix-extension-manifest"></a>Внесение изменений в манифест расширения VSIX

Чтобы убедиться, что пользовательская установка Visual Studio содержит все сборки, необходимые для запуска расширения, укажите все необходимые компоненты или пакеты в файле манифеста расширения. Когда пользователь пытается установить расширение, Всиксинсталлер проверит, установлены ли все необходимые компоненты. Если некоторые из них отсутствуют, пользователю будет предложено установить недостающие компоненты как часть процесса установки расширения.

> [!Note]
> Как минимум, все расширения должны указывать компонент редактора Visual Studio Core в качестве необходимого компонента.

* Измените файл манифеста расширения (обычно именуемый *source. extension. vsixmanifest*).
* Убедитесь `InstallationTarget` , что включает 15,0.
* Добавьте необходимые обязательные компоненты для установки (как показано в примере ниже).
  * Рекомендуется указывать только идентификаторы компонентов для необходимых компонентов установки.
  * [Инструкции по идентификации идентификаторов компонентов](#find-component-ids)см. в разделе в конце этого документа.

Пример

```xml
<PackageManifest>
 ...
    <Prerequisites>
        <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Component.DiagnosticTools" Version="[15.0.25814.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Shell.12.0" Version="[12.0]" />
    </Prerequisites>
 ...
</PackageManifest>
```

### <a name="option-use-the-designer-to-make-changes-to-the-vsix-extension-manifest"></a>Параметр: использование конструктора для внесения изменений в манифест расширения VSIX

Вместо непосредственного редактирования XML-файла манифеста можно использовать вкладку Новая **Предварительная** проверка в конструкторе манифеста, чтобы выбрать необходимые компоненты, и XML будет обновлен.

> [!Note]
> Конструктор манифеста позволяет выбирать только компоненты (не рабочие нагрузки и пакеты), установленные в текущем экземпляре Visual Studio. Если необходимо добавить необходимое условие для рабочей нагрузки, пакета или компонента, которые в настоящее время не установлены, измените XML-файл манифеста напрямую.

* Файл с открытым *исходным кодом. расширение. vsixmanifest [Design]* .
* Выберите вкладку **необходимые компоненты** и нажмите кнопку **создать** .

   ![Конструктор манифеста VSIX](media/vsix-manifest-designer.png)

* Откроется окно **Добавление нового необходимого компонента** .

   ![добавить необходимый компонент VSIX](media/add-vsix-prerequisite.png)

* Щелкните раскрывающийся список **имя** и выберите нужный предварительный компонент.
* При необходимости обновите версию.

   > [!Note]
   > В поле версия будет предварительно заполнена версия установленного компонента с диапазоном, охватывающим следующую основную версию компонента (но не включая).

   ![добавить необходимый компонент Roslyn](media/add-roslyn-prerequisite.png)

* Нажмите кнопку **ОК**.

## <a name="update-debug-settings-for-the-project"></a>Обновление параметров отладки для проекта

Если вы хотите выполнить отладку расширения в экспериментальном экземпляре Visual Studio, убедитесь, что в параметрах проекта для действия начать **Отладка**задано  >  **Start action** значение **Запуск внешней программы —** это *devenv.exe* файл установки Visual Studio 2017.

Он может выглядеть так: *C:\Program Files (x86) \Microsoft Visual Studio\2017\Enterprise\Common7\IDE\devenv.exe*

![Запуск внешней программы](media/start-external-program.png)

> [!Note]
> Действие запуска отладки обычно хранится в файле *csproj. User* . Этот файл обычно включается в *gitignore* -файл и, следовательно, обычно не сохраняется вместе с другими файлами проекта при фиксации в системе управления версиями. Таким образом, если вы получили обновление решения из системы управления версиями, скорее всего, для проекта не будет задано значение для действия Start. В новых проектах VSIX, созданных с помощью Visual Studio 2017, будет создан файл *. csproj. User* со значением по умолчанию, указывающим на текущий каталог установки Visual Studio. Однако если выполняется миграция расширения VSIX v2, скорее всего, файл *csproj. User* будет содержать ссылки на предыдущую версию каталога установки Visual Studio. Если задать значение для **Debug**  >  **действия запуска** отладки, то при попытке отладки расширения будет запускаться правильный экспериментальный экземпляр Visual Studio.

## <a name="check-that-the-extension-builds-correctly-as-a-vsix-v3"></a>Проверка правильности сборки расширения (в виде VSIX v3)

* Создайте проект VSIX.
* Распакуйте созданный VSIX.
  * По умолчанию VSIX-файл находится внутри *bin/debug* или *bin/Release* как *[йоуркустомекстенсион]. VSIX*.
  * Переименуйте *VSIX* -файл в *ZIP* -файл, чтобы легко просмотреть его содержимое.
* Проверьте наличие трех файлов:
  * *расширение. vsixmanifest*
  * *manifest.jsна*
  * *catalog.jsна*

## <a name="check-when-all-required-prerequisites-are-installed"></a>Проверка установки всех необходимых компонентов

Проверка успешности установки VSIX на компьютере, на котором установлены все необходимые компоненты.

> [!Note]
> Перед установкой любого расширения закройте все экземпляры Visual Studio.

Попытка установить расширение:

* В Visual Studio 2017

![Установщик VSIX в Visual Studio 2017](media/vsixinstaller-vs-2017.png)

* Необязательно. Проверьте предыдущие версии Visual Studio.
  * Подтверждает обратную совместимость.
  * Должен работать с Visual Studio 2012, Visual Studio 2013, Visual Studio 2015.
* Необязательно. Убедитесь, что средство проверки версий установщика VSIX предлагает варианты версий.
  * Включает в себя предыдущие версии Visual Studio (если они установлены).
  * Включает Visual Studio 2017.

Если Visual Studio была недавно открыта, может появиться диалоговое окно следующего вида:

![выполняющиеся процессы VS](media/vs-running-processes.png)

Дождитесь завершения работы процессов или завершите задачи вручную. Процессы можно найти по указанному имени или идентификатору PID, указанному в скобках.

> [!Note]
> Эти процессы не будут автоматически завершаться, пока выполняется экземпляр Visual Studio. Убедитесь, что вы завершили работу всех экземпляров Visual Studio на компьютере, в том числе из других пользователей, и продолжайте выполнять повторную попытку.

## <a name="check-when-missing-the-required-prerequisites"></a>Проверка отсутствия необходимых предварительных требований

* Попытка установить расширение на компьютере с Visual Studio 2017, который не содержит все компоненты, определенные в предварительных требованиях (см. выше).
* Убедитесь, что установка определяет отсутствующие компоненты, и перечисляет их в качестве необходимого компонента в Всиксинсталлер.
* Примечание. повышение прав потребуется, если необходимо установить необходимые компоненты с расширением.

![всиксинсталлер отсутствует необходимый компонент](media/vsixinstaller-missing-prerequisite.png)

## <a name="decide-on-components"></a>Выбор компонентов

При поиске зависимостей вы обнаружите, что одна зависимость может сопоставляться с несколькими компонентами. Чтобы определить, какие зависимости следует указать в качестве необходимых компонентов, мы рекомендуем выбрать компонент, имеющий такие же функциональные возможности, как у вашего расширения, а также учитывать пользователей и типы компонентов, которые могли бы быть установлены, или не забывать об установке. Мы также предлагаем создание расширений таким образом, чтобы необходимые условия соответствовали минимальным требованиям, которые позволят вашему модулю запускаться, а дополнительные функции — неактивным, если некоторые компоненты не обнаруживаются.

Для получения дополнительных рекомендаций мы определили несколько распространенных типов расширений и предлагаемых предварительных требований:

Тип расширения | Отображаемое имя | ID
--- | --- | ---
Редактор | Основной редактор Visual Studio | Microsoft.VisualStudio.Component.CoreEditor
Roslyn | C# и Visual Basic | Microsoft.VisualStudio.Component.Roslyn.LanguageServices
WPF | Основные средства рабочей нагрузки управляемого рабочего стола | Microsoft.VisualStudio.Component.ManagedDesktop.Core
Отладчик | JIT-отладчик | Microsoft.VisualStudio.Component.Debugger.JustInTime

## <a name="find-component-ids"></a>Поиск идентификаторов компонентов

Список компонентов, отсортированных по продукту Visual Studio, находится в [рабочей нагрузке Visual studio 2017 и идентификаторах компонентов](../install/workload-and-component-ids.md?view=vs-2019). Используйте эти идентификаторы компонентов в манифесте для своих идентификаторов.

Если вы не уверены, какой компонент содержит конкретный двоичный файл, скачайте [электронную таблицу сопоставления > компонентов](https://aka.ms/vs2017componentid-binaries).

### <a name="vs2017-componentbinarymappingxlsx"></a>vs2017-ComponentBinaryMapping.xlsx

Лист Excel содержит четыре столбца: **имя компонента**, **ИД**компонента, **версия**, имя **двоичного файла или файлов**.  Фильтры можно использовать для поиска и поиска конкретных компонентов и двоичных файлов.

Для всех ссылок сначала определите, какие из них находятся в компоненте базового редактора (Microsoft. VisualStudio. Component. Коридитор).  Как минимум необходимо, чтобы основной компонент редактора был указан в качестве необходимого компонента для всех расширений. Для ссылок, которые не находятся в основном редакторе, добавьте фильтры в разделе **двоичные файлы и имена файлов** для поиска компонентов, имеющих любой из поднаборов этих ссылок.

Примеры:

* Если у вас есть расширение отладчика и известно, что проект содержит ссылку на *VSDebugEng.dll* и *VSDebug.dll*, нажмите кнопку Фильтр в заголовке **двоичные файлы/имена файлов** .  Выполните поиск по запросу "VSDebugEng.dll" и нажмите кнопку *ОК*.  Затем снова нажмите кнопку фильтра в заголовке **двоичные файлы/имена файлов** и выполните поиск по запросу "VSDebug.dll".  Установите флажок **Добавить текущее выделение для фильтрации** и нажмите кнопку **ОК**.  Теперь просмотрите **имя компонента** , чтобы найти компонент, который наиболее связан с типом расширения. В этом примере следует выбрать JIT-отладчик и добавить его в VSIXMANIFEST.
* Если известно, что проект работает с элементами отладчика, можно выполнить поиск по слову "Debugger" в поле фильтра поиска, чтобы увидеть, какие компоненты содержат отладчик в своем имени.

## <a name="specify-a-visual-studio-2017-release"></a>Укажите выпуск Visual Studio 2017

Например, если для расширения требуется определенная версия Visual Studio 2017, то она зависит от функции, выпущенной в 15,3, необходимо указать номер сборки в VSIX **InstallationTarget**. Например, выпуск 15,3 имеет номер сборки "15.0.26730.3". Сопоставление выпусков для номеров сборки можно увидеть [здесь](../install/visual-studio-build-numbers-and-release-dates.md). Использование номера выпуска "15,3" не будет работать правильно.

Если для расширения требуется 15,3 или более поздней версии, вы объявили **версию InstallationTarget** как [15.0.26730.3, 16,0):

```xml
<Installation>
  <InstallationTarget Id="Microsoft.VisualStudio.Community" Version="[15.0.26730.3, 16.0)" />
</Installation>
```