---
title: Регистрация и выбор (пакет VSPackage системы управления версиями) | Документация Майкрософт
description: Узнайте, как зарегистрировать пакет VSPackage для системы управления версиями в Visual Studio и как выбрать пакеты для загрузки из нескольких зарегистрированных пакетов управления версиями.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- registration, source control packages
- source control packages, registration
ms.assetid: 7d21fe48-489a-4f55-acb5-73da64c4e155
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 0784b16acd00e354c8ecf36f34d6b05c750f6bec
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99837207"
---
# <a name="registration-and-selection-source-control-vspackage"></a>Регистрация и выбор (пакет VSPackage системы управления версиями)
Для предоставления доступа к необходимо зарегистрировать пакет VSPackage системы управления версиями [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] . Если зарегистрировано более одного пакета VSPackage системы управления версиями, пользователь может выбрать, какой пакет VSPackage будет загружаться в нужное время. Дополнительные сведения о пакетах VSPackage и их регистрации см. в разделе [пакеты VSPackage](../../extensibility/internals/vspackages.md) .

## <a name="registering-a-source-control-package"></a>Регистрация пакета системы управления версиями
 Пакет системы управления версиями зарегистрирован так, что [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] среда может найти его и запросить поддерживаемые функции. Это в соответствии со схемой загрузки с задержкой, в которой экземпляр пакета создается только в том случае, если его функции или команды являются обязательными или запрошены явным образом.

 Пакеты VSPackage размещают сведения в разделе реестра для конкретной версии, HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\\ *x. Y*, где *X* — основной номер версии, а *Y* — дополнительный номер версии. Это позволяет поддерживать параллельную установку нескольких версий [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] .

 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)]Пользовательский интерфейс поддерживает выбор из нескольких установленных подключаемых модулей системы управления версиями (через пакет адаптера системы управления версиями), а также пакетов VSPackage системы управления версиями. В каждый момент времени может существовать только один активный подключаемый модуль системы управления версиями или VSPackage. Однако, как описано ниже, интегрированная среда разработки позволяет переключаться между подключаемыми модулями системы управления версиями и пакетами VSPackage с помощью автоматического механизма подкачки пакетов на основе решений. Существуют некоторые требования к части пакета VSPackage системы управления версиями, позволяющие реализовать этот механизм выбора.

### <a name="registry-entries"></a>Записи реестра
 Для пакета системы управления версиями требуются три частных идентификатора GUID:

- GUID пакета: это основной идентификатор GUID для пакета, который содержит реализацию системы управления версиями (в данном разделе это называется ID_Package).

- GUID системы управления версиями. это GUID для пакета VSPackage системы управления версиями, который используется для регистрации в заглушке системы управления версиями Visual Studio. Он также используется в качестве идентификатора GUID контекста пользовательского интерфейса команды. Идентификатор GUID службы системы управления версиями зарегистрирован в GUID системы управления версиями. В этом примере идентификатор GUID системы управления версиями называется ID_SccProvider.

- GUID службы системы управления версиями: это идентификатор GUID частной службы, используемый Visual Studio (этот раздел называется SID_SccPkgService в этом разделе). Помимо этого, в пакете системы управления версиями необходимо определить другие идентификаторы GUID для пакетов VSPackage, окон инструментов и т. д.

  Пакет VSPackage системы управления версиями должен делать следующие записи реестра:

| Имя раздела | Записи |
| - | - |
| `HKEY_LOCAL_MACHINE\   SOFTWARE\     Microsoft\       VisualStudio\         X.Y\           SourceControlProviders\` | (по умолчанию) = rg_sz: {ID_SccProvider} |
| `HKEY_LOCAL_MACHINE\   SOFTWARE\     Microsoft\       VisualStudio\         X.Y\           SourceControlProviders\             {ID_SccProvider}\` | (по умолчанию) = rg_sz:\<Friendly name of Package><br /><br /> Служба = rg_sz: {SID_SccPkgService} |
| `HKEY_LOCAL_MACHINE\   SOFTWARE\     Microsoft\       VisualStudio\         X.Y\           SourceControlProviders\             {ID_SccProvider}\               Name\` | (по умолчанию) = rg_sz: #\<Resource ID for localized name><br /><br /> Package = rg_sz: {ID_Package} |
| `HKEY_LOCAL_MACHINE\   SOFTWARE\     Microsoft\       VisualStudio\         X.Y\           SolutionPersistence\             <PackageName>\`<br /><br /> (Обратите внимание, что имя ключа, `SourceCodeControl` , уже используется [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] и недоступно для выбора \<PackageName> .) | (по умолчанию) = rg_sz: {ID_Package} |

## <a name="selecting-a-source-control-package"></a>Выбор пакета системы управления версиями
 Несколько подключаемых модулей на основе API для подключаемого модуля системы управления версиями и пакеты VSPackage для системы управления версиями могут быть одновременно зарегистрированы. Процесс выбора подключаемого модуля системы управления версиями или VSPackage должен гарантировать, что [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] загружает подключаемый модуль или VSPackage в соответствующее время и может отложить загрузку ненужных компонентов до тех пор, пока они не потребуются. Кроме того, [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] необходимо удалить все элементы пользовательского интерфейса из других неактивных пакетов VSPackage, включая пункты меню, диалоговые окна и панели инструментов, и отобразить пользовательский интерфейс для активного пакета VSPackage.

 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] загружает пакет VSPackage системы управления версиями при выполнении одной из следующих операций:

- Решение открывается (если решение находится в системе управления версиями).

   Когда открывается решение или проект в системе управления версиями, интегрированная среда разработки вызывает загрузку пакета VSPackage системы управления версиями, который был назначен для этого решения.

- Выполняются любые команды меню пакета VSPackage системы управления версиями.

  Пакет VSPackage системы управления версиями должен загружать все необходимые компоненты только в том случае, если они действительно будут использоваться (в других случаях это называется отложенной загрузкой).

### <a name="automatic-solution-based-vspackage-swapping"></a>Автоматическое переключение VSPackage на основе решений
 Можно вручную поменять местами пакеты VSPackage системы управления версиями с помощью [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] диалогового окна **Параметры** в категории **система управления версиями** . Автоматическое переключение пакетов на основе решения означает, что для пакета управления версиями, предназначенного для конкретного решения, автоматически устанавливается значение активно при открытии решения. Каждый пакет системы управления версиями должен реализовывать <xref:Microsoft.VisualStudio.Shell.Interop.IVsSccProvider.SetActive%2A> и <xref:Microsoft.VisualStudio.Shell.Interop.IVsSccProvider.SetInactive%2A> . [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] обрабатывает переключение между подключаемыми модулями системы управления версиями (реализацией API подключаемого модуля системы управления версиями) и пакетами VSPackage в системе управления версиями.

 Пакет адаптера системы управления версиями используется для переключения на любой подключаемый модуль на основе API для любого подключаемого модуля системы управления версиями. Процесс переключения на промежуточный пакет адаптера системы управления версиями и определение того, какой подключаемый модуль системы управления версиями должен быть установлен в значение активный или неактивный, прозрачен для пользователя. Пакет адаптера всегда активен, если активен любой подключаемый модуль системы управления версиями. Переключение между двумя подключаемыми модулями системы управления версиями для простого загрузки и выгрузки библиотеки DLL подключаемого модуля. Однако переключение на пакет VSPackage системы управления версиями включает взаимодействие с интегрированной средой разработки для загрузки соответствующего пакета VSPackage.

 Пакет VSPackage системы управления версиями вызывается при открытии любого решения, а раздел реестра для VSPackage — в файле решения. При открытии решения [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] находит значение реестра и загружает соответствующий пакет VSPackage системы управления версиями. Все пакеты VSPackage системы управления версиями должны иметь описанные выше записи реестра. Решение, которое находится под управлением системы управления версиями, помечается как связанное с определенным пакетом VSPackage системы управления версиями. Пакеты VSPackage системы управления версиями должны реализовывать, <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolutionPersistence> чтобы включить автоматическое переключение VSPackage на основе решения.

### <a name="visual-studio-ui-for-package-selection-and-switching"></a>Пользовательский интерфейс Visual Studio для выбора и переключения пакетов
 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] предоставляет пользовательский интерфейс для системы управления версиями и выбора подключаемых модулей в диалоговом окне **Параметры** в категории **система управления версиями** . Он позволяет пользователю выбрать активный подключаемый модуль системы управления версиями или VSPackage. Раскрывающийся список включает:

- Все установленные пакеты системы управления версиями

- Все установленные подключаемые модули системы управления версиями

- Параметр «нет», который отключает управление исходным кодом.

  Видимым является только пользовательский интерфейс для активного выбора системы управления версиями. Выбор VSPackage скрывает пользовательский интерфейс для предыдущего пакета VSPackage и отображает пользовательский интерфейс нового пакета. Активный пакет VSPackage выбирается отдельно для каждого пользователя. Если пользователь имеет несколько копий [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] открытых параллельно, каждый из них потенциально может использовать другой активный пакет VSPackage. Если несколько пользователей входят в систему одного и того же компьютера, каждый пользователь может иметь отдельные экземпляры [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] Open, каждый из которых имеет отдельный активный пакет VSPackage. Когда [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] пользователь закрывает несколько экземпляров, пакет VSPackage системы управления версиями, который был активным для последнего открытого решения, превращается в пакет VSPackage системы управления версиями по умолчанию, который устанавливается в значение Активный при перезапуске.

  В отличие от предыдущих версий [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] , перезагрузка интегрированной среды разработки больше не является единственным способом переключения пакетов VSPackage системы управления версиями. Выбран автоматический выбор VSPackage. Для переключения пакетов требуются права пользователя Windows (не администраторы или опытные пользователи).

## <a name="see-also"></a>См. также раздел
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolutionPersistence>
- [Функции](../../extensibility/internals/source-control-vspackage-features.md)
- [Создание подключаемого модуля системы управления версиями](../../extensibility/internals/creating-a-source-control-plug-in.md)
- [VSPackages](../../extensibility/internals/vspackages.md)
