---
title: Основные компоненты службы | Документация Майкрософт
description: Сведения о службах, которые являются интерфейсами для другого пакета VSPackage для использования. Службы в VSPackage могут переопределять встроенные или другие службы.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- services, essentials
ms.assetid: fbe84ad9-efe1-48b1-aba3-b50b90424d47
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 145097b9e012d8c09df1424747d04148df3cae8f
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99911015"
---
# <a name="service-essentials"></a>Основные компоненты службы
Служба — это контракт между двумя пакетами VSPackage. Один пакет VSPackage предоставляет конкретный набор интерфейсов для использования другим пакетом VSPackage. [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] является коллекцией пакетов VSPackage, которые предоставляют службы другим пакетам VSPackage.

 Например, службу Свсактивитилог можно использовать для получения интерфейса Ивсактивитилог, который можно использовать для записи в журнал действий. Дополнительные сведения см. в разделе [инструкции. Использование журнала действий](../../extensibility/how-to-use-the-activity-log.md).

 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] также предоставляет некоторые встроенные службы, которые не зарегистрированы. Пакеты VSPackage могут заменить встроенные или другие службы, предоставляя переопределение службы. Для любой службы разрешено только одно переопределение службы.

 Службы не имеют возможности обнаружения. Таким образом, необходимо указать идентификатор службы (SID) службы, которую требуется использовать, а также сведения о предоставляемых им интерфейсах. Эта информация представлена в справочной документации по службе.

- Пакеты VSPackage, предоставляющие службы, называются поставщиками услуг.

- Службы, предоставляемые другим пакетам VSPackage, называются глобальными службами.

- Службы, доступные только для пакета VSPackage, который их реализует, или для любого объекта, который он создает, называются локальными службами.

- Службы, которые заменяют встроенные службы или службы, предоставляемые другими пакетами, называются переопределениями служб.

- Службы или переопределения служб загружаются по требованию, то есть поставщик услуг загружается, когда предоставляемая им служба запрашивается другим пакетом VSPackage.

- Для поддержки загрузки по запросу поставщик услуг регистрирует свои глобальные службы с помощью [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] . Дополнительные сведения см. [в разделе руководство. предоставление службы](../../extensibility/how-to-provide-a-service.md).

- После получения службы используйте [QueryInterface](/cpp/atl/queryinterface) (неуправляемый код) или приведение (управляемый код) для получения требуемого интерфейса, например:

  ```vb
  TryCast(GetService(GetType(SVsActivityLog)), IVsActivityLog)
  ```

  ```csharp
  GetService(typeof(SVsActivityLog)) as IVsActivityLog;
  ```

- Управляемый код ссылается на службу по ее типу, тогда как неуправляемый код ссылается на службу по ее идентификатору GUID.

- При [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] загрузке VSPackage он передает поставщику служб пакету VSPackage, чтобы предоставить VSPackage доступ к глобальным службам. Это называется "заблокировано" пакетом VSPackage.

- Пакеты VSPackage могут быть поставщиками служб для создаваемых ими объектов. Например, форма может отправить запрос на службу цвета в кадр, который может передать запрос [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] .

- Управляемые объекты, которые глубоко вложены или вообще не являются узлами, могут вызывать <xref:Microsoft.VisualStudio.Shell.Package.GetGlobalService%2A> для прямого доступа к глобальным службам.

<a name="how-to-use-getglobalservice"></a>

## <a name="use-getglobalservice"></a>Использование GetGlobalService

Иногда может потребоваться получить службу из окна инструментов или контейнера элемента управления, который не был добавлен в узел, или в другом месте с поставщиком услуг, который не знает о нужной службе. Например, может потребоваться запись в журнал действий из элемента управления. Дополнительные сведения об этих и других сценариях см. [в разделе руководство. Устранение неполадок служб](../../extensibility/how-to-troubleshoot-services.md).

Большинство служб Visual Studio можно получить, вызвав статический <xref:Microsoft.VisualStudio.Shell.Package.GetGlobalService%2A> метод.

<xref:Microsoft.VisualStudio.Shell.Package.GetGlobalService%2A> полагается на кэшированный поставщик служб, который инициализируется в первый раз, когда все пакеты VSPackage, производные от пакета, размещается на сайте. Необходимо убедиться в том, что это условие выполнено, или, в противном случае, быть подготовленным для службы со значением NULL.

К счастью, <xref:Microsoft.VisualStudio.Shell.Package.GetGlobalService%2A> большая часть времени работает правильно.

- Если пакет VSPackage предоставляет службу, известную только для другого пакета VSPackage, то пакет VSPackage, запрашивающий службу, будет находиться на сайте до загрузки пакета VSPackage, предоставляющего службу.

- Если окно инструментов создается пакетом VSPackage, то перед созданием окна инструментов VSPackage размещается в узле.

- Если контейнер элемента управления размещается в окне инструментов, созданном с помощью VSPackage, то пакет VSPackage размещается до создания контейнера элемента управления.

### <a name="to-get-a-service-from-within-a-tool-window-or-control-container"></a>Получение службы из окна инструментов или с помощью контейнера элементов управления

- Вставьте этот код в конструктор, окно инструментов или контейнер элемента управления:

    ```csharp
    IVsActivityLog log = Package.GetGlobalService(typeof(SVsActivityLog)) as IVsActivityLog;
        if (log == null) return;
    ```

    ```vb
    Dim log As IVsActivityLog = TryCast(Package.GetGlobalService(GetType(SVsActivityLog)), IVsActivityLog)
    If log Is Nothing Then
        Return
    End If
    ```

    Этот код получает службу Свсактивитилог и приводит ее к интерфейсу Ивсактивитилог, который можно использовать для записи в журнал действий. Пример см. в разделе [как использовать журнал действий](../../extensibility/how-to-use-the-activity-log.md).

## <a name="see-also"></a>См. также раздел

- [Список доступных служб](../../extensibility/internals/list-of-available-services.md)
- [Использование и предоставление служб](../../extensibility/using-and-providing-services.md)
- [Приведение и преобразование типов](/dotnet/csharp/programming-guide/types/casting-and-type-conversions)
- [Приведение](/cpp/cpp/casting)
