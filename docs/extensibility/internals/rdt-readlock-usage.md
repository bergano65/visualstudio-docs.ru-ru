---
title: Использование RDT_ReadLock | Документация Майкрософт
description: Дополнительные сведения о _VSRDTFLAGS. Флаг RDT_ReadLock, который обеспечивает логику блокировки документа в выполняемой таблице документов.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- RDT_ReadLock
- visible
- RDT_EditLock
- invisible
ms.assetid: b935fc82-9d6b-4a8d-9b70-e9a5c5ad4a55
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 7a2165bf6d605384e52dbc3cb90b5485d8022ee7
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99915232"
---
# <a name="rdt_readlock-usage"></a>Использование RDT_ReadLock

[_VSRDTFLAGS. RDT_ReadLock](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_ReadLock>) — это флаг, который предоставляет логику блокировки документа в выполняемой таблице документов (РДТ), которая представляет собой список всех документов, открытых в Visual Studio IDE в данный момент. Этот флаг определяет, когда документы открываются, и является ли документ видимым в пользовательском интерфейсе или может оставаться невидимым в памяти.

Как правило, используется [_VSRDTFLAGS. RDT_ReadLock](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_ReadLock>) , если выполняется одно из следующих условий:

- Вы хотите открыть документ в невидимом виде и только для чтения, но он еще не был установлен, которому <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> он должен владеть.

- Необходимо, чтобы пользователю было предложено сохранить документ, который был незаметно открыт, прежде чем пользователь отобразит его в пользовательском интерфейсе, а затем попытался закрыть его.

## <a name="how-to-manage-visible-and-invisible-documents"></a>Управление видимыми и невидимыми документами

Когда пользователь открывает документ в пользовательском интерфейсе, <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> необходимо установить владельца документа и [_VSRDTFLAGS. ](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_EditLock>) Необходимо задать флаг RDT_EditLock. Если <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> владелец не может быть установлен, документ не будет сохранен, когда пользователь нажмет кнопку **сохранить все** или закроет интегрированную среду разработки. Это означает, что если документ открыт незаметно для изменения в памяти, и пользователю предлагается сохранить документ при завершении работы или сохранить, если выбран параметр **сохранить все** , то `RDT_ReadLock` использовать нельзя. Вместо этого необходимо использовать `RDT_EditLock` и зарегистрировать, <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> когда [__VSREGDOCLOCKHOLDER. Флаг RDLH_WeakLockHolder](<xref:Microsoft.VisualStudio.Shell.Interop.__VSREGDOCLOCKHOLDER.RDLH_WeakLockHolder>) .

## <a name="rdt_editlock-and-document-modification"></a>RDT_EditLock и изменение документа

Приведенный выше флаг указывает на то, что невидимый открывающий документ будет давать его `RDT_EditLock` при открытии документа пользователем в видимом **документвиндов**. Когда это происходит, пользователю предоставляется запрос **Save** , когда видимый **документвиндов** закрывается. `Microsoft.VisualStudio.Package.Automation.OAProject.CodeModel` реализации, использующие службу, <xref:Microsoft.VisualStudio.Shell.Interop.IVsInvisibleEditorManager> изначально работают, когда используется только объект `RDT_ReadLock` (т. е. когда документ открывается незаметно для анализа данных). Позже, если документ необходимо изменить, блокировка будет обновлена до слабого **RDT_EditLock**. Если пользователь открывает документ в видимой **документвиндов**, `CodeModel` слабый `RDT_EditLock` выпуск освобождается.

Если пользователь закроет **документвиндов** и **не** выберет запрос на сохранение открытого документа, то `CodeModel` Реализация уничтожает всю информацию в документе и повторно откроет документ с диска, когда в следующий раз для документа потребуются дополнительные сведения. Тонкостью этого поведения является экземпляр, в котором пользователь открывает **документвиндов** невидимого открытого документа, изменяет его, закрывает его, а затем выбирает **нет** при появлении запроса на сохранение документа. В этом случае, если документ содержит `RDT_ReadLock` , документ не будет закрыт, а измененный документ останется открытым невидимым в памяти, даже если пользователь отказался от сохранения документа.

Если невидимый открывающий документ использует слабый объект `RDT_EditLock` , он получает блокировку, когда пользователь открывает документ, и никакие другие блокировки не удерживаются. Когда пользователь закрывает **документвиндов** и выбирает **No (нет** ) при запросе на сохранение документа, документ должен быть закрыт из памяти. Это означает, что невидимый клиент должен прослушивать события РДТ для отслеживания этого вхождения. При следующем необходимости документ должен быть открыт повторно.
