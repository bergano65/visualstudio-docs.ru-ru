---
title: Компоненты редактора
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], new - architecture
ms.assetid: 822cbb8d-7ab4-40ee-bd12-44016ebcce81
author: gregvanl
ms.author: gregvanl
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: 3979138944671ff2809f4f73beb0a28b222ec5ff
ms.sourcegitcommit: 1fc6ee928733e61a1f42782f832ead9f7946d00c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2019
ms.locfileid: "60053199"
---
# <a name="inside-the-editor"></a>В редакторе

Редактор состоит из нескольких разных подсистем, которые предназначены для предотвращения редактор текста отдельные модели представления текста и пользовательского интерфейса.

Эти разделы описывают различные аспекты редактора:

- [Обзор подсистемы](../extensibility/inside-the-editor.md#overview-of-the-subsystems)

- [Модель текста](../extensibility/inside-the-editor.md#the-text-model)

- [Представление текста](../extensibility/inside-the-editor.md#the-text-view)

Эти разделы описывают возможности редактора кода:

- [Теги и классификаторов](../extensibility/inside-the-editor.md#tags-and-classifiers)

- [Элементы оформления](../extensibility/inside-the-editor.md#adornments)

- [Проекция](../extensibility/inside-the-editor.md#projection)

- [Структура](../extensibility/inside-the-editor.md#outlining)

- [Привязок мыши](../extensibility/inside-the-editor.md#mouse-bindings)

- [Редактор операций](../extensibility/inside-the-editor.md#editor-operations)

- [IntelliSense](../extensibility/inside-the-editor.md#intellisense)

## <a name="overview-of-the-subsystems"></a>Обзор подсистемы

### <a name="text-model-subsystem"></a>Подсистемы модели текста

Подсистема модели текста отвечает за представления текста и включение его обработки. Подсистема модели текст содержит <xref:Microsoft.VisualStudio.Text.ITextBuffer> интерфейс, который описывает последовательность символов, которые должны отображаться в редакторе. Этот текст можно изменить, отслеживаться и обрабатываться различными способами. Модель текста также предоставляет типы для следующих аспектов:

- Служба, которая связывает текст с файлами и управляет чтения и записи их в файловой системе.

- Разностный служба, которая находит минимальными различиями между двумя последовательностями объектов.

- Система для описания текст в буфере, с точки зрения подмножества текста в другие буферы.

Подсистема модели текст предоставляется концепций пользовательского интерфейса (UI). Например не несет ответственности за форматирование текста или текста, и он не имеет сведений о visual элементы оформления, которые могут быть связаны с текстом.

Открытые типы текста подсистемы модели содержатся в *Microsoft.VisualStudio.Text.Data.dll* и *Microsoft.VisualStudio.CoreUtility.dll*, которые зависят от только базового .NET Framework Библиотека классов и Managed Extensibility Framework (MEF).

### <a name="text-view-subsystem"></a>Текстовое представление подсистемы

Для форматирования и отображения текста отвечает подсистеме представления текста. Типы в этой подсистеме можно разделить на два слоя: в зависимости от того, является ли типы полагаться на Windows Presentation Foundation (WPF). Наиболее важными типами являются <xref:Microsoft.VisualStudio.Text.Editor.ITextView> и <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextView>, какой элемент управления, набор текстовых строк, которые должны отображаться и также курсор, выбор и средства для декоративных текст с помощью элементов пользовательского интерфейса WPF. Эта подсистема также предоставляет область отображения поля вокруг текста. Эти поля могут быть расширены и может содержать различные виды содержимого и визуальные эффекты. Поля относятся строки чисел отображает и полосами прокрутки.

Открытые типы подсистемы представления текста, содержащихся в *Microsoft.VisualStudio.Text.UI.dll* и *Microsoft.VisualStudio.Text.UI.Wpf.dll*. Первая сборка содержит элементы независимо от платформы, а второй содержит элементы, относящихся к WPF.

### <a name="classification-subsystem"></a>Подсистема классификации

Подсистема классификации отвечает за определение свойства шрифта для текста. Классификатор разбивает текст на различных классов, например, «ключевое слово» или «comment». Сопоставление форматов классификации связывающая эти классы свойства шрифта, например, «синий Consolas 10 пт». Эта информация используется в представлении текста при его форматирует и отображает текст. Добавление тегов, который описан более подробно далее в этом разделе включает данные должны быть сопоставлены диапазоны текста.

Открытые типы классификации подсистемы содержатся в Microsoft.VisualStudio.Text.Logic.dll и их взаимодействие с визуальными аспектами классификации, которые содержатся в Microsoft.VisualStudio.Text.UI.Wpf.dll.

### <a name="operations-subsystem"></a>Подсистема операций

Подсистема операции определяет поведение редактора. Она предоставляет реализацию для команд редактора Visual Studio и системе отмены.

## <a name="a-closer-look-at-the-text-model-and-the-text-view"></a>Подробный обзор модели текста и представлением текста

### <a name="the-text-model"></a>Модель текста

Подсистема модели текст включает разные группы текстовых типов. К ним относятся текстового буфера, снимков текста и текстовых диапазонов.

#### <a name="text-buffers-and-text-snapshots"></a>Текстовыми буферами и снимков текста

<xref:Microsoft.VisualStudio.Text.ITextBuffer> Интерфейс представляет последовательность символов Юникода, которые закодированы с помощью UTF-16, что кодировка используется `String` тип в .NET Framework. Текстового буфера, которые могут быть сохранены как файл документа системы, но это не является обязательным.

<xref:Microsoft.VisualStudio.Text.ITextBufferFactoryService> Используется для создания в пустой текстовый буфер или текстовый буфер, который инициализируется из строки или из <xref:System.IO.TextReader>. Текстовый буфер можно сохранять в файловой системе как <xref:Microsoft.VisualStudio.Text.ITextDocument>.

Любой поток можно редактировать текстового буфера, пока поток становится владельцем текстового буфера, вызвав <xref:Microsoft.VisualStudio.Text.ITextBuffer.TakeThreadOwnership%2A>. После этого только этот поток можно выполнить изменения.

Текстовый буфер можно выполнить множество версий во время его существования. Новая версия создается каждый раз при редактировании буфера и неизменяемый <xref:Microsoft.VisualStudio.Text.ITextSnapshot> представляет содержимое этой версии буфера. Так как текстовых снимков являются неизменяемыми, доступны снимок текста в любом потоке, без ограничений, даже если текстовый буфер, который он представляет продолжает изменяться.

#### <a name="text-snapshots-and-text-snapshot-lines"></a>Моментальные снимки текста и строк текста моментальных снимков

Можно просмотреть содержимое моментального снимка текст как последовательность символов, или как последовательность строк. Символы и строки являются оба индексируются, начиная с нуля. Пустой текстовый снимок содержит нуль символов и одну пустую строку. Строка отделена любую допустимую последовательность символов разрыва строки Юникода или начало или конец буфера. Символы разрыва строки явно представлены в текстовом снимке, и разрывы строк в снимок текста, могут быть одинаковыми.

> [!NOTE]
> Дополнительные сведения о символы разрыва строки в редакторе Visual Studio, см. в разделе [кодировки и разрывы строк](../ide/encodings-and-line-breaks.md).

Представленный текстовую строку <xref:Microsoft.VisualStudio.Text.ITextSnapshotLine> объект, который можно получить из моментального снимка текста для некоторого числа или для определенной позиции.

#### <a name="snapshotpoints-snapshotspans-and-normalizedsnapshotspancollections"></a>Точки SnapshotPoint SnapshotSpans и NormalizedSnapshotSpanCollections

Объект <xref:Microsoft.VisualStudio.Text.SnapshotPoint> представляет позицию символа в моментальном снимке. Позиция гарантированно находиться между 0 и длину моментального снимка. Объект <xref:Microsoft.VisualStudio.Text.SnapshotSpan> представляет фрагмент текста в моментальном снимке. Гарантируется, что его конечное положение находиться между 0 и длину моментального снимка. <xref:Microsoft.VisualStudio.Text.NormalizedSnapshotSpanCollection> Состоит из набора <xref:Microsoft.VisualStudio.Text.SnapshotSpan> объектов, принадлежащих одному снимку.

#### <a name="spans-and-normalizedspancollections"></a>Диапазоны и NormalizedSpanCollections

Объект <xref:Microsoft.VisualStudio.Text.Span> представляет интервал, который может применяться к диапазону текста в текстовом снимке. Моментальный снимок имеют отсчитываемый от нуля, чтобы диапазоны можно запустить в любой позиции, включая ноль. `End` Диапазона равно сумме его `Start` свойство и его `Length` свойство. Объект `Span` не включает символ, который индексируется по `End` свойство. Например, область, которая имеет Start = 5 и длина = 3 имеет конечный = 8, и он содержит знаки в позициях, 5, 6 и 7. Нотация для этой области является 5..8).

Два диапазоны пересекаются, если они содержат любые общие позиции, включая конечное положение. Таким образом, пересечение [3, 5) и [2, 7) — [3, 5) и пересечение [3, 5) и [5, 7) — [5, 5). (Обратите внимание, что [5, 5) — это пустой диапазон.)

Два диапазоны перекрываются, если они содержат общие позиции, за исключением конечного положения. Пустой диапазон никогда не перекрывается другими диапазонами и перекрытие двух диапазонов не является пустым.

Объект <xref:Microsoft.VisualStudio.Text.NormalizedSpanCollection> приведен список диапазонов порядке свойства Start диапазонов. В списке объединяются перекрывающиеся или смежных диапазонов. Например, если набор диапазонов [5..9), [0..1), [3..6), и [9..10), нормализованный список диапазонов [0..1), [3..10).

#### <a name="itextedit-textversion-and-text-change-notifications"></a>Уведомления об изменении ITextEdit, версия TextVersion и текста

Содержимое текстового буфера может быть изменен с помощью <xref:Microsoft.VisualStudio.Text.ITextEdit> объекта. Создание такой объект (с помощью одного из `CreateEdit()` методы <xref:Microsoft.VisualStudio.Text.ITextBuffer>) запускает транзакцию текст, состоящий из изменений текста. Каждую правку является заменой некоторые диапазон текста в буфере строк. Координаты и содержание каждую правку указываются относительно моментальный снимок буфера, при запуске транзакции. <xref:Microsoft.VisualStudio.Text.ITextEdit> Объект корректирует координаты изменения, которые зависят от других изменений в той же транзакции.

Например рассмотрим текстовый буфер, который содержит эту строку:

```
abcdefghij
```

Применить транзакции, содержащей два изменения, один редактирования, который заменяет диапазон в [2..4) с помощью символа `X` и второй редактирования, который заменяет диапазон в [6..9) с помощью символа `Y`. Результатом является этот буфер:

```
abXefYj
```

Координаты для второй изменения были рассчитаны по отношению к содержимое буфера в начале транзакции, до применения первое изменение.

Изменения в буфере вступят в силу при <xref:Microsoft.VisualStudio.Text.ITextEdit> объект фиксируется путем вызова его `Apply()` метод. В случае отсутствия хотя бы один непустой Правка, новый <xref:Microsoft.VisualStudio.Text.ITextVersion> создается новый <xref:Microsoft.VisualStudio.Text.ITextSnapshot> создается и один `Changed` события. Каждая версия текста, у них разные текстовом снимке. Снимок текста представляет полного состояния текстового буфера после транзакцию изменения, но версия текста описание только изменений из одного моментального снимка к следующему. В целом моментальные снимки текста должен использоваться один раз и затем удаляется, пока некоторое время должен существовать текстовых версий.

Текстовая версия содержит <xref:Microsoft.VisualStudio.Text.INormalizedTextChangeCollection>. Эта коллекция содержит описание изменений, при применении к моментального снимка, создания последующих моментального снимка. Каждый <xref:Microsoft.VisualStudio.Text.ITextChange> в коллекции содержит позицию символа, изменение, строку замены и строку замены. Строку замены является пустым для вставки в базовый, а строку замены будет пустым для основных удаления. Нормализованная коллекция всегда является `null` для самой последней версии текстового буфера.

Только один <xref:Microsoft.VisualStudio.Text.ITextEdit> можно создать экземпляр объекта для текстового буфера в любое время, и все правки текста должны выполняться в потоке, который владеет текстового буфера (если Затребован владения). Правка текста можно брошенным путем вызова его `Cancel` метод или его `Dispose` метод.

<xref:Microsoft.VisualStudio.Text.ITextBuffer> также предоставляет `Insert()`, `Delete()`, и `Replace()` найти методы, которые опираются на <xref:Microsoft.VisualStudio.Text.ITextEdit> интерфейс. Вызывает эти имеет тот же эффект, что и при создании <xref:Microsoft.VisualStudio.Text.ITextEdit> объекта, аналогичные вызовом, а затем применить изменения.

#### <a name="tracking-points-and-tracking-spans"></a>Точки отслеживания и отслеживающих диапазонов

<xref:Microsoft.VisualStudio.Text.ITrackingPoint> Представляет позицию символа в текстовом буфере. Если буфер редактируется способом, который вызывает позиции символа для сдвига, точки отслеживания смещается соответствующим образом его. Например если точка отслеживания определяет положение 10 в буфер и вставляются пять символов в начале буфера, точки отслеживания затем ссылающийся на положение 15. Если вставка в точно позиции, обозначенное с помощью точки отслеживания, его поведение определяется его <xref:Microsoft.VisualStudio.Text.PointTrackingMode>, который может быть либо `Positive` или `Negative`. При положительном режим отслеживания точки отслеживания ссылается на один и тот же символ, который теперь является в конце курсора. Если режим отслеживания является отрицательным, точки отслеживания ссылается на первый символ вставленной в исходную позицию. Если символ в позиции, представленного точка отслеживания удаляется, точки отслеживания сдвигает первый символ, который следует за удаленной диапазона. Например если точка отслеживания ссылается на символ в позиции 5, и будут удалены символы в позициях 3 – 6, точки отслеживания определяет ссылку на символ в позиции 3.

<xref:Microsoft.VisualStudio.Text.ITrackingSpan> Представляет диапазон символов, а не только на одну позицию. Его поведение определяется его <xref:Microsoft.VisualStudio.Text.SpanTrackingMode>. Если используется режим отслеживания диапазонов [SpanTrackingMode.EdgeInclusive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeInclusive), отслеживающий диапазон увеличится до дополнительного текста, вставленная по краям. Если используется режим отслеживания диапазонов [SpanTrackingMode.EdgeExclusive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeExclusive), отслеживающий диапазон не может включать текст, вставленный на границах. Тем не менее если используется режим отслеживания диапазонов [SpanTrackingMode.EdgePositive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgePositive), вставка помещает текущая позиция перемещается к начальной, и если режим отслеживания диапазонов [SpanTrackingMode.EdgeNegative](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeNegative), Вставка помещает текущее положение ближе к окончанию.

Можно получить позицию точки отслеживания или диапазон отслеживающий диапазон для любой моментальный снимок текстового буфера, к которому они принадлежат. Точки отслеживания и отслеживающих диапазонов можно безопасно ссылаться из любого потока.

#### <a name="content-types"></a>Типы содержимого

Типы содержимого представляют собой механизм для определения различных видов содержимого. Тип содержимого может быть типом файла, например «text», «код» или «binary», или тип технологии, например «xml», «vb» или «c#». Например слово «using» является ключевым словом в C# и Visual Basic, но не в других языках программирования. Таким образом определение ключевого слова будет ограничен типами содержимого «c#» и «vb».

Типы содержимого используются как фильтр для элементов оформления и другие элементы редактора. Многие функции редактора и точки расширения определяются для каждого типа содержимого. Например выделение цветом текста отличается для обычные текстовые файлы, XML-файлы и файлы исходного кода Visual Basic. Текстовые буферы обычно назначаются типом содержимого, при их создании, и можно изменить тип содержимого текстового буфера.

Типы содержимого может несколько наследовать от других типов содержимого. <xref:Microsoft.VisualStudio.Utilities.ContentTypeDefinition> Позволяет указать несколько базовых типов в качестве родительских элементов данного типа содержимого.

Разработчики могут определять свои собственные типы содержимого и зарегистрировать их с помощью <xref:Microsoft.VisualStudio.Utilities.IContentTypeRegistryService>. Многие функции редактора можно определить по отношению к определенному типу содержимого с помощью <xref:Microsoft.VisualStudio.Utilities.ContentTypeAttribute>. Например редактор поля, элементы оформления и обработчики мыши можно определить, чтобы они применялись только к редакторам, отображающих содержимым определенного типа.

### <a name="the-text-view"></a>Представление текста

В представлении части шаблона контроллер (MVC) представления модели определяет представление текста, форматирования представления, графических элементов, таких как полоса прокрутки и курсор. Все элементы представления редактора Visual Studio основаны на WPF.

#### <a name="text-views"></a>Текст представления

<xref:Microsoft.VisualStudio.Text.Editor.ITextView> Интерфейс представляет собой независимый от платформы представления текста. Он используется главным образом для отображения текстовых документов в окне, но его можно также использовать для других целей, например, во всплывающей подсказке.

Текстовое представление ссылается на различные виды текстовых буферов. <xref:Microsoft.VisualStudio.Text.Editor.ITextView.TextViewModel%2A> Свойство ссылается на <xref:Microsoft.VisualStudio.Text.Editor.ITextViewModel> объекта, указывающего на эти три разных текстовых буферов: буфер данных, который представляет верхнего уровня данных буфера в буфере, в какой редактировании происходит и visual буфер, который представляет буфер, который является отображается в представлении текста.

Текст форматируется в зависимости от классификаторы, вложенные в базовом текстовом буфере и оформить с помощью поставщиков оформления, подключенные к самому представлению текста.

#### <a name="the-text-view-coordinate-system"></a>Система координат представления текста

Система координат представления текста указывает позиций в представлении текста. В этой системе координат x значение 0,0 соответствует по левому краю текста, а значения y 0,0 соответствует и верхним краем текста, отображаемого. Координаты x увеличивается слева направо, а координата y увеличивается сверху вниз.

Окно просмотра (часть текста в текстовом окне) не может быть таким же образом горизонтальной прокрутки как может прокручиваться по вертикали. Область просмотра может прокручиваться по горизонтали, изменив ее левая координата, чтобы он перемещался по отношению к поверхности рисования. Тем не менее, окно просмотра может прокручиваться по вертикали путем изменения отрисованному тексту, что приводит к <xref:Microsoft.VisualStudio.Text.Editor.ITextView.LayoutChanged> возникает событие.

Расстояние в системе координат соответствуют логических пикселях. Если поверхность для отрисовки текста отображается без преобразования изменения масштаба, одну единицу в системе координат отрисовки текста соответствует один пиксель на экране.

#### <a name="margins"></a>Поля

<xref:Microsoft.VisualStudio.Text.Editor.ITextViewMargin> Интерфейс представляет поле и позволяет управлять видимостью поля и его размер. Существуют четыре предопределенных полей, которые называются «Top», «Left», «Right» и «Bottom» и присоединяются к верхней, нижней, левой или правой границы представления. Эти поля являются контейнерами, в которых могут размещаться другими полями. Интерфейс определяет методы, возвращающие размер поля и видимость поля. Поля являются визуальные элементы, содержащие дополнительные сведения о представлении текста, к которому они подключены. Например поле номеров строк отображает номера строк для представления текста. Поле глифов отображает элементы пользовательского интерфейса.

<xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewMarginProvider> Интерфейса отвечает за создание и размещение полей. Поля могут быть упорядочены по отношению к других полей. Поля с более высоким приоритетом приведены ближе к текстовому представлению. Например если два левого полей, полю A и B полей и полей B имеет низкий приоритет, чем полю A, поле B, отображается слева от поля A.

#### <a name="the-text-view-host"></a>Узел представления текста

<xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewHost> Интерфейс содержит представления текста и все смежные оформление, которые сопровождают представления, например, полосы прокрутки. Узел представления текста также содержит поля, присоединенные к границы представления.

#### <a name="formatted-text"></a>Форматированный текст

Представляет собой текст, отображаемый в представлении текста <xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine> объектов. Каждая строка представления текста соответствует одна строка текста в представлении текста. Длинных строк в базовом текстовом буфере могут быть частично скрыты (если не включен перенос слов) или разбит на несколько строк представления текста. <xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine> Интерфейс содержит методы и свойства для сопоставления координаты и символов, а также для элементов оформления, которые могут быть связаны со строкой.

<xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine> объекты создаются с помощью <xref:Microsoft.VisualStudio.Text.Formatting.IFormattedLineSource> интерфейс. Если вас интересуют только текст, который отображается в текущий момент в представлении, можно игнорировать источника форматирования. Если вы заинтересованы в формате текста, не отображаются в представлении (например, для поддержки вырезания форматированного текста и вставить), можно использовать <xref:Microsoft.VisualStudio.Text.Formatting.IFormattedLineSource> для форматирования текста в текстовом буфере.

Представление текста форматирует один <xref:Microsoft.VisualStudio.Text.ITextSnapshotLine> за раз.

## <a name="editor-features"></a>Возможности редактора

Возможности редактора кода предназначены, чтобы определение функции отличается от его реализации. Редактор включает следующие возможности:

- Теги и классификаторов

- Элементы оформления

- Проекция

- Структуризация

- Мыши и ключом привязки

- Операции и примитивы

- IntelliSense

### <a name="tags-and-classifiers"></a>Теги и классификаторов

Теги — это маркеры, которые связаны с диапазон текста. Они могут быть представлены различными способами, например, с помощью выделения цветом текста, подчеркивание, графики или всплывающие окна. Классификаторы — один вид тега.

Другие виды тегов <xref:Microsoft.VisualStudio.Text.Tagging.TextMarkerTag> для выделения текста, <xref:Microsoft.VisualStudio.Text.Tagging.OutliningRegionTag> для структурирования, и <xref:Microsoft.VisualStudio.Text.Tagging.ErrorTag> для ошибок компиляции.

#### <a name="classification-types"></a>Типы классификации

<xref:Microsoft.VisualStudio.Text.Classification.IClassificationType> Интерфейс представляет класс эквивалентности, который является абстрактным категорией текста. Типы классификации может несколько наследовать от других типов классификации. Например классификаций языков программирования могут включать «ключевое слово», «комментарий» и «идентификатор», которые наследуют от «код». Типы классификации естественного языка может включать «существительное», «глагол» и «прилагательными», которые наследуют от «естественного языка».

#### <a name="classifications"></a>Классификация

Классификация является экземпляром определенного типа классификации, обычно через диапазон текста. Объект <xref:Microsoft.VisualStudio.Text.Classification.ClassificationSpan> используется для представления классификацию. Диапазон классификации может рассматриваться как метку, которая охватывает определенный диапазон текста и сообщает системе, что этот диапазон текста имеет определенного типа классификации.

#### <a name="classifiers"></a>Классификаторы

<xref:Microsoft.VisualStudio.Text.Classification.IClassifier> — Это механизм, который разбивает текст на набору классификаций. Классификаторы должен быть определен для специальных типов содержимого и для определенных текстовых буферов. Клиенты должны реализовать <xref:Microsoft.VisualStudio.Text.Classification.IClassifier> участвовать в классификации текста.

#### <a name="classifier-aggregators"></a>Классификатор агрегаторы

Агрегатор классификатор — это механизм, который объединяет все классификаторы для одного текстового буфера в один набор классификации. Например классификатора C# и классификатор на английском языке создать классификации на примечание в файле C#. Рассмотрим этот комментарий:

```
// This method produces a classifier
```

Классификатор C# может маркировать весь диапазон как комментарий и классификатор английского языка может классифицировать «выдает» как «глагол» и «method», как «существительное». Средство инвентаризации программного обеспечения предоставляет набор неперекрывающихся классификации, а тип набора основан на всех публикаций.

Агрегатор классификатора также — это классификатор, так как он разбивает текст на набору классификаций. Средство инвентаризации программного обеспечения классификатора также гарантирует, что не перекрывающихся классификации и что сортируются классификации. Отдельные классификаторы — может вернуть любой набор категорий в любом порядке и перекрывающиеся любым способом.

#### <a name="classification-formatting-and-text-coloring"></a>Форматирование классификации и цвета текста

Форматирование текста — это пример функции, которая основана на классификация текста. Он используется на уровне представления текста для определения отображение текста в приложении. Область форматирования текста зависит от WPF, но не поддерживает логическое определение классификаций.

Формата классификации — это набор свойств для типа затрагивает конкретный класс форматирования. Эти форматы наследуют формат родительского типа классификации.

<xref:Microsoft.VisualStudio.Text.Classification.IClassificationFormatMap> — Это сопоставление из типа классификации набор свойств форматирования текста. Реализация сопоставление форматов в редакторе обрабатывает все экспорты из форматов классификации.

### <a name="adornments"></a>Элементы оформления

Элементы оформления, графические эффекты, которые не связаны непосредственно с шрифт и цвет символов в представлении текста. Например Подчеркивание красной волнистой линией, используемую для обозначения-компиляции кода во многих языках программирования, элемент embedded оформления и подсказки отображаются всплывающие элементы оформления. Элементы оформления являются производными от <xref:System.Windows.UIElement> и реализовать <xref:Microsoft.VisualStudio.Text.Tagging.ITag>. Два типа специализированные тега оформления: <xref:Microsoft.VisualStudio.Text.Tagging.SpaceNegotiatingAdornmentTag>, для элементов оформления, которые занимают то же место как текст в представлении, и <xref:Microsoft.VisualStudio.Text.Tagging.ErrorTag>, для подчеркивание волнистой линией.

Внедренные элементы оформления, графики, которая является частью представления форматированного текста. Они организованы в различных уровней Z-порядка. Существуют три встроенные слои, следующим образом: текст, курсор и выделение. Тем не менее разработчики могут определять дополнительные слои и поместить их в порядке по отношению к друг с другом. Три вида внедренные элементы оформления: элементы оформления текста относительно (которые перемещения при перемещении текст того они удаляются при удалении текста), зависящий от представления оформлений (что необходимо сделать с частями нетекстовых представления) и управлением владельца оформлений ( Разработчик должен управлять их расположение).

Всплывающие элементы оформления, графики, которые отображаются в маленьком окне над представлением текста, например, подсказок.

### <a name="projection"></a> Проекции

Проекция — это метод для создания разных видов текстовый буфер, который не хранят текст, но вместо этого объединяет текст из других текстовых буферов. Например буфер проекции может использоваться для объединения текста из двух буферов и представит результат, как если бы он выполняется только один буфер или для скрытия части текста в один буфер. Буфер проекции может выступать в качестве буфера источника другой буфер проекции. Набор буферов, связанных с помощью проекции могут создаваться для изменения порядка текста различными способами. (Такой набор называется также *граф буферов*.) Функция структурирования Visual Studio текст реализуется с помощью буфера проекции для скрытия свернутого текста, и редактор Visual Studio для страниц ASP.NET использует проекции для поддержки внедренного языков, таких как Visual Basic и C#.

<xref:Microsoft.VisualStudio.Text.Projection.IProjectionBuffer> Создается с помощью <xref:Microsoft.VisualStudio.Text.Projection.IProjectionBufferFactoryService>. Буфер проекции, представленного упорядоченная последовательность <xref:Microsoft.VisualStudio.Text.ITrackingSpan> объекты, которые известны как *исходных диапазонов*. Содержимое эти диапазоны представлены в виде последовательности символов. Текстовых буферов, из которых рисуются исходных диапазонов именуются *источника буферы*. Клиенты буфера проекции нет необходимости Имейте в виду, что он отличается от обычного текстового буфера.

Буфер проекции прослушивает события изменения текста в исходных буферах. Когда текст в источнике охватывают изменений, буфер проекции сопоставляется собственный координаты в координаты измененного текста и вызывает соответствующие изменения текста события. Например рассмотрим исходные буферы A и B, имеющие эти содержимое:

```
A: ABCDE
B: vwxyz
```

Если буфер проекции P формируется из двух текстовых диапазонов, один со всеми буфера, а, а другие, все буфера B, P имеет следующее содержимое:

```
P: ABCDEvwxyz
```

Если подстрока `xy` удаляется из буфера B, а затем буфер P формирует событие, которое указывает, что были удалены знаки в позициях, 7 и 8.

Также можно непосредственно редактировать в буфер проекции. Оно передает изменения в соответствующий источник буферы. Например если строка вставляется в буфер "P" в положение 6 (исходной позиции символ «v»), вставка распространяется буфер B в позиции 1.

Существуют ограничения на исходных диапазонов, которые участвуют в буфере проекции. Исходных диапазонов, не могут перекрываться; расположение в буфере проекции не может сопоставить более одного местоположения в любом буфере источника, а расположение в исходном буфере невозможно сопоставить с более чем из одного расположения в буфере проекции. Circularities не допускаются в отношении исходного буфера.

События создаются, когда набор исходных буферов при изменении буфера проекции и набор исходных диапазонов изменения.
Буфер элизии — это особый тип буфера проекции. В основном используется для структурирования и для операций, разворачивать и сворачивать блоки текста. Буфер элизии основан на лишь один исходный буфер и диапазонов в буфере элизии должны быть упорядочены же, как они упорядочиваются в буфере источника.

#### <a name="the-buffer-graph"></a>Граф буферов

<xref:Microsoft.VisualStudio.Text.Projection.IBufferGraph> Интерфейс предоставляет сопоставление между граф буферов проекции. В виде направленного ациклического графа, подобно дерева абстрактного синтаксиса, который создается с помощью языкового компилятора собираются все текстовые буферы и буферов проекции. Диаграммы определяется верхнего буфера, который может быть любой текстовый буфер. Граф буферов можно сопоставить с точки в верхнем буфере до точки в исходном буфере или из диапазона верхнего буфера, в набор диапазонов в исходном буфере. Аналогичным образом он может сопоставления или span из исходного буфера до определенного момента верхнего буфера. Буфер графы создаются с помощью <xref:Microsoft.VisualStudio.Text.Projection.IBufferGraphFactoryService>.

#### <a name="events-and-projection-buffers"></a>События и буферов проекции

При изменении буфер проекции, изменения отправляются из буфера проекции в буферы, зависящие от нее. После изменения все буферы, события изменения буфера создаются, начиная с самой глубокой буфера.

### <a name="outlining"></a>структуризация

Структурирование является возможность разворачивать и сворачивать различные блоки текста в представлении текста. Структурирование определен как тип из <xref:Microsoft.VisualStudio.Text.Tagging.ITag>, в так же, как определенные элементы оформления. Объект <xref:Microsoft.VisualStudio.Text.Tagging.OutliningRegionTag> — это тег, который определяет область текста, который можно разворачивать и сворачивать. Чтобы использовать структурирование, необходимо импортировать <xref:Microsoft.VisualStudio.Text.Outlining.IOutliningManagerService> для получения <xref:Microsoft.VisualStudio.Text.Outlining.IOutliningManager>. Диспетчер структуры перечисляет сворачивает и разворачивает различных блоков, которые представлены в виде <xref:Microsoft.VisualStudio.Text.Outlining.ICollapsible> объектов и создает события соответствующим образом.

### <a name="mouse-bindings"></a>Привязок мыши

Привязок мыши связи движения мыши на различные команды. С помощью определенных привязок мыши <xref:Microsoft.VisualStudio.Text.Editor.IMouseProcessorProvider>, и определенные сочетания клавиш с помощью <xref:Microsoft.VisualStudio.Text.Editor.IKeyProcessorProvider>. <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewHost> Автоматически создает все привязки, а также соединяет их в события мыши в представлении.

<xref:Microsoft.VisualStudio.Text.Editor.IMouseProcessor> Интерфейс содержит обработчики событий предварительной обработки и последующей обработки для разных событий мыши. Для обработки одного из событий, можно переопределить некоторые методы в <xref:Microsoft.VisualStudio.Text.Editor.MouseProcessorBase>.

### <a name="editor-operations"></a>Редактор операций

Редактор операций можно использовать для автоматизации взаимодействия с помощью редактора, для использования в сценариях или в других целях. Вы можете импортировать <xref:Microsoft.VisualStudio.Text.Operations.IEditorOperationsFactoryService> операций доступа к заданной <xref:Microsoft.VisualStudio.Text.Editor.ITextView>. Затем эти объекты можно использовать для изменения выбранной области, прокрутите представление или переместить курсор на разные части представления.

### <a name="intellisense"></a>IntelliSense

IntelliSense поддерживает завершение операторов, Справка по сигнатурам (также известный как сведения о параметрах), краткие сведения и лампочки.

Завершение операторов предоставляет всплывающие списки возможных завершений для имен методов, XML-элементов и другие элементы программирования или разметки. В общем случае жест пользователя вызывает сеанс завершения. Сеанс отображает список возможных завершений, и пользователь может выбрать один или закрыть список. <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionBroker> Отвечает за создание и активация <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionSession>. <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionSource> Вычисляет <xref:Microsoft.VisualStudio.Language.Intellisense.CompletionSet> элементов завершения сеанса.

## <a name="see-also"></a>См. также

- [Точки расширения редактора и служба языка](../extensibility/language-service-and-editor-extension-points.md)
- [Импорт в редакторе](../extensibility/editor-imports.md)