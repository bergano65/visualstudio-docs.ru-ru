---
title: Управление параллельными ассоциациями файлов | Документация Майкрософт
description: Если пакет VSPackage предоставляет сопоставления файлов, решите, как выполнять параллельную установку, в которой в конкретной версии Visual Studio открывается файл.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- verbs, setting default
ms.assetid: 9b6df3bc-d15c-4a5d-9015-948a806193b7
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 157e8b4b4d7a00845fb76e0105414879cb1f472d
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99924851"
---
# <a name="manage-side-by-side-file-associations"></a>Управление параллельными сопоставлениями файлов

Если пакет VSPackage предоставляет сопоставления файлов, необходимо решить, как обрабатывать параллельные установки, в которых [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] должна быть вызвана конкретная версия, чтобы открыть файл. Проблемы имеют несовместимые форматы файлов.

Пользователи предполагают, что новая версия продукта совместима с более ранними версиями, чтобы существующие файлы можно было загрузить в новую версию без потери данных. В идеале пакет VSPackage может загружать и сохранять форматы файлов более ранних версий. Если это не так, следует предложить обновить формат файла до новой версии VSPackage. Недостаток этого подхода заключается в том, что обновленный файл не может быть открыт в более ранней версии.

Чтобы избежать этой проблемы, можно изменить расширения, если форматы файлов станут несовместимыми. Например, версия 1 пакета VSPackage может использовать расширение, *. mypkg10* и версия 2 могут использовать расширение, *. mypkg20*. Это различие определяет пакет VSPackage, который открывает определенный файл. При добавлении новых пакетов VSPackage в список программ, связанных со старым расширением, пользователи могут щелкнуть файл правой кнопкой мыши и выбрать открыть его в более новом пакете VSPackage. На этом этапе пакет VSPackage может предложить обновить файл до нового формата или открыть файл и обеспечить совместимость с более ранними версиями VSPackage.

> [!NOTE]
> Эти подходы можно сочетать. Например, можно обеспечить обратную совместимость, загрузив старый файл и предложим обновить формат файла при его сохранении пользователем.

## <a name="face-the-problem"></a>Проблема

Если требуется несколько параллельных пакетов VSPackage для использования одного и того же расширения, необходимо выбрать версию [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] , связанную с расширением. Ниже приведены два варианта.

- Откройте файл в последней версии, [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] установленной на компьютере пользователя.

   При таком подходе установщик отвечает за определение последней версии [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] и включает его в запись реестра, записанную для сопоставления файлов. В установщик Windowsном пакете можно включить пользовательские действия, чтобы задать свойство, указывающее последнюю версию [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] .

  > [!NOTE]
  > В этом контексте «последняя» означает «последнюю поддерживаемую версию». Эти записи установщика не будут автоматически обнаруживать последующий выпуск [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] . Записи в разделе [Определение требований к системе](../extensibility/internals/detecting-system-requirements.md) и в [командах, которые должны выполняться после установки](../extensibility/internals/commands-that-must-be-run-after-installation.md) , аналогичны приведенным здесь и необходимы для поддержки дополнительных версий [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] .

   Следующие строки в таблице CustomAction задают свойство DEVENV_EXE_LATEST как свойство, заданное в таблицах Аппсеарч и Реглокатор, которые обсуждаются в [командах, которые должны быть выполнены после установки](../extensibility/internals/commands-that-must-be-run-after-installation.md). Строки в таблице Инсталлексекутесекуенце запланируют настраиваемые действия на раннем этапе последовательности выполнения. Значения в столбце Условие позволяют логике работать:

  - Visual Studio .NET 2002 — это последняя версия, если это единственная текущая версия.

  - Visual Studio .NET 2003 — это последняя версия, только если она имеется и отсутствует [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] .

  - [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] — Последняя версия, если это единственная текущая версия.

    В итоге DEVENV_EXE_LATEST содержит путь к последней версии devenv.exe.

  **Строки таблицы CustomAction, определяющие последнюю версию Visual Studio**

  |Действие|Тип|Источник|Назначение|
  |------------|----------|------------|------------|
  |CA_SetDevenvLatest_2002|51|DEVENV_EXE_LATEST|[DEVENV_EXE_2002]|
  |CA_SetDevenvLatest_2003|51|DEVENV_EXE_LATEST|[DEVENV_EXE_2003]|
  |CA_SetDevenvLatest_2005|51|DEVENV_EXE_LATEST|[DEVENV_EXE_2005]|

  **Строки таблицы Инсталлексекутесекуенце, определяющие последнюю версию Visual Studio**

  |Действие|Условие|Последовательность|
  |------------|---------------|--------------|
  |CA_SetDevenvLatest_2002|DEVENV_EXE_2002, А НЕ (DEVENV_EXE_2003 ИЛИ DEVENV_EXE_2005)|410|
  |CA_SetDevenvLatest_2003|DEVENV_EXE_2003 И НЕ DEVENV_EXE_2005|420|
  |CA_SetDevenvLatest_2005|DEVENV_EXE_2005|430|

   Вы можете использовать свойство DEVENV_EXE_LATEST в таблице реестра пакета установщик Windows, чтобы записать значение по умолчанию **HKEY_CLASSES_ROOT *ProgID* шеллопенкомманд** Key, [DEVENV_EXE_LATEST] "%1"

- Запустите общую программу запуска, которая позволит выбрать оптимальный вариант из доступных версий VSPackage.

   Разработчики [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] выбрали этот подход для решения сложных требований нескольких форматов решений и проектов, которые появляющиеся результатом многих версий [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] . При таком подходе вы регистрируете программу запуска в качестве обработчика расширения. Средство запуска проверяет файл и решает, какая версия и пакет [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] VSPackage могут работать с этим конкретным файлом. Например, если пользователь открывает файл, который был последним сохранен в определенной версии VSPackage, средство запуска может запустить пакет VSPackage в соответствующей версии [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] . Кроме того, пользователь может настроить средство запуска, чтобы всегда запускать последнюю версию. Средство запуска также может предлагать пользователю обновить формат файла. Если формат файла содержит номер версии, средство запуска может сообщать пользователю о том, что файл имеет формат из версии, более поздней, чем один или несколько установленных пакетов VSPackage.

   Средство запуска должно находиться в установщик Windows компоненте, который является общим для всех версий VSPackage. Этот процесс гарантирует, что последняя версия всегда установлена и не будет удалена до удаления всех версий пакета VSPackage. Таким образом, сопоставления файлов и другие записи реестра компонента запуска сохраняются даже при удалении одной версии VSPackage.

## <a name="uninstall-and-file-associations"></a>Удаление и сопоставление файлов

Удаление пакета VSPackage, записывающего записи реестра для сопоставлений файлов, приводит к удалению сопоставлений файлов. Поэтому у расширения нет связанных программ. Установщик Windows не восстанавливает записи реестра, которые были добавлены при установке VSPackage. Ниже приведены некоторые способы исправления сопоставлений файлов пользователей.

- Используйте общий компонент средства запуска, как описано выше.

- Попросите пользователя выполнить восстановление версии VSPackage, которой пользователь хочет владеть ассоциацией файлов.

- Предоставьте отдельную исполняемую программу, которая перезапишет соответствующие записи реестра.

- Укажите страницу параметров конфигурации или диалоговое окно, которое позволяет пользователям выбрать сопоставления файлов и освободить Потерянные связи. Попросите пользователей запустить его после удаления.

## <a name="see-also"></a>См. также раздел

- [Регистрация расширений имен файлов для параллельных развертываний](../extensibility/registering-file-name-extensions-for-side-by-side-deployments.md)
- [Регистрация команд для расширений имен файлов](../extensibility/registering-verbs-for-file-name-extensions.md)
