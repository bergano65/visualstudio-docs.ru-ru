---
title: Цвета и стили для Visual Studio | Документация Майкрософт
description: Узнайте, как взаимодействие с пользователем в Visual Studio использует Color в качестве средства связи, а не по чисто Aesthetic причинам.
ms.custom: SEO-VS-2020
ms.date: 07/31/2017
ms.topic: conceptual
ms.assetid: 0e384ea1-4d9e-4307-8884-6e183900732c
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: bf32f4cd32ad6e53c1db33f75f68559e84414436
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99942910"
---
# <a name="colors-and-styling-for-visual-studio"></a>Цвета и стили для Visual Studio

## <a name="use-color-in-visual-studio"></a>Использование цвета в Visual Studio

В Visual Studio цвет используется в основном как средство связи, а не как декорирование. Используйте минимальный цвет и зарезервируйте его в тех ситуациях, когда вы хотите:

- Передавать значение или принадлежность (например, модификаторы платформы или языка)

- Привлечь внимание (например, об изменении состояния)

- Повышение удобочитаемости и предоставление ориентиров для навигации по пользовательскому интерфейсу

- Повышение запрошенности

Существует несколько вариантов назначения цветов элементам пользовательского интерфейса в Visual Studio. Иногда может быть трудно выяснить, какой вариант использовать, или как правильно его использовать. Этот раздел поможет вам:

- Изучите различные службы и системы, используемые для определения цветов в Visual Studio.

- Выберите правильный параметр для заданного элемента.

- Правильно используйте выбранный параметр.

> [!NOTE]
> Никогда не кодировать шестнадцатеричные, RGB или системные цвета в элементы пользовательского интерфейса. Использование служб обеспечивает гибкость при настройке оттенка. Кроме того, без службы вы не сможете воспользоваться возможностями коммутации темы [службы всколор](../../extensibility/ux-guidelines/colors-and-styling-for-visual-studio.md#BKMK_TheVSColorService).

### <a name="methods-for-assigning-color-to-visual-studio-interface-elements"></a>Методы для назначения цвета элементам интерфейса Visual Studio

Выберите метод, который лучше всего подходит для элементов пользовательского интерфейса.

| Пользовательский интерфейс | Метод | Какие? |
| --- | --- | --- |
| У вас есть встроенные или изолированные диалоговые окна. | **Системные цвета** | Системные имена, позволяющие операционной системе определять цвет и внешний вид элементов пользовательского интерфейса, таких как общие элементы управления диалогового окна. |
| У вас есть пользовательский интерфейс, который должен быть согласован с общей средой VS, и у вас есть элементы пользовательского интерфейса, соответствующие категории и семантическому значению общих токенов. | **Общие общие цвета** | Существующие стандартные имена маркеров цветов для определенных элементов пользовательского интерфейса |
| У вас есть отдельный компонент или группа функций, и для таких элементов нет общего цвета. | **Пользовательские цвета** | Имена маркеров цвета, которые относятся к области и не предназначены для совместного использования с другим интерфейсом пользователя |
| Вы хотите разрешить конечному пользователю настраивать пользовательский интерфейс или содержимое (например, для текстовых редакторов или специализированных окон конструктора). | **Настройка конечных пользователей**<br /><br />**(Средства &gt; Диалоговое окно параметров)** | Параметры, определенные на странице "шрифты и цвета" диалогового окна " **&gt; Параметры инструментов** " или специальной страницы, относящиеся к одному компоненту пользовательского интерфейса. |

### <a name="visual-studio-themes"></a>Темы Visual Studio

Visual Studio включает три различные цветовые темы: «светлый», «темный» и «синий». Он также обнаруживает режим высокая контрастность, который является цветовой темой на уровне системы, предназначенной для специальных возможностей.

Пользователям предлагается выбрать тему во время первого использования Visual Studio и возможность переключать темы, последовательно выбрав **Сервис &gt; Параметры &gt; Среда &gt; Общие** и выбрав новую тему в раскрывающемся меню "Цветовая тема".

Пользователи также могут использовать панель управления для переключения целых систем на одну из нескольких высокая контрастность тем. Если пользователь выбирает тему высокая контрастность, селектор цветовой темы Visual Studio больше не влияет на цвета в Visual Studio, хотя все изменения в теме сохраняются, когда пользователь выходит из режима высокая контрастность. Дополнительные сведения о режиме высокая контрастность см. в разделе [выбор высокая контрастность цветов](../../extensibility/ux-guidelines/colors-and-styling-for-visual-studio.md#BKMK_ChoosingHighContrastColors).

### <a name="the-vscolor-service"></a>Служба Всколор

Visual Studio предоставляет службу цветов окружения, известную как служба Всколор, которая позволяет привязывать значения цветов элементов пользовательского интерфейса к именованной записи, содержащей значения цвета для каждой темы Visual Studio. Это гарантирует, что цвета будут автоматически меняться в соответствии с текущей выбранной пользователем темой или режимом высокая контрастность системы. Использование службы означает, что реализация всех изменений цвета, связанных с темами, обрабатывается в одном месте, и если вы используете общие общие цвета из службы, Пользовательский интерфейс автоматически отразит новые темы в будущих версиях Visual Studio.

### <a name="implementation"></a>Реализация

Исходный код Visual Studio содержит несколько файлов определений пакетов, которые содержат списки имен токенов и соответствующие значения цвета для каждой темы. Служба цветов считывает Всколорс, определенные в этих файлах определения пакета. Эти цвета указываются в разметке XAML или в коде и затем загружаются с помощью `IVsUIShell5.GetThemedColor` метода или из сопоставления DynamicResource.

### <a name="system-colors"></a>Системные цвета

Стандартные элементы управления ссылаются на системные цвета по умолчанию. Если вы хотите, чтобы пользовательский интерфейс использовал системные цвета, например при создании встроенного или изолированного диалогового окна, ничего делать не нужно.

### <a name="common-shared-colors-in-the-vscolor-service"></a>Общие общие цвета в службе Всколор

Элементы интерфейса должны отражать общую среду Visual Studio. Повторное использование общих цветов, подходящих для разрабатываемого компонента пользовательского интерфейса, гарантирует, что интерфейс будет соответствовать другим интерфейсам Visual Studio и что цвета будут автоматически обновляться при добавлении или обновлении тем.

Прежде чем использовать распространенные общие цвета, убедитесь, что вы понимаете, как правильно их использовать. Неправильное использование общих цветов может привести к несогласованности, неприятной работе или путанице пользователей.

### <a name="user-customizable-colors"></a>Настраиваемые пользователем цвета

См. раздел [предоставление цветов для конечных пользователей](../../extensibility/ux-guidelines/colors-and-styling-for-visual-studio.md#BKMK_ExposingColorsForEndUsers)

Иногда требуется разрешить конечному пользователю настраивать пользовательский интерфейс, например при создании редактора кода или области конструктора. Настраиваемые компоненты пользовательского интерфейса находятся в разделе **шрифты и цвета** диалогового окна **&gt; Параметры средств** , где пользователи могут выбрать изменение цвета переднего плана, цвета фона или и того и другого.

![&gt;Диалоговое окно "Сервис Параметры"](../../extensibility/ux-guidelines/media/0301-a_toolsoptionsdialog.png "0301 — a_ToolsOptionsDialog")<br />&gt;Диалоговое окно "Сервис Параметры"

## <a name="the-vscolor-service"></a><a name="BKMK_TheVSColorService"></a> Служба Всколор

Visual Studio предоставляет службу цветов окружения, которая также называется службой Всколор или службой цветов оболочки. Эта служба позволяет привязывать значения цветов элементов пользовательского интерфейса к цветовой набору «имя-значение», который содержит цвета для каждой темы. Служба Всколор должна использоваться для всех элементов пользовательского интерфейса, чтобы цвета автоматически изменялись для отражения текущей выбранной пользователем темы, поэтому пользовательский интерфейс, привязанный к службе цветов среды, будет интегрироваться с новыми темами в будущих версиях Visual Studio.

### <a name="how-the-service-works"></a>Как работает служба

Служба цвета окружения считывает Всколорс, определенные в pkgdef для компонента пользовательского интерфейса. Затем эти Всколорс указываются в разметке или коде XAML и загружаются с помощью `IVsUIShell5.GetThemedColor` или `DynamicResource` сопоставления.

![Архитектура службы цвета среды разработки](../../extensibility/ux-guidelines/media/0302-a_environmentcolorservicearchitecture.png "0302 — a_EnvironmentColorServiceArchitecture")<br />Архитектура службы цвета среды разработки

### <a name="accessing-the-service"></a>Доступ к службе

Существует несколько различных способов доступа к службе Всколор в зависимости от того, какой тип маркеров цвета вы используете и какой тип кода у вас есть.

#### <a name="predefined-environment-colors"></a>Стандартные цвета среды

##### <a name="from-native-code"></a>Из машинного кода

Оболочка предоставляет службу, которая предоставляет доступ к `COLORREF` цветам. Служба или интерфейс:

```
IVsUIShell2::GetVSSysColorEx(VSSYSCOLOR dwSysColIndex, DWORD *pdwRGBval)
```

В файле VSShell80. idl перечисление `__VSSYSCOLOREX` содержит константы цвета оболочки. Чтобы использовать его, передайте в качестве значения индекса одно из значений, указанных `enum __VSSYSCOLOREX` в документации MSDN, или стандартный индексный номер, который принимается системным API Windows `GetSysColor` . При этом возвращается значение RGB цвета, которое следует использовать во втором параметре.

При хранении пера или кисти с новым цветом необходимо `AdviseBroadcastMessages` (выходить из оболочки Visual Studio) и прослушивать `WM_SYSCOLORCHANGE` `WM_THEMECHANGED` сообщения и.

Чтобы получить доступ к службе цветов в машинном коде, необходимо выполнить вызов, подобный следующему:

```
pUIShell2->GetVSSysColorEx(VSCOLOR_COLOR_NAME, &rgbLOCAL_COLOR);
```

> [!NOTE]
> `COLORREF`Значения, возвращаемые, `GetVSSysColorEx()` содержат только компоненты R, G, B цвета темы. Если в записи темы используется прозрачность, то перед возвратом значение альфа-канала отбрасывается. Таким образом, если нужно использовать нужный цвет среды в том месте, где важен канал прозрачности, следует использовать `IVsUIShell5.GetThemedColor` вместо `IVsUIShell2::GetVSSysColorEx` , как описано далее в этом разделе.

##### <a name="from-managed-code"></a>Из управляемого кода

Доступ к службе Всколор с помощью машинного кода довольно прост. Однако при работе с управляемым кодом определение способа использования службы может оказаться непростой задачей. С учетом этого ниже приведен фрагмент кода C#, демонстрирующий этот процесс:

```csharp
private void VSColorPaint(object sender, System.Windows.Forms.PaintEventArgs e)
{
    //getIVSUIShell2
    IVsUIShell2 uiShell2 = Package.GetService(typeof(SVsUIShell)) as IVsUIShell2;
    Debug.Assert (uiShell2 != null, "failed to get IVsUIShell2");

    if (uiShell2 != null)
    {
        //get the COLORREF structure
        uint win32Color;
        uiShell2.GetVSSysColorEx((int)__VSSYSCOLOREX.VSCOLOR_SMARTTAG_HOVER_FILL, out win32Color);

        //translate it to a managed Color structure
        Color myColor = ColorTranslator.FromWin32((int)win32Color);
        //use it
        e.Graphics.FillRectangle(new SolidBrush(myColor), 0, 0, 100, 100);
    }
}
```

При работе в Visual Basic используйте:

```vb
Dim myColor As Color = ColorTranslator.FromWin32((Integer)win32Color)
```

##### <a name="from-wpf-ui"></a>Из пользовательского интерфейса WPF

Можно выполнить привязку к цветам Visual Studio с помощью значений, экспортированных в приложение `ResourceDictionary` . Ниже приведен пример использования ресурсов из таблицы цветов, а также привязки к данным шрифтов среды в XAML.

```xml
<Style TargetType="{x:Type Button}">
    <Setter Property="TextBlock.FontFamily"
            Value="{DynamicResource VsFont.EnvironmentFontFamily}" />
    <Setter Property="TextBlock.FontSize"
            Value="{DynamicResource VsFont.EnvironmentFontSize}" />
    <Setter Property="Background"
            Value="{DynamicResource VsBrush.EnvironmentBackgroundGradient}" />
</Style>
```

#### <a name="helper-classes-and-methods-for-managed-code"></a>Вспомогательные классы и методы для управляемого кода

Для управляемого кода библиотека управляемой платформы пакетов () оболочки `Microsoft.VisualStudio.Shell.12.0.dll` содержит несколько вспомогательных классов, облегчающих использование тематических цветов.

Вспомогательные методы в `Microsoft.VisualStudio.Shell.VsColors` классе в MPF включают `GetThemedGDIColor()` и `GetThemedWPFColor()` . Эти вспомогательные методы возвращают значение цвета для записи темы как `System.Drawing.Color` или `System.Windows.Media.Color` , для использования в WinForms или в пользовательском интерфейсе WPF.

```csharp
IVsUIShell5 shell5;
Button button = new Button();
button.BackColor = GetThemedGDIColor(shell5, SolutionExplorerColors.SelectedItemBrushKey);
button.ForeColor = GetThemedGDIColor(shell5, SolutionExplorerColors.SelectedItemTextBrushKey);

/// <summary>
/// Gets a System.Drawing.Color value from the current theme for the given color key.
/// </summary>
/// <param name="vsUIShell">The IVsUIShell5 service, used to get the color's value.</param>
/// <param name="themeResourceKey">The key to find the color for.</param>
/// <returns>The current theme's value of the named color.</returns>
public static System.Drawing.Color GetThemedGDIColor(this IVsUIShell5 vsUIShell, ThemeResourceKey themeResourceKey)
{
   Validate.IsNotNull(vsUIShell, "vsUIShell");
   Validate.IsNotNull(themeResourceKey, "themeResourceKey");

   byte[] colorComponents = GetThemedColorRgba(vsUIShell, themeResourceKey);

   // Note: The Win32 color we get back from IVsUIShell5.GetThemedColor is ABGR
   return System.Drawing.Color.FromArgb(colorComponents[3], colorComponents[0], colorComponents[1], colorComponents[2]);
}

private static byte[] GetThemedColorRgba(IVsUIShell5 vsUIShell, ThemeResourceKey themeResourceKey)
{
   Guid category = themeResourceKey.Category;
   __THEMEDCOLORTYPE colorType = __THEMEDCOLORTYPE.TCT_Foreground
   if (themeResourceKey.KeyType == ThemeResourceKeyType.BackgroundColor || themeResourceKey.KeyType == ThemeResourceKeyType.BackgroundBrush)
   {
      colorType = __THEMEDCOLORTYPE.TCT_Background;
   }

   // This call will throw an exception if the color is not found
   uint rgbaColor = vsUIShell.GetThemedColor(ref category, themeResourceKey.Name, (uint)colorType);
   return BitConverter.GetBytes(rgbaColor);
}
public static System.Windows.Media.Color GetThemedWPFColor(this IVsUIShell5 vsUIShell, ThemeResourceKey themeResourceKey)
{
   Validate.IsNotNull(vsUIShell, "vsUIShell");
   Validate.IsNotNull(themeResourceKey, "themeResourceKey");

   byte[] colorComponents = GetThemedColorComponents(vsUIShell, themeResourceKey);

    return System.Windows.Media.Color.FromArgb(colorComponents[3], colorComponents[0], colorComponents[1], colorComponents[2]);
}
```

Класс также можно использовать для получения идентификаторов ВСКОЛОР для заданного ключа ресурса цвета WPF или наоборот.

```csharp
public static string GetColorBaseKey(int vsSysColor);
public static bool TryGetColorIDFromBaseKey(string baseKey, out int vsSysColor);
```

Методы `VsColors` класса запрашивают службу всколор для возвращения значения цвета при каждом вызове. Для получения значения цвета в качестве `System.Drawing.Color` альтернативы лучшей производительностью вместо этого используйте методы `Microsoft.VisualStudio.PlatformUI.VSThemeColor` класса, которые кэшируют значения цветов, полученные из службы всколор. Класс подписывается внутренним образом оболочке для передачи широковещательных сообщений и удаляет кэшированное значение при возникновении события изменения темы. Кроме того, класс предоставляет. NET-понятное событие для подписки на изменения темы. Используйте `ThemeChanged` событие, чтобы добавить новый обработчик, и используйте `GetThemedColor()` метод для получения цветовых значений `ThemeResourceKeys` . Пример кода может выглядеть следующим образом:

```csharp
public MyWindowPanel()
{
    InitializeComponent();

    // Subscribe to theme changes events so we can refresh the colors
    VSColorTheme.ThemeChanged += VSColorTheme_ThemeChanged;

    RefreshColors();
}

private void VSColorTheme_ThemeChanged(ThemeChangedEventArgs e)
{
    RefreshColors();

    // Also post a message to all the children so they can apply the current theme appropriately
    foreach (System.Windows.Forms.Control child in this.Controls)
    {
        NativeMethods.SendMessage(child.Handle, e.Message, IntPtr.Zero, IntPtr.Zero);
    }
}

private void RefreshColors()
{
    this.BackColor = VSColorTheme.GetThemedColor(EnvironmentColors.ToolWindowBackgroundColorKey);
    this.ForeColor = VSColorTheme.GetThemedColor(EnvironmentColors.ToolWindowTextColorKey);
}

protected override void Dispose(bool disposing)
{
    if (disposing)
    {
        VSColorTheme.ThemeChanged -= this.VSColorTheme_ThemeChanged;
        base.Dispose(disposing);}
}
```

## <a name="choosing-high-contrast-colors"></a><a name="BKMK_ChoosingHighContrastColors"></a> Выбор цветов высокая контрастность

### <a name="overview"></a>Обзор

Windows использует несколько высококонтрастных тем на уровне системы, повышающих цветовую контрастность текста, фона и изображений, что делает элементы более разными на экране. По соображениям доступности важно, чтобы элементы интерфейса Visual Studio правильно отвечали, когда пользователь переключается на тему высокая контрастность.

Для высокая контрастность тем можно использовать только несколько системных цветов. При выборе имен системных цветов помните следующие советы.

- **Выберите Системные цвета, которые имеют то же семантическое значение** , что и элемент, для которого выполняется выделение цветом. Например, при выборе цвета с высокой контрастностью для текста в окне используйте WindowText и not Контролтекст.

- **Выберите сочетание переднего плана и фона** , или вы не будете уверены, что выбранный цвет будет работать во всех высокая контрастность темах.

- **Определите, какие части пользовательского интерфейса наиболее важны, и убедитесь, что области содержимого будут выделены.** Вы теряете много деталей, что небольшие различия в цветном оттенке обычно различны, поэтому использование строгих цветов границы является общим для определения областей содержимого, так как для разных областей содержимого нет вариантов цвета.

### <a name="system-color-set"></a>Системный набор цветов

Таблица в [блоге группы разработчиков WPF: ссылка на SystemColors](/archive/blogs/wpf/systemcolors-reference) указывает полный набор имен системных цветов и соответствующие тона, отображаемые в каждой теме.

При применении ограниченного набора цветов в пользовательском интерфейсе *предполагается, что будут потеряны небольшие сведения, которые присутствовали в «обычных» темах*. Ниже приведен пример пользовательского интерфейса с нетонкие серыми цветами, которые используются для различения областей в окне инструментов. В случае связывания с тем же окном, отображаемым в высокая контрастность режиме, можно увидеть, что все фоны имеют один и тот же тон, а границы этих областей обозначаются только рамками.

![Пример того, как тонкие сведения теряются в высокая контрастность](../../extensibility/ux-guidelines/media/030303-a_propertieswindow.png "030303 — a_PropertiesWindow")<br />Пример того, как тонкие сведения теряются в высокая контрастность

#### <a name="choosing-text-colors-in-an-editor"></a>Выбор цветов текста в редакторе

Выделенный цветом текст используется в редакторе или в области конструктора для указания значения, например для упрощения идентификации групп сходных элементов. Однако в высокая контрастностьной теме нет возможности отличить более чем от трех цветов текста. WindowText, Грайтекст и Хоттракктекст — это единственные цвета, доступные на поверхности Виндовбаккграунд. Так как вы не можете использовать более трех цветов, тщательно выбирайте наиболее важные отличия, которые должны отображаться в режиме высокая контрастность.

Тона для каждого из имен токенов, разрешенных в области редактора, так как они отображаются в каждой теме высокая контрастность:

![Сравнение редактора высокой контрастности](../../extensibility/ux-guidelines/media/030303-b_hceditorcomparison.png "030303 — b_HCEditorComparison")<br />Сравнение редактора высокой контрастности

Примеры области редактора в синей теме:

![Редактор в "Голубой" теме](../../extensibility/ux-guidelines/media/030303-c_editorblue.png "030303 — c_EditorBlue")<br />Редактор в "Голубой" теме

![Редактор в высокая контрастность тема #1](../../extensibility/ux-guidelines/media/030303-d_editorhc1.png "030303 — d_EditorHC1")<br />Редактор в высокая контрастность тема #1

### <a name="usage-patterns"></a>Варианты использования

Многие стандартные элементы пользовательского интерфейса уже имеют определенные цвета высокая контрастность. Вы можете ссылаться на эти шаблоны использования при выборе собственных имен системных цветов, чтобы элементы пользовательского интерфейса соответствовали аналогичным компонентам.

| Системный цвет | Использование |
| --- | --- |
| ActiveCaption | — Активные и заменяющиеся глифы кнопки окна IDE и нависания<br />— Фон строки заголовка для окон IDE и нависания.<br />— Фон строки состояния по умолчанию |
| ActiveCaptionText | — Активная интегрированная среда разработки и окна с нависаниям для переднего плана заголовка (текст и глифы)<br />— Фон и граница активных кнопок окна при наведении указателя мыши и нажатии |
| Control | — Поле со списком, раскрывающийся список и элемент управления Поиск по умолчанию и отключенный фон, включая раскрывающуюся кнопку<br />-Фон кнопки закрепления<br />— Фон панели команд<br />— Фон окна инструментов |
| ControlDark | — Фон IDE<br />-Разделители в меню и на панели команд<br />— Граница панели команд<br />-Тени меню<br />— Вкладка окна инструментов по умолчанию и граница и разделитель для наведения<br />-Фон кнопки переполнения документа<br />— Граница целевого глифа закрепления |
| ControlDarkDark |— Без фокуса, выбранное окно вкладки документа |
| ControlLight |— Автоматически скрывать границу вкладки<br />— Поле со списком и граница раскрывающегося списка<br />-Закрепление целевого фона и границы |
| контроллигхтлигхт | — Выбрано, ориентирована подготовленная граница |
| контролтекст | — Поле со списком и глиф раскрывающегося списка<br />— Окно инструментов. невыделенный текст вкладки |
| грайтекст |-Поле со списком и раскрывающийся список отключена граница, раскрывающийся элемент глифа, текст и пункт меню<br />-Отключенный текст меню<br />-Элемент управления поиском текст заголовка "Параметры поиска"<br />-Разделитель раздела элемента управления поиска |
| Выделить | — Все фоновые рисунки и границы, которые нажимаются при наведении указателя, за исключением границы кнопки раскрывающегося списка и области переполнения документа<br />— Фон выбранного элемента |
| хигхлигхттекст | — Все нажимаемые и нажатые передние кнопки (текст и глифы)<br />— Окно инструментов и окно вкладки документа, управляющие передним планом<br />— Граница заголовков окна инструментов<br />-Ориентированный, выбранный передний план вкладки подготовки<br />— Граница кнопки области переполнения документа при наведении указателя мыши и нажатии<br />-Выбранная граница значка|
| хоттракк | — Ползунок полосы прокрутки и граница при нажатии<br />— Значок стрелки полосы прокрутки при нажатии клавиши |
| инактивекаптион | — Неактивная интегрированная среда разработки и глифы кнопок окон с плавающей наведением<br />— Фон строки заголовка для окон IDE и нависания.<br />-Отключенный фон элемента управления поиском |
| инактивекаптионтекст | — Неактивная панель заголовка IDE и нависанияd Windows (текст и глифы)<br />— Неактивные кнопки окна фон и граница при наведении указателя<br />— Фоновый рисунок и граница для кнопки окна инструментов без фокуса<br />— Отключенный передний план элемента управления поиском |
| Меню | — Фон раскрывающегося меню<br />-Установлен и отключен флажок фон галочки |
| менутекст | — Граница раскрывающегося меню<br />-Check Marks<br />-Глифы меню<br />— Текст раскрывающегося меню<br />-Выбранная граница значка |
| Полоса прокрутки | -Фон стрелки полосы прокрутки и полосы прокрутки, все состояния |
| Окно | -Автоматически скрывать фон вкладки<br />-Фон строки меню и полки команды<br />— Нефокусная или невыбранная вкладка окна документа и граница документа для открытых и подготовленных вкладок.<br />— Фон панели заголовка окна средства без фокуса<br />— Фон вкладки окна инструментов: выбрано и не выбрано |
| WindowFrame | — Граница IDE |
| WindowText | -Автоматически скрывать передний план вкладки<br />— Выбранный передний план вкладки окна инструментов<br />— Нефокусная вкладка окна документа без фокуса или основной цвет вкладки<br />— Представление дерева по умолчанию — передний план и наведение указателя мыши на невыделенный глиф<br />— Выбранная граница вкладки окна инструментов<br />-Ползунок полосы прокрутки фона, границы и глиф |

## <a name="exposing-colors-for-end-users"></a><a name="BKMK_ExposingColorsForEndUsers"></a> Предоставление цветов для конечных пользователей

### <a name="overview"></a>Обзор

Иногда требуется разрешить конечному пользователю настраивать пользовательский интерфейс, например при создании редактора кода или области конструктора. Самый распространенный способ сделать это — воспользоваться диалоговым окном **Сервис &gt; Параметры** . Если у вас нет строго специализированного пользовательского интерфейса, требующего специальных элементов управления, самый простой способ представления настроек — на странице **шрифты и цвета** в разделе **Среда** диалогового окна. Для каждого элемента, предоставляемого для настройки, пользователь может выбрать изменение цвета переднего плана, цвета фона или и того и другого.

### <a name="building-a-vspackage-for-your-customizable-colors"></a>Создание пакета VSPackage для настраиваемых цветов

Пакет VSPackage может управлять шрифтами и цветами с помощью пользовательских категорий и отображать элементы на странице свойств шрифты и цвета. При использовании этого механизма пакеты VSPackage должны реализовывать интерфейс [ивсфонтандколордефаултспровидер](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaultsprovider) и связанные с ним интерфейсы.

В принципе этот механизм можно использовать для изменения всех существующих отображаемых элементов и категорий, содержащих их. Однако его не следует использовать для изменения категории текстового редактора или ее отображаемых элементов. Дополнительные сведения о категории текстовый редактор см. в разделе [Общие сведения о шрифтах и цветах](/previous-versions/visualstudio/visual-studio-2015/extensibility/font-and-color-overview?preserve-view=true&view=vs-2015).

Для реализации пользовательских категорий или отображаемых элементов пакет VSPackage должен:

- **Создание или указание категорий в реестре.** Реализация страницы свойств **шрифтов и цветов** в интегрированной среде разработки использует эти сведения для правильного запроса службы, поддерживающей данную категорию.

- **Создание или указание групп в реестре (необязательно).** Может быть полезно определить группу, которая представляет объединение двух или более категорий. Если группа определена, интегрированная среда разработки автоматически выполняет слияние подкатегорий и распространяет отображаемые элементы в группе.

- **Реализуйте поддержку интегрированной среды разработки.**

- **Обрабатывайте изменения шрифта и цвета.**

#### <a name="to-create-or-identify-categories"></a>Создание или указание категорий

Создайте запись реестра особого типа в разделе `[HKLM\SOFTWARE\Microsoft \Visual Studio\\<Visual Studio version\>\FontAndColors\\<Category\>]` где `<Category>` — нелокализованное имя категории.

Заполните реестр двумя значениями:

| Имя | Тип | Данные | Описание |
| --- | --- | --- | --- |
| Категория | REG_SZ | Идентификатор GUID | Идентификатор GUID, созданный для задания категории |
| Пакет | REG_SZ | Идентификатор GUID | Идентификатор GUID службы VSPackage, которая поддерживает категорию |

 Служба, указанная в реестре, должна предоставлять реализацию [ивсфонтандколордефаултс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaults) для соответствующей категории.

#### <a name="to-create-or-identify-groups"></a>Создание или указание групп

Создайте запись реестра особого типа в разделе `[HKLM\SOFTWARE\Microsoft \Visual Studio\\<Visual Studio version\>\FontAndColors\\<group\>]` где `<group>` — нелокализованное имя группы.

Заполните реестр двумя значениями:

| Имя | Тип | Данные | Описание |
|--- | --- | --- | --- |
| Категория | REG_SZ | Идентификатор GUID | Идентификатор GUID, созданный для задания категории |
| Пакет | REG_SZ | Идентификатор GUID | Идентификатор GUID службы VSPackage, которая поддерживает категорию |

Служба, указанная в реестре, должна обеспечивать реализацию <xref:Microsoft.VisualStudio.Shell.Interop.IVsFontAndColorGroup> для соответствующей группы.

![Реализация Ивсфонтандколорграуп](../../extensibility/ux-guidelines/media/0304-a_fontandcolorgroup.png "0304 — a_FontAndColorGroup")<br />Реализация интерфейса `IVsFontAndColorGroup`

### <a name="to-implement-ide-support"></a>Реализация поддержки интегрированной среды разработки

Реализуйте [GetObject](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaultsprovider.getobject), который возвращает интерфейс [ивсфонтандколордефаултс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaults) или <xref:Microsoft.VisualStudio.Shell.Interop.IVsFontAndColorGroup> интерфейс в интегрированную среду разработки для каждой указанной категории или GUID группы.

Для каждой поддерживаемой категории поддерживается пакет VSPackage, реализующий отдельный экземпляр интерфейса [ивсфонтандколордефаултс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaults) .

Методы, реализованные через [ивсфонтандколордефаултс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaults) , должны предоставлять интегрированную среду разработки:

- Списки отображаемых элементов в категории

- Локализуемые имена для отображаемых элементов

- Отображение сведений для каждого элемента категории

> [!NOTE]
> Каждая категория должна содержать по крайней мере один отображаемый элемент.

Интегрированная среда разработки использует <xref:Microsoft.VisualStudio.Shell.Interop.IVsFontAndColorGroup> интерфейс для определения объединения нескольких категорий.

Его реализация предоставляет интегрированную среду разработки:

- Список категорий, составляющих данную группу.

- Доступ к экземплярам [ивсфонтандколордефаултс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolordefaults) , поддерживающим каждую категорию в группе

- Локализуемые имена групп

#### <a name="updating-the-ide"></a>Обновление интегрированной среды разработки

В интегрированной среде разработки кэшируются сведения о параметрах шрифтов и цветов. Таким образом, после любого изменения конфигурации шрифта и цвета среды IDE рекомендуется обеспечить актуальность кэша.

Обновление кэша осуществляется через интерфейс [ивсфонтандколоркачеманажер](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorcachemanager) и может выполняться глобально или только для выбранных элементов.

### <a name="handling-font-and-color-changes"></a>Обработка изменений шрифта и цвета

Для правильной поддержки цветовой раскраски текста, отображаемого VSPackage, служба цветов, поддерживающая VSPackage, должна реагировать на изменения, инициированные пользователем, на странице свойств шрифты и цвета.

Для этого VSPackage должен:

- **обрабатывайте события, созданные интегрированной средой разработки** , путем реализации интерфейса [ивсфонтандколоревентс](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorevents) . Интегрированная среда разработки вызывает соответствующий метод после изменения пользователем страницы шрифты и цвета. Например, если выбран новый шрифт, вызывается метод [онфонтчанжед](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorevents.onfontchanged) .

  **OR**

- **опросить изменения в интегрированной среде разработки**. Это можно сделать с помощью реализованного в системе интерфейса [сбой ivsfontandcolorstorage](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorstorage) . Несмотря на то, что в основном для поддержки сохраняемости, метод [DataItem](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorstorage.getitem) может получать сведения о шрифтах и цветах для отображаемых элементов. Дополнительные сведения о параметрах шрифтов и цветов см. в статье MSDN [доступ к сохраненным параметрам шрифта и цвета](/previous-versions/visualstudio/visual-studio-2015/extensibility/accessing-stored-font-and-color-settings?preserve-view=true&view=vs-2015).

> [!NOTE]
> Чтобы проверить правильность результатов опроса, используйте интерфейс [ивсфонтандколоркачеманажер](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorcachemanager) , чтобы определить, требуются ли операции очистки и обновления кэша до вызова методов получения интерфейса [сбой ivsfontandcolorstorage](/dotnet/api/microsoft.visualstudio.shell.interop.ivsfontandcolorstorage) .

#### <a name="registering-custom-font-and-color-category-without-implementing-interfaces"></a>Регистрация пользовательского шрифта и категории цветов без реализации интерфейсов

В следующем примере кода показано, как зарегистрировать настраиваемую категорию шрифта и цвета без реализации интерфейсов.

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0Exp\FontAndColors\CSharp Tool Window]
"Package"="{F5E7E71D-1401-11D1-883B-0000F87579D2}"
"Category"="{9FF46859-A47E-47bf-8AC5-EC3DBE69D1FE}"
"ToolWindowPackage"="{7259e420-6241-4e0d-b535-5b820671d183}"

    "NameID"=dword:00000064
```

Для этого примера кода:

- `"NameID"` = Идентификатор ресурса локализованного имени категории в пакете
- `"ToolWindowPackage"` = Идентификатор GUID пакета
- `"Category"="{9FF46859-A47E-47bf-8AC5-EC3DBE69D1FE}"` — Это лишь пример, а фактическое значение может быть новым идентификатором GUID, предоставленным разработчиком.

### <a name="set-the-font-and-color-property-category-guid"></a>Задание GUID категории свойств Font и Color

В приведенном ниже примере кода показано задание идентификаторов GUID категории.

```csharp
// m_pView is your IVsTextView
IVsTextEditorPropertyCategoryContainer spPropCatContainer =
(IVsTextEditorPropertyCategoryContainer)m_pView;
if (spPropCatContainer != null)
{
IVsTextEditorPropertyContainer spPropContainer;
Guid GUID_EditPropCategory_View_MasterSettings =
new Guid("{D1756E7C-B7FD-49a8-B48E-87B14A55655A}");
hr = spPropCatContainer.GetPropertyCategory(
ref GUID_EditPropCategory_View_MasterSettings,
out spPropContainer);
if(hr == 0)
{
hr =
spPropContainer.SetProperty(
VSEDITPROPID.VSEDITPROPID_ViewGeneral_FontCategory,
catGUID);
hr =
spPropContainer.SetProperty(
VSEDITPROPID.VSEDITPROPID_ViewGeneral_ColorCategory,
catGUID);
}
}
```
