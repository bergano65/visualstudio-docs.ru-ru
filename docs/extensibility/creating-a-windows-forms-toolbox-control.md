---
title: Создание Windows Forms элемента управления панели элементов | Документация Майкрософт
description: В этом пошаговом руководстве показано, как использовать шаблон элемента управления панели элементов Windows Forms для создания простого элемента управления счетчика с помощью пакета SDK для Visual Studio.
ms.date: 3/16/2019
ms.topic: how-to
helpviewer_keywords:
- winforms
- toolbox
- windows forms
ms.assetid: 0be6ffc1-8afd-4d02-9a5d-e27dde05fde6
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 4bb9505ab475da7919a39eb03e7c84b92857db4e
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99902195"
---
# <a name="create-a-windows-forms-toolbox-control"></a>Создание Windows Forms элемента управления панели элементов

Шаблон элемента элемента управления панели элементов Windows Forms, включенный в средства расширения Visual Studio (пакет VS SDK), позволяет создать элемент управления **панели элементов** , который автоматически добавляется при установке расширения. В этом пошаговом руководстве показано, как использовать шаблон для создания простого элемента управления счетчика, который можно распространить другим пользователям.

## <a name="prerequisites"></a>Предварительные требования

Начиная с Visual Studio 2015, пакет SDK для Visual Studio не устанавливается из центра загрузки. Он входит в состав программы установки Visual Studio как дополнительный компонент. Пакет SDK для VS можно установить и позже. Дополнительные сведения см. [в статье Установка пакета SDK для Visual Studio](../extensibility/installing-the-visual-studio-sdk.md).

## <a name="create-the-toolbox-control"></a>Создание элемента управления панели элементов

Шаблон элемента управления панели элементов Windows Forms создает неопределенный пользовательский элемент управления и предоставляет все функциональные возможности, необходимые для добавления элемента управления на **панель элементов**.

### <a name="create-an-extension-with-a-windows-forms-toolbox-control"></a>Создание расширения с помощью Windows Forms элемента управления панели элементов

1. Создайте проект VSIX с именем `MyWinFormsControl` . Шаблон проекта VSIX можно найти в диалоговом окне " **Новый проект** ", выполнив поиск по слову "VSIX".

2. После открытия проекта добавьте Windows Forms шаблон элемента **элемента управления панели элементов** с именем `Counter` . В **Обозреватель решений** щелкните правой кнопкой мыши узел проекта и выберите команду **Добавить**  >  **новый элемент**. В диалоговом окне **Добавление нового элемента** перейдите в раздел расширяемость **Visual C#**  >   и выберите **Windows Forms элемент управления панели элементов** .

3. При этом добавляется пользовательский элемент управления, `ProvideToolboxControlAttribute` <xref:Microsoft.VisualStudio.Shell.RegistrationAttribute> для размещения элемента управления в **панели элементов**, а также запись ресурса **Microsoft. VisualStudio. тулбоксконтрол** в манифесте VSIX для развертывания.

### <a name="build-a-user-interface-for-the-control"></a>Создание пользовательского интерфейса для элемента управления

`Counter`Элементу управления требуются два дочерних элемента управления: <xref:System.Windows.Forms.Label> для вывода текущего счетчика и <xref:System.Windows.Forms.Button> для сброса счетчика в значение 0. Другие дочерние элементы управления не требуются, так как вызывающие объекты увеличивают счетчик программным образом.

#### <a name="to-build-the-user-interface"></a>Создание пользовательского интерфейса

1. В **Обозреватель решений** дважды щелкните *Counter.CS* , чтобы открыть его в конструкторе.

2. Удалите **щелчком мыши.** , которая включается по умолчанию при добавлении шаблона элемента элемента управления панели элементов Windows Forms.

3. Перетащите элемент управления с **панели элементов**, `Label` а затем `Button` элемент управления под ним в область конструктора.

4. Измените размер элемента управления "общий" на 150, 50 пикселей и измените размер элемента управления "Кнопка" на 50, 20 пикселей.

5. В окне **Свойства** задайте следующие значения для элементов управления в области конструктора.

    |Control|Property (Свойство)|Значение|
    |-------------|--------------|-----------|
    |`Label1`|**Text**|""|
    |`Button1`|**Имя**|бтнресет|
    |`Button1`|**Text**|Reset|

### <a name="code-the-user-control"></a>Код пользовательского элемента управления

`Counter`Элемент управления предоставит метод для увеличения счетчика, событие, которое будет выдаваться при каждом увеличении счетчика, кнопку **сброса** и три свойства для хранения текущего числа, отображаемого текста, а также для отображения или скрытия кнопки **сброса** . Атрибут `ProvideToolboxControl` определяет место на **панели элементов** , в котором будет отображаться элемент управления `Counter` .

#### <a name="to-code-the-user-control"></a>Код пользовательского элемента управления

1. Дважды щелкните форму, чтобы открыть обработчик событий Load в окне кода.

2. Над методом обработчика событий в классе Control создайте целое число, чтобы сохранить значение счетчика, и строку для хранения отображаемого текста, как показано в следующем примере.

    ```csharp
    int currentValue;
    string displayText;
    ```

3. Создайте следующие открытые объявления свойств.

    ```csharp
    public int Value {
        get { return currentValue; }
    }

    public string Message {
        get { return displayText; }
        set { displayText = value; }
    }

    public bool ShowReset {
        get { return btnReset.Visible; }
        set { btnReset.Visible = value; }
    }

    ```

    Вызывающие объекты могут получить доступ к этим свойствам для получения и задания отображаемого текста счетчика, а также для отображения или скрытия кнопки **Сброс** . Вызывающие объекты могут получить текущее значение свойства только для чтения `Value` , но не могут задавать значение напрямую.

4. Добавьте следующий код в `Load` событие для элемента управления.

    ```csharp
    private void Counter_Load(object sender, EventArgs e)
    {
        currentValue = 0;
        label1.Text = Message + Value;
    }

    ```

    Задание текста **метки** в <xref:System.Windows.Forms.UserControl.Load> событии позволяет загружать целевые свойства до применения их значений. Установка текста **метки** в конструкторе приведет к пустой **метке**.

5. Создайте следующий открытый метод для увеличения счетчика.

    ```csharp
    public void Increment()
    {
        currentValue++;
        label1.Text = displayText + Value;
        Incremented(this, EventArgs.Empty);
    }

    ```

6. Добавьте объявление `Incremented` события в класс Control.

    ```csharp
    public event EventHandler Incremented;
    ```

    Вызывающие объекты могут добавлять обработчики в это событие для реагирования на изменения значения счетчика.

7. Вернитесь в режим конструктора и дважды щелкните кнопку **Сброс** , чтобы создать `btnReset_Click` обработчик событий. Затем заполните его, как показано в следующем примере.

    ```csharp
    private void btnReset_Click(object sender, EventArgs e)
    {
        currentValue = 0;
        label1.Text = displayText + Value;
    }

    ```

8. Непосредственно над определением класса в объявлении атрибута `ProvideToolboxControl` измените значение первого параметра с `"MyWinFormsControl.Counter"` на `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.

    В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.

    ```csharp
    [ProvideToolboxControl("General", false)]
    public partial class Counter : UserControl
    ```

### <a name="test-the-control"></a>Тестирование элемента управления

 Чтобы протестировать элемент управления **панели элементов** , сначала протестируйте его в среде разработки, а затем протестируйте в скомпилированном приложении.

#### <a name="to-test-the-control"></a>Тестирование элемента управления

1. Нажмите клавишу **F5** , чтобы **начать отладку**.

    Эта команда выполняет сборку проекта и открывает второй экспериментальный экземпляр Visual Studio с установленным элементом управления.

2. В экспериментальном экземпляре Visual Studio создайте проект **приложения Windows Forms** .

3. В **Обозреватель решений** дважды щелкните *Form1.CS* , чтобы открыть его в конструкторе, если он еще не открыт.

4. На **панели элементов** `Counter` элемент управления должен отображаться в разделе **Общие** .

5. Перетащите `Counter` элемент управления в форму, а затем выберите его. `Value`Свойства, `Message` и `ShowReset` будут отображаться в окне **Свойства** вместе со свойствами, унаследованными от <xref:System.Windows.Forms.UserControl> .

6. Задайте для свойства `Message` значение `Count:`.

7. Перетащите <xref:System.Windows.Forms.Button> элемент управления в форму, а затем задайте для свойства Name и Text кнопки значение `Test` .

8. Дважды щелкните кнопку, чтобы открыть *Form1.CS* в представлении кода и создать обработчик щелчка.

9. В обработчике щелчка вызовите `counter1.Increment()` .

10. В функции конструктора после вызова `InitializeComponent` Введите, `counter1``.``Incremented +=` а затем дважды нажмите клавишу **Tab** .

    Visual Studio создает обработчик на уровне формы для `counter1.Incremented` события.

11. Выделите `Throw` оператор в обработчике событий, введите `mbox` , а затем дважды нажмите клавишу **Tab** , чтобы создать окно сообщения из фрагмента кода Mbox.

12. На следующей строке добавьте следующий `if` / `else` блок, чтобы задать видимость кнопки **сброса** .

    ```csharp
    if (counter1.Value < 5) counter1.ShowReset = false;
    else counter1.ShowReset = true;
    ```

13. Нажмите клавишу **F5**.

    Откроется форма. `Counter`Элемент управления отображает следующий текст.

    **Число: 0**

14. Выберите **Тест**.

    Счетчик увеличивается, и Visual Studio отображает окно сообщения.

15. Закройте окно сообщения.

    Кнопка **сброса** исчезнет.

16. Выберите **тест** , пока счетчик не достигнет **5** -закрывающих окон сообщений каждый раз.

    Появится кнопка **Сброс** .

17. Выберите **Сброс**.

    Счетчик сбрасывается в значение **0**.

## <a name="next-steps"></a>Дальнейшие действия

При создании элемента управления **панели элементов** Visual Studio создает файл с именем *ProjectName. VSIX* в папке \bin\debug\ проекта. Элемент управления можно развернуть, загружая *VSIX* -файл в сеть или на сайт. Когда пользователь открывает *VSIX* -файл, этот элемент управления устанавливается и добавляется на **панель элементов** Visual Studio на компьютере пользователя. Кроме того, можно передать *VSIX* файл в [Visual Studio Marketplace](https://marketplace.visualstudio.com/) , чтобы пользователи могли его найти, просмотрев в   >  диалоговом окне "**расширения и обновления** " инструментов.

## <a name="see-also"></a>См. также раздел

- [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)
- [Создание элемента управления панели элементов WPF](../extensibility/creating-a-wpf-toolbox-control.md)
- [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)
- [Основы разработки Windows Forms элементов управления](/dotnet/framework/winforms/controls/windows-forms-control-development-basics)
