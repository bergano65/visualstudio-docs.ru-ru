---
title: Отладка приложения Node.js
description: Visual Studio поддерживает отладку приложений Node.js в Visual Studio.
ms.custom: ''
ms.date: 12/03/2018
ms.technology: vs-nodejs
ms.topic: conceptual
ms.devlang: javascript
author: mikejo5000
ms.author: mikejo
manager: douge
dev_langs:
- JavaScript
ms.workload:
- nodejs
ms.openlocfilehash: 57054d8ba804a653b11b05fc229fa162d677bcae
ms.sourcegitcommit: f6dd17b0864419083d0a1bf54910023045526437
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/27/2018
ms.locfileid: "53803788"
---
# <a name="debug-a-nodejs-app-in-visual-studio"></a>Отладка приложения Node.js в Visual Studio

Visual Studio позволяет выполнять отладку кода JavaScript и TypeScript. Вы можете задавать и использовать точки останова, подключать отладчик, проверять значения переменных, просматривать стек вызовов и применять другие функции отладки.

## <a name="debug-server-side-script"></a>Отладка серверного скрипта

1. Открыв проект в Visual Studio, откройте файл JavaScript с серверным скриптом (например, *server.js*) и щелкните в области слева, чтобы задать точку останова:

    ![Задание точки останова](../javascript/media/tutorial-nodejs-react-set-breakpoint.png)

    Точки останова — это один из самых простых и важных компонентов надежной отладки. Точка останова указывает, где Visual Studio следует приостановить выполнение кода, чтобы вы могли проверить значения переменных или поведение памяти либо выполнение ветви кода.

1. Чтобы запустить приложение, нажмите клавишу **F5** (или выберите пункт меню **Отладка** > **Начать отладку**).

    Выполнение отладчика прервется в установленной точке останова (текущий оператор выделяется желтым цветом). Теперь вы можете изучить состояние приложения, наводя указатель мыши на переменные в текущей области и используя окна отладчика, такие как **Локальные** и **Контрольные значения**.

1. Чтобы продолжить выполнение приложения, нажмите клавишу **F5**.

1. Если вы хотите использовать Средства Chrome для разработчиков (средства F12), нажмите клавишу **F12**. С их помощью можно изучить модель DOM и взаимодействовать с приложением с помощью консоли JavaScript.

## <a name="debug-client-side-script"></a>Отладка клиентского скрипта

Visual Studio поддерживает отладку только для браузеров Chrome и Internet Explorer. В некоторых сценариях отладчик автоматически останавливается на точках останова в коде JavaScript и TypeScript, в том числе во внедренных в HTML-файлы скриптах.

Если для кода применена минификация или он создан в транспайлере, например в TypeScript или Babel, для оптимизации возможностей отладки следует применить [сопоставления источника](#generate_sourcemaps). Подключить отладчик к запущенному клиентскому скрипту вы сможете даже без сопоставлений источника. Но в этом случае вы сможете задавать и использовать точки останова только в файле с минифицированным или созданным в транспайлере кодом, но не в исходном файле кода. Например, в приложении Vue.js минифицированный скрипт передается в формате строки в инструкцию `eval`, и другого способа пошагового выполнения этого кода в отладчике Visual Studio, кроме сопоставлений источника, нет. В некоторых сложных сценариях отладки вы можете использовать также средства Chrome для разработчика или средства F12 для Microsoft Edge.

Чтобы подключить отладчик из Visual Studio и использовать точки останова в коде на стороне клиента, необходимо правильно настроить процесс в отладчике. Ниже описывается один из способов для браузера Chrome.

### <a name="attach-the-debugger-to-client-side-script-using-chrome"></a>Подключение отладчика к клиентскому скрипту с помощью Chrome

1. Закройте все окна Chrome.

    Это действие следует выполнить перед запуском Chrome в режиме отладки.

2. Щелкните правой кнопкой мыши кнопку **Пуск** Windows, выберите команду **Выполнить** и введите следующую команду:

    `chrome.exe --remote-debugging-port=9222`

    Эта команда запускает Chrome в режиме отладки.

3. Переключитесь в Visual Studio и установите точку останова в исходном коде. (Выберите для точки останова такую строку кода, в которой допустимы точки останова, например в инструкции `return` или объявлении `var`).

    ![Задание точки останова](../javascript/media/tutorial-nodejs-react-set-breakpoint-client-code.png)

    Если вам потребуется найти определенную строку кода в большом файле автоматически созданного года, используйте клавиши **CTRL**+**F** или пункты меню **Изменить** > **Поиск и замена**  >  **Быстрый поиск**).

4. Выбрав Chrome в качестве целевого объекта отладки в Visual Studio, нажмите клавиши **CTRL**+**F5** (**Отладка** > **Запуск без отладки**), чтобы запустить приложение в браузере.

    Приложение откроется в новой вкладке браузера.

    Если Chrome установлен на вашем компьютере, но отсутствует в списке, выберите **Просмотреть с помощью** в раскрывающемся списке целевых объектов отладки, а затем установите Chrome в качестве целевого объекта отладки по умолчанию (выберите **По умолчанию**).

5. Выберите **Отладка** > **Присоединение к процессу**.

6. В диалоговом окне **Присоединение к процессу** выберите в поле **Присоединить к** элемент **Код Webkit** и введите **chrome** в поле фильтра, чтобы отфильтровать результаты поиска.

    **Код WebKit** — это обязательное значение для браузера Chrome, который основан на пакете Webkit.

7. Выберите процесс Chrome с правильным портом узла (1337 в нашем примере) и щелкните **Присоединить**.

    ![Присоединение к процессу](../javascript/media/tutorial-nodejs-react-attach-to-process.png)

    Определить, что отладчик присоединился правильно, можно по открытию проводника DOM и консоли JavaScript в Visual Studio. Эти средства отладки аналогичны инструментам Chrome для разработчиков и средствам F12 для Microsoft Edge.

    > [!NOTE]
    > Если отладчик не присоединяется и появляется сообщение "Не удалось присоединиться к процессу. Операция недопустима в текущем состоянии" — попробуйте закрыть все экземпляры Chrome в диспетчере задач перед попыткой запуска Chrome в режиме отладки. Возможно, выполняются расширения Chrome и препятствуют переходу в режим полной отладки.

8. Если код с точкой останова уже был выполнен, обновите страницу браузера, чтобы попасть на точку останова.

    Когда отладчик приостановит выполнение, вы можете изучить состояние приложения, наводя указатель мыши на переменные и используя окна отладчика. Вы также можете выполнять пошаговую отладку кода (клавиши **F5**, **F10** и **F11**).

    Для минифицированного или созданного в транспайлере кода JavaScript вы сможете использовать точки останова в автоматически созданном коде JavaScript или в сопоставленном с ним файле TypeScript (если используются сопоставления источника) в зависимости от среды и состояния браузера. В любом случае вы можете выполнять пошаговую отладку кода и просматривать переменные.

    * Если вам нужно приостановить выполнение кода в файле TypeScript, но это сделать не удается, используйте **присоединение к процессу**, чтобы подключить отладчик, как описано в предыдущих этапах. Затем откройте динамически созданный файл TypeScript в обозревателе решений. Для этого откройте **Документы скриптов** > **filename.tsx**, установите точку останова и обновите страницу в браузере (установите точку останова в строке кода, допускающей точки останова, например в операторе `return` или объявлении `var`).

        Кроме того, для прерывания выполнения кода в файле TypeScript, когда напрямую это сделать не удается, попробуйте использовать оператор `debugger;` в файле TypeScript или установите точки останова в средствах Chrome для разработчиков.

    * Если вам нужно приостановить выполнение кода в файле JavaScript, созданном в транспайлере (например, *app-bundle.js*), но сделать это не удается, удалите файл сопоставления источника *filename.js.map*.

     > [!TIP]
     > После того как вы впервые присоединитесь к процессу с помощью этих инструкций, в дальнейшем можно присоединяться к нему в Visual Studio 2017 с помощью команды **Отладка** > **Повторно подключиться к процессу**.

## <a name="generate_sourcemaps"></a> Создание сопоставлений источника для отладки

В Visual Studio можно использовать и создавать сопоставления источника для исходных файлов JavaScript. Такая возможность часто нужна, когда исходный код минифицирован или создан в транспайлере, например в TypeScript или Babel. Доступные варианты зависят от типа проекта.

* Проект TypeScript в Visual Studio по умолчанию автоматически создает сопоставления источника.

* В проекте JavaScript вам потребуется создать сопоставления источника с помощью средства упаковки (например, webpack) и компилятора (например, TypeScript или Babel), которые вы можете добавить в проект. Вместе с компилятором TypeScript необходимо добавить еще и файл *tsconfig.json*. Пример такой операции на основе базовой конфигурации webpack вы найдете в руководстве по [созданию приложения Node.js с использованием React](../javascript/tutorial-nodejs-with-react-and-jsx.md).

> [!NOTE]
> Если вы не знакомы с сопоставлениями источников, изучите [эту вводную статью](https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/), прежде чем продолжать работу.

Чтобы настроить дополнительные параметры для сопоставлений источника, используйте файл *tsconfig.json* или параметры проекта для проекта TypeScript, но не оба метода сразу.

### <a name="configure-source-maps-using-a-tsconfigjson-file"></a>Настройка сопоставлений источника с помощью файла tsconfig.json

Если вы добавите в проект файл *tsconfig.json*, Visual Studio будет считать корневой каталог проектом TypeScript. Чтобы добавить этот файл, щелкните проект правой кнопкой мыши в обозревателе решений и последовательно выберите **Добавить > Новый элемент > Web > Скрипты > Файл конфигурации TypeScript JSON**. Это действие добавит в проект файл *tsconfig.json*, аналогичный представленному ниже.

```json
{
  "compilerOptions": {
    "noImplicitAny": false,
    "noEmitOnError": true,
    "removeComments": false,
    "sourceMap": true,
    "target": "es5"
  },
  "exclude": [
    "node_modules",
    "wwwroot"
  ]
}
```

#### <a name="compiler-options-for-tsconfigjson"></a>Параметры компилятора для tsconfig.json

* **inlineSourceMap**. Создает один общий файл с сопоставлениями источников, а не отдельный файл сопоставления для каждого исходного файла.
* **inlineSources**. Помещает исходный код в тот же файл вместе с сопоставлениями источников. Для этого режима также нужно настроить *inlineSourceMap* или *sourceMap*.
* **mapRoot**. Указывает расположение, из которого отладчику следует брать файлы сопоставления источника (*.map*), вместо расположения по умолчанию. Используйте этот флаг, если во время выполнения файлы *.map* и файлы *.js* должны размещаться в разных каталогах. Указанное здесь расположение внедряется в сопоставление источника, чтобы указать для отладчика расположение файлов *.map*.
* **sourceMap**. Создает соответствующий файл *.map*.
* **sourceRoot**. Указывает расположение, из которого отладчику следует брать файлы TypeScript, вместо расположения по умолчанию. Используйте этот флаг, если в ходе время выполнения и разработки исходные файлы должны размещаться в разных каталогах. Указанное здесь расположение внедряется в сопоставление источника, чтобы указать для отладчика расположение исходных файлов.

Дополнительные сведения о параметрах компилятора вы найдете на странице с [параметрами компилятора](https://www.typescriptlang.org/docs/handbook/compiler-options.html) в справочнике по TypeScript.

### <a name="configure-source-maps-using-project-settings"></a>Настройка сопоставления источника с помощью параметров проекта

Также вы можете настроить параметры сопоставления источника в свойствах проекта, щелкнув проект правой кнопкой мыши и выбрав **Проект > Свойства > Сборка TypeScript > Отладка**.

Здесь доступны следующие параметры проекта.

* **Создать сопоставления источника** (эквивалентно **sourceMap** в *tsconfig.json*). Создает соответствующий файл *.map*.
* **Укажите корневой каталог сопоставлений источника** (эквивалентно **mapRoot** в *tsconfig.json*). Указывает расположение, из которого отладчику следует брать файлы сопоставления, вместо автоматически созданного расположения. Используйте этот флаг, если во время выполнения файлы *.map* и файлы .js должны размещаться в разных каталогах. Указанное здесь расположение внедряется в сопоставление источника, чтобы указать для отладчика расположение файлов сопоставления.
* **Укажите корневой каталог файлов TypeScript** (эквивалентно **sourceRoot** в *tsconfig.json*). Указывает расположение, из которого отладчику следует брать файлы TypeScript, вместо расположения по умолчанию. Используйте этот флаг, если в ходе выполнения и разработки исходные файлы должны размещаться в разных каталогах. Указанное здесь расположение внедряется в сопоставление источника, чтобы указать для отладчика расположение исходных файлов.

## <a name="debug-javascript-in-dynamic-files-using-razor-aspnet"></a>Отладка JavaScript в динамических файлах с помощью Razor (ASP.NET)

Visual Studio поддерживает отладку только для браузеров Chrome и Internet Explorer. Точки останова автоматически добавляются в файлы JavaScript/TypeScript и внедренные скрипты в HTML-файлах.

Для динамически создаваемых файлов не выполняется автоматическая отладка. Вы не сможете автоматически использовать точки останова в файлах, созданных с синтаксисом Razor (.cshtml, .vbhtml). Для отладки файлов такого типа вы можете применить два следующих подхода.

* **Поместите инструкцию `debugger;` в той строке, где нужно прервать выполнение**. Эта инструкция прерывает выполнение динамического скрипта и начинает отладку сразу же при его создании.
* **Загрузите страницу и откройте динамический документ в Visual Studio**. Чтобы воспользоваться этим методом, нужно открыть динамический файл в процессе отладки, задать в нем точку останова и обновить страницу. В зависимости от выбранного браузера (Chrome или Internet Explorer) вы сможете найти этот файл с помощью следующих действий.

   Для Chrome откройте пункты меню **Обозреватель решений > Документы скриптов > [Имя_нужной_страницы]**.

    > [!NOTE]
    > В браузере Chrome вы можете получить сообщение `no source is available between `.<script>` tags.` This is OK, just continue debugging.

   Для Internet Explorer откройте пункты меню **Обозреватель решений > Документы скриптов > Windows Internet Explorer > [Имя_нужной_страницы]**.

Дополнительные сведения см. в руководстве по [отладке проектов ASP.NET в браузере Google Chrome на стороне клиента](https://blogs.msdn.microsoft.com/webdev/2016/11/21/client-side-debugging-of-asp-net-projects-in-google-chrome/).
