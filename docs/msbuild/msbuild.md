---
title: MSBuild | Документы Майкрософт
description: Сведения о том, как платформа Microsoft Build Engine (MSBuild) предоставляет для файла проекта схему XML, чтобы управлять сборками.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- MSBuild, about MSBuild
- MSBuild, overview
ms.assetid: e39f13f7-1e1d-4435-95ca-0c222bca071c
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: dbf938e61cc1567beb682847821595f5ca6cc026
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99905473"
---
# <a name="msbuild"></a>MSBuild

Microsoft Build Engine представляет собой платформу для сборки приложений. Компонент MSBuild обеспечивает для файла проекта схему XML, определяющую способы, используемые платформой сборки для обработки и сборки приложений. Visual Studio использует MSBuild, но MSBuild не зависит от Visual Studio. Вызывая *msbuild.exe* для файла проекта или решения, можно контролировать и создавать в продукты в средах без установленного экземпляра Visual Studio.

 Visual Studio использует MSBuild для загрузки и сборки управляемых проектов. Файлы проектов в Visual Studio (с расширением *CSPROJ*, *VBPROJ*, *VCXPROJ*) содержат код XML MSBuild, который выполняется при создании проекта с помощью интегрированной среды разработки. Проекты Visual Studio импортируют все необходимые параметры и процессы сборки для выполнения стандартной работы по разработке, но их можно расширять и изменять в Visual Studio или в редакторе XML.

 Сведения об MSBuild для C++ см. в разделе [MSBuild (C++)](/cpp/build/msbuild-visual-cpp).

 В следующих примерах показаны случаи, когда сборки можно запускать с помощью вызова MSBuild из командной строки, а не интегрированной среды разработки Visual Studio.

- Среда Visual Studio не установлена. ([Скачайте MSBuild без Visual Studio](https://visualstudio.microsoft.com/downloads/?q=build+tools).)

- Необходимо использовать 64-разрядную версию MSBuild. Эта версия MSBuild обычно не нужна, но она позволяет MSBuild обращаться к большему объему памяти.

- Сборку требуется выполнять в нескольких процессах. Однако можно использовать интегрированную среду разработки, чтобы добиться того же результата для проектов на C++ и C#.

- Требуется изменить систему сборки. Например, может потребоваться выполнить следующие действия:

  - предварительная обработка файлов перед их компиляцией;

  - копирование выходных данных сборки в другое место;

  - создание сжатых файлов из выходных данных сборки;

  - пост-обработка. Например, может потребоваться присвоить сборке другой номер версии.

Можно написать код в интегрированной среде разработки Visual Studio, но запускать сборку с помощью MSBuild. В качестве альтернативы можно выполнять сборку кода в интегрированной среде разработки на компьютере разработчика, но запускать MSBuild из командной строки для сборки и интеграции кода, полученного от нескольких разработчиков. Для сборки проектов .NET Core можно также применять [интерфейс командной строки (CLI) .NET Core](/dotnet/core/tools/), использующий MSBuild.

> [!NOTE]
> С помощью Azure Pipelines можно автоматически компилировать, тестировать и развертывать приложение. Система сборки может автоматически запускать сборку, когда разработчики возвращают код (например, как часть стратегии непрерывной интеграции) или по расписанию (например, выполнять ежедневную ночную тестовую сборку). Azure Pipelines компилирует код с использованием MSBuild. Дополнительные сведения см. в описании [Azure Pipelines](/azure/devops/pipelines/index?view=vsts&preserve-view=true).

В статье представлен обзор MSBuild. Вводную информацию см. в статье [Пошаговое руководство. Использование MSBuild](../msbuild/walkthrough-using-msbuild.md).

## <a name="use-msbuild-at-a-command-prompt"></a>Использование MSBuild в командной строке

 Чтобы запустить MSBuild из командной строки, передайте файл проекта в *MSBuild.exe* при использовании соответствующих параметров командной строки. Параметры командной строки позволяют задавать свойства, выполнять определенные целевые объекты и задавать другие параметры, управляющие процессом построения. Например, используя следующий синтаксис командной строки, можно создать файл *MyProj.proj* со свойством `Configuration`, для которого задается значение `Debug`.

```cmd
MSBuild.exe MyProj.proj -property:Configuration=Debug
```

 Дополнительные сведения о параметрах командной строки MSBuild см. в статье [Справочник по командной строке MSBuild](../msbuild/msbuild-command-line-reference.md).

> [!IMPORTANT]
> Перед загрузкой проекта определите, можно ли доверять коду.

## <a name="project-file"></a>Файл проекта

 MSBuild использует открытый и расширяемый формат файлов проекта на базе XML. Формат файла проекта MSBuild позволяет разработчикам описывать создаваемые элементы, а также способы их построения для разных операционных систем и конфигураций. Кроме того, формат файла проекта позволяет разработчикам создавать многократно используемые правила сборки, которые можно разложить на отдельные файлы, чтобы сборки могли выполняться единообразно в различных проектах в составе соответствующего продукта.

 В следующих разделах описаны некоторые из базовых элементов формата файла проекта MSBuild. См. дополнительные сведения о [создании базового файла проекта MSBuild с нуля](../msbuild/walkthrough-creating-an-msbuild-project-file-from-scratch.md).

### <a name="properties"></a><a name="BKMK_Properties"></a> Свойства

 Свойства представляют пары ключ-значение, с помощью которых выполняется настройка построения. Для объявления свойства создается элемент с таким же именем как у свойства, который является дочерним по отношению к элементу [PropertyGroup](../msbuild/propertygroup-element-msbuild.md). Например, в следующем коде создается свойство `BuildDir` со значением `Build`.

```xml
<PropertyGroup>
    <BuildDir>Build</BuildDir>
</PropertyGroup>
```

 Свойство можно определить условно, задав атрибут `Condition` в элементе. Содержимое условных элементов игнорируется, пока значение условия не станет `true`. В следующем примере определяется элемент `Configuration`, если он еще не был определен.

```xml
<Configuration  Condition=" '$(Configuration)' == '' ">Debug</Configuration>
```

 Для обращения к свойствам в файле проекта используется синтаксис $(\<PropertyName>). Например, к свойствам из предыдущих примеров можно обращаться с помощью конструкций `$(BuildDir)` и `$(Configuration)`.

 Дополнительные сведения о свойствах см. в разделе [Свойства MSBuild](../msbuild/msbuild-properties.md).

### <a name="items"></a><a name="BKMK_Items"></a> Элементы

 Элементы — это входные данные для системы сборки, как правило, представляющие файлы. Элементы группируются в типы на основе определяемых пользователем имен элементов. Эти типы элементов можно использовать в качестве параметров для задач, в которых с помощью отдельных элементов выполняются этапы процесса построения.

 Для объявления элементов в файле проекта создается элемент с именем типа элементов, являющийся дочерним по отношению к элементу [ItemGroup](../msbuild/itemgroup-element-msbuild.md). Например, с помощью приведенного ниже кода создается тип элементов с именем `Compile`, в который входят два файла.

```xml
<ItemGroup>
    <Compile Include = "file1.cs"/>
    <Compile Include = "file2.cs"/>
</ItemGroup>
```

 Для обращения к типам элементов в файле проекта используется синтаксис @(\<ItemType>). Например, ссылка на тип элементов в этом примере выглядела бы следующим образом: `@(Compile)`.

 В MSBuild имена элементов и атрибутов задаются с учетом регистра. А имена свойств, элементов (item) и метаданных — нет. В следующем примере создается тип элементов `Compile`, `comPile` или любого другого варианта написания, и типу элементов присваивается значение "one.cs;two.cs".

```xml
<ItemGroup>
  <Compile Include="one.cs" />
  <comPile Include="two.cs" />
</ItemGroup>
```

 При объявлении элементов можно использовать подстановочные знаки; элементы могут содержать дополнительные метаданные для расширенных сценариев построения. Дополнительные сведения об элементах см. в разделе [Элементы](../msbuild/msbuild-items.md).

### <a name="tasks"></a><a name="BKMK_Tasks"></a> Задачи

 Задачи — это блоки исполняемого кода, с помощью которых в проектах MSBuild выполняются операции построения. Например, в задаче может выполняться компиляция входных файлов или запускаться внешняя программа. Созданные задачи могут использоваться совместно и многократно разными разработчиками в различных проектах.

 Алгоритм выполнения задачи записан в управляемом коде и сопоставлен с MSBuild с помощью элемента [UsingTask](../msbuild/usingtask-element-msbuild.md). Для создания собственной задачи можно разработать управляемый тип, реализующий интерфейс <xref:Microsoft.Build.Framework.ITask>. Дополнительные сведения о способах создания задач см. в руководстве по [написанию задач](../msbuild/task-writing.md).

 MSBuild включает стандартные задачи, которые можно изменять в соответствии с требованиями. Примеры: [Copy](../msbuild/copy-task.md) — копирование файлов, [MakeDir](../msbuild/makedir-task.md) — создание каталогов, [Csc](../msbuild/csc-task.md) — компиляция файлов исходного кода Visual C#. Список доступных задач и сведения об их использовании см. в [справочнике по задачам](../msbuild/msbuild-task-reference.md).

 Задача выполняется в файле проекта MSBuild путем создания элемента с таким же именем как у задачи в виде дочернего элемента по отношению к элементу [Target](../msbuild/target-element-msbuild.md). Задачи, как правило, принимают параметры, которые передаются как атрибуты элемента. В качестве параметров можно использовать свойства и элементы MSBuild. Например, с помощью следующего кода вызывается задача [MakeDir](../msbuild/makedir-task.md) и ей передается значение свойства `BuildDir`, объявленного в предыдущем примере.

```xml
<Target Name="MakeBuildDirectory">
    <MakeDir  Directories="$(BuildDir)" />
</Target>
```

 Дополнительные сведения о задачах см. в разделе [Задачи](../msbuild/msbuild-tasks.md).

### <a name="targets"></a><a name="BKMK_Targets"></a> Целевые объекты

 Целевые объекты позволяют группировать задачи в определенном порядке и использовать разделы файла проекта в качестве точек входа в процесс построения. Целевые объекты часто группируются в логические разделы, чтобы повысить удобочитаемость и расширяемость. Благодаря разбиению действий построения на множество целевых объектов можно вызывать один фрагмент процесса построения из других целевых объектов, не создавая при этом копии соответствующего раздела кода в каждом целевом объекте. Например, если требуется создать ссылки для нескольких точек входа в процесс сборки, можно создать целевой объект, который выполняет сборку ссылок, и выполнять этот целевой объект из каждой нужной точки входа.

 Целевые объекты объявляются в файле проекта с помощью элемента [Target](../msbuild/target-element-msbuild.md). Например, с помощью следующего кода создается целевой объект с именем `Compile`, который затем вызывает задачу [Csc](../msbuild/csc-task.md) со списком элементов, объявленным в предыдущем примере.

```xml
<Target Name="Compile">
    <Csc Sources="@(Compile)" />
</Target>
```

 В более сложных сценариях целевые объекты могут использоваться для описания связей друг с другом и выполнять анализ зависимостей, что позволяет пропускать целые разделы процесса сборки, если такой целевой объект актуален. Дополнительные сведения о целевых объектах см. в разделе [Целевые объекты](../msbuild/msbuild-targets.md).

## <a name="build-logs"></a>Журналы сборки

 Ошибки, предупреждения и сообщения журнала сборки можно выводить на консоль или на другое устройство вывода. Дополнительные сведения см. в руководствах по [получению журналов сборки](../msbuild/obtaining-build-logs-with-msbuild.md) и [ведению журналов в MSBuild](../msbuild/logging-in-msbuild.md).

## <a name="use-msbuild-in-visual-studio"></a>Использование MSBuild в Visual Studio

 Visual Studio использует формат файла проекта MSBuild для хранения данных сборки об управляемых объектах. Параметры проекта, добавленные или измененные с помощью интерфейса Visual Studio, отражаются в файле *.\*proj*, который создается для каждого проекта. Для построения управляемых проектов в Visual Studio используется размещенный экземпляр MSBuild. Это означает, что выполнить построение управляемого проекта можно в Visual Studio или в командной строке (даже при отсутствии Visual Studio), и результаты будут одинаковыми.

 См. дополнительные сведения об [использовании MSBuild в Visual Studio](../msbuild/walkthrough-using-msbuild.md).

## <a name="multitargeting"></a><a name="BKMK_Multitargeting"></a> Настройка для различных версий

 С помощью Visual Studio можно компилировать приложение для его запуска на любой из нескольких версий платформы .NET Framework. Например, можно компилировать приложение для запуска в .NET Framework 2.0 на 32-разрядной платформе, а также компилировать то же приложение для запуска в .NET Framework 4.5 на 64-разрядной платформе. Возможность компиляции для нескольких платформ называется настройкой для различных версий.

 Ниже приведены несколько преимуществ настройки для различных версий:

- Можно разрабатывать приложения, которые предназначены для более ранних версий платформы .NET Framework, например версий 2.0, 3.0 и 3.5.

- Можно ориентироваться на платформы, отличные от .NET Framework, например на Silverlight.

- Можно ориентироваться на *профиль платформы*, который представляет собой предопределенное подмножество целевой платформы.

- После появления пакета обновления для текущей версии .NET Framework можно выбрать его в качестве целевой платформы.

- Поддержка различных платформ гарантирует, что приложение использует только те функциональные возможности, которые доступны в целевой версии .NET Framework и платформы.

Дополнительные сведения см. в разделе [Настройка для различных версий](../msbuild/msbuild-multitargeting-overview.md).

## <a name="see-also"></a>См. также

| Заголовок | Описание |
| - | - |
| [Пошаговое руководство: Создание файла проекта MSBuild с нуля](../msbuild/walkthrough-creating-an-msbuild-project-file-from-scratch.md) | Содержит описание способов пошагового создания основного файла проекта путем использования только текстового редактора. |
| [Пошаговое руководство: Использование MSBuild](../msbuild/walkthrough-using-msbuild.md) | Содержит вводную информацию о стандартных блоках MSBuild и описание способов записи, управления и отладки проектов MSBuild без выхода из интегрированной среды разработки Visual Studio. |
| [Основные понятия MSBuild](../msbuild/msbuild-concepts.md) | Содержит информацию о четырех стандартных блоках MSBuild: свойствах, элементах, целевых объектах и задачах. |
| [Элементы](../msbuild/msbuild-items.md) | Содержит описание общих понятий, относящихся к формату файлов MSBuild, и способов взаимодействия фрагментов. |
| [Свойства MSBuild](../msbuild/msbuild-properties.md) | Содержит вводную информацию о свойствах и коллекциях свойств. Свойства представляют собой пары ключ-значение, с помощью которых выполняется настройка сборок. |
| [Целевые объекты](../msbuild/msbuild-targets.md) | Содержит объяснение группировки задач в определенном порядке и вызова разделов процесса построения из командной строки. |
| [Задачи](../msbuild/msbuild-tasks.md) | Описывает процесс создания блока исполняемого кода, с помощью которого MSBuild выполняет атомарные операции построения. |
| [Условия](../msbuild/msbuild-conditions.md) | Рассматривает использование атрибута `Condition` в элементе MSBuild. |
| [Дополнительные возможности](../msbuild/msbuild-advanced-concepts.md) | Содержит информацию о пакетной обработке, выполнении преобразований, использовании нескольких целевых платформ и других дополнительных возможностях. |
| [Ведение журнала в MSBuild](../msbuild/logging-in-msbuild.md) | Описание возможностей записи в журнал событий, сообщений и ошибок сборки. |
| [Как MSBuild выполняет сборку проектов](build-process-overview.md) | Описывает внутренний процесс сборки, используемый в MSBuild. |
| [Дополнительные ресурсы](https://social.msdn.microsoft.com/forums/vstudio/home?forum=msbuild) | Содержит список ресурсов сообщества и службы поддержки с дополнительной информацией о MSBuild. |

## <a name="reference"></a>Справочник

- [Справочные сведения о MSBuild](../msbuild/msbuild-reference.md)\
 Содержит ссылки на разделы, содержащие справочную информацию.

- [Глоссарий](msbuild-glossary.md)\
 Содержит определения общих терминов MSBuild.
