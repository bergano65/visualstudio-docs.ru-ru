---
title: Командная строка профилировщика — запуск автономного приложения, получение статистики приложения
description: Узнайте, как использовать программы командной строки Средств профилирования Visual Studio, чтобы запускать автономные приложения, а также собирать данные о производительности, применяя метод выборки.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
ms.assetid: 52dcee2b-f178-4a76-bddc-e36c50bfcb78
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: vs-2017
ms.workload:
- multiple
ms.openlocfilehash: 49955afdb97ade1612c270dbb1094ca0ef04a947
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99928995"
---
# <a name="how-to-launch-a-stand-alone-application-with-the-profiler-and-collect-application-statistics-by-using-the-command-line"></a>Практическое руководство. Запуск автономного приложения с профилировщиком и сбор статистики приложения с помощью командной строки
В этом разделе описывается использование программ командной строки средств профилирования [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для запуска автономного (клиентского) приложения и сбора статистических данных о производительности с помощью метода выборки.

> [!NOTE]
> Возможности расширенной безопасности в Windows 8 и Windows Server 2012 требовали значительных изменений в способе, которым профилировщик Visual Studio собирает данные на этих платформах. Для приложений универсальной платформы Windows также требуются новые методы сбора. См. раздел [Средства производительности в приложениях Windows 8 и Windows Server 2012](../profiling/performance-tools-on-windows-8-and-windows-server-2012-applications.md).
>
> Добавление данных об уровневом взаимодействии в сеанс профилирования требует определенных процедур со средствами профилирования командной строки. См. [Сбор данных взаимодействия уровней](../profiling/adding-tier-interaction-data-from-the-command-line.md)

 Для использования программ командной строки профилировщика необходимо добавить путь в переменную среды PATH окна командной строки или в саму команду. Средства профилирования можно запустить на компьютере, где установлена среда Visual Studio, из окна командной строки Visual Studio.

1. Если средства профилирования выполняются на компьютере, где установлена среда Visual Studio, оболочка командной строки Visual Studio задает правильные пути автоматически. В меню **Сервис** выберите **Командная строка Visual Studio**.

> [!NOTE]
> Сведения о пути к средствам профилирования см. в статье [Указание пути к программам командной строки средств профилирования](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md). На 64-разрядных компьютерах доступны 64- и 32-разрядные версии этих программ. Для использования программ командной строки профилировщика необходимо добавить путь к программам в переменную среды PATH окна командной строки или в саму команду.

## <a name="start-the-application-with-the-profiler"></a>Запуск приложения с помощью профилировщика
 Чтобы запустить целевое приложение с помощью профилировщика, воспользуйтесь параметрами VSPerfCmd **/start** и **/launch** для инициализации профилировщика и запуска приложения. Параметры **/start** и **/launch** с соответствующими параметрами можно указать в одной командной строке.

 Можно также добавить параметр **/globaloff** для приостановки сбора данных при запуске целевого приложения. Затем используйте параметр **/globalon** для запуска сбора данных.

#### <a name="to-start-an-application-by-using-the-profiler"></a>Запуск приложения с помощью профилировщика

1. Откройте окно командной строки.

2. Запуск профилировщика. Тип:

    **VSPerfCmd /start:sample /output:** `OutputFile` [`Options`]

   - Параметр [/start](../profiling/start.md)**:sample** инициализирует профилировщик.

   - Параметр [/output](../profiling/output.md)**:**`OutputFile` является обязательным для параметра **/start**. `OutputFile` указывает имя и расположение файла данных профилирования (VSP-файла).

     С параметром **/start:sample** можно использовать любой из следующих параметров.

   | Параметр | Описание |
   | - | - |
   | [/wincounter](../profiling/wincounter.md) **:** `WinCounterPath` | Задает счетчик производительности Windows, данные которого будут собираться во время профилирования. |
   | [/automark](../profiling/automark.md) **:** `Interval` | Используется с только с параметром **/wincounter**. Указывает время (в миллисекундах) между событиями сбора счетчика производительности Windows. Значение по умолчанию — 500 мс. |
   | [/events](../profiling/events-vsperfcmd.md) **:** `Config` | Задает события трассировки событий для Windows (ETW), собираемые во время профилирования. События трассировки событий Windows собираются в отдельный *ETL*-файл. |

3. Запустите целевое приложение. Введите: **VSPerfCmd /launch:** `appName` [`Options`] [`Sample Event`]

    С параметром **/launch** можно использовать один или несколько из следующих параметров.

   |Параметр|Описание|
   |------------|-----------------|
   |[/args](../profiling/args.md) **:** `Arguments`|Указывает строку, которая содержит аргументы командной строки для передачи в целевое приложение.|
   |[/console](../profiling/console.md)|Запускает целевое приложение командной строки в отдельном окне.|

    По умолчанию выборка данных производительности выполняется каждые 10 000 000 неостановленных циклов процессора. Это примерно один раз каждые 10 секунд для процессора с частотой 1 ГГц. Можно указать один из следующих параметров, чтобы изменить длительность цикла или задать другое событие выборки.

   |Событие выборки|Описание|
   |------------------|-----------------|
   |[/timer](../profiling/timer.md) **:** `Interval`|Изменяет интервал выборки на число неостановленных циклов, которые указываются с помощью свойства `Interval`.|
   |[/pf](../profiling/pf.md)[ **:** `Interval`]|Изменяет событие выборки на "ошибки страниц". Если указано свойство `Interval`, задает количество ошибок страниц между выборками. Значение по умолчанию — 10.|
   |[/sys](../profiling/sys-vsperfcmd.md)[ **:** `Interval`]|Изменяет событие выборки на "системные вызовы" из процесса к ядру операционной системы (syscall). Если указано свойство `Interval`, задает количество вызовов между выборками. Значение по умолчанию — 10.|
   |[/counter](../profiling/counter.md) **:** `Config`|Изменяет событие выборки и интервал на "счетчик производительности процессора" и интервал, указанный в `Config`.|

## <a name="control-data-collection"></a>Управление сбором данных
 Пока целевое приложение выполняется, вы можете управлять сбором данных путем запуска и остановки записи данных в файл данных профилировщика, используя параметры *VSPerfCmd.exe*. Управление сбором данных позволяет собирать данные на конкретных этапах выполнения программы, например при запуске или завершении работы приложения.

#### <a name="to-start-and-stop-data-collection"></a>Запуск и остановка сбора данных

- Следующие пары параметров запускают и останавливают сбор данных. Каждый параметр необходимо указывать в отдельной командной строке. Сбор данных можно включать и отключать несколько раз.

    |Параметр|Описание|
    |------------|-----------------|
    |[/globalon /globaloff](../profiling/globalon-and-globaloff.md)|Запускает ( **/globalon**) или останавливает ( **/globaloff**) сбор данных для всех процессов.|
    |[/processon](../profiling/processon-and-processoff.md) **:** `PID`  [/processoff](../profiling/processon-and-processoff.md) **:** `PID`|Запускает ( **/processon**) или останавливает ( **/processoff**) сбор данных для процесса с указанным идентификатором процесса (`PID`).|
    |[/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} [/detach](../profiling/detach.md)[**:**{`PID`&#124;`ProcName`}]|**/attach** запускает сбор данных для процесса с указанным идентификатором `PID` или именем процесса (ProcName). **/detach** останавливает сбор данных для указанного процесса или для всех процессов, если конкретный процесс не задан.|

## <a name="end-the-profiling-session"></a>Завершение сеанса профилирования
 Для завершения сеанса профилирования профилировщик не должен быть подключен к любому профилируемому процессу, кроме того, необходимо явным образом завершить его работу. Вы можете отключить профилировщик от приложения, профилируемого с помощью метода выборки, закрыв приложение или вызвав параметр **VSPerfCmd /detach**. Затем можно вызвать параметр **VSPerfCmd /shutdown**, чтобы завершить работу профилировщика и закрыть файл данных профилирования. Команда **VSPerfClrEnv /off** сбрасывает переменные среды профилирования.

#### <a name="to-end-a-profiling-session"></a>Завершение сеанса профилирования

1. Выполните одно из следующих действий, чтобы отключить профилировщик от целевого приложения.

    - Закройте целевое приложение.

         -или-

    - Введите команду **VSPerfCmd /detach**.

2. Завершите работу профилировщика. Тип:

     **VSPerfCmd**  [/shutdown](../profiling/shutdown.md)

## <a name="see-also"></a>См. также
- [Профилирование автономных приложений](../profiling/command-line-profiling-of-stand-alone-applications.md)
- [Представления данных метода выборки](../profiling/profiler-sampling-method-data-views.md)
