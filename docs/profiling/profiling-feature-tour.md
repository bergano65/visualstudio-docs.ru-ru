---
title: Начало работы со средствами профилирования
description: Краткий обзор различных средств диагностики, доступных в Visual Studio.
ms.custom: ''
ms.date: 09/08/2020
ms.topic: overview
f1_keywords:
- vs.diagnosticshub.overview
dev_langs:
- CSharp
helpviewer_keywords:
- diagnostic tools
ms.assetid: d2ee0301-ea78-43d8-851a-71b7b2043d73
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: bfd7055303fed2c18501d5eea3b49b34c68ec248
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99929112"
---
# <a name="first-look-at-profiling-tools"></a>Первое знакомство со средствами профилирования

Visual Studio предоставляет широкий набор средств профилирования для выявления различных типов проблем с производительностью в зависимости от типа приложения. В этой статье мы кратко рассмотрим наиболее распространенные средства профилирования.

См. дополнительные сведения о [рекомендуемом средстве профилирования](#which-tool-should-i-use) с поддержкой разных типов приложений.

## <a name="measure-performance-while-debugging"></a>Измерение производительности во время отладки

Средства профилирования, которыми можно воспользоваться во время сеанса отладки, доступны в окне "Средства диагностики". Окно "Средства диагностики" появится автоматически, если вы не отключали эту функцию. Чтобы открыть окно, щелкните **Отладка | Окна | Показать средства диагностики**. В открытом окне можно выбирать средства, для которых требуется собрать данные.

![Окно "Средства диагностики"](../profiling/media/prof-tour-diagnostic-tools.png "Диагностические средства")

При отладке можно использовать окно **Средства диагностики** для анализа использования ЦП и памяти, а также просматривать события, отображающие сведения, связанные с производительностью.

![Представление Сводка средств диагностики](../profiling/media/prof-tour-cpu-and-memory-graph.gif "Сводка Средства диагностики")

Использование окна **Средства диагностики** является распространенным способом профилирования приложений, но для сборок выпуска вместо этого также можно выполнять последующий анализ приложения. Дополнительные сведения о различных подходах см. в статье [Выполнение средств профилирования с отладчиком и без него](../profiling/running-profiling-tools-with-or-without-the-debugger.md). См. дополнительные сведения о [рекомендуемом средстве профилирования](#which-tool-should-i-use) с поддержкой разных типов приложений.

Средства, доступные в окне "Средства диагностики" или во время сеанса отладки:
- [Загрузка ЦП](../profiling/beginners-guide-to-performance-profiling.md)
- [Использование памяти](../profiling/memory-usage.md).
- [PerfTips](../profiling/perftips.md)

> [!NOTE]
> Для запуска средств профилирования с отладчиком (окно **Средства диагностики**) требуется Windows 8 и более поздние версии. Вы можете использовать средства [последующего анализа](#post_mortem) с Windows 7 и более поздними версиями. 

## <a name="measure-performance-in-release-builds"></a><a name="post_mortem"></a> Измерение производительности в сборках выпуска

Средства в Профилировщике производительности предназначены для анализа сборок **выпуска**. В профилировщике производительности можно собрать диагностические сведения во время работы приложения, а затем проанализировать их после его остановки (последующий анализ).

Откройте Профилировщик производительности, последовательно выбрав **Отладка** > **Профилировщик производительности** (или нажмите клавиши **ALT + F2**).

![Профилировщик производительности](../profiling/media/prof-tour-performance-profiler.png "Профилировщик производительности")

Дополнительные сведения об использовании средства "Загрузка ЦП" или "Использование памяти" в Профилировщике производительности и средств, встроенных в отладчик, см. в статье [Запуск средств профилирования с отладчиком или без него](../profiling/running-profiling-tools-with-or-without-the-debugger.md). 

Средства, доступные в Профилировщике производительности:

- [Загрузка ЦП](../profiling/cpu-usage.md)
- [Распределение объектов .NET](../profiling/dotnet-alloc-tool.md)
- [Использование памяти](../profiling/memory-usage-without-debugging2.md).
- [Средство .NET Async](../profiling/analyze-async.md).
- [Средства базы данных](../profiling/analyze-database.md).
- [Использование GPU](../profiling/gpu-usage.md)

См. дополнительные сведения о [рекомендуемом средстве профилирования](#which-tool-should-i-use) с поддержкой разных типов приложений.

В некоторых сценариях в окне можно выбрать [несколько средств профилирования](../profiling/use-multiple-profiler-tools-simultaneously.md). Средства, такие как "Загрузка ЦП", могут предоставлять дополнительные данные, полезные для проведения анализа. Вы также можете использовать [профилировщик командной строки](../profiling/profile-apps-from-command-line.md), чтобы поддержать сценарии, включающие несколько средств профилирования.

## <a name="examine-performance-using-perftips"></a>Проверка производительности с помощью PerfTips

Зачастую просмотреть сведения о производительности проще всего с помощью [PerfTips](../profiling/perftips.md). Используя подсказки, вы можете просматривать сведения о производительности непосредственно при взаимодействии с кодом. Можно проверить такие сведения, как длительность события (измеряется с момента последней приостановки отладчика или с момента запуска приложения). Например, при пошаговом выполнении кода (F10, F11) PerfTips отображает длительность выполнения приложения с операции на предыдущем шаге до текущего шага.

![Обзор профилирования PerfTips](../profiling/media/prof-tour-perf-tips.png "Обзор профилирования PerfTips")

PerfTips можно использовать для проверки длительности выполнения блока кода или времени, необходимого для завершения работы одной функции.

PerfTips отображает те же события, которые также выводятся в представлении **События** средств диагностики. В представлении **События** приводятся различные события, которые возникают при отладке, например операция задания точки останова или пошагового выполнения кода.

![Представление События для средств диагностики](../profiling/media/prof-tour-events.png "Средства диагностики — представление События")

 > [!NOTE]
 > Если у вас установлен выпуск Visual Studio Enterprise, на этой вкладке вы можете увидеть [события IntelliTrace](../debugger/intellitrace.md).

## <a name="analyze-cpu-usage"></a>Анализ использования ЦП

Средство загрузки ЦП является хорошей отправной точкой для анализа производительности приложения. С его помощью вы получите дополнительные сведения о ресурсах ЦП, используемых приложением. Вы можете использовать [средство "Загрузка ЦП", встроенное в отладчик](../profiling/beginners-guide-to-performance-profiling.md), или [средство "Использование ЦП"последующего анализа](../profiling/cpu-usage.md).

При использовании средства "Загрузка ЦП", встроенного в отладчик, откройте окно "Средства диагностики" (если оно закрыто, выберите **Отладка > Окна > Показать средства диагностики**). Во время отладки откройте представление **Сводка** и выберите **Запись профиля ЦП**.

![Включение использования ЦП для средств диагностики](../profiling/media/prof-tour-enable-cpu-profiling.png "Средства диагностики — включить использование ЦП")

Единственный способ использовать средство — установить в коде две точки останова: одну в начале и одну в конце функции и области кода, которые требуется проанализировать. Проверьте данные профилирования во время приостановки во второй точке останова.

В представлении **Загрузка ЦП** отображается список функций, упорядоченных по самой продолжительно выполняющейся (эта функция расположена в верхней части). Это поможет переходить к функциям, где наблюдаются проблемы с производительностью.

![Представление Использование ЦП для средств диагностики](../profiling/media/prof-tour-cpu-usage.png "Средства диагностики — использование ЦП")

Дважды щелкните нужную функцию, после чего откроется подробное представление с тремя панелями (представление "бабочки"): выбранная функция будет находиться в центре окна, вызываемая функция — в левой части, а вызывающая функция — в правой. В разделе **Тело функции** также показан общий объем времени (и доля времени), затраченного в теле функции за исключением времени, затраченного в вызываемых и вызывающих функциях. Эти данные помогут оценить, оказывает ли негативное влияние на производительность сама функция.

![Представление бабочка вызывающий/вызываемый для средств диагностики](../profiling/media/prof-tour-cpu-usage-caller-callee.png "Средства диагностики — представление Вызывающий/вызываемый")

## <a name="analyze-memory-usage"></a>Анализ данных об использовании памяти

В окне **средств диагностики** также можно оценить использование памяти в приложении с помощью средства **Использование памяти**. Например, можно узнать число и размер объектов в куче. В Профилировщике производительности можно использовать [средство "Использование памяти", встроенное в отладчик](../profiling/memory-usage.md) или средство ["Использование памяти" для последующего анализа](../profiling/memory-usage-without-debugging2.md).

Разработчики .NET могут выбрать [средство распределения объектов .NET](../profiling/dotnet-alloc-tool.md) или средство [Использование памяти](../profiling/memory-usage.md).

- **Средство выделения объектов .NET** помогает определять закономерности и аномалии выделения в коде .NET, а также обнаруживать распространенные проблемы, связанные со сборкой мусора. Оно используется только в качестве инструмента последующего анализа. Этот инструмент можно запускать на локальных или удаленных компьютерах.
- Средство **Использование памяти** полезно при определении утечек в памяти, которые не являются характерными для приложений .NET. Если при проверке памяти необходимо использовать функции отладчика, например пошаговое выполнение кода, рекомендуется выбирать [средство "Использование памяти", встроенное в отладчик](../profiling/beginners-guide-to-performance-profiling.md).

Для анализа использования памяти с помощью **средства использования памяти** необходимо сделать хотя бы один моментальный снимок памяти. Часто наилучшим способом анализа памяти является создание двух снимков: первый создается непосредственно перед возникновением потенциальной проблемы с памятью, а второй — сразу же после возникновения этой проблемы. Затем можно просмотреть различия двух моментальных снимков и точно определить, что изменилось. На следующем рисунке показано создание моментального снимка с помощью средства, встроенного в отладчик.

![Создание моментального снимка в средствах диагностики](../profiling/media/prof-tour-take-snapshots.gif "Средства диагностики — сделать моментальные снимки")

При выборе одной из ссылок со стрелкой откроется разностное представление кучи (красная стрелка вверх ![Увеличение использования памяти](../profiling/media/prof-tour-mem-usage-up-arrow.png "Увеличение показателя использования памяти") показывает растущее количество объектов (слева) или увеличивающийся размер памяти (справа)). Если щелкнуть ссылку справа, откроется разностное представление кучи, упорядоченное по объектам, которые привели к максимальному увеличению размера кучи. Это может помочь выявить проблемы с памятью. Например, на следующем рисунке байты, используемые объектами `ClassHandlersStore`, увеличены на 3 492 байт на втором моментальном снимке.

![Средства диагностики — представление Инструмент сравнения кучи](../profiling/media/prof-tour-mem-usage-diff-heap.png "Средства диагностики — представление Инструмент сравнения кучи")

Если в представлении **Использование памяти** щелкнуть ссылку слева, представление кучи будет упорядочено по количеству объектов. Объекты определенного типа, количество которых максимально выросло, отображаются в верхней части (отсортированы по столбцу **Count Diff** (Разница числа)).

## <a name="analyze-resource-consumption-xaml"></a>Анализ использования ресурсов (XAML)

В приложениях XAML, таких как классические приложения WPF и приложения универсальной платформы Windows, можно анализировать потребление ресурсов, используя средство "Временная шкала приложения". Например, вы можете проанализировать время, затраченное приложением на подготовку кадров пользовательского интерфейса (макет и обработка), обработку запросов от сети и дисков, а также на такие сценарии, как запуск приложения, загрузка страницы и изменение размера окон. Чтобы использовать это средство, выберите **Временная шкала приложения** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните сценарий с предполагаемой проблемой потребления ресурсов, а затем щелкните **Остановка сбора**, чтобы создать отчет.

Низкие значения частоты кадров на графе **Пропускная способность визуализации** может означать наличие проблем визуализации, присутствующих при запуске приложения. Аналогично, высокие показатели на графе **Использование потока пользовательского интерфейса** могут соответствовать проблемам со скоростью отклика пользовательского интерфейса. В отчете можно выбрать временной период предполагаемой проблемы производительности и затем в представлении "Подробная временная шкала" (нижняя панель) изучить подробные действия потока пользовательского интерфейса.

![Средство профилирования — временная шкала приложения](../profiling/media/prof-tour-application-timeline.gif "Обзор профилирования — временная шкала приложения")

В представлении "Подробная временная шкала" находятся такие сведения, как тип действия (или затронутый элемент пользовательского интерфейса), а также длительность действия. Например, на рисунке событие **Макета** для элемента управления сетки длится 57,53 мс.

Дополнительные сведения см. в разделе [Временная шкала приложения](../profiling/application-timeline.md).

::: moniker range=">=vs-2019"

## <a name="examine-application-events"></a>Изучение событий приложения

[Средство просмотра](../profiling/events-viewer.md) общих событий позволяет просматривать действия приложения с помощью списка событий, таких как загрузка модуля, запуск потока и конфигурации системы. Это позволяет эффективнее диагностировать работу приложения в профилировщике Visual Studio. Это средство доступно в Профилировщике производительности. Откройте Профилировщик производительности, последовательно выбрав **Отладка** > **Профилировщик производительности** (или нажмите клавиши **ALT + F2**).

Это средство отображает каждое событие в представлении списка. Столбцы содержат сведения о каждом событии, например имя события, метку времени и идентификатор процесса.

![Трассировка средства просмотра событий](../profiling/media/eventviewertrace.png "Трассировка средства просмотра событий")

## <a name="analyze-asynchronous-code-net"></a>Анализ асинхронного кода (.NET)

[Средство .NET Async](../profiling/analyze-async.md) позволяет проанализировать производительность асинхронного кода в приложении. Это средство доступно в Профилировщике производительности. Откройте Профилировщик производительности, последовательно выбрав **Отладка** > **Профилировщик производительности** (или нажмите клавиши **ALT + F2**).

Средство отображает все асинхронные операции в представлении списка. Вы можете просмотреть такие сведения, как время начала и окончания, а также общее время асинхронной операции.

![Остановка средства .NET Async](../profiling/media/async-tool-opened.png "Остановка средства .NET Async")

## <a name="analyze-database-performance-net-core"></a>Анализ производительности базы данных (.NET Core)

Для приложений .NET Core, использующих ADO.NET или Entity Framework Core, средство для работы с [базами данных](../profiling/analyze-database.md) позволяет записывать запросы к базам данных, которые приложение выполняет во время диагностического сеанса. Сведения об отдельных запросах затем можно анализировать, чтобы определить области для улучшения производительности приложения. Это средство доступно в Профилировщике производительности. Откройте Профилировщик производительности, последовательно выбрав **Отладка** > **Профилировщик производительности** (или нажмите клавиши **ALT + F2**).

Это средство отображает каждый запрос в представлении списка. Вы можете просмотреть такие сведения, как время начала и длительность запроса.

![Allocation](./media/db-gotosource.png "Выделение")

::: moniker-end

## <a name="examine-ui-performance-and-accessibility-events-uwp"></a>Проверка событий производительности и доступности пользовательского интерфейса (UWP)

В приложениях UWP в окне **Средства диагностики** можно включить параметр **Анализ пользовательского интерфейса**. Средство выполняет поиск общих проблем производительности или доступности и во время отладки отображает их в представлении **События**. В описаниях событий содержатся сведения, которые могут помочь при устранении неполадок.

![Просмотр событий анализа пользовательского интерфейса в средствах диагностики](../profiling/media/prof-tour-ui-analysis.png "Средства диагностики — просмотр событий анализа пользовательского интерфейса")

## <a name="analyze-gpu-usage-direct3d"></a>Анализ использования GPU (Direct3D)

В приложениях Direct3D (компоненты Direct3D должны быть в C++) можно изучить действие GPU и проанализировать проблемы производительности. Дополнительные сведения см. в разделе [Использование GPU](./gpu-usage.md). Чтобы использовать это средство, выберите **Использование GPU** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните нужные действия профилирования, а затем щелкните **Остановка сбора**, чтобы создать отчет.

Выберите период времени на графах и щелкните **Просмотреть сведения**. В нижней панели появится представление подробных сведений. В этом представлении можно узнать, сколько событий происходит в каждом ЦП и графическом процессоре. Выбирайте события в самой нижней панели, чтобы открывать всплывающие окна на временной шкале. Например, выберите событие **Присутствующие**, чтобы просмотреть всплывающие окна по вызову **Присутствующий**. (Светло-серые вертикальные линии Vsync можно использовать в качестве точек отсчета для понимания того, пропустили ли вертикальную синхронизацию определенные вызовы с типом **Присутствующий**. Чтобы приложение выводило изображение со стабильной частотой в 60 кадров/с, между каждыми двумя вертикальными синхронизациями должен выполняться один вызов с типом **Присутствующий**.

![Средство профилирования — использование GPU](../profiling/media/prof-tour-gpu-usage.png "Диаграмма Использование GPU")

Графы также можно использовать для определения узких мест производительности ЦП или GPU.

::: moniker range="vs-2017"
## <a name="analyze-performance-javascript-uwp"></a>Анализ производительности (JavaScript UWP)

Для приложений UWP можно использовать средство "Память JavaScript" и средство "Скорость реагирования пользовательского интерфейса HTML".

Средство "Память JavaScript" аналогично средству "Использование памяти", доступному для других типов приложений. Это средство можно использовать для анализа использования памяти и поиска утечек памяти в приложении. Дополнительные сведения об этом средстве см. в разделе [Память JavaScript](../profiling/javascript-memory.md).

![Средство профилирования — память JavaScript](../profiling/media/diagjsmemory.png "DiagJSMemory")

Для диагностики скорости отклика пользовательского интерфейса, медленной загрузки и медленных визуальных обновлений в приложениях UWP используйте средство "Скорость реагирования пользовательского интерфейса HTML". Это средство аналогично инструменту "Временная шкала приложения" для других типов приложений. Дополнительные сведения см. в разделе [Скорость реагирования пользовательского интерфейса HTML](../profiling/html-ui-responsiveness.md).

![Средство профилирования — скорость реагирования пользовательского интерфейса HTML](../profiling/media/diaghtmlresp.png "DiagHTMLResp")
::: moniker-end

::: moniker range="vs-2017"
## <a name="analyze-network-usage-uwp"></a>Анализ использования сети (UWP)

В приложениях UWP можно анализировать выполненные сетевые операции с помощью API `Windows.Web.Http`. Это средство поможет вам устранить проблемы, включая проблемы с доступом и проверкой подлинности, неправильным использованием кэша и низкой производительностью процесса отображения и скачивания. Чтобы использовать это средство, выберите **Сеть** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните нужные действия, где используется `Windows.Web.Http`, а затем щелкните **Остановка сбора**, чтобы создать отчет.

![Средство профилирования — использование сети](../profiling/media/prof-tour-network-usage.png "Диаграмма Использование сети")

Выберите операцию в представлении "Сводка", чтобы просмотреть более подробные сведения.

![Подробные сведения в средстве использования сети](../profiling/media/prof-tour-network-usage-details.png "Диаграмма Сведения об использовании сети")

Дополнительные сведения см. в разделе [Использование сети](../profiling/network-usage.md).
::: moniker-end

## <a name="analyze-performance-legacy-tools"></a>Анализ производительности (устаревшие инструменты)

::: moniker range="vs-2017"
Если требуются функции, которые в настоящее время отсутствуют в средствах "Загрузка ЦП" или "Использование памяти", и вы работаете с классическими приложениями или приложениями ASP.NET, воспользуйтесь обозревателем производительности, поддерживающем профилирование. (Не поддерживается в приложениях UWP). Дополнительные сведения см. в разделе [Обозреватель производительности](../profiling/performance-explorer.md).
::: moniker-end

::: moniker range=">=vs-2019"
В Visual Studio 2019 устаревший Обозреватель производительности и связанные средства профилирования, такие как мастер производительности, были объединены в Профилировщик производительности, который можно открыть с помощью команды **Отладка** > **Профилировщик производительности**. В Профилировщике производительности доступные средства диагностики зависят от выбранного целевого объекта и текущего открытого запускаемого проекта. Инструмент "Загрузка ЦП" предоставляет возможности выборки, ранее поддерживаемые мастером производительности. Средство инструментирования предоставляет возможность профилирования с инструментированием (для точного числа и длительности вызовов), которая была представлена в мастере производительности. В Профилировщике производительности также содержатся дополнительные средства памяти.
::: moniker-end

![Средство "Обозреватель производительности"](../profiling/media/prof-tour-performance-explorer.png "Обозреватель производительности")

## <a name="which-tool-should-i-use"></a>Какие средства следует использовать?

Ниже приведена таблица со списком различных средств, предлагаемых в Visual Studio, и различных типов проектов, в которых эти средства можно использовать.

::: moniker range=">=vs-2019"
|Средство производительности|Классические приложения Windows|UWP|ASP.NET/ASP.NET Core|
|----------------------|---------------------|-------------|-------------|
|[PerfTips](../profiling/perftips.md)|да|да|да|
|[Использование ЦП](../profiling/beginners-guide-to-performance-profiling.md)|да|да|да|
|[Использование памяти](../profiling/memory-usage.md)|да|да|да|
|[Распределение объектов .NET](../profiling/dotnet-alloc-tool.md)|да (только для .NET.)|да|да|
|[Использование GPU](./gpu-usage.md)|да|да|нет|
|[Временная шкала приложения](../profiling/application-timeline.md)|да (XAML)|да|Нет|
|[Средство просмотра событий](../profiling/events-viewer.md)|да|да|да|
|[.NET Async](../profiling/analyze-async.md)|да (только для .NET.)|да|да|
|[База данных](../profiling/analyze-database.md)|да (только .NET Core)|Нет|да (только ASP.NET Core)|
|[Обозреватель производительности](#analyze-performance-legacy-tools)|Нет|нет|Нет|
|[IntelliTrace](../debugger/intellitrace.md)|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|
::: moniker-end

::: moniker range="vs-2017"
|Средство производительности|Классические приложения Windows|UWP|ASP.NET/ASP.NET Core|
|----------------------|---------------------|-------------|-------------|
|[Использование ЦП](../profiling/beginners-guide-to-performance-profiling.md)|да|да|да|
|[Использование памяти](../profiling/memory-usage.md)|да|да|да|
|[Использование GPU](./gpu-usage.md)|да|да|нет|
|[Временная шкала приложения](../profiling/application-timeline.md)|да (XAML)|да|нет|
|[PerfTips](../profiling/perftips.md)|да|да для XAML, нет для HTML|да|
|[Обозреватель производительности](../profiling/performance-explorer.md)|да|нет|да|
|[IntelliTrace](../debugger/intellitrace.md)|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|
|[Использование сети](../profiling/network-usage.md)|нет|да|Нет|
|[HTML UI responsiveness](../profiling/html-ui-responsiveness.md)|Нет|да для HTML, нет для XAML|Нет|
|[Память JavaScript](../profiling/javascript-memory.md)|Нет|да для HTML, нет для XAML|Нет|
::: moniker-end


## <a name="see-also"></a>См. также
- [Отладка в Visual Studio](../debugger/debugger-feature-tour.md)