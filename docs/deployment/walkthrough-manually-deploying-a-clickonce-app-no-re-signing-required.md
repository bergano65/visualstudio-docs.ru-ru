---
title: Развертывание вручную приложения ClickOnce & обеспечение фирменной символики
description: Узнайте, как создавать развертываемые клиентами приложения ClickOnce, не создавая новый манифест развертывания, который может использовать фирменную символику клиента.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- branding
- preserved branding information
- ClickOnce deployment, manually
- multiple ClickOnce deployment and branding
- ClickOnce deployment, SDK tools
- customer deployments
- manual ClickOnce deployments
- manifests [ClickOnce]
- ClickOnce applications, deployed by others
ms.assetid: c21822fb-d4ee-42e4-b72d-41ee9786efe5
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: c0e8895f45524526fc8007ff909a9c541e9899b3
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99917260"
---
# <a name="walkthrough-manually-deploy-a-clickonce-application-that-does-not-require-re-signing-and-that-preserves-branding-information"></a>Пошаговое руководство. Развертывание вручную приложения ClickOnce, которое не требует повторного подписания и сохраняет сведения о фирменной символике
Когда вы создаете [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложение, а затем предоставляете его клиенту для публикации и развертывания, ему обычно пришлось обновить манифест развертывания и повторно подписать его. Хотя этот метод по-прежнему является предпочтительным в большинстве случаев, платформа .NET Framework 3,5 позволяет создавать [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывания, которые могут быть развернуты клиентами без необходимости повторно создавать новый манифест развертывания. Дополнительные сведения см. в статье [развертывание приложений ClickOnce для тестирования и рабочих серверов без повторного подписывания](../deployment/deploying-clickonce-applications-for-testing-and-production-without-resigning.md).

 При создании [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения и последующем его предоставлении клиенту для публикации и развертывания приложение может использовать фирменную символику клиента или может сохранить фирменную символику. Например, если приложение является единым частным приложением, может потребоваться сохранить фирменную символику. Если приложение сильно настроено для каждого клиента, может потребоваться использовать фирменную символику клиента. Платформа .NET Framework 3,5 позволяет сохранить фирменную символику, сведения об издателе и подписи безопасности при предоставлении приложения организации для развертывания. Дополнительные сведения см. [в статье Создание приложений ClickOnce для развертывания другими пользователями](../deployment/creating-clickonce-applications-for-others-to-deploy.md).

> [!NOTE]
> В этом пошаговом руководстве вы создадите развертывания вручную с помощью программы командной строки *Mage.exe* или графического средства *MageUI.exe*. Дополнительные сведения о ручных развертываниях см. [в разделе Пошаговое руководство. Развертывание приложения ClickOnce вручную](../deployment/walkthrough-manually-deploying-a-clickonce-application.md).

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения действий, описанных в этом пошаговом руководстве, необходимо следующее.

- Windows Forms приложение, готовое к развертыванию. Это приложение будет называться *WindowsFormsApp1*.

- Visual Studio или Windows SDK.

### <a name="to-deploy-a-clickonce-application-with-multiple-deployment-and-branding-support-using-mageexe"></a>Развертывание приложения ClickOnce с несколькими развертываниями и поддержкой фирменной символики с помощью Mage.exe

1. Откройте командную строку Visual Studio или [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] командную строку и перейдите в каталог, в котором будут храниться [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] файлы.

2. Создайте каталог с именем после текущей версии развертывания. Если приложение развертывается в первый раз, скорее всего, будет выбрано значение **1.0.0.0**.

   > [!NOTE]
   > Версия развертывания может отличаться от версии файлов приложения.

3. Создайте подкаталог с именем **bin** и скопируйте в него все файлы приложения, включая исполняемые файлы, сборки, ресурсы и файлы данных.

4. Создание манифеста приложения с вызовом Mage.exe.

   ```cmd
   mage -New Application -ToFile 1.0.0.0\WindowsFormsApp1.exe.manifest -Name "Windows Forms App 1" -Version 1.0.0.0 -FromDirectory 1.0.0.0\bin -UseManifestForTrust true -Publisher "A. Datum Corporation"
   ```

5. Подпишите манифест приложения с помощью цифрового сертификата.

   ```cmd
   mage -Sign WindowsFormsApp1.exe.manifest -CertFile mycert.pfx
   ```

6. Создайте манифест развертывания, вызвав *Mage.exe*. По умолчанию *Mage.exe* помечает [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывание как установленное приложение, чтобы его можно было запускать как в сети, так и в автономном режиме. Чтобы приложение было доступно только в том случае, если пользователь находится в режиме «в сети», используйте `-i` аргумент со значением `f` . Так как это приложение будет использовать преимущества нескольких развертываний, исключите `-providerUrl` аргумент в *Mage.exe*. (В версиях платформа .NET Framework до версии 3,5, исключением `-providerUrl` для автономного приложения будет возникать ошибка.)

   ```cmd
   mage -New Deployment -ToFile WindowsFormsApp1.application -Name "Windows Forms App 1" -Version 1.0.0.0 -AppManifest 1.0.0.0\WindowsFormsApp1.manifest
   ```

7. Не подписывать манифест развертывания.

8. Предоставьте все файлы клиенту, который будет развертывать приложение в своей сети.

9. На этом этапе клиент должен подписать манифест развертывания с помощью самостоятельно созданного сертификата. Например, если клиент работает для компании «Adventure Works», он может создать самозаверяющий сертификат с помощью средства *MakeCert.exe* . Затем используйте средство *Pvk2pfx.exe* , чтобы объединить файлы, созданные *MakeCert.exe* , в PFX-файл, который можно передать в *Mage.exe*.

    ```cmd
    makecert -r -pe -n "CN=Adventure Works" -sv MyCert.pvk MyCert.cer
    pvk2pfx.exe -pvk MyCert.pvk -spc MyCert.cer -pfx MyCert.pfx
    ```

10. Затем клиент использует этот сертификат для подписания манифеста развертывания.

    ```cmd
    mage -Sign WindowsFormsApp1.application -CertFile MyCert.pfx
    ```

11. Клиент развертывает приложение для пользователей.

### <a name="to-deploy-a-clickonce-application-with-multiple-deployment-and-branding-support-using-mageuiexe"></a>Развертывание приложения ClickOnce с несколькими развертываниями и поддержкой фирменной символики с помощью MageUI.exe

1. Откройте командную строку Visual Studio или [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] командную строку и перейдите в каталог, в котором будут храниться [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] файлы.

2. Создайте подкаталог с именем **bin** и скопируйте в него все файлы приложения, включая исполняемые файлы, сборки, ресурсы и файлы данных.

3. Создайте подкаталог с именем после текущей версии развертывания. Если приложение развертывается в первый раз, скорее всего, будет выбрано значение **1.0.0.0**.

   > [!NOTE]
   > Версия развертывания может отличаться от версии файлов приложения.

4. Переместите каталог \\ **bin** в каталог, созданный на шаге 2.

5. Запустите графическое средство *MageUI.exe*.

   ```cmd
   MageUI.exe
   ```

6. Создайте новый манифест приложения, выбрав в меню **файл**, **создать**, **манифест приложения** .

7. На вкладке **имя** по умолчанию введите имя и номер версии этого развертывания. Кроме того, укажите значение для **издателя**, которое будет использоваться в качестве имени папки для ярлыка приложения в меню "Пуск" при развертывании.

8. Перейдите на вкладку **Параметры приложения** и щелкните **использовать манифест приложения для получения сведений о доверии**. Это позволит использовать сторонние фирменные настройки для этого [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения.

9. Перейдите на вкладку **файлы** и нажмите кнопку **обзора** рядом с текстовым полем **каталог приложения** .

10. Выберите каталог, содержащий файлы приложения, созданные на шаге 2, и нажмите кнопку **ОК** в диалоговом окне Выбор папки.

11. Нажмите кнопку **заполнить** , чтобы добавить все файлы приложения в список файлов. Если приложение содержит более одного исполняемого файла, пометьте основной исполняемый файл для этого развертывания в качестве запускаемого приложения, выбрав **пункт точка входа** в раскрывающемся списке **Тип файла** . (Если приложение содержит только один исполняемый файл, *MageUI.exe* пометит его.)

12. Перейдите на вкладку **требуемые разрешения** и выберите уровень доверия, который приложение должно утверждать. По умолчанию используется **полное доверие**, которое подходит для большинства приложений.

13. Выберите **файл**, **сохранить** в меню и сохраните манифест приложения. Вам будет предложено подписать манифест приложения при его сохранении.

14. Если у вас есть сертификат, хранящийся в качестве файла в файловой системе, используйте параметр **подписать как файл сертификата** и выберите сертификат из файловой системы с помощью кнопки с многоточием (**...**).

     -или-

     Если сертификат хранится в хранилище сертификатов, к которому можно получить доступ с компьютера, выберите **параметр подписать с сохраненным сертификатом** и выберите сертификат из предоставленного списка.

15. В меню выберите **файл**, **создать**, **манифест развертывания** , чтобы создать манифест развертывания, а затем на вкладке **имя** укажите имя и номер версии (**1.0.0.0** в этом примере).

16. Перейдите на вкладку **Обновление** и укажите, как часто требуется обновлять это приложение. Если приложение использует [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] API развертывания для проверки наличия обновлений, снимите флажок отмечено, что **приложение должно проверять наличие обновлений**.

17. Перейдите на вкладку **ссылка на приложение** . Вы можете предварительно заполнить все значения на этой вкладке, нажав кнопку **Выбрать манифест** и выбрав манифест приложения, созданный на предыдущих шагах.

18. Выберите **сохранить** и сохраните манифест развертывания на диск. Вам будет предложено подписать манифест приложения при его сохранении. Нажмите кнопку **Отмена** , чтобы сохранить манифест без его подписания.

19. Предоставьте клиенту все файлы приложения.

20. На этом этапе клиент должен подписать манифест развертывания с помощью самостоятельно созданного сертификата. Например, если клиент работает для компании «Adventure Works», он может создать самозаверяющий сертификат с помощью средства *MakeCert.exe* . Затем используйте средство *Pvk2pfx.exe* , чтобы объединить файлы, созданные *MakeCert.exe* , в PFX-файл, который можно передать в *MageUI.exe*.

    ```cmd
    makecert -r -pe -n "CN=Adventure Works" -sv MyCert.pvk MyCert.cer
    pvk2pfx.exe -pvk MyCert.pvk -spc MyCert.cer -pfx MyCert.pfx
    ```

21. После создания сертификата клиент подписывает манифест развертывания, открыв манифест развертывания в *MageUI.exe* и сохранив его. Когда откроется диалоговое окно подписывание, пользователь выбирает параметр **подписать как файл сертификата** и выбирает PFX-файл, который он сохранил на диске.

22. Клиент развертывает приложение для пользователей.

## <a name="see-also"></a>См. также раздел
- [Mage.exe (средство создания и редактирования манифеста)](/dotnet/framework/tools/mage-exe-manifest-generation-and-editing-tool)
- [MageUI.exe (средство создания и редактирования манифестов, графический клиент)](/dotnet/framework/tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client)
- [Программой](/windows/desktop/SecCrypto/makecert)
