---
title: Анализ кода с помощью анализаторов Roslyn
ms.date: 09/01/2020
description: Познакомьтесь с анализом исходного кода в Visual Studio. Узнайте об исправлениях кода и различных типах анализаторов и уровнях серьезности.
ms.custom: SEO-VS-2020
ms.topic: overview
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
- code analyzers
author: mikadumont
ms.author: midumont
manager: jmartens
ms.workload:
- dotnet
ms.openlocfilehash: d6a295e4abc62a7591c98b92cad4c173c5ff507b
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99859805"
---
# <a name="overview-of-source-code-analysis"></a>Обзор анализа исходного кода

Анализаторы .NET Compiler Platform (Roslyn) выполняют анализ стиля, качества, удобства, структуры и других характеристик кода C# или Visual Basic, а также выявляют проблемы в нем. Эта проверка или анализ выполняется во время разработки во всех открытых файлах.

Анализаторы можно разбить на следующие группы.

- Анализаторы [стиля кода](/dotnet/fundamentals/code-analysis/code-style-rule-options?preserve-view=true&view=vs-2019#convention-categories) встроены в Visual Studio. Идентификатор диагностики или код для этих анализаторов имеет формат IDExxxx, например IDE0067. Вы можете настроить параметры на [странице параметров текстового редактора](../ide/code-styles-and-code-cleanup.md) или в [файле EditorConfig](/dotnet/fundamentals/code-analysis/code-style-rule-options). Начиная с .NET 5.0, анализаторы стиля кода включены в пакет SDK для .NET и могут строго рассматриваться как предупреждения или ошибки сборки. Дополнительные сведения см. [здесь](/dotnet/fundamentals/productivity/code-analysis#code-style-analysis).

- Анализаторы [качества кода](/dotnet/fundamentals/code-analysis/quality-rules/index) теперь доступны в пакете SDK для .NET 5 и включены по умолчанию. Идентификатор диагностики или код для этих анализаторов имеет формат CAxxxx, например CA1822. Дополнительные сведения см. в разделе об [анализе качества кода](/dotnet/fundamentals/productivity/code-analysis#code-quality-analysis).

- Вы можете установить сторонние анализаторы в виде пакета NuGet или расширения Visual Studio. Анализаторы сторонних разработчиков, такие как [StyleCop](https://www.nuget.org/packages/StyleCop.Analyzers/), [Roslynator](https://www.nuget.org/packages/Roslynator.Analyzers/), [XUnit Analyzers](https://www.nuget.org/packages/xunit.analyzers/) и [Sonar Analyzer](https://www.nuget.org/packages/SonarAnalyzer.CSharp/).

## <a name="severity-levels-of-analyzers"></a>Уровни серьезности анализаторов

У каждого анализатора есть один из следующих уровней серьезности:

| Уровень серьезности (Обозреватель решений) | Уровень серьезности (файл EditorConfig) | Реакция на событие во время сборки | Реакция на событие редактора |
|-|-|-|
| Ошибка | `error` | Нарушения отображаются как *ошибки* в списке ошибок и в выходных данных сборки из командной строки и приводят к сбою сборок.| Соответствующий код ошибки подчеркнут красной волнистой линией и отмечен небольшой красной рамкой в полосе прокрутки. |
| Предупреждение | `warning` | Нарушения отображаются как *предупреждения* в списке ошибок и в выходных данных сборки из командной строки, но не приводят к сбою сборок. | Соответствующий код подчеркнут зеленой волнистой линией и отмечен небольшой зеленой рамкой в полосе прокрутки. |
| Сведения | `suggestion` | Нарушения отображаются как *сообщения* в списке ошибок и отсутствуют в выходных данных сборки из командной строки. | Соответствующий код подчеркнут серой волнистой линией и отмечен небольшой серой рамкой в полосе прокрутки. |
| Скрытый | `silent` | Невидимая для пользователя. | Невидимая для пользователя. Тем не менее данные диагностики передаются в обработчик диагностики IDE. |
| Нет | `none` | Полностью подавлена. | Полностью подавлена. |
| По умолчанию | `default` | Соответствует стандартному уровню серьезности правила. Чтобы определить, какое значение по умолчанию используется для правила, просмотрите окно свойств. | Соответствует стандартному уровню серьезности правила. |

Если анализатор обнаруживает нарушения правил, они помечаются в редакторе кода (*волнистая линия* под соответствующим кодом) и в окне "Список ошибок".

![Нарушение анализатора в окне "Список ошибок"](../code-quality/media/code-analysis-error-list.png)

Нарушения анализаторов, приведенные в списке ошибок, соответствуют [уровню серьезности](../code-quality/use-roslyn-analyzers.md#configure-severity-levels) правила. Нарушения анализаторов выделяются в редакторе кода с помощью волнистых линий под соответствующим кодом. На следующем рисунке показаны три нарушения &mdash; одна ошибка (красная волнистая линия), одно предупреждение (зеленая волнистая линия) и одно предложение (три серые точки):

![Волнистые линии в редакторе кода в Visual Studio](media/diagnostics-severity-colors.png)

Многие правила анализатора или *диагностические средства* имеют одно или несколько связанных *исправлений кода*, которые можно применить для устранения нарушения правила. Исправления кода отображаются в меню со значком лампочки вместе с другими типами [быстрых действий](../ide/quick-actions.md). Сведения об этих исправлениях кода см. в разделе [Распространенные быстрые действия](../ide/quick-actions.md).

![Нарушение анализа и исправление кода быстрого действия](../code-quality/media/built-in-analyzer-code-fix.png)

## <a name="configure-analyzer-severity-levels"></a>Настройка уровней серьезности анализатора

Вы можете настроить уровни серьезности правил анализатора или *данные диагностики* в [файле EditorConfig](../code-quality/use-roslyn-analyzers.md#set-rule-severity-in-an-editorconfig-file) или в [меню лампочки](../code-quality/use-roslyn-analyzers.md#set-rule-severity-from-the-light-bulb-menu).

Анализаторы также можно настроить для проверки кода во время сборки и в реальном времени по мере ввода. Можно настроить область выполнения динамического анализа кода только для текущего документа, для всех открытых документов или для всего решения. См. практическое руководство по [ Настройка области динамического анализа кода](./configure-live-code-analysis-scope-managed-code.md).

> [!TIP]
> Ошибки и предупреждения времени сборки из анализаторов кода отображаются только в том случае, если анализаторы установлены как пакет NuGet. Встроенные анализаторы (например, IDE0067 и IDE0068) никогда не запускаются во время сборки.

## <a name="nuget-package-versus-vsix-extension"></a>Сравнение пакета NuGet и расширения VSIX

Сторонние анализаторы можно установить для отдельного проекта с помощью пакета NuGet. Некоторые из них также доступны в виде расширения Visual Studio. В этом случае они применяются к любому решению, открытому в Visual Studio. Между этими двумя способами [установки анализаторов](../code-quality/install-roslyn-analyzers.md) существуют некоторые ключевые различия.

### <a name="scope"></a>Область

Если анализаторы устанавливаются как расширение Visual Studio, они применяются на уровне решения и ко всем экземплярам Visual Studio. Если анализаторы устанавливаются в виде пакета NuGet, что является предпочтительным, они применяются только к проекту, где установлен данный пакет NuGet. В командных окружениях анализаторы, установленные как пакеты NuGet, входят в область для *всех разработчиков*, работающих над этим проектом.

### <a name="build-errors"></a>Ошибки сборки

Чтобы применить правила во время сборки, например с помощью командной строки или в составе сборки непрерывной интеграции (CI), выберите один из следующих вариантов:

- Создайте проект .NET 5.0, который содержит анализаторы по умолчанию в пакете SDK для .NET. Для проектов, предназначенных для .NET 5.0 или более поздней версии анализ кода включен по умолчанию. Вы можете включить анализ кода для проектов, предназначенных для более ранних версий .NET, задав для свойства [EnableNETAnalyzers](/dotnet/core/project-sdk/msbuild-props#enablenetanalyzers) значение true.

- Установите анализаторы в качестве пакета NuGet. Если установить анализатор как расширение, его предупреждения и ошибки не будут отображаться в отчете о сборке.

На следующем изображении показаны выходные данные сборки из командной строки для создания проекта, содержащего нарушение правила анализа:

![Выходные данные MSBuild с нарушением правила](media/command-line-build-analyzers.png)

### <a name="rule-severity"></a>Важность правил

Вы не можете настроить важность правил из анализаторов, которые были установлены как расширение Visual Studio. Чтобы настроить [важность правила](../code-quality/use-roslyn-analyzers.md#configure-severity-levels), установите анализаторы как пакет NuGet.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Установка анализаторов кода в Visual Studio](../code-quality/install-roslyn-analyzers.md)

> [!div class="nextstepaction"]
> [Использование анализаторов кода в Visual Studio](../code-quality/use-roslyn-analyzers.md)

## <a name="see-also"></a>См. также

- [Часто задаваемые вопросы по анализаторам](analyzers-faq.md)
- [Написание собственного анализатора кода](../extensibility/getting-started-with-roslyn-analyzers.md)
- [Пакет SDK для .NET Compiler Platform](/dotnet/csharp/roslyn-sdk/)