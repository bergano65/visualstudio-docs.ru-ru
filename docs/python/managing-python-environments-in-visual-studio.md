---
title: Управление окружениями и интерпретаторами Python
description: Окно окружений Python позволяет управлять глобальными и виртуальными окружениями, а также окружениями conda, установкой интерпретаторов и пакетов Python, а также назначением окружений для проектов Visual Studio.
ms.date: 12/07/2018
ms.topic: conceptual
author: kraigb
ms.author: kraigb
manager: jillfra
ms.workload:
- python
- data-science
ms.openlocfilehash: 4514aa132adab37425d0d49c4594fec8db09d12d
ms.sourcegitcommit: 34940a18f5b03a59567f54c7024a0b16d4272f1e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2019
ms.locfileid: "56155725"
---
# <a name="how-to-create-and-manage-python-environments-in-visual-studio"></a>Как создавать окружения Python в Visual Studio и управлять ими

*Окружение* Python представляет собой контекст, в котором выполняется код Python. Различают глобальные, виртуальные окружения и окружения Conda. Окружение состоит из интерпретатора, библиотеки (обычно это стандартная библиотека Python) и нескольких установленных пакетов. Вместе они определяют, какие языковые конструкции и синтаксис допустимы, какие возможности операционной системы доступны и какие пакеты можно использовать.

В Visual Studio для Windows есть окно **Окружения Python**, которое позволяет управлять окружениями и выбрать одно из них в качестве окружения по умолчанию для новых проектов. Все это мы рассмотрим в этой статье. Другие связанные с окружениями аспекты описаны в следующих статьях:

- Для каждого конкретного проекта можно [выбрать конкретное окружение](selecting-a-python-environment-for-a-project.md) вместо варианта по умолчанию.

- Дополнительные сведения о создании и использовании виртуальных окружений для проектов Python см. в разделе [Использование виртуальных окружений](selecting-a-python-environment-for-a-project.md#use-virtual-environments).

- Если вы хотите установить пакеты в окружении, см. [справочник по вкладке "Пакеты"](python-environments-window-tab-reference.md#packages-tab).

- Чтобы установить другой интерпретатор Python, см. раздел [Установка интерпретаторов Python](installing-python-interpreters.md). Как правило, если вы скачиваете и запускаете установщик для основного дистрибутива Python, Visual Studio обнаруживает эту новую установку, это окружение отображается в окне **Окружения Python** и может быть выбрано для проектов.

Если вы только начинаете работу с Python в Visual Studio, можете ознакомиться с базовыми сведениями в следующих статьях:

- [Работа с Python в Visual Studio](overview-of-python-tools-for-visual-studio.md)
- [Установка поддержки Python в Visual Studio](installing-python-support-in-visual-studio.md)

> [!Note]
> Вы не можете управлять окружениями для кода Python, который открыт только в качестве папки с помощью команды **Файл** > **Открыть** > **Папка**. В таком случае [создайте проект Python на основе существующего кода](quickstart-01-python-in-visual-studio-project-from-existing-code.md), чтобы использовать функции окружения Visual Studio.

## <a name="the-python-environments-window"></a>Окно "Окружения Python"

*(Приведенные в этом разделе снимки экрана представляют Visual Studio 15.8. Пользовательский интерфейс может немного отличаться в зависимости от используемой версии Visual Studio.)*

Окружения, обнаруженные Visual Studio, отображаются в окне **Окружения Python**. Чтобы открыть это окно, используйте один из следующих методов:

- Выберите команду меню **Просмотр** > **Другие окна** > **Окружения Python**.
- В **обозревателе решений** щелкните правой кнопкой мыши узел **Окружения Python** в нужном проекте и выберите **Просмотреть все окружения Python**.

    ![Команда View All Python Environments (Показать все среды Python) в обозревателе решений](media/environments-view-all.png)

В любом случае окно **Окружения Python** открывается на одном уровне с **обозревателем решений**.

![Окно со средами Python](media/environments-default-view.png)

Visual Studio ищет установленные глобальные окружения с помощью реестра (следуя по [PEP 514](https://www.python.org/dev/peps/pep-0514/)), а также виртуальные окружения и окружения Conda (см. [Типы окружений](#types-of-environments)). Если нужное окружение не отображается в списке, ознакомьтесь с разделом [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

При выборе окружения в списке на вкладке **Обзор** Visual Studio отображаются различные свойства и команды для этого окружения. Например, как видно на рисунке выше, интерпретатор находится в папке *C:\Python36-32*. Четыре команды в нижней части вкладки **Обзор** открывают командную строку с выполняющимся интерпретатором. Дополнительные сведения см. в статье [Справочная информация по вкладкам окна "Окружения Python" — обзор](python-environments-window-tab-reference.md#overview-tab).

Используйте раскрывающийся список под списком окружений для перехода к различным вкладкам, таким как **Пакеты** и **IntelliSense**. Эти вкладки также описаны в [справочнике по вкладкам окна "Окружения Python"](python-environments-window-tab-reference.md).

Выбор окружения не приводит к изменению его связи с любыми проектами. Окружение по умолчанию, выделенное полужирным шрифтом в списке, используется Visual Studio для любых новых проектов. Чтобы использовать другое окружение для новых проектов, используйте команду **Назначить это окружение по умолчанию для новых проектов**. В контексте проекта всегда можно выбрать конкретное окружение. Дополнительные сведения см. в разделе о [выборе окружения для проекта](selecting-a-python-environment-for-a-project.md).

Справа от каждого окружения в списке есть элемент управления, который позволяет открыть **интерактивное** окно для этого окружения. (В Visual Studio 2017 версии 15.5 и более ранних версий также может отображаться еще один элемент управления, отвечающий за обновление базы данных IntelliSense для этого окружения. Дополнительные сведения о базе данных см. в [справочнике по вкладкам окна "Окружения"](python-environments-window-tab-reference.md#intellisense-tab).)

> [!Tip]
> Если окно **Окружения Python** развернуто достаточно широко, вы получите более полное представление окружений. Такой вариант может оказаться для вас более удобным.
>
> ![Развернутое окно Python Environments (Среды Python)](media/environments-expanded-view.png)

> [!Note]
> Несмотря на то что Visual Studio учитывает параметр system-site-packages, его нельзя изменить из среды Visual Studio.

### <a name="what-if-no-environments-appear"></a>Что делать, если окружения не отображаются?

Если окружения не отображаются, значит Visual Studio не удалось обнаружить ни одной установки Python в стандартных расположениях. Такое может случиться, если после установки Visual Studio 2017 вы очистили все параметры интерпретаторов в настройках установщика для рабочей нагрузки Python. Возможно, вы не установили интерпретатор для Visual Studio 2015 или более ранней версии. Дополнительные сведения см. в статье [Установка интерпретаторов Python](installing-python-interpreters.md).

Если вы точно знаете, что на компьютере установлен интерпретатор Python, но Visual Studio (любая версия) не может его обнаружить, укажите его расположение вручную с помощью команды **+ Настраиваемый**. Дополнительные сведения см. в следующем разделе [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

> [!Tip]
> Visual Studio обнаруживает обновления для существующих интерпретаторов, например обновление Python 2.7.11 до версии 2.7.14, с помощью установщиков с сайта python.org. В процессе установки старое окружение исчезнет из списка **Окружения Python**, прежде чем на его месте появится обновленная версия.
>
> Но если вы переместите интерпретатор и его окружение вручную с помощью средств файловой системы, Visual Studio не сможет узнать его новое расположение. Дополнительные сведения см. в статье [Перемещение интерпретатора](installing-python-interpreters.md#move-an-interpreter).

### <a name="types-of-environments"></a>Типы окружений

Visual Studio может работать с глобальными, виртуальными окружениями и окружениями Conda.

#### <a name="global-environments"></a>Глобальные среды

Каждая установка Python (например, Python 2.7, Python 3.6, Python 3.7, Anaconda 4.4.0 и т. п.) поддерживает собственное *глобальное окружение*. См. статью [Установка интерпретаторов Python](installing-python-interpreters.md). Каждое окружение состоит из определенного интерпретатора Python, его стандартной библиотеки, набора предварительно установленных пакетов и любых дополнительных пакетов, устанавливаемых при активации этого окружения. Установив пакет в глобальном окружении, мы предоставляем к нему доступ для всех проектов, в которых оно используется. Если окружение находится в защищенной области файловой системы (например, в *C:\Program files*), для установки пакетов требуются права администратора.

Глобальные окружения доступны для всех проектов на компьютере. В Visual Studio вы можете выбрать одно глобальное окружение по умолчанию, которое будет использоваться для всех проектов, если вы не укажете другое для определенного проекта. Дополнительные сведения см. в разделе о [выборе окружения для проекта](selecting-a-python-environment-for-a-project.md).

#### <a name="virtual-environments"></a>Виртуальные среды

Хотя работа в глобальном окружении проста и удобна для начала, со временем это окружение станет загромождено множеством разных пакетов, установленных вами для различных проектов. Такой беспорядок затрудняет тщательное тестирование приложения с использованием определенного набора пакетов с известными версиями, что в точности соответствует среде, которую вы можете настроить на сервере сборки или веб-сервере. Когда двум проектам требуются несовместимые пакеты или разные версии одного пакета, могут возникать конфликты.

По этой причине разработчики часто создают для проекта *виртуальное окружение*. Виртуальное окружение представляет собой вложенную папку в проекте, содержащую копию конкретного интерпретатора. При активации виртуального окружения все устанавливаемые вами пакеты устанавливаются только во вложенной папке этого окружения. При последующем запуске программы Python в этом окружении вы знаете, что она выполняется с использованием только этих конкретных пакетов.

Visual Studio предоставляет прямую поддержку для создания виртуального окружения для проекта. Например, если открыть проект, содержащий файл *requirements.txt*, или создать проект из шаблона, который включает этот файл, Visual Studio предложит автоматически создать виртуальное окружение и установить эти зависимости.

Вы можете создать виртуальное окружение в открытом проекте в любой момент. В **обозревателе решений** разверните узел проекта, щелкните правой кнопкой мыши элемент **Окружения Python** и выберите "Добавить виртуальное окружение". Дополнительные сведения см. в разделе [Создание виртуального окружения](selecting-a-python-environment-for-a-project.md#create-a-virtual-environment).

В Visual Studio также доступна команда для создания файла *requirements.txt* из виртуального окружения, что позволяет легко воссоздать окружение на других компьютерах. См. дополнительные сведения о [виртуальных окружениях](selecting-a-python-environment-for-a-project.md#use-virtual-environments).

#### <a name="conda-environments"></a>Окружения Conda

Окружение conda создается с помощью средства `conda` или интегрированного управления conda в Visual Studio 2017 версии 15.7 и более поздних версий. (Требуется Anaconda или Miniconda; Anaconda можно установить через установщик Visual Studio, см. раздел [Установка — Visual Studio 2017](installing-python-support-in-visual-studio.md#visual-studio-2017).)

1. Выберите **+ Создать окружение conda** в окне **Окружения Python**, чтобы открыть вкладку **Создать новое окружение conda**:

    ![Создание вкладки для нового окружения conda](media/environments-conda-1.png)

1. Введите имя окружения в поле **Имя**, выберите базовый интерпретатор Python в поле **Python** и нажмите **Создать**.

1. В окне **Вывод** отображается ход выполнения для нового окружения с несколькими инструкциями CLI после завершения создания:

    ![Успешное создание окружения conda](media/environments-conda-2.png)

1. В Visual Studio можно активировать окружение conda для проекта так же, как любое другое окружение, как описано в статье [Выбор окружения для проекта](selecting-a-python-environment-for-a-project.md).

1. Установить пакеты в окружении можно на вкладке [Пакеты](python-environments-window-tab-reference.md#packages-tab).

> [!Note]
> Для оптимальной работы с окружениями conda используйте conda 4.4.8 или более поздней версии (версии conda отличаются от версий Anaconda). Установка Anaconda 5.1 из установщика Visual Studio 2017

Чтобы просмотреть версию conda, в которой хранятся окружения conda, и другие сведения, запустите `conda info` в командной строке Anaconda (то есть в командной строке, в пути которой указана Anaconda):

```cli
conda info
```

Папки окружения conda будут выглядеть следующим образом:

```output
       envs directories : c:\anaconda3\envs
                          C:\Users\user\AppData\Local\conda\conda\envs
                          C:\Users\user\.conda\envs
```

Поскольку окружения conda не хранятся в проекте, они работают как глобальные среды. Например, если установить пакет в окружении Conda, он станет доступным для всех проектов, в которых используется это окружение.

Для Visual Studio 2017 версии 15.6 и более ранних версий можно использовать окружения conda, указав на них вручную, как описано в разделе [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

Visual Studio 2017 версии 15.7 и более поздних версий обнаруживает окружения conda автоматически и отображает их в окне **Окружения Python**, как описано в следующем разделе.

## <a name="manually-identify-an-existing-environment"></a>Указание существующего окружения вручную

Чтобы указать окружение (в том числе окружение Conda в Visual Studio 2017 версии 15.6 и более ранних версий), установленное в нестандартном расположении, выполните следующие действия:

1. Выберите **+ Настраиваемое** в окне **Окружения Python**, чтобы открыть вкладку **Настройка**:

    ![Представление по умолчанию для новой настраиваемой среды](media/environments-custom-1.png)

1. Введите имя среды в поле **Описание**.

1. Введите путь к интерпретатору или найдите его (с помощью кнопки **...**) в поле **Префикс пути**.

1. Если Visual Studio обнаружит интерпретатор Python в этом расположении (ниже представлен пример пути к окружению Conda), команда **Автоматическое определение** станет активна. Если выбрать **Автоматическое определение**, все оставшиеся поля заполняются автоматически. Также вы можете заполнить эти поля вручную.

    ![Включение команды автоматического определения](media/environments-custom-2.png)

    ![Заполнение полей сведениями об окружении с помощью автоматического определения](media/environments-custom-3.png)

1. Когда все поля будут заполнены нужными значениями, щелкните **Применить**, чтобы сохранить конфигурацию. Теперь это окружение можно использовать в Visual Studio так же, как и остальные.

1. Если потребуется удалить окружение, которое вы указали вручную, щелкните команду **Удалить** на вкладке **Настройка**. Для автоматически обнаруженных сред этот параметр не предлагается. Дополнительные сведения см. в [описании вкладки "Настройка"](python-environments-window-tab-reference.md#configure-tab).

## <a name="fix-or-delete-invalid-environments"></a>Исправление или удаление недопустимых сред

Если Visual Studio находит записи реестра для среды, но путь к интерпретатору недопустим, в окне **Окружения Python** отображается зачеркнутое имя.

![Окно сред Python с недопустимой средой](media/environments-invalid-entry.png)

Чтобы исправить нужную среду, попробуйте сначала использовать процесс **исправления** в установщике. Такая возможность есть, например, в установщиках для стандартной версии Python 3.x.

Чтобы исправить среду, у которой нет возможности исправления, или удалить недопустимую среду, следуйте инструкциям ниже и измените реестр напрямую. Visual Studio автоматически обновляет окно **Окружения Python** при внесении изменений в реестр.

1. Запустите файл *regedit.exe*.
1. Перейдите к **HKEY_LOCAL_MACHINE\SOFTWARE\Python** в случае 32-разрядных интерпретаторов или **HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Python** — в случае 64-разрядных. Если используется IronPython, вместо этого ищите **IronPython**.
1. Разверните узел, соответствующий дистрибутиву, например **PythonCore** в случае CPython или **ContinuumAnalytics** в случае Anaconda. Если используется IronPython, разверните узел номера версии.
1. Проверьте значения в узле **InstallPath**.

    ![Записи реестра для обычной установки CPython](media/environments-registry-entries.png)

    - Если среда по-прежнему существует на компьютере, измените значение **ExecutablePath** на правильное расположение. Также исправьте значения **(Default)** и **WindowedExecutablePath** требуемым образом.
    - Если среда больше не существует на компьютере и вы хотите удалить ее из окна **Окружения Python**, удалите родительский узел **InstallPath**, например **3.6** на приведенном выше рисунке.

## <a name="see-also"></a>См. также

- [Установка интерпретаторов Python](installing-python-interpreters.md)
- [Выбор интерпретатора для проекта](selecting-a-python-environment-for-a-project.md)
- [Использование файла requirements.txt для зависимостей](managing-required-packages-with-requirements-txt.md)
- [Пути поиска](search-paths.md)
- [Справочная информация по окну "Окружения Python"](python-environments-window-tab-reference.md)
