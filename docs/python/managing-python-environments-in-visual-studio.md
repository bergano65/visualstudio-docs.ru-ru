---
title: Управление окружениями и интерпретаторами Python
description: Окно окружений Python позволяет управлять глобальными и виртуальными окружениями, а также окружениями conda, установкой интерпретаторов и пакетов Python, а также назначением окружений для проектов Visual Studio.
ms.date: 08/06/2019
ms.topic: how-to
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- python
- data-science
ms.openlocfilehash: efd75e79d7c015539dfe045f7b0a3b266cfb4756
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99923756"
---
# <a name="how-to-create-and-manage-python-environments-in-visual-studio"></a>Как создавать окружения Python в Visual Studio и управлять ими

**Окружение Python** представляет собой контекст, в котором выполняется код Python. Различают глобальные, виртуальные окружения и окружения Conda. Окружение состоит из интерпретатора, библиотеки (обычно это стандартная библиотека Python) и нескольких установленных пакетов. Вместе они определяют, какие языковые конструкции и синтаксис допустимы, какие возможности операционной системы доступны и какие пакеты можно использовать.

В Visual Studio для Windows есть окно **Окружения Python**, которое позволяет управлять окружениями и выбрать одно из них в качестве окружения по умолчанию для новых проектов. Все это мы рассмотрим в этой статье. Другие связанные с окружениями аспекты описаны в следующих статьях:

- Для каждого конкретного проекта можно [выбрать конкретное окружение](selecting-a-python-environment-for-a-project.md) вместо варианта по умолчанию.

- Дополнительные сведения о создании и использовании виртуальных окружений для проектов Python см. в разделе [Использование виртуальных окружений](selecting-a-python-environment-for-a-project.md#use-virtual-environments).

- Если вы хотите установить пакеты в окружении, см. [справочник по вкладке "Пакеты"](python-environments-window-tab-reference.md#packages-tab).

- Чтобы установить другой интерпретатор Python, см. раздел [Установка интерпретаторов Python](installing-python-interpreters.md). Как правило, если вы скачиваете и запускаете установщик для основного дистрибутива Python, Visual Studio обнаруживает эту новую установку, это окружение отображается в окне **Окружения Python** и может быть выбрано для проектов.

Если вы только начинаете работу с Python в Visual Studio, можете ознакомиться с базовыми сведениями в следующих статьях:

- [Работа с Python в Visual Studio](overview-of-python-tools-for-visual-studio.md)
- [Установка поддержки Python в Visual Studio](installing-python-support-in-visual-studio.md)

::: moniker range="vs-2017"
> [!Note]
> Вы не можете управлять окружениями для кода Python, который открыт только в качестве папки с помощью команды **Файл** > **Открыть** > **Папка**. В таком случае [создайте проект Python на основе существующего кода](quickstart-01-python-in-visual-studio-project-from-existing-code.md), чтобы использовать функции окружения Visual Studio.
::: moniker-end

::: moniker range=">=vs-2019"
> [!Note]
> Вы можете управлять окружениями для кода Python, который открыт в качестве папки с помощью команды **Файл** > **Открыть** > **Папка**. Панель инструментов Python позволяет переключаться между всеми обнаруженными окружениями, а также добавлять новые окружения. Сведения об окружении хранятся в файле PythonSettings.json в папке .vs рабочей области.
::: moniker-end

## <a name="the-python-environments-window"></a>Окно "Окружения Python"

Окружения, обнаруженные Visual Studio, отображаются в окне **Окружения Python**. Чтобы открыть это окно, используйте один из следующих методов:

- Выберите команду меню **Просмотр** > **Другие окна** > **Окружения Python**.
- В **обозревателе решений** щелкните правой кнопкой мыши узел **Окружения Python** в нужном проекте и выберите **Просмотреть все окружения Python**.

    ::: moniker range="vs-2017"
    ![Команда View All Python Environments (Показать все среды Python) в обозревателе решений](media/environments/environments-view-all.png)
    ::: moniker-end
    ::: moniker range=">=vs-2019"
    ![Команда View All Python Environments (Показать все среды Python) в обозревателе решений](media/environments/environments-view-all-2019.png)
    ::: moniker-end

В любом случае окно **Окружения Python** открывается на одном уровне с **обозревателем решений**.

::: moniker range="vs-2017"
![Окно со средами Python](media/environments/environments-default-view.png)
::: moniker-end
::: moniker range=">=vs-2019"
![Окно со средами Python](media/environments/environments-default-view-2019.png)
::: moniker-end

Visual Studio ищет установленные глобальные окружения с помощью реестра (следуя по [PEP 514](https://www.python.org/dev/peps/pep-0514/)), а также виртуальные окружения и окружения Conda (см. [Типы окружений](#types-of-environments)). Если нужное окружение не отображается в списке, ознакомьтесь с разделом [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

При выборе окружения в списке на вкладке **Обзор** Visual Studio отображаются различные свойства и команды для этого окружения. Например, как видно на рисунке выше, интерпретатор находится в папке *C:\Python36-32*. Четыре команды в нижней части вкладки **Обзор** открывают командную строку с выполняющимся интерпретатором. Дополнительные сведения см. в статье [Справочная информация по вкладкам окна "Окружения Python" — обзор](python-environments-window-tab-reference.md#overview-tab).

Используйте раскрывающийся список под списком окружений для перехода к различным вкладкам, таким как **Пакеты** и **IntelliSense**. Эти вкладки также описаны в [справочнике по вкладкам окна "Окружения Python"](python-environments-window-tab-reference.md).

Выбор окружения не влияет на его связи с любыми проектами. Окружение по умолчанию, выделенное полужирным шрифтом в списке, используется Visual Studio для любых новых проектов. Чтобы использовать другое окружение для новых проектов, используйте команду **Назначить это окружение по умолчанию для новых проектов**. В контексте проекта всегда можно выбрать конкретное окружение. Дополнительные сведения см. в разделе о [выборе окружения для проекта](selecting-a-python-environment-for-a-project.md).

Справа от каждого окружения в списке есть элемент управления, который позволяет открыть **интерактивное** окно для этого окружения. (В Visual Studio 2017 версии 15.5 и более ранних версий также может отображаться еще один элемент управления, отвечающий за обновление базы данных IntelliSense для этого окружения. Дополнительные сведения о базе данных см. в [справочнике по вкладкам окна "Окружения"](python-environments-window-tab-reference.md).)

::: moniker range="vs-2017"
> [!Tip]
> Если окно **Окружения Python** развернуто достаточно широко, вы получите более полное представление окружений. Такой вариант может оказаться для вас более удобным.
>
> ![Развернутое окно Python Environments (Среды Python)](media/environments/environments-expanded-view.png)
::: moniker-end

::: moniker range=">=vs-2019"
> [!Tip]
> Если окно **Окружения Python** развернуто достаточно широко, вы получите более полное представление окружений. Такой вариант может оказаться для вас более удобным.
>
> ![Развернутое окно Python Environments (Среды Python)](media/environments/environments-expanded-view-2019.png)
::: moniker-end

> [!Note]
> Несмотря на то что Visual Studio учитывает параметр system-site-packages, его нельзя изменить из среды Visual Studio.

### <a name="what-if-no-environments-appear"></a>Что делать, если окружения не отображаются?

Если окружения не отображаются, значит Visual Studio не удалось обнаружить ни одной установки Python в стандартных расположениях. Такое может случиться, если после установки Visual Studio 2017 или более поздней версии вы очистили все параметры интерпретаторов в настройках установщика для рабочей нагрузки Python. Возможно, вы не установили интерпретатор для Visual Studio 2015 или более ранней версии. Дополнительные сведения см. в статье [Установка интерпретаторов Python](installing-python-interpreters.md).

Если вы точно знаете, что на компьютере установлен интерпретатор Python, но Visual Studio (любая версия) не может его обнаружить, укажите его расположение вручную с помощью команды **+ Настраиваемый**. Дополнительные сведения см. в следующем разделе [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

> [!Tip]
> Visual Studio обнаруживает обновления для существующих интерпретаторов, например обновление Python 2.7.11 до версии 2.7.14, с помощью установщиков с сайта python.org. В процессе установки старое окружение исчезнет из списка **Окружения Python**, прежде чем на его месте появится обновленная версия.
>
> Но если вы переместите интерпретатор и его окружение вручную с помощью средств файловой системы, Visual Studio не сможет узнать его новое расположение. Дополнительные сведения см. в статье [Перемещение интерпретатора](installing-python-interpreters.md#move-an-interpreter).

### <a name="types-of-environments"></a>Типы окружений

Visual Studio может работать с глобальными, виртуальными окружениями и окружениями Conda.

#### <a name="global-environments"></a>Глобальные среды

Каждая установка Python (например, Python 2.7, Python 3.6, Python 3.7, Anaconda 4.4.0 и т. п.) поддерживает собственное *глобальное окружение*. См. статью [Установка интерпретаторов Python](installing-python-interpreters.md). Каждое окружение состоит из определенного интерпретатора Python, его стандартной библиотеки, набора предварительно установленных пакетов и любых дополнительных пакетов, устанавливаемых при активации этого окружения. Установив пакет в глобальном окружении, мы предоставляем к нему доступ для всех проектов, в которых оно используется. Если окружение находится в защищенной области файловой системы (например, в *C:\Program files*), для установки пакетов требуются права администратора.

Глобальные окружения доступны для всех проектов на компьютере. В Visual Studio вы можете выбрать одно глобальное окружение по умолчанию, которое будет использоваться для всех проектов, если вы не укажете другое для определенного проекта. Дополнительные сведения см. в разделе о [выборе окружения для проекта](selecting-a-python-environment-for-a-project.md).

#### <a name="virtual-environments"></a>Виртуальные среды

Хотя работа в глобальном окружении проста и удобна для начала, со временем это окружение станет загромождено множеством разных пакетов, установленных вами для различных проектов. Такой беспорядок затрудняет тщательное тестирование приложения с использованием определенного набора пакетов с известными версиями, что в точности соответствует среде, которую вы можете настроить на сервере сборки или веб-сервере. Когда двум проектам требуются несовместимые пакеты или разные версии одного пакета, могут возникать конфликты.

По этой причине разработчики часто создают для проекта *виртуальное окружение*. Виртуальное окружение представляет собой вложенную папку в проекте, содержащую копию конкретного интерпретатора. При активации виртуального окружения все устанавливаемые вами пакеты устанавливаются только во вложенной папке этого окружения. При последующем запуске программы Python в этом окружении вы знаете, что она выполняется с использованием только этих конкретных пакетов.

Visual Studio предоставляет прямую поддержку для создания виртуального окружения для проекта. Например, если открыть проект, содержащий файл *requirements.txt*, или создать проект из шаблона, который включает этот файл, Visual Studio предложит автоматически создать виртуальное окружение и установить эти зависимости.

Вы можете создать виртуальное окружение в открытом проекте в любой момент. В **обозревателе решений** разверните узел проекта, щелкните правой кнопкой мыши элемент **Окружения Python** и выберите "Добавить виртуальное окружение". Дополнительные сведения см. в разделе [Создание виртуального окружения](./selecting-a-python-environment-for-a-project.md?view=vs-2019&preserve-view=true#create-a-virtual-environment-1).

В Visual Studio также доступна команда для создания файла *requirements.txt* из виртуального окружения, что позволяет легко воссоздать окружение на других компьютерах. См. дополнительные сведения о [виртуальных окружениях](selecting-a-python-environment-for-a-project.md#use-virtual-environments).

#### <a name="conda-environments"></a>Окружения Conda

Окружение conda создается с помощью средства `conda` или интегрированного управления conda в Visual Studio 2017 версии 15.7 и более поздних версий. (Требуется Anaconda или Miniconda, которые можно установить через Visual Studio Installer, подробнее см. в разделе [Установка](installing-python-support-in-visual-studio.md#visual-studio-2019-and-visual-studio-2017).)

::: moniker range="vs-2017"

1. Выберите **+ Создать окружение conda** в окне **Окружения Python**, чтобы открыть вкладку **Создать новое окружение conda**:

    ![Создание вкладки для нового окружения conda](media/environments/environments-conda-1.png)

1. Введите имя окружения в поле **Имя**, выберите базовый интерпретатор Python в поле **Python** и нажмите **Создать**.

1. В окне **Вывод** отображается ход выполнения для нового окружения с несколькими инструкциями CLI после завершения создания:

    ![Успешное создание окружения conda](media/environments/environments-conda-2.png)

1. В Visual Studio можно активировать окружение conda для проекта так же, как любое другое окружение, как описано в статье [Выбор окружения для проекта](selecting-a-python-environment-for-a-project.md).

1. Установить пакеты в окружении можно на вкладке [Пакеты](python-environments-window-tab-reference.md#packages-tab).
::: moniker-end

::: moniker range=">=vs-2019"

1. Выберите **+Добавить окружение** в окне **Окружения Python** (или на панели инструментов Python), чтобы открыть диалоговое окно **Добавление окружения**. В этом диалоговом окне выберите вкладку **Среда Conda**:

    ![Вкладка "Среда Conda" в диалоговом окне "Добавление окружения"](media/environments/environments-conda-1-2019.png)

1. Настройте следующие поля:

    | Поле | Описание |
    | --- | --- |
    | Проект | Проект, в котором вы создаете окружение (если в вашем решении Visual Studio есть несколько проектов). |
    | name | Имя среды Conda. |
    | Add packages from (Добавить пакеты из) | Выберите **Environment file** (Файл окружения), если у вас есть файл *environment.yml* с описанием зависимостей, или выберите **One or more Anaconda package names** (Имена одного или нескольких пакетов Anaconda) и отметьте хотя бы один пакет Python или версию Python в поле ниже. Этот список пакетов передает Conda задание на создание окружения Python. Чтобы установить последнюю версию Python, используйте `python`. Чтобы установить определенную версию, используйте `python=,major>.<minor>`, как показано в `python=3.7`. Кнопка пакета позволяет выбрать версии Python и общие пакеты из нескольких меню. |
    | Set as current environment (Установить в качестве текущего окружения) | После создания окружения активирует его в выбранном проекте. |
    | Set as default environment for new projects (Установить в качестве окружения по умолчанию для новых проектов) | Автоматически устанавливает среду Conda и активирует ее во всех новых проектах, которые создаются в Visual Studio. Этот параметр эквивалентен параметру **Make this the default environment for new projects** (Назначить это окружение по умолчанию для новых проектов) в окне **Окружения Python**. |
    | View in Python Environments window (Просмотреть в окне окружений Python) | Указывает, нужно ли отобразить окно **Окружения Python** после создания окружения. |

    > [!Important]
    > При создании среды Conda обязательно укажите хотя бы одну версию Python или пакет Python с помощью `environments.yml` или списка пакетов, чтобы окружение содержало среду выполнения Python. В противном случае Visual Studio игнорирует окружение, то есть оно не отображается в окне **Окружения Python** и его нельзя задать в качестве текущего окружения для проекта и глобального окружения.
    >
    > Если вы случайно создадите среду Conda без версии Python, выполните команду `conda info`, чтобы просмотреть расположения папок среды Conda и вручную удалите вложенную папку окружения из этого расположения.

1. Выберите **Создать** и отслеживайте ход выполнения в **окне вывода**. Выходные данные после завершения создания возвращают несколько инструкций CLI:

    ![Успешное создание окружения conda](media/environments/environments-conda-2-2019.png)

1. В Visual Studio можно активировать окружение conda для проекта так же, как любое другое окружение, как описано в статье [Выбор окружения для проекта](selecting-a-python-environment-for-a-project.md).

1. Чтобы установить дополнительные пакеты в окружении, воспользуйтесь вкладкой [Пакеты](python-environments-window-tab-reference.md#packages-tab).
::: moniker-end

> [!Note]
> Для оптимальной работы с окружениями conda используйте conda 4.4.8 или более поздней версии (версии conda отличаются от версий Anaconda). Вы можете установить подходящие версии Miniconda (Visual Studio 2019) и Anaconda (Visual Studio 2017) через установщик Visual Studio.

Чтобы просмотреть версию conda, в которой хранятся окружения conda, и другие сведения, запустите `conda info` в командной строке Anaconda (то есть в командной строке, в пути которой указана Anaconda):

```cli
conda info
```

Папки окружения conda будут выглядеть следующим образом:

```output
       envs directories : C:\Users\user\.conda\envs
                          c:\anaconda3\envs
                          C:\Users\user\AppData\Local\conda\conda\envs
```

Поскольку окружения conda не хранятся в проекте, они работают как глобальные среды. Например, если установить пакет в окружении Conda, он станет доступным для всех проектов, в которых используется это окружение.

Для Visual Studio 2017 версии 15.6 и более ранних версий можно использовать окружения conda, указав на них вручную, как описано в разделе [Указание существующего окружения вручную](#manually-identify-an-existing-environment).

Visual Studio 2017 версии 15.7 и более поздних версий обнаруживает окружения conda автоматически и отображает их в окне **Окружения Python**, как описано в следующем разделе.

## <a name="manually-identify-an-existing-environment"></a>Указание существующего окружения вручную

Чтобы указать окружение (в том числе окружение Conda в Visual Studio 2017 версии 15.6 и более ранних версий), установленное в нестандартном расположении, выполните следующие действия:

::: moniker range="vs-2017"

1. Выберите **+ Настраиваемое** в окне **Окружения Python**, чтобы открыть вкладку **Настройка**:

    ![Представление по умолчанию для новой настраиваемой среды](media/environments/environments-custom-1.png)

1. Введите имя среды в поле **Описание**.

1. Введите путь к интерпретатору или найдите его (с помощью кнопки **...** ) в поле **Префикс пути**.

1. Если Visual Studio обнаружит интерпретатор Python в этом расположении (ниже представлен пример пути к окружению Conda), команда **Автоматическое определение** станет активна. Если выбрать **Автоматическое определение**, все оставшиеся поля заполняются автоматически. Также вы можете заполнить эти поля вручную.

    ![Включение команды автоматического определения](media/environments/environments-custom-2.png)

    ![Заполнение полей сведениями об окружении с помощью автоматического определения](media/environments/environments-custom-3.png)

1. Когда все поля будут заполнены нужными значениями, щелкните **Применить**, чтобы сохранить конфигурацию. Теперь это окружение можно использовать в Visual Studio так же, как и остальные.

1. Если потребуется удалить окружение, которое вы указали вручную, щелкните команду **Удалить** на вкладке **Настройка**. Для автоматически обнаруженных сред этот параметр не предлагается. Дополнительные сведения см. в [описании вкладки "Настройка"](python-environments-window-tab-reference.md#configure-tab).

::: moniker-end

::: moniker range=">=vs-2019"

1. Выберите **+Добавить окружение** в окне **Окружения Python** (или на панели инструментов Python), чтобы открыть диалоговое окно **Добавление окружения**. В этом диалоговом окне выберите вкладку **Существующие среды**:

    ![Вкладка "Существующие среды" в диалоговом окне "Добавление окружения"](media/environments/environments-custom-1-2019.png)

1. Щелкните раскрывающийся список **Окружение** и выберите **Пользовательское**:

    ![Выбор пользовательского окружения в диалоговом окне "Добавление окружения"](media/environments/environments-custom-2-2019.png)

1. В предоставленных полях в диалоговом окне введите путь к интерпретатору (**Prefix path**) или найдите его с помощью кнопки **...** , и большинство других полей заполнятся автоматически. Просмотрите предложенные значения и измените их при необходимости, а затем щелкните **Добавить**.

    ![Поля для ввода данных о пользовательском окружении в диалоговом окне "Добавление окружения"](media/environments/environments-custom-3-2019.png)

1. Сведения об окружении можно просмотреть и изменить в любое время через окно **Окружения Python**. Выберите в этом окне нужное окружение и перейдите на вкладку **Настройка**. Внеся изменения, выберите команду **Применить**. Вы также можете удалить окружение с помощью команды **Удалить** (недоступно для автоматически обнаруженных сред). Дополнительные сведения см. в [описании вкладки "Настройка"](python-environments-window-tab-reference.md#configure-tab).
::: moniker-end

## <a name="fix-or-delete-invalid-environments"></a>Исправление или удаление недопустимых сред

Если Visual Studio находит записи реестра для среды, но путь к интерпретатору недопустим, в окне **Окружения Python** отображается зачеркнутое имя.

::: moniker range="vs-2017"
![Окно сред Python с недопустимой средой](media/environments/environments-invalid-entry.png)
::: moniker-end
::: moniker range=">=vs-2019"
![Окно сред Python с недопустимой средой](media/environments/environments-invalid-entry-2019.png)
::: moniker-end

Чтобы исправить нужную среду, попробуйте сначала использовать процесс **исправления** в установщике. Такая возможность есть, например, в установщиках для стандартной версии Python 3.x.

Чтобы исправить среду, у которой нет возможности исправления, или удалить недопустимую среду, следуйте инструкциям ниже и измените реестр напрямую. Visual Studio автоматически обновляет окно **Окружения Python** при внесении изменений в реестр.

1. Запустите файл *regedit.exe*.
1. Перейдите к разделу **HKEY_LOCAL_MACHINE\SOFTWARE\Python** или **HKEY_CURRENT_USER\SOFTWARE\Python**. Если используется IronPython, вместо этого ищите **IronPython**.
1. Разверните узел, соответствующий дистрибутиву, например **Python Core** для CPython или **ContinuumAnalytics** для Anaconda. Если используется IronPython, разверните узел номера версии.
1. Проверьте значения в узле **InstallPath**.

    ![Записи реестра для обычной установки CPython](media/environments/environments-registry-entries.png)

    - Если среда по-прежнему существует на компьютере, измените значение **ExecutablePath** на правильное расположение. Также исправьте значения **(Default)** и **WindowedExecutablePath** требуемым образом.
    - Если среда больше не существует на компьютере и вы хотите удалить ее из окна **Окружения Python**, удалите родительский узел **InstallPath**, например **3.6** на приведенном выше рисунке.
    - Недопустимые параметры в **HKEY_CURRENT_USER\SOFTWARE\Python** переопределяют параметры в **HKEY_LOCAL_MACHINE\SOFTWARE\Python**.

## <a name="see-also"></a>См. также

- [Установка интерпретаторов Python](installing-python-interpreters.md)
- [Выбор интерпретатора для проекта](selecting-a-python-environment-for-a-project.md)
- [Использование файла requirements.txt для зависимостей](managing-required-packages-with-requirements-txt.md)
- [Пути поиска](search-paths.md)
- [Справочная информация по окну "Окружения Python"](python-environments-window-tab-reference.md)