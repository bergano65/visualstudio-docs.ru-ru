---
title: Создание подключаемого модуля уровня запроса для веб-тестов производительности в Visual Studio | Документы Майкрософт
ms.date: 10/19/2016
ms.topic: conceptual
helpviewer_keywords:
- request-level plug-in, creating
- Web performance tests, requests
ms.assetid: d0b5b23c-7e94-4637-be6c-2620a5442d46
author: gewarren
ms.author: gewarren
manager: douge
ms.technology: vs-ide-test
ms.openlocfilehash: ea574f2f0c9b4d3f0f6da029433b5b600a400702
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="how-to-create-a-request-level-plug-in"></a>Практическое руководство. Создание подключаемого модуля уровня запроса

*Запросы* представляют собой декларативные операторы, образующие веб-тесты производительности. Подключаемые модули веб-теста производительности позволяют изолировать и повторно использовать код вне основных декларативных операторов веб-теста производительности. Можно создать подключаемые модули и добавить их к отдельному запросу, а также к веб-тесту производительности, в котором он содержится. Настраиваемый *подключаемый модуль запросов* обеспечивает способ вызова кода при выполнении конкретного запроса в веб-тесте производительности.

Каждый подключаемый модуль запросов веб-теста производительности имеет метод PreRequest и PostRequest. После прикрепления подключаемого модуля запросов к определенному HTTP-запросу событие PreRequest инициируется перед отправкой запроса, а событие PostRequest — после получения запроса.

Настроенные подключаемые модули запроса веб-теста производительности можно создать с помощью пользовательского класса, производного от базового класса <xref:Microsoft.VisualStudio.TestTools.WebTesting.WebTestRequestPlugin>.

Настроенные подключаемые модули запросов веб-теста производительности можно использовать с записанными веб-тестами производительности. Настроенные подключаемые модули запросов веб-теста производительности позволяют сократить до минимума объем создаваемого пользователем кода для достижения более высокого уровня управления веб-тестами производительности. Также они используются с закодированными веб-тестами производительности. См. раздел [Создание и запуск закодированного веб-теста производительности](../test/generate-and-run-a-coded-web-performance-test.md).

## <a name="to-create-a-request-level-plug-in"></a>Создание подключаемого модуля уровня запроса

1.  В обозревателе решений щелкните решение правой кнопкой мыши,  выберите пункт **Добавить**, а затем **Новый проект**.

     Откроется диалоговое окно **Добавление нового проекта**.

2.  В области **Установленные шаблоны** выберите **Visual C#**.

3.  В списке шаблонов выберите элемент **Библиотека классов**.

4.  В текстовом поле **Имя** введите имя класса и нажмите кнопку **ОК**.

     Новый проект библиотеки классов будет добавлен в обозреватель решений, а новый класс появится в редакторе кода.

5.  В обозревателе решений щелкните правой кнопкой мыши папку **Ссылки** в новой библиотеке классов и выберите команду **Добавить ссылку**.

     Появится диалоговое окно **Добавление ссылки**.

6.  Перейдите на вкладку **.NET**, прокрутите вниз, выберите пункт **Microsoft.VisualStudio.QualityTools.WebTestFramework** и нажмите кнопку **ОК**.

     Ссылка на **Microsoft.VisualStudio.QualityTools.WebTestFramework** будет добавлена в папку **Ссылки** в обозревателе решений.

7.  В обозревателе решений щелкните правой кнопкой мыши верхний узел проекта веб-тестов производительности и нагрузочных тестов, содержащего нагрузочный тест, в который требуется добавить подключаемый модуль теста запроса веб-теста производительности. Выберите команду **Добавить ссылку**.

     Появится диалоговое окно **Добавление ссылки**.

8.  Перейдите на вкладку **Проекты**, выберите проект библиотеки классов и нажмите кнопку **ОК**.

9. Напишите код подключаемого модуля в редакторе кода. Сначала создайте открытый класс, производный от класса <xref:Microsoft.VisualStudio.TestTools.WebTesting.WebTestRequestPlugin>.

10. Реализуйте код внутри одного или обоих обработчиков событий <xref:Microsoft.VisualStudio.TestTools.WebTesting.WebTestRequestPlugin.PreRequest*> и <xref:Microsoft.VisualStudio.TestTools.WebTesting.WebTestRequestPlugin.PostRequest*>. Образец реализации см. в приведенном ниже разделе "Пример".

11. После написания кода выполните построение нового проекта.

12. Откройте веб-тест производительности, к которому необходимо добавить подключаемый модуль запросов.

13. Щелкните правой кнопкой мыши запрос, к которому требуется добавить подключаемый модуль запросов, и выберите команду **Добавить подключаемый модуль запросов**.

     Откроется диалоговое окно **Добавить подключаемый модуль запросов веб-теста**.

14. В области **Выберите подключаемый модуль** выберите новый подключаемый модуль.

15. В области **Свойства выбранного подключаемого модуля** задайте начальные значения для подключаемого модуля, которые будут использоваться во время выполнения.

    > [!NOTE]
    > С помощью подключаемых модулей можно предоставить доступ к произвольному количеству свойств; их необходимо сделать общедоступными, задаваемыми и относящимися к базовому типу, например к целочисленному, логическому или строковому. Кроме того, свойства подключаемого модуля веб-теста производительности можно изменить позже в окне "Свойства".

16. Нажмите кнопку **ОК**.

     Подключаемый модуль добавляется в папку **Подключаемые модули запросов**, которая является дочерней папкой HTTP-запроса.

    > [!WARNING]
    > При запуске веб-теста производительности или нагрузочного теста, использующего данный подключаемый модуль, может появиться ошибка примерно следующего вида:
    >
    > **Сбой запроса. Исключение в событии \<подключаемый модуль>: не удалось загрузить файл или сборку "Файл \<"Имя подключаемого модуля".dll>, Version=\<n.n.n.n>, Culture=neutral, PublicKeyToken=null" или одну из зависимостей. Не удается найти указанный файл.**
    >
    > Это происходит, если в один из подключаемых модулей внесены изменения кода и создана новая версия библиотеки DLL **(Version=0.0.0.0)**, однако подключаемый модуль по-прежнему ссылается на исходную версию подключаемого модуля. Чтобы устранить эту проблему, выполните следующие действия.
    >
    > 1.  В ссылках проекта веб-тестов производительности и нагрузочных тестов появится предупреждение. Удалите и вновь добавьте ссылку на библиотеку DLL подключаемого модуля.
    > 2.  Удалите подключаемый модуль из теста или соответствующего расположения, а затем снова добавьте его.

## <a name="example"></a>Пример

С помощью показанного ниже кода можно создать настраиваемый подключаемый модуль веб-теста производительности, который отображается в двух диалоговых окнах. В первом диалоговом окне отображается URL-адрес, связанный с запросов, к которому добавляется подключаемый модуль запросов. Во втором окне отображается имя компьютера агента.

> [!NOTE]
> В следующем фрагменте кода необходимо добавить ссылку на System.Windows.Forms.

```csharp
using System;
using System.Collections.Generic;
using System.Windows.Forms;
using Microsoft.VisualStudio.TestTools.WebTesting;

namespace RequestPluginNamespace
{
    public class MyWebRequestPlugin : WebTestRequestPlugin
    {
        public override void PostRequest(object sender, PostRequestEventArgs e)
        {
            MessageBox.Show(e.WebTest.Context.AgentName);
        }
        public override void PreRequest(object sender, PreRequestEventArgs e)
        {
            MessageBox.Show(e.Request.Url);
        }
    }
}
```

## <a name="see-also"></a>См. также

- <xref:Microsoft.VisualStudio.TestTools.WebTesting.WebTestRequestPlugin>
- [Создание пользовательского кода и подключаемых модулей для нагрузочных тестов](../test/create-custom-code-and-plug-ins-for-load-tests.md)
- [Кодирование пользовательского правила извлечения для веб-теста производительности](../test/code-a-custom-extraction-rule-for-a-web-performance-test.md)
- [Кодирование пользовательского правила проверки для веб-теста производительности](../test/code-a-custom-validation-rule-for-a-web-performance-test.md)
- [Практическое руководство. Создание подключаемого модуля нагрузочных тестов](../test/how-to-create-a-load-test-plug-in.md)
- [Создание и запуск закодированного веб-теста производительности](../test/generate-and-run-a-coded-web-performance-test.md)