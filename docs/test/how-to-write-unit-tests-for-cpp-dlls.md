---
title: Написание модульных тестов для библиотек DLL на C++ в Visual Studio | Документы Майкрософт
ms.date: 11/04/2017
ms.technology: vs-ide-test
ms.topic: article
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
author: mikeblome
ms.openlocfilehash: 519d1ae3c38e3366eb898ff1fe050533f1b5e221
ms.sourcegitcommit: 900ed1e299cd5bba56249cef8f5cf3981b10cb1c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2018
---
# <a name="write-unit-tests-for-c-dlls-in-visual-studio"></a>Написание модульных тестов для библиотек DLL на C++ в Visual Studio

 Существует несколько способов протестировать код библиотеки DLL в зависимости от того, экспортирует ли он функции, которые требуется проверить. Выберите один из следующих вариантов:

 **Модульные тесты вызывают только функции, экспортированные из библиотеки DLL:** Добавьте отдельный тестовый проект, как описывается в статье [Создание модульных тестов для C/C++](writing-unit-tests-for-c-cpp.md). В тестовом проекте добавьте ссылку на проект библиотеки DLL.

 Перейдите к процедуре [Создание ссылки на экспортируемые функции из проекта библиотеки DLL](#projectRef).

 **Сборка библиотеки DLL выполняется в виде файла EXE.** Добавьте отдельный тестовый проект. Привяжите его к выходному объектному файлу.

 Перейдите к процедуре [Связывание тестов с объектным файлом или файлом библиотеки](#objectRef).

 **Модульные тесты вызывают не являющиеся членами функции, которые не экспортируются из библиотеки DLL; сборка библиотеки DLL может быть выполнена в виде статической библиотеки.** Измените проект библиотеки DLL так, чтобы он компилировался в LIB-файл. Добавьте отдельные тестовый проект со ссылкой на тестируемый проект.

 Этот подход имеет то преимущество, что вы можете использовать члены, которые не экспортируются, но тесты по-прежнему содержатся в отдельном проекте.

 Перейдите к процедуре [Преобразование библиотеки DLL в статическую библиотеку](#staticLink).

 **Модульные тесты должны вызывать не являющиеся членами функции, которые не экспортируются, и сборку кода необходимо выполнить в виде библиотеки динамической компоновки (DLL).** Добавьте модульные тесты в тот же проект, в котором находится код продукта.

 Перейдите к процедуре [Добавление модульных тестов в тот же проект](#sameProject).

## <a name="creating-the-tests"></a>Создание тестов

###  <a name="staticLink"></a> Преобразование библиотеки DLL в статическую библиотеку

-   Если тесты должны использовать члены, которые не экспортируются проектом библиотеки DLL, а сборка тестируемого проекта выполнена в виде динамической библиотеки, то следует преобразовать его в статическую библиотеку.

    1.  В **обозревателе решений** в контекстном меню тестируемого проекта выберите пункт **Свойства**. Откроется окно свойств проекта.

    2.  Выберите **Свойства конфигурации | Общие**.

    3.  Установите для свойства **Тип конфигурации** значение **Статическая библиотека (.lib)**.

 Продолжите выполнение процедуры [Связывание тестов с объектным файлом или файлом библиотеки](#objectRef).

###  <a name="projectRef"></a> Создание ссылки на экспортируемые функции библиотеки DLL из тестового проекта

-   Если проект библиотеки DLL экспортирует функции, которые необходимо протестировать, можно добавить ссылку на проект кода из тестового проекта.

    1.  Создание проекта машинного модульного теста

        1.  В меню **Файл** выберите **Создать | Проект | Visual C++, Тест | Проект модульного теста C++**.

    2.  В **обозревателе решений** в контекстном меню тестового проекта выберите пункт **Ссылки**. Откроется окно свойств проекта.

    3.  Выберите **Общие свойства | .NET Framework и ссылки**, а затем нажмите кнопку **Добавить новую ссылку**.

    4.  Выберите **Проекты**, а затем тестируемый проект.

         Нажмите кнопку **Добавить** .

    5.  В свойствах тестового проекта добавьте расположение тестируемого проекта в каталоги включения.

         Выберите **Свойства конфигурации | Каталоги VC++ | Каталоги включаемых файлов**.

         Выберите **Изменить**, а затем добавьте каталог заголовков тестируемого проекта.

 Перейдите к разделу [Написание модульных тестов](#addTests).

###  <a name="objectRef"></a> Связывание тестов с объектным файлом или файлом библиотеки

-   Если библиотека DLL не экспортирует функции, которые необходимо проверить, можно добавить файл выходных данных **OBJ** или **LIB** в зависимости тестового проекта.

    1.  Создание проекта машинного модульного теста

        1.  В меню **Файл** выберите **Создать | Проект | Visual C++ | Тест | Проект машинного модульного теста**.

    2.  В **обозревателе решений** в контекстном меню тестового проекта выберите пункт **Свойства**.

    3.  Выберите **Свойства конфигурации | Компоновщик | Ввод | Дополнительные зависимости**.

         Выберите **Изменить** и добавьте имена файлов **.obj** или **.lib**. Не используйте полный путь.

    4.  Выберите **Свойства конфигурации | Компоновщик | Общие | Дополнительные каталоги библиотек**.

         Выберите **Изменить** и добавьте путь к каталогу файлов **.obj** или **.lib**. Путь обычно находится внутри папки построения тестируемого проекта.

    5.  Выберите **Свойства конфигурации | Каталоги VC++ | Каталоги включаемых файлов**.

         Выберите **Изменить**, а затем добавьте каталог заголовков тестируемого проекта.

 Перейдите к разделу [Написание модульных тестов](#addTests).

###  <a name="sameProject"></a> Добавление модульных тестов в тот же проект

1.  Измените свойства проекта кода продукта для того, чтобы он включал заголовки и файлы библиотек, которые необходимы для модульного тестирования.

    1.  В **обозревателе решений** в контекстном меню тестируемого проекта выберите пункт "Свойства". Откроется окно свойств проекта.

    2.  Выберите **Свойства конфигурации | Каталоги VC++**.

    3.  Измените каталоги включения и библиотек:

        |||
        |-|-|
        |**Каталоги включаемых файлов** | **$(VCInstallDir)UnitTest\include;$(IncludePath)**|
        |**Каталоги библиотек** | **$(VCInstallDir)UnitTest\lib;$(LibraryPath)**|

2.  Добавьте файл модульного тестирования С++:

    -   В **обозревателе решений** в контекстном меню проекта выберите **Добавить | Создать элемент | Модульный тест C++**.

 Перейдите к разделу [Написание модульных тестов](#addTests).

##  <a name="addTests"></a> Написание модульных тестов

1.  В каждом файле кода модульного теста добавьте оператор `#include` для заголовков тестируемого проекта.

2.  Добавьте тестовые классы и методы в файлы кода модульного теста. Пример:

    ```cpp
    #include "stdafx.h"
    #include "CppUnitTest.h"
    #include "MyProjectUnderTest.h"
    using namespace Microsoft::VisualStudio::CppUnitTestFramework;
    namespace MyTest
    {
      TEST_CLASS(MyTests)
      {
      public:
          TEST_METHOD(MyTestMethod)
          {
              Assert::AreEqual(MyProject::Multiply(2,3), 6);
          }
      };
    }
    ```

## <a name="run-the-tests"></a>Запуск тестов

1.  В меню **Тест** выберите пункты **Окна | Обозреватель тестов**.

1. Если в окне видны не все тесты, выполните сборку тестового проекта, щелкнув его узел в **обозревателе решений** правой кнопкой мыши и выбрав пункт **Сборка** или **Перестроить**.

1.  В обозревателе тестов нажмите **Запустить все** или выберите тесты, которые следует запустить. Щелкните тест правой кнопкой мыши, чтобы получить доступ к другим командам, включая запуск в режиме отладки с включенными точками останова.

## <a name="see-also"></a>См. также

- [Создание модульных тестов для C/C++](writing-unit-tests-for-c-cpp.md)
- [Справочник по API Microsoft.VisualStudio.TestTools.CppUnitTestFramework](../test/microsoft-visualstudio-testtools-cppunittestframework-api-reference.md)
- [Отладка машинного кода](../debugger/debugging-native-code.md)
- [Пошаговое руководство. Создание и использование библиотеки DLL (C++)](/cpp/build/walkthrough-creating-and-using-a-dynamic-link-library-cpp)
- [Импортирование и экспортирование](/cpp/build/importing-and-exporting)
- [Краткое руководство. Разработка на основе тестирования с использованием обозревателя тестов](../test/quick-start-test-driven-development-with-test-explorer.md)
