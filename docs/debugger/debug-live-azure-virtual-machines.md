---
title: Отладка динамических виртуальных машин ASP.NET Azure и масштабируемых наборов виртуальных машин Azure
description: Узнайте, как настроить точки моментальных снимков и просмотреть моментальные снимки с помощью Snapshot Debugger.
ms.custom: ''
ms.date: 02/06/2019
ms.topic: conceptual
helpviewer_keywords:
- debugger
author: poppastring
ms.author: madownie
manager: andster
monikerRange: '>= vs-2019'
ms.workload:
- aspnet
- azure
ms.openlocfilehash: 2880b8bee25a79f5f182043ffed5c50c4512d033
ms.sourcegitcommit: 53aa5a413717a1b62ca56a5983b6a50f7f0663b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59663198"
---
# <a name="debug-live-aspnet-apps-on-azure-virtual-machines-and-azure-virtual-machine-scale-sets-using-the-snapshot-debugger"></a>Отладка динамических приложений ASP.NET на виртуальных машинах Azure и масштабируемых наборах виртуальных машин Azure с помощью Snapshot Debugger

Средство Snapshot Debugger создает моментальный снимок рабочих приложений при выполнении интересующего вас кода. Чтобы указать отладчику на необходимость создать моментальный снимок, следует установить точки прикрепления и точки ведения в коде. Отладчик позволяет увидеть источник ошибки, не затрагивая трафик рабочего приложения. Средство Snapshot Debugger позволяет значительно сократить затраты времени на устранение проблем, возникающих в рабочих средах.

Точки моментальных снимков и точки ведения журнала похожи на точки останова, но в отличие от точек останова, точки моментальных снимков не приостанавливают работу приложения при выполненной строке. Как правило, создание моментального снимка в точке прикрепления занимает 10–20 мс.

В этом руководстве рассмотрены следующие задачи:

> [!div class="checklist"]
> * запуск Snapshot Debugger;
> * задание точки моментальных снимков и просмотр моментального снимка;
> * задание точки ведения журнала.

## <a name="prerequisites"></a>Предварительные требования

* Отладчик моментальных снимков для виртуальных машин (ВМ) Azure и масштабируемые наборы виртуальных машин Azure только для Visual Studio Enterprise 2019 г. или более поздней версии с **рабочую нагрузку разработки Azure**. (На вкладке **Отдельные компоненты** его можно найти в разделе **Отладка и тестирование** > **Отладчик моментальных снимков**.)

    Если он еще не установлен, установите [Visual Studio 2019 Enterprise](https://visualstudio.microsoft.com/vs/).

* Коллекция моментальных снимков доступна для следующих веб-приложений Azure Machines\Virtual машин масштабируемые наборы виртуальных машин:
  * Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  * Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.

## <a name="open-your-project-and-start-the-snapshot-debugger"></a>Открытие проекта и запуск Snapshot Debugger

1. Откройте проект, моментальный снимок которого хотите отладить.

    > [!IMPORTANT]
    > Отладка моментальных снимков, необходимо открыть *же версию исходного кода* , опубликованный в службе виртуальных Machine\Virtual машины масштабируемого набора Azure.

1. Выберите **Отладка > Подключить Snapshot Debugger...**. Выберите виртуальный Machine\Virtual машины масштабируемого набора Azure развертывается веб-приложения и учетная запись хранилища Azure и нажмите кнопку **Attach**.

      ![Запуск отладчика моментальных снимков из меню "Отладка"](../debugger/media/snapshot-debug-menu-attach.png)

      ![Выбор ресурса Azure](../debugger/media/snapshot-select-azure-resource-vm.png) 

    > [!IMPORTANT]
    > Если впервые щелкнуть **Подключить Snapshot Debugger** для виртуальной машины, службы IIS автоматически перезагрузятся.
    > Когда вы впервые щелкаете **подключить отладчик моментальных снимков** для масштабируемых наборов виртуальных машин, требует ручного обновления каждого экземпляра масштабируемые наборы виртуальных машин.

    Метаданные для **модулей** изначально не будут активированы, чтобы кнопка **Запуск коллекции** стала активной, перейдите к веб-приложению. Visual Studio теперь находится в режиме отладки моментальных снимков.

   ![Режим отладки моментальных снимков](../debugger/media/snapshot-message.png)

    > [!NOTE]
    > Расширение сайта Application Insights также поддерживает отладку моментальных снимков. При возникновении сообщения об ошибке из-за того, что расширение сайта устарело, ознакомьтесь со статьей [Устранение неполадок и известные проблемы для отладки моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-troubleshooting.md) для получения подробной информации об обновлении.
    > Для масштабируемого набора виртуальных МАШИН пользователь потребуется вручную обновить экземпляры в своих масштабируемых наборов виртуальных машин после присоединения отладчика моментальных снимков в первый раз.

   **Модули** окне отображается, когда загрузки всех модулей для Azure виртуальный Machine\Virtual машины масштабируемого набора (выберите **Отладка > Windows > модули** чтобы открыть это окно).

   ![Проверка окна модулей](../debugger/media/snapshot-modules.png)

## <a name="set-a-snappoint"></a>Настройка точки моментальных снимков

1. В редакторе кода щелкните левое внутреннее окно рядом с интересующей вас строкой кода, чтобы задать точку моментальных снимков. Убедитесь, что будет выполняться именно этот код.

   ![Настройка точки моментальных снимков](../debugger/media/snapshot-set-snappoint.png)

1. Нажмите кнопку **Запустить коллекцию**, чтобы включить точку моментальных снимков.

   ![Включение точки моментальных снимков](../debugger/media/snapshot-start-collection.png)

    > [!TIP]
    > Вы не можете выполнять шаги при просмотре снимка, но можете поместить несколько точек моментальных снимков в свой код, чтобы следить за выполнением в разных строках кода. При наличии нескольких точек моментальных снимков в коде Snapshot Debugger обеспечивает доступность соответствующих моментальных снимков из того же сеанса конечного пользователя. Snapshot Debugger делает это, даже если в ваше приложение попадает много пользователей.

## <a name="take-a-snapshot"></a>Сделайте моментальный снимок

Когда точка моментальных снимков включена, она создает моментальный снимок при каждом выполнении строки кода, на которой она размещена. Это выполнение может быть вызвано реальным запросом на вашем сервере. Для принудительного выполнения точки моментальных снимков перейдите к представлению браузера на своем веб-сайте и выполните все необходимые действия, которые приведут к выполнению точки моментальных снимков.

## <a name="inspect-snapshot-data"></a>Проверка данных моментальных снимков

1. При выполнении точки моментальных снимков в окне "Средства диагностики" появляется снимок. Чтобы открыть это окно, выберите **Отладка > Windows > Показать средства диагностики**.

   ![Открытие точки моментальных снимков](../debugger/media/snapshot-diagsession-window.png)

1. Дважды щелкните точку моментальных снимков, чтобы открыть снимок в редакторе кода.

   ![Проверка данных моментальных снимков](../debugger/media/snapshot-inspect-data.png)

   В этом представлении вы можете навести курсор на переменные для просмотра советов, используя окна **Локальные элементы**, **Контрольные значения** и **Стек вызовов**, а также оценки выражений.

    Сам веб-сайт является активным, и это не влияет на конечных пользователей. По умолчанию создается только один моментальный снимок для каждой точки моментальных снимков. После создания моментального снимка точка моментальных снимков отключается. Если вы хотите сделать еще один снимок в одной точке, вы можете снова включить ее, нажав **Обновить коллекцию**.

Вы можете также добавить дополнительные точки моментальных снимков в приложение и включить их с помощью кнопки **Обновить коллекцию**.

**Нужна помощь?** См. статьи [Устранение неполадок и известные проблемы для отладки моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-troubleshooting.md) и [Часто задаваемые вопросы по отладке моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-faq.md).

## <a name="set-a-conditional-snappoint"></a>Настройка условной точки моментальных снимков

Если вам трудно воссоздать определенное состояние в своем приложении, подумайте, может ли помочь использование условной точки моментальных снимков. Условные точки прикрепления позволяют избегать создания моментального снимка, пока приложение не войдет в требуемое состояние, например, если переменная имеет определенное значение, которое требуется проверить. Вы можете установить условия, используя выражения, фильтры или счетчики посещений.

#### <a name="to-create-a-conditional-snappoint"></a>Создание условной точки моментальных снимков

1. Щелкните правой кнопкой мыши значок точки моментальных снимков (пустой шар) и выберите **Параметры**.

   ![Выберите параметры](../debugger/media/snapshot-snappoint-settings.png)

1. В окне параметров точки моментальных снимков введите выражение.

   ![Введение выражения](../debugger/media/snapshot-snappoint-conditions.png)

   На предыдущей иллюстрации снимок сделан только для точки моментальных снимков при `visitor.FirstName == "Dan"`.

## <a name="set-a-logpoint"></a>Задание точки ведения журнала

Кроме создания моментального снимка, при нажатии точки моментальных снимков вы также можете настроить точки моментальных снимков для регистрации сообщения (то есть создать точку ведения журнала). Вы можете установить точки ведения журнала без повторного развертывания приложения. Точки ведения журнала выполняются виртуально и не оказывают никакого влияния или побочных эффектов на работающее приложение.

#### <a name="to-create-a-logpoint"></a>Создание точки ведения журнала

1. Щелкните правой кнопкой мыши значок точки моментальных снимков (синий шестиугольник) и выберите **Параметры**.

1. В окне параметров точки моментальных снимков выберите **Действия**.

    ![Создание точки ведения журнала](../debugger/media/snapshot-logpoint.png)

1. В поле **Сообщение** вы можете ввести новое сообщение журнала, которое хотите зарегистрировать. Вы также можете оценить переменные в сообщении журнала, поместив их в фигурные скобки.

    При выборе **Отправить в окно вывода**, когда достигнута точка ведения журнала, сообщение будет отображено в окне "Средства диагностики".

    ![Данные точки ведения журнала в окне "Средства диагностики"](../debugger/media/snapshot-logpoint-output.png)

    При выборе **Отправить в журнал приложений**, когда будет достигнута точка ведения журнала, сообщение будет отображено в любом месте, из которого вы сможете просмотреть сообщения из `System.Diagnostics.Trace` (или `ILogger` в .NET Core), например [App Insights](/azure/application-insights/app-insights-asp-net-trace-logs).

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как использовать Snapshot Debugger для Виртуальных машин Azure и для Масштабируемых наборов виртуальных машин Azure. Вы можете прочитать дополнительные сведения об этой функции.

> [!div class="nextstepaction"]
> [Ответы на часто задаваемые вопросы по отладке моментальных снимков](../debugger/debug-live-azure-apps-faq.md)