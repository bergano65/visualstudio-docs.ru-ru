---
title: Отладка интерактивных приложений ASP.NET Azure
titleSuffix: Visual Studio Enterprise
description: Узнайте, как с помощью Snapshot Debugger в Visual Studio задать точки моментальных снимков и создать моментальные снимки при отладке работающих приложений ASP.NET в Azure.
ms.custom: ''
ms.date: 03/16/2018
ms.topic: how-to
helpviewer_keywords:
- debugger
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- aspnet
- azure
ms.openlocfilehash: 53a7d00548e6d273e2afa2da48669b3d1f3cf827
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99873328"
---
# <a name="debug-live-aspnet-azure-apps-using-the-snapshot-debugger"></a>Отладка интерактивных приложений ASP.NET Azure с использованием Snapshot Debugger

Средство Snapshot Debugger создает моментальный снимок рабочих приложений при выполнении интересующего вас кода. Чтобы указать отладчику на необходимость создать моментальный снимок, следует установить точки прикрепления и точки ведения в коде. Отладчик позволяет увидеть источник ошибки, не затрагивая трафик рабочего приложения. Средство Snapshot Debugger позволяет значительно сократить затраты времени на устранение проблем, возникающих в рабочих средах.

Точки моментальных снимков и точки ведения журнала похожи на точки останова, но в отличие от точек останова, точки моментальных снимков не приостанавливают работу приложения при выполненной строке. Как правило, создание моментального снимка в точке прикрепления занимает 10–20 мс.

В этом руководстве рассмотрены следующие задачи:

> [!div class="checklist"]
> * запуск Snapshot Debugger;
> * задание точки моментальных снимков и просмотр моментального снимка;
> * задание точки ведения журнала.

## <a name="prerequisites"></a>Предварительные требования

* Расширение Snapshot Debugger доступно, начиная с Visual Studio 2017 Enterprise версии 15.5 с **рабочей нагрузкой разработки Azure**. (На вкладке **Отдельные компоненты** его можно найти в разделе **Отладка и тестирование** > **Отладчик моментальных снимков**.)

   ::: moniker range=">=vs-2019"
   При необходимости установите [Visual Studio 2019](https://visualstudio.microsoft.com/downloads). Если вы выполняете обновление предыдущей установки Visual Studio, запустите Visual Studio Installer и проверьте компонент Snapshot Debugger в **ASP.NET и рабочей нагрузке веб-разработки**.
   ::: moniker-end
   ::: moniker range="<=vs-2017"
   Если он еще не установлен, установите [Visual Studio 2017 Enterprise версии 15.5](https://visualstudio.microsoft.com/vs/older-downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=vs+2017+download) или более поздней. Если вы выполняете обновление предыдущей установки Visual Studio 2017, запустите Visual Studio Installer и проверьте компонент Snapshot Debugger в **ASP.NET и рабочей нагрузке веб-разработки**.
   ::: moniker-end

* План Службы приложений Azure "Базовый" или выше.

* Коллекция моментальных снимков доступна для следующих веб-приложений, выполняющихся в службе приложений Azure App:
  * Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  * Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.

## <a name="open-your-project-and-start-the-snapshot-debugger"></a>Открытие проекта и запуск Snapshot Debugger

1. Откройте проект, моментальный снимок которого хотите отладить.

   > [!IMPORTANT]
   > Для отладки моментальных снимков необходимо открыть *ту же версию исходного кода*, которая опубликована в Службе приложений Azure.

::: moniker range="<=vs-2017"

2. В Cloud Explorer (**Просмотр > Cloud Explorer**) щелкните правой кнопкой мыши Службу приложений Azure, в которой развернут ваш проект, и выберите **Подключить Snapshot Debugger**.

   ![Запустить Snapshot Debugger](../debugger/media/snapshot-launch.png)

::: moniker-end

::: moniker range=">=vs-2019"

2. Выберите **Отладка > Подключить Snapshot Debugger...** . Выберите Службу приложений Azure, в которой развернут ваш проект, и учетную запись хранения Azure, а затем нажмите **Подключить**. Snapshot Debugger поддерживает [Службу Azure Kubernetes](debug-live-azure-kubernetes.md), а также [виртуальные машины Azure и масштабируемые наборы виртуальных машин](debug-live-azure-virtual-machines.md).

   ![Запуск отладчика моментальных снимков из меню "Отладка"](../debugger/media/snapshot-debug-menu-attach.png)

   ![Выбор ресурса Azure](../debugger/media/snapshot-select-azure-resource-appservices.png)

::: moniker-end

   > [!IMPORTANT]
   > При первом выборе функции **Подключить Snapshot Debugger** вам будет предложено установить расширение сайта Snapshot Debugger в Службу приложений Azure. Для этой установки требуется перезапуск Службы приложений Azure.

   ::: moniker range="<=vs-2017"
   > [!NOTE]
   > Расширение сайта Application Insights также поддерживает отладку моментальных снимков. При возникновении сообщения об ошибке о том, что расширение сайта устарело, см. руководство по [устранению неполадок и известных проблемах при отладке моментальных снимков](../debugger/debug-live-azure-apps-troubleshooting.md) для получения подробной информации об обновлении.
   ::: moniker-end
   ::: moniker range=">=vs-2019"
   > [!NOTE]
   > (Visual Studio 2019 версии 16.2 и выше) В Snapshot Debugger включена поддержка облака Azure. Убедитесь, что выбранные ресурс Azure и учетная запись хранения Azure находятся в одном и том же облаке. Обратитесь к администратору Azure, если у вас возникли вопросы о конфигурациях предприятия для обеспечения соответствия [требованиям Azure](https://azure.microsoft.com/overview/trusted-cloud/).
   ::: moniker-end

   Visual Studio теперь находится в режиме отладки моментальных снимков.
   ![Режим отладки моментальных снимков](../debugger/media/snapshot-message.png)

   Окно **Модули** показывает, когда все модули для Службы приложений Azure загружены (выберите **Отладка > Windows > Модули**, чтобы открыть это окно).

   ![Проверка окна модулей](../debugger/media/snapshot-modules.png)

## <a name="set-a-snappoint"></a>Настройка точки моментальных снимков

1. В редакторе кода щелкните поле слева рядом с нужной строкой кода, чтобы задать точку моментальных снимков. Убедитесь, что будет выполняться именно этот код.

   ![Настройка точки моментальных снимков](../debugger/media/snapshot-set-snappoint.png)

2. Нажмите кнопку **Запустить коллекцию**, чтобы включить точку моментальных снимков.

   ![Включение точки моментальных снимков](../debugger/media/snapshot-start-collection.png)

   > [!TIP]
   > Вы не можете выполнять шаги при просмотре снимка, но можете поместить несколько точек моментальных снимков в свой код, чтобы следить за выполнением в разных строках кода. При наличии нескольких точек моментальных снимков в коде Snapshot Debugger обеспечивает доступность соответствующих моментальных снимков из того же сеанса конечного пользователя. Snapshot Debugger делает это, даже если в ваше приложение попадает много пользователей.

## <a name="take-a-snapshot"></a>Сделайте моментальный снимок

После настройки точки моментальных снимков можно создать моментальный снимок вручную, перейдя в представление веб-сайта в браузере и выполнив строку кода с пометкой, или дождаться, пока пользователи создадут его при использовании сайта.

## <a name="inspect-snapshot-data"></a>Проверка данных моментальных снимков

1. При выполнении точки моментальных снимков в окне "Средства диагностики" появляется снимок. Чтобы открыть это окно, выберите **Отладка > Windows > Показать средства диагностики**.

   ![Открытие точки моментальных снимков](../debugger/media/snapshot-diagsession-window.png)

1. Дважды щелкните точку моментальных снимков, чтобы открыть снимок в редакторе кода.

   ![Проверка данных моментальных снимков](../debugger/media/snapshot-inspect-data.png)

   В этом представлении вы можете навести курсор на переменные для просмотра советов, используя окна **Локальные элементы**, **Контрольные значения** и **Стек вызовов**, а также оценки выражений.

   Сам веб-сайт остается активным, и это не влияет на работу пользователей. По умолчанию создается только один моментальный снимок для каждой точки моментальных снимков. После создания моментального снимка точка моментальных снимков отключается. Если вы хотите сделать еще один снимок в одной точке, вы можете снова включить ее, нажав **Обновить коллекцию**.

Вы можете также добавить дополнительные точки моментальных снимков в приложение и включить их с помощью кнопки **Обновить коллекцию**.

**Нужна помощь?** См. статьи [Устранение неполадок и известные проблемы для отладки моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-troubleshooting.md) и [Часто задаваемые вопросы по отладке моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-faq.md).

## <a name="set-a-conditional-snappoint"></a>Настройка условной точки моментальных снимков

Если вам сложно воссоздать определенное состояние в своем приложении, попробуйте использовать условную точку моментальных снимков. Условные точки моментальных снимков определяют время создания моментального снимка, например момент, когда переменная содержит определенное значение, которое необходимо проверить. Вы можете установить условия, используя выражения, фильтры или счетчики посещений.

#### <a name="to-create-a-conditional-snappoint"></a>Создание условной точки моментальных снимков

1. Щелкните правой кнопкой мыши значок точки моментальных снимков (пустой шар) и выберите **Параметры**.

   ![Выберите параметры](../debugger/media/snapshot-snappoint-settings.png)

1. В окне параметров точки моментальных снимков введите выражение.

   ![Введение выражения](../debugger/media/snapshot-snappoint-conditions.png)

   На предыдущей иллюстрации снимок сделан только для точки моментальных снимков при `visitor.FirstName == "Dan"`.

## <a name="set-a-logpoint"></a>Задание точки ведения журнала

Кроме создания моментального снимка, при нажатии точки моментальных снимков вы также можете настроить точки моментальных снимков для регистрации сообщения (то есть создать точку ведения журнала). Вы можете установить точки ведения журнала без повторного развертывания приложения. Точки ведения журнала выполняются виртуально и не оказывают никакого влияния или побочных эффектов на работающее приложение.

#### <a name="to-create-a-logpoint"></a>Создание точки ведения журнала

1. Щелкните правой кнопкой мыши значок точки моментальных снимков (синий шестиугольник) и выберите **Параметры**.

1. В окне параметров точки моментальных снимков выберите **Действия**.

   ![Создание точки ведения журнала](../debugger/media/snapshot-logpoint.png)

1. В поле **Сообщение** вы можете ввести новое сообщение журнала, которое хотите зарегистрировать. Вы также можете оценить переменные в сообщении журнала, поместив их в фигурные скобки.

   При выборе **Отправить в окно вывода**, когда достигнута точка ведения журнала, сообщение будет отображено в окне "Средства диагностики".

   ![Данные точки ведения журнала в окне "Средства диагностики"](../debugger/media/snapshot-logpoint-output.png)

   При выборе **Отправить в журнал приложений**, когда будет достигнута точка ведения журнала, сообщение будет отображено в любом месте, из которого вы сможете просмотреть сообщения из `System.Diagnostics.Trace` (или `ILogger` в .NET Core), например [App Insights](/azure/application-insights/app-insights-asp-net-trace-logs).

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как использовать Snapshot Debugger для Служб приложений. Вы можете прочитать дополнительные сведения об этой функции.

> [!div class="nextstepaction"]
> [Ответы на часто задаваемые вопросы по отладке моментальных снимков](../debugger/debug-live-azure-apps-faq.md)