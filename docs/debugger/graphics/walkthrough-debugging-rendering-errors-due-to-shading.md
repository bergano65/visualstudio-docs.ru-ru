---
title: Пошаговое руководство. Отладка ошибок отрисовки, возникающих из-за заливки | Документация Майкрософт
description: Проведите анализ для обнаружения ошибки шейдера. В этом руководстве показано, как использовать диагностику графики в Visual Studio, включая журнал пикселей графики и отладчик HLSL.
ms.custom: SEO-VS-2020, seodec18
ms.date: 11/04/2016
ms.topic: conceptual
ms.assetid: 01875b05-cc7b-4add-afba-f2b776f86974
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 491a2c5ab0bcb923d9999bd55249150d33a650ae
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99891869"
---
# <a name="walkthrough-debugging-rendering-errors-due-to-shading"></a>Пошаговое руководство. Отладка ошибок отрисовки, возникающих из-за заливки
В данном пошаговом руководстве показано, как с помощью средств диагностики графики [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] исследовать объект, который имеет неверный цвет из-за ошибки шейдера.

 В этом пошаговом руководстве показывается:

- Проанализируйте документ журнала графики, чтобы определить пиксели, которые указывают на проблему.

- Использование окна **Журнал пикселей графики** для более подробного изучения состояния пикселей.

- Использование **отладчика HLSL** для изучения построителей текстур и шейдеров вершин.

## <a name="scenario"></a>Сценарий
 Неверное окрашивание объектов часто возникает, когда шейдер вершин передает неверные или неполные данные в построитель текстуры.

 В данном сценарии вы недавно добавили объект в приложение. Вы также добавили новую вершину и построители текстуры для преобразования объекта и придали ему уникальный внешний вид. При запуске приложения во время теста объект окрашивается сплошным черным цветом. С помощью диагностики графики можно записать данные о проблеме в журнал графики, чтобы можно было выполнить отладку приложения. Проблема в приложении выглядит так, как показано на следующем рисунке.

 ![Объект выводится с неправильными цветами.](media/gfx_diag_demo_render_error_shader_problem.png "gfx_diag_demo_render_error_shader_problem")

## <a name="investigation"></a>Исследование
 С помощью средств диагностики графики можно загрузить документ журнала графики для проверки кадров, захваченных в ходе теста.

#### <a name="to-examine-a-frame-in-a-graphics-log"></a>Анализ кадра в журнале графики

1. Загрузите в [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] журнал графики, содержащий кадр, на котором видно, что модель отсутствует. В [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] откроется новое окно документа журнала графики. В верхней части этого окна находится вывод целевого объекта отрисовки для выбранного кадра. В нижней части находится **Список кадров**, в котором каждый захваченный кадр отображается как эскиз.

2. В **списке кадров** выберите кадр, на котором объект имеет неправильный внешний вид. Однобуферная прорисовка обновляется, и в ней отображается выбранный кадр. В этом сценарии окно документа журнала графики выглядит так, как показано на следующем рисунке.

    ![Документ журнала графики в Visual Studio.](media/gfx_diag_demo_render_error_shader_step_1.png "gfx_diag_demo_render_error_shader_step_1")

   После выбора кадра, который демонстрирует проблему, можно воспользоваться окном **Журнал пикселей графики** для ее диагностики. Окно **Журнал пикселей графики** в хронологическом порядке показывает примитивы, которые могут влиять на определенный пиксель, шейдеры примитивов и влияние, которые примитивы могут оказывать на целевой объект отрисовки.

#### <a name="to-examine-a-pixel"></a>Проверка пикселя

1. Откройте окно **Журнал пикселей графики** . На панели инструментов **Диагностика графики** выберите **Журнал пикселей**.

2. Выберите пиксель для изучения. В окне документа журнала графики выберите один из пикселей на неправильно окрашенном объекте:

    ![При выборе пикселя отображается его журнал.](media/gfx_diag_demo_render_error_shader_step_2.png "gfx_diag_demo_render_error_shader_step_2")

    Окно **журнала пикселей графики** будет обновлено, чтобы отразить выбранный пиксель. В этом случае окно **журнала пикселей графики** выглядит следующим образом.

    ![В журнале пикселя показано одно событие DrawIndexed.](media/gfx_diag_demo_render_error_shader_step_3.png "gfx_diag_demo_render_error_shader_step_3")

    Обратите внимание, что результат работы построителя текстуры — полностью непрозрачный черный цвет (0, 0, 0, 1), а **средство слияния вывода** объединило его с **предыдущим** цветом пикселя таким образом, что в **результате** тоже получился полностью непрозрачный черный цвет.

   После того как будет проверен неправильно окрашенный пиксель и обнаружено, что выходной цвет построителя текстуры не является ожидаемым, можно использовать отладчик HLSL, чтобы проверить построитель текстуры и узнать, что случилось с цветом объекта. Отладчик HLSL можно использовать для проверки состояния переменных HLSL при выполнении, пошагового выполнения кода HLSL и указания точек останова для помощи в диагностике проблемы.

#### <a name="to-examine-the-pixel-shader"></a>Изучение построителя текстуры

1. Начните отладку построителя текстуры. В окне **Журнал пикселей графики** в разделе примитива объекта рядом с **построителем текстуры** нажмите кнопку **Начать отладку** .

2. В этом сценарии несложно заметить, что построитель текстуры не является источником проблемы, так как он просто передает цвет из шейдера вершин.

3. Наведите указатель на `input.color`. Обратите внимание, что его значение — полностью непрозрачный черный (0, 0, 0, 1).

    ![Член "color" объекта "input" равен "black".](media/gfx_diag_demo_render_error_shader_step_5.png "gfx_diag_demo_render_error_shader_step_5")

    В этом сценарии анализ показывает, что неверный цвет, вероятно, является результатом работы шейдера вершин, который не предоставляет правильные сведения о цвете шейдеру пикселей, с которыми тот мог бы работать.

   После того как вы определили, что шейдер вершин, вероятно, не предоставляет правильных сведений шейдеру пикселей, следующий шаг — проверить шейдер вершин.

#### <a name="to-examine-the-vertex-shader"></a>Проверка шейдера вершин

1. Запустите отладку шейдера вершин. В окне **Журнала пикселей графики** в разделе примитива объекта рядом с **шейдером вершин** нажмите кнопку **Начать отладку** .

2. Найдите структуру выходных данных шейдера вершин — это входные данные для построителя текстуры. В этом сценарии эта структура называется `output`. Просмотрите код шейдера вершин и обратите внимание, что член `color` структуры `output` явно установлен в полностью непрозрачный черный, — возможно, в результате каких-либо действий по отладке.

3. Убедитесь, что член цвета никогда не копируется из входной структуры. Поскольку значение `output.color` устанавливается в полностью непрозрачный черный непосредственно перед возвратом структуры `output`, имеет смысл убедиться, что значение `output` не было правильно инициализировано на предыдущей строке. Выполняйте пошагово код шейдера вершин, пока не достигнете строки, на которой `output.color` устанавливается в черный, и наблюдайте за значением `output.color`. Обратите внимание, что значение `output.color` не инициализируется до его установки в черный. Это подтверждает, что строка кода, которая устанавливает `output.color` в черный, должна быть изменена, а не удалена.

    ![Значение "output.color" равно "black".](media/gfx_diag_demo_render_error_shader_step_7.png "gfx_diag_demo_render_error_shader_step_7")

   После того как вы определили, что причиной проблемы отрисовки является то, что шейдер вершин не предоставляет правильное значение цвета шейдеру пикселей, можно переходить к устранению проблемы. В этом сценарии для этого необходимо изменить следующий код в шейдере вершин:

```hlsl
output.color = float3(0.0f, 0.0f, 0.0f);
```

 в

```hlsl
output.color = input.color;
```

 Этот код просто передает цвет вершины из вершин объекта без изменений, более сложные шейдеры вершин могут изменять цвет до его передачи. Исправленный код шейдера вершин должен выглядеть примерно так:

 ![Исправленный код шейдера вершин.](media/gfx_diag_demo_render_error_shader_step_8.png "gfx_diag_demo_render_error_shader_step_8")

 Внеся исправления в код, можно заново собрать его и еще раз запустить приложение, чтобы убедиться, что проблема с отрисовкой решена.

 ![Объект выводится с правильными цветами.](media/gfx_diag_demo_render_error_shader_resolution.png "gfx_diag_demo_render_error_shader_resolution")
