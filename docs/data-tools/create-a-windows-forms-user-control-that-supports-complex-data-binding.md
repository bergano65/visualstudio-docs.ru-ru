---
title: Создание Windows Forms пользовательского элемента управления с привязкой данных
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data binding, user controls
- data binding, complex
- user controls [Visual Studio], complex data binding
author: jillre
ms.author: jillfra
manager: jillfra
ms.workload:
- data-storage
ms.openlocfilehash: f8da3485ac28d1d4f3ad77f3aa0ba381e0350dae
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72648647"
---
# <a name="create-a-windows-forms-user-control-that-supports-complex-data-binding"></a>Создание пользовательского элемента управления Windows Forms со сложной привязкой данных

При отображении данных на формах в приложениях Windows можно выбрать существующие элементы управления из **панели элементов**. Кроме того, можно создавать пользовательские элементы управления, если приложению требуются функции, недоступные в стандартных элементах управления. В этом пошаговом руководстве демонстрируется создание элемента управления, реализующего <xref:System.ComponentModel.ComplexBindingPropertiesAttribute>. Элементы управления, реализующие <xref:System.ComponentModel.ComplexBindingPropertiesAttribute>, содержат свойство `DataSource` и `DataMember`, которое можно привязать к данным. Такие элементы управления похожи на <xref:System.Windows.Forms.DataGridView> или <xref:System.Windows.Forms.ListBox>.

Дополнительные сведения о создании элементов управления см. в разделе [разработка Windows Forms элементов управления во время разработки](/dotnet/framework/winforms/controls/developing-windows-forms-controls-at-design-time).

При создании элементов управления для использования в сценариях привязки к данным необходимо реализовать один из следующих атрибутов привязки к данным:

|Использование атрибутов привязки данных|
| - |
|Реализуйте <xref:System.ComponentModel.DefaultBindingPropertyAttribute> на простых элементах управления, таких как <xref:System.Windows.Forms.TextBox>, которые отображают отдельный столбец (или свойство) данных. Дополнительные сведения см. [в разделе создание Windows Forms пользовательского элемента управления, поддерживающего простую привязку данных](../data-tools/create-a-windows-forms-user-control-that-supports-simple-data-binding.md).|
|Реализуйте <xref:System.ComponentModel.ComplexBindingPropertiesAttribute> на элементах управления, таких как <xref:System.Windows.Forms.DataGridView>, которые отображают списки (или таблицы) данных. (Этот процесс описан в данном пошаговом руководстве.)|
|Реализуйте <xref:System.ComponentModel.LookupBindingPropertiesAttribute> на элементах управления, таких как <xref:System.Windows.Forms.ComboBox>, которые отображают списки (или таблицы) данных, но также должны представлять отдельный столбец или отдельное свойство. Дополнительные сведения см. [в разделе создание Windows Forms пользовательского элемента управления, поддерживающего привязку данных подстановки](../data-tools/create-a-windows-forms-user-control-that-supports-lookup-data-binding.md).|

В этом пошаговом руководстве создается сложный элемент управления, отображающий строки данных из таблицы. В данном примере используется таблица `Customers` из учебной базы данных "Борей". Сложный элемент управления отображает таблицу клиентов в <xref:System.Windows.Forms.DataGridView> в пользовательском элементе управления.

В ходе этого пошагового руководства вы научитесь:

- Добавление нового **пользовательского элемента управления** в проект.

- Визуальное проектирование пользовательского элемента управления.

- Реализация атрибута `ComplexBindingProperty`.

- Создайте набор данных с помощью [мастера настройки источника данных](../data-tools/media/data-source-configuration-wizard.png).

- Задайте таблицу **Customers** в [окне Источники данных](add-new-data-sources.md#data-sources-window) , чтобы использовать новый сложный элемент управления.

- Добавьте новый элемент управления, перетащив его из окна **Источники данных** на **Form1**.

## <a name="prerequisites"></a>Необходимые компоненты

В этом пошаговом руководстве используется SQL Server Express LocalDB и образец базы данных Northwind.

1. Если у вас нет SQL Server Express LocalDB, установите его на [странице загрузки SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions-express)или с помощью **Visual Studio Installer**. В **Visual Studio Installer**можно установить SQL Server Express LocalDB как часть рабочей нагрузки **хранения и обработки данных** или как отдельный компонент.

1. Установите учебную базу данных Northwind, выполнив следующие действия.

    1. В Visual Studio откройте окно **Обозреватель объектов SQL Server** . (Обозреватель объектов SQL Server устанавливается как часть рабочей нагрузки **хранения и обработки данных** в Visual Studio Installer.) Разверните узел **SQL Server** . Щелкните правой кнопкой мыши экземпляр LocalDB и выберите **создать запрос**.

       Откроется окно редактора запросов.

    1. Скопируйте [скрипт Transact-SQL Northwind](https://github.com/MicrosoftDocs/visualstudio-docs/blob/master/docs/data-tools/samples/northwind.sql?raw=true) в буфер обмена. Этот сценарий T-SQL создает базу данных Northwind с нуля и заполняет ее данными.

    1. Вставьте скрипт T-SQL в редактор запросов, а затем нажмите кнопку **выполнить** .

       По истечении короткого времени выполнение запроса завершается и создается база данных Northwind.

## <a name="create-a-windows-forms-app-project"></a>Создание проекта Windows Forms приложения

Первым шагом является создание проекта **Windows Forms приложения** для C# или Visual Basic. Присвойте проекту имя **ComplexControlWalkthrough**.

## <a name="add-a-user-control-to-the-project"></a>Добавление пользовательского элемента управления в проект

Поскольку в этом пошаговом руководстве создается сложный элемент управления с возможностью привязки данных из **пользовательского элемента управления**, добавьте в проект элемент **пользовательского элемента управления** :

1. В меню **Проект** выберите пункт **Добавить пользовательский элемент управления**.

1. Введите **ComplexDataGridView** в области **Имя** и нажмите кнопку **Добавить**.

    Элемент управления **ComplexDataGridView** добавляется в **Обозреватель решений** и открывается в конструкторе.

## <a name="design-the-complexdatagridview-control"></a>Разработка элемента управления ComplexDataGridView

Чтобы добавить <xref:System.Windows.Forms.DataGridView> к пользовательскому элементу управления, перетащите <xref:System.Windows.Forms.DataGridView> из **панели элементов** в область конструктора пользовательского элемента управления.

## <a name="add-the-required-data-binding-attribute"></a>Добавление требуемого атрибута привязки данных

Для сложных элементов управления, поддерживающих привязку к данным, можно реализовать <xref:System.ComponentModel.ComplexBindingPropertiesAttribute>:

1. Переключите элемент управления **ComplexDataGridView** в представление кода. (В меню **Вид** выберите **Код**.)

1. Замените код в `ComplexDataGridView` следующим кодом:

    [!code-csharp[VbRaddataDisplaying#4](../data-tools/codesnippet/CSharp/create-a-windows-forms-user-control-that-supports-complex-data-binding_1.cs)]
    [!code-vb[VbRaddataDisplaying#4](../data-tools/codesnippet/VisualBasic/create-a-windows-forms-user-control-that-supports-complex-data-binding_1.vb)]

1. В меню **Построение** выберите пункт **Построить решение**.

## <a name="create-a-data-source-from-your-database"></a>Создание источника данных из базы данных

Используйте мастер **настройки источника данных** для создания источника данных на основе таблицы `Customers` в образце базы данных Northwind:

1. Чтобы открыть окно **Источники данных** , в меню **данные** выберите команду **отобразить источники данных**.

2. В окне **Источники данных** выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.

3. На странице **Выбор типа источника данных** выберите элемент **База данных** и нажмите **Далее**.

4. На странице **Выбор подключения к базе данных** выполните одно из следующих действий:

   - Если подключение к учебной базе данных Northwind доступно в раскрывающемся списке, то выберите его.

   - Выберите **Новое подключение** для открытия диалогового окна **Добавить/изменить подключение**.

5. Если базе данных требуется пароль, выберите параметр для включения конфиденциальных данных и нажмите кнопку **Далее**.

6. На странице **Сохранение подключения в файле конфигурации приложения** нажмите кнопку **Далее**.

7. Разверните узел **Таблицы** на странице **Выбор объектов базы данных**.

8. Выберите таблицу `Customers` и нажмите кнопку **Готово**.

   Объект **NorthwindDataSet** добавляется в проект, и таблица `Customers` отображается в окне **Источники данных**.

## <a name="set-the-customers-table-to-use-the-complexdatagridview-control"></a>Настройка таблицы Customers для использования элемента управления ComplexDataGridView

Вы можете задать создаваемый элемент управления в окне **Источники данных** перед перетаскиванием элементов на форму.

1. Откройте **Form1** в конструкторе.

1. Разверните узел **Customers** в окне **Источники данных**.

1. Щелкните стрелку раскрывающегося списка в узле **Клиенты** и выберите **Настройка**.

1. Выберите **ComplexDataGridView** в списке **Связанные элементы управления** диалогового окна **Настройка данных интерфейса пользователя**.

1. Щелкните стрелку раскрывающегося списка в таблице `Customers` и выберите **ComplexDataGridView** в списке элементов управления.

## <a name="add-controls-to-the-form"></a>Добавление элементов управления на форму

Вы можете создавать элементы управления с привязкой к данным с помощью перетаскивания элементов из окна **Источники данных** на форму. Перетащите главный узел **Клиенты** из окна **Источники данных** на форму. Убедитесь, что элемент управления **ComplexDataGridView** используется для вывода данных таблицы.

## <a name="run-the-application"></a>Запуск приложения

Нажмите клавишу **F5** для запуска приложения.

## <a name="next-steps"></a>Следующие шаги

В зависимости от требований приложения существуют несколько шагов, которые, возможно, потребуется выполнить после создания элемента управления, поддерживающего привязку к данным. Некоторые типичные дальнейшие действия.

- Помещение пользовательских элементов управления в библиотеку элементов управления, чтобы их можно было повторно использовать в других приложениях.

- Создание элементов управления, поддерживающих сценарии поиска. Дополнительные сведения см. [в разделе создание Windows Forms пользовательского элемента управления, поддерживающего привязку данных подстановки](../data-tools/create-a-windows-forms-user-control-that-supports-lookup-data-binding.md).

## <a name="see-also"></a>См. также

- [Привязка элементов управления Windows Forms к данным в Visual Studio](../data-tools/bind-windows-forms-controls-to-data-in-visual-studio.md)
- [Задание поведения, при котором элемент управления создается при перетаскивании из окна "Источники данных"](../data-tools/set-the-control-to-be-created-when-dragging-from-the-data-sources-window.md)
- [Элементы управления Windows Forms](/dotnet/framework/winforms/controls/index)