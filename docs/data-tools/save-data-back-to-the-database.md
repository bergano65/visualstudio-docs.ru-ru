---
title: Сохранение данных обратно в базу данных
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- datasets [Visual Basic], validating data
- data validation, datasets
- data [Visual Studio], saving
- row version
- updating datasets, constraints
- datasets [Visual Basic], about datasets
- datasets [Visual Basic], merging
- updates, constraints in datasets
- saving data, about saving data
- datasets [Visual Basic], constraints
- TableAdapters
ms.assetid: afe6cb8a-dc6a-428b-b07b-903ac02c890b
author: gewarren
ms.author: gewarren
manager: douge
ms.prod: visual-studio-dev15
ms.technology: vs-data-tools
ms.workload:
- data-storage
ms.openlocfilehash: 43fe5ab7baf168517f92d1bea1024070e5817669
ms.sourcegitcommit: f37affbc1b885dfe246d4b2c295a6538b383a0ca
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2018
ms.locfileid: "37175334"
---
# <a name="save-data-back-to-the-database"></a>Сохранение данных обратно в базу данных

Набор данных является копией в памяти данных. Если изменить эти данные, рекомендуется сохранить эти изменения в базе данных. Одним из трех способов это сделать.

- Путем вызова одного из `Update` методы адаптера таблицы

- Путем вызова одного из `DBDirect` методы адаптера таблицы

- Путем вызова `UpdateAll` метод TableAdapterManager, который Visual Studio создает для вас, если набор данных содержит таблицы, связанные с другими таблицами в наборе данных

Привязка данных таблицы набора данных к элементам управления на странице формы Windows или XAML, архитектура привязки данных делает всю работу за вас.

Если вы знакомы с адаптеры таблиц, можно перейти непосредственно к одному из следующих разделов:

|Раздел|Описание:|
|-----------|-----------------|
|[Вставка новых записей в базу данных](../data-tools/insert-new-records-into-a-database.md)|Как выполнять обновления и вставок с использованием адаптеров таблиц TableAdapter или команд объектов|
|[Обновление данных с помощью адаптера таблицы](../data-tools/update-data-by-using-a-tableadapter.md)|Выполнить обновление с помощью адаптеров таблиц|
|[Иерархическое обновление](../data-tools/hierarchical-update.md)|Выполнить обновление из набора данных с помощью двух или более связанных таблиц|
|[Обработка исключения параллельности](../data-tools/handle-a-concurrency-exception.md)|Как обрабатывать исключения, когда два пользователя пытаются изменить те же данные в базе данных, в то же время|
|[Практическое: сохранение данных с помощью транзакции](../data-tools/save-data-by-using-a-transaction.md)|Как сохранить данные в транзакции в системе. Transactions-пространство имен и объект TransactionScope|
|[Сохранение данных в транзакции](../data-tools/save-data-in-a-transaction.md)|Пошаговое руководство, в котором создается приложение Windows Forms демонстрируется сохранение данных в базу данных внутри транзакции|
|[Сохранение данных в базе данных (несколько таблиц)](../data-tools/save-data-to-a-database-multiple-tables.md)|Изменение записей и сохранение изменений в нескольких таблицах в базе данных|
|[Сохранение данных из объекта в базе данных](../data-tools/save-data-from-an-object-to-a-database.md)|Как передавать данные из объекта, не в наборе данных в базу данных с помощью метода DbDirect адаптера таблицы|
|[Сохранение данных с помощью методов DBDirect адаптера таблицы](../data-tools/save-data-with-the-tableadapter-dbdirect-methods.md)|Способы использования TableAdapter для отправки SQL-запросы непосредственно к базе данных|
|[Сохранение набора данных в формате XML](../data-tools/save-a-dataset-as-xml.md)|Как сохранить набор данных в XML-документ|

## <a name="two-stage-updates"></a>Обновление в два этапа

Обновление источника данных — это двухэтапный процесс. Первым шагом является обновление набора данных и новые записи, измененных записей или удаленных записей. Если ваше приложение никогда не отправляет эти изменения в источнике данных, вы будете завершения обновления.

Если отправить изменения обратно в базе данных, второй этап не требуется. Если вы не используете элементы управления с привязкой данных, необходимо вручную вызвать `Update` метод один адаптер таблицы (или адаптер данных), который используется для заполнения набора данных. Тем не менее можно также использовать различных адаптеров, к примеру, для перемещения данных из одного источника данных в другой или для обновления нескольких источников данных. Если вы не используете привязки данных и сохранение изменений в связанных таблицах, необходимо вручную создать экземпляр переменной автоматически созданные `TableAdapterManager` класса, а затем вызвать его `UpdateAll` метод.

![Концептуальная схема рабочего процесса обновления набора данных](../data-tools/media/vbdatasetupdates.gif)

Набор данных содержит коллекции таблиц, которые содержат коллекции строк. Если вы собираетесь обновить позже базового источника данных, необходимо использовать методы в `DataTable.DataRowCollection` свойство при добавлении или удалении строк. Эти методы выполняют отслеживания изменений, необходимый для обновления источника данных. При вызове метода `RemoveAt` коллекции на свойство строки, удаление не будет передан в базе данных.

## <a name="merge-datasets"></a>Объединение наборов данных

Вы можете обновить содержимое набора данных по *объединение* его с помощью другого набора данных. Это включает в себя копирование содержимого *источника* набора данных в вызывающий набор данных (называется *целевой* набора данных). При объединении наборов данных, для целевого набора данных добавляются новые записи в исходном наборе данных. Кроме того для целевого набора данных добавляются дополнительные столбцы в исходном наборе данных. Объединение наборов данных полезно в том случае, когда у вас есть локальный набор данных и получить второй набор данных из другого приложения. Это также полезно, когда вы получаете второй набор данных из компонента, например к веб-службе XML или когда необходимо интегрировать данные из нескольких наборов данных.

При объединении наборов данных, можно передать логический аргумент (`preserveChanges`), которые сообщают <xref:System.Data.DataSet.Merge%2A> метод необходимость сохранять существующие изменения в конечном наборе данных. Так как наборы данных поддерживают несколько версий записей, важно помнить, что более одной версии записей объединяется. В следующей таблице показаны как объединяется записи в два набора данных:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Уилсон|Джеймс Уилсон C.|
|Текущие|Джим Уилсон|Джеймс Уилсон C.|

Вызов <xref:System.Data.DataSet.Merge%2A> метод в предыдущей таблице с `preserveChanges=false targetDataset.Merge(sourceDataset)` приводит следующие данные:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Уилсон C.|Джеймс Уилсон C.|
|Текущие|Джеймс Уилсон C.|Джеймс Уилсон C.|

Вызов <xref:System.Data.DataSet.Merge%2A> метод с `preserveChanges = true targetDataset.Merge(sourceDataset, true)` приводит следующие данные:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Уилсон C.|Джеймс Уилсон C.|
|Текущие|Джим Уилсон|Джеймс Уилсон C.|

> [!CAUTION]
> В `preserveChanges = true` сценария, если <xref:System.Data.DataSet.RejectChanges%2A> метод вызывается для записи в конечном наборе данных, а затем он возвращается к исходным данным из *источника* набора данных. Это означает, что при попытке обновить исходный источник данных с целевого набора данных, может быть возможность найти исходная строка для обновления. Можно предотвратить нарушение параллелизма, заполнив другой набор данных с помощью обновленных записей из источника данных и затем выполняет слияние для предотвращения одновременного нарушения. (Нарушение параллелизма происходит, когда другой пользователь изменяет запись в источнике данных после заполнения набора данных).

## <a name="update-constraints"></a>Обновить ограничения

Чтобы внести изменения в существующую строку данных, добавить или обновить данные в отдельных столбцах. Если набор данных содержит ограничения (например, внешние ключи или ограничения, не допускающие значения NULL), это возможно, что запись может временно находиться в состоянии ошибки при ее обновлении. То есть он может быть в состоянии ошибки, после завершения обновления одного столбца, но прежде чем перейти к следующему.

Во избежание преждевременных нарушений ограничений можно временно приостановить ограничения на обновление. Это служит двум целям:

- Он предотвращает ошибку вызываемом после завершения обновления одного столбца, но еще не запущена, обновления другой.

- Это предотвращает определенные обновления события из процесса (события, которые часто используются для проверки).

> [!NOTE]
> В Windows Forms, архитектуру привязки данных, который встроен в datagrid приостанавливает проверку, пока фокус перемещается за пределы строки, и у вас нет явного вызова ограничений <xref:System.Data.DataRow.BeginEdit%2A>, <xref:System.Data.DataRow.EndEdit%2A>, или <xref:System.Data.DataRow.CancelEdit%2A> методы.

Ограничения можно автоматически отключены при <xref:System.Data.DataSet.Merge%2A> метод вызывается в наборе данных. По завершении слияния, если все ограничения набора данных, который не может быть включен, <xref:System.Data.ConstraintException> возникает исключение. В этом случае <xref:System.Data.DataSet.EnforceConstraints%2A> свойству `false,` и все нарушения ограничений должны быть решены <xref:System.Data.DataSet.EnforceConstraints%2A> свойства `true`.

После завершения обновления, вы можете повторно включить проверку ограничений, что также разрешает события обновления и инициирует их.

Дополнительные сведения о делегатах см. в разделе [отключение ограничений при заполнении набора данных](../data-tools/turn-off-constraints-while-filling-a-dataset.md).

## <a name="dataset-update-errors"></a>Ошибки обновления набора данных

При обновлении записи в наборе данных, есть вероятность ошибки. Например можно случайно записать данные неверного типа в столбец или данных, слишком длинное или с другими проблемами целостности. Или, возможно, относящиеся к приложению проверки, которые могут вызывать пользовательские ошибки в любом этапе выполнения события обновления. Дополнительные сведения см. в разделе [проверки данных в наборах данных](../data-tools/validate-data-in-datasets.md).

## <a name="maintain-information-about-changes"></a>Сохранить сведения об изменениях

Сведения об изменениях в наборе данных поддерживается двумя способами: путем пометки строк, которые указывают, что они были изменены (<xref:System.Data.DataRow.RowState%2A>) и счет хранения нескольких копий записи (<xref:System.Data.DataRowVersion>). С помощью этих сведений, процессы, можно определить, что изменилось в наборе данных и отправлять соответствующие обновления в источнике данных.

### <a name="rowstate-property"></a>Свойства RowState

<xref:System.Data.DataRow.RowState%2A> Свойство <xref:System.Data.DataRow> объект является значение, предоставляющее сведения о состоянии конкретной строки данных.

В следующей таблице приведены возможные значения <xref:System.Data.DataRowState> перечисления:

|Значение DataRowState|Описание:|
|------------------------|-----------------|
|<xref:System.Data.DataRowState.Added>|Строка была добавлена как элемент <xref:System.Data.DataRowCollection>. (Строку в это состояние не имеет соответствующей исходной версии, так как она не существовала при последней <xref:System.Data.DataRow.AcceptChanges%2A> был вызван метод).|
|<xref:System.Data.DataRowState.Deleted>|Строка была удалена с помощью <xref:System.Data.DataRow.Delete%2A> из <xref:System.Data.DataRow> объекта.|
|<xref:System.Data.DataRowState.Detached>|Строка, будет создана, но не является частью какой-либо <xref:System.Data.DataRowCollection>. Объект <xref:System.Data.DataRow> объект находится в этом состоянии сразу же после его создания, прежде чем он добавлен в коллекцию, а после его удаления из коллекции.|
|<xref:System.Data.DataRowState.Modified>|Значение столбца в строке был изменен каким-либо образом.|
|<xref:System.Data.DataRowState.Unchanged>|Строка не была изменена с момента <xref:System.Data.DataRow.AcceptChanges%2A> последнего вызова метода.|

### <a name="datarowversion-enumeration"></a>DataRowVersion - перечисление

Наборы данных поддерживают несколько версий записей. <xref:System.Data.DataRowVersion> Поля, используемые при получении значения в <xref:System.Data.DataRow> с помощью <xref:System.Data.DataRow.Item%2A> свойство или <xref:System.Data.DataRow.GetChildRows%2A> метод <xref:System.Data.DataRow> объекта.

В следующей таблице приведены возможные значения <xref:System.Data.DataRowVersion> перечисления:

|Значение DataRowVersion|Описание:|
|--------------------------|-----------------|
|<xref:System.Data.DataRowVersion.Current>|Текущая версия записи содержит все изменения, выполненных на записи с момента последнего <xref:System.Data.DataRow.AcceptChanges%2A> был вызван. Если строка была удалена, нет в текущей версии нет.|
|<xref:System.Data.DataRowVersion.Default>|Значение по умолчанию записи, в соответствии с определением источник схемы или данных набора данных.|
|<xref:System.Data.DataRowVersion.Original>|Исходная версия записи является копией записи, сделанной в последнее время изменения были зафиксированы в наборе данных. На практике это обычно версия записи как прочитанное из источника данных.|
|<xref:System.Data.DataRowVersion.Proposed>|Предлагаемая версия записи доступна временно, пока не завершено обновление — то есть между моментом, когда вызывается <xref:System.Data.DataRow.BeginEdit%2A> метод и <xref:System.Data.DataRow.EndEdit%2A> метод. Обычно к предлагаемой версии записи в обработчике для события, такие как <xref:System.Data.DataTable.RowChanging>. Вызов <xref:System.Data.DataRow.CancelEdit%2A> метод отменяет изменения и удаляет предлагаемую версию строки данных.|

Исходные и текущие версии полезны при передаче обновленных сведений к источнику данных. Как правило когда обновление отправляется к источнику данных, новые сведения для базы данных — в текущей версии записи. Информация от первоначальной версии используется для поиска записи для обновления.

Например в случае, когда изменяется первичный ключ записи, требуется способ найти запись в источнике данных, чтобы внести изменения. Если исходной версии нет, то запись, скорее всего добавится к источнику данных, в результате чего не только в записи о дополнительных нежелательных, но в одну запись, которая является неточным и устаревших. Две версии также используются в управлении параллелизмом. Вы можете сравнить исходную версию для записи в источнике данных, чтобы определить, изменилась ли запись после ее загрузки в набор данных.

Предложенная полезно в тех случаях, когда необходимо выполнить проверку до внесения изменений в набор данных.

Даже если записи были изменены, не всегда исходная или текущая версия этой строки. При вставке новой строки в таблицу, не существует исходной версии, только текущей версии. Аналогично Если удалить строку путем вызова в таблице `Delete` метод, есть только исходная версия, но не текущей версии.

Можно проверить наличие определенной версии записи, запрашивая строку данных <xref:System.Data.DataRow.HasVersion%2A> метод. Можно получить доступ к любой версии записи путем передачи <xref:System.Data.DataRowVersion> значение перечисления в качестве дополнительного аргумента при запросе значения столбца.

## <a name="get-changed-records"></a>Получение измененных записей

Это распространенная практика не выполнять обновление всех записей в наборе данных. Например, пользователь может работать с формами Windows <xref:System.Windows.Forms.DataGridView> элемент управления, отображающий несколько записей. Тем не менее пользователь может обновить только несколько записей, удалить одну и вставить новую. Наборы данных и таблицы данных предоставляют метод (`GetChanges`) для возвращения только строк, которые были изменены.

Можно создать подмножества измененных записей с помощью `GetChanges` метод таблицы данных (<xref:System.Data.DataTable.GetChanges%2A>) или набора данных (<xref:System.Data.DataSet.GetChanges%2A>) сам. Если метод вызывается для таблицы данных, он возвращает копию таблицы, измененные записи. Аналогичным образом Если вызвать метод на основе набора данных, вы получите новый набор данных с помощью только измененные записи в нем.

`GetChanges` сама по себе возвращает все измененные записи. Напротив, передавая нужное <xref:System.Data.DataRowState> в качестве параметра `GetChanges` метод, можно указать какое подмножество измененных записей требуется: добавленные записи, которые помечены для удаления, отсоединенные записи или измененные записи.

Получение подмножества измененных записей полезно в том случае, если вы хотите отправить другому компоненту для обработки записей. Вместо отправки всего набора данных, можно сократить расходы на взаимодействии с другим компонентом, получая только записи, необходимые для компонента.

## <a name="commit-changes-in-the-dataset"></a>Зафиксируйте изменения в наборе данных

При внесении изменений в наборе данных, <xref:System.Data.DataRow.RowState%2A> свойству измененных строк. Установить, поддерживаются и становятся доступными для вас группой исходные и текущие версии записей <xref:System.Data.DataRowView.RowVersion%2A> свойство. Метаданные, которые хранятся в свойствах этих измененных строк необходим для отправки необходимые обновления к источнику данных.

Если изменения отражают текущее состояние источника данных, больше не нужно сохранять эти сведения. Как правило существует два раза при набора данных и его источником синхронизированы.

- Сразу после загрузки сведений в набор данных, например при считывании данных из источника.

- После отправки изменений из набора данных к источнику данных (но не раньше, поскольку будут потеряны сведения об изменениях, необходимое для отправки изменений в базу данных).

Можно зафиксировать ожидающие изменения в набор данных, вызвав <xref:System.Data.DataSet.AcceptChanges%2A> метод. Как правило <xref:System.Data.DataSet.AcceptChanges%2A> вызывается в следующих случаях:

- После его загрузки набора данных. При загрузке набора данных путем вызова адаптера `Fill` метод, а затем адаптер автоматически выполняет изменения. Тем не менее при загрузке набора данных путем его слияния с другим набором данных, затем необходимо зафиксировать изменения вручную.

    > [!NOTE]
    > Вы можете запретить адаптер автоматически фиксации изменений, при вызове `Fill` метод, задав `AcceptChangesDuringFill` свойства адаптера, который `false`. Если он становится равным `false`, то <xref:System.Data.DataRow.RowState%2A> каждой строки, вставляемой при заполнении присваивается <xref:System.Data.DataRowState.Added>.

- После отправки изменений набора данных к другому процессу, например веб-службы XML.

    > [!CAUTION]
    > Применение изменений таким образом, будут удалены все сведения об изменениях. Не фиксации изменений, пока после того как вы завершите выполнение операций, которые требуют, чтобы знать, какие изменения были внесены в наборе данных приложение.

Этот метод выполняет следующее:

- Записывает <xref:System.Data.DataRowVersion.Current> версию записи в его <xref:System.Data.DataRowVersion.Original> версии и перезаписывает исходную версию.

- Удаляет любую строку, где <xref:System.Data.DataRow.RowState%2A> свойству <xref:System.Data.DataRowState.Deleted>.

- Наборы <xref:System.Data.DataRow.RowState%2A> свойства записи для <xref:System.Data.DataRowState.Unchanged>.

<xref:System.Data.DataSet.AcceptChanges%2A> Метод доступен на трех уровнях. Его можно вызвать для <xref:System.Data.DataRow> объект фиксации изменения только для этой строки. Его также можно вызвать для <xref:System.Data.DataTable> объекта, чтобы выполнить все строки в таблице. Наконец, вы можете вызывать для <xref:System.Data.DataSet> объекта, чтобы выполнить все ожидающие изменения для всех записей всех таблиц набора данных.

В следующей таблице описаны изменения, выполняемые в зависимости от метода называется на:

|Метод|Результат|
|------------|------------|
|<xref:System.Data.DataRow.AcceptChanges%2A?displayProperty=fullName>|Изменения производятся только в определенной строке.|
|<xref:System.Data.DataTable.AcceptChanges%2A?displayProperty=fullName>|Изменения вносятся во все строки данной таблицы.|
|<xref:System.Data.DataSet.AcceptChanges%2A?displayProperty=fullName>|Изменения вносятся во все строки всех таблиц набора данных.|

> [!NOTE]
> При загрузке набора данных путем вызова адаптера `Fill` метод, вам не нужно явным образом принять изменения. По умолчанию `Fill` вызовы методов `AcceptChanges` метод после завершения заполнения таблицы данных.

Связанный метод <xref:System.Data.DataSet.RejectChanges%2A>, отменяет изменения, скопировав <xref:System.Data.DataRowVersion.Original> версии обратно в <xref:System.Data.DataRowVersion.Current> версии записей. Он также задает <xref:System.Data.DataRow.RowState%2A> каждой записи обратно к <xref:System.Data.DataRowState.Unchanged>.

## <a name="data-validation"></a>Проверка данных

Часто, чтобы проверить соответствие требованиям процессов, передаче данных в приложении, необходимо добавить проверку. Для этого может потребоваться ввод пользователя в форме может быть правильным, проверка данных, который отправляется в приложение другим приложением, или даже проверки, что сведения, определяемые в компоненте подпадают под ограничения источника данных и требований к приложениям.

Можно проверить данные несколькими способами:

- Бизнес-уровне, добавив код в приложении для проверки данных. Набор данных является централизованно, это можно сделать. Набор данных предоставляет некоторые преимущества проверки серверной части, такие как возможность проверить изменения, как изменяются значения столбцов и строк. Дополнительные сведения см. в разделе [проверки данных в наборах данных](../data-tools/validate-data-in-datasets.md).

- На уровне представления данных, путем добавления проверки форм. Дополнительные сведения см. в разделе [пользовательского ввода проверка в Windows Forms](/dotnet/framework/winforms/user-input-validation-in-windows-forms).

- В данных серверной части, отправляя данные в источнике данных — например, база данных и ему можно принять или отклонить данные. При работе с базой данных с расширенными возможностями для проверки данных и предоставления сведений об ошибке, это может быть практический подход, так как можно проверить данные независимо от того, откуда были получены. Тем не менее этот подход не может вместить требования проверки для конкретного приложения. Кроме того Если источник данных проверки данных может привести множество циклов к источнику данных, в зависимости от того, как приложения упрощает разрешение ошибок проверки возникает со стороны серверной части.

   > [!IMPORTANT]
   > При использовании команды обработки данных с <xref:System.Data.SqlClient.SqlCommand.CommandType%2A> свойство, которое будет присвоено <xref:System.Data.CommandType.Text>, тщательно проверяйте информацию, отправляемые с клиента перед передачей его к базе данных. Пользователи-злоумышленники могут попытаться отправить (внедрить) модифицированные или добавочные инструкции SQL с целью получения несанкционированного доступа или повреждения БД. Прежде чем передавать входные данные пользователя в базе данных, всегда проверяйте, что информация верна. Рекомендуется всегда использовать параметризованные запросы или хранимые процедуры, если это возможно.

## <a name="transmit-updates-to-the-data-source"></a>Передавать обновления в источнике данных

После внесения изменений в наборе данных, могут передавать изменения к источнику данных. Чаще всего это сделать, вызвав `Update` метод адаптера таблицы (или адаптер данных). Этот метод в цикле каждой записи в таблице данных, определяет тип выполняемого обновления (update, insert или delete), если таковые имеются, а затем выполняет соответствующую команду.

В качестве иллюстрации того, как выполняются обновления Предположим, что приложение использует набор данных, содержащий в одну таблицу данных. Приложение извлекает две строки из базы данных. После извлечения данных в памяти таблица выглядит следующим образом:

```sql
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Unchanged)    c400         Nancy Buchanan    Pending
```

Приложение изменяет состояние Иван Иванов «Основной». В результате этого изменения значение <xref:System.Data.DataRow.RowState%2A> свойства для этой строки меняется с <xref:System.Data.DataRowState.Unchanged> для <xref:System.Data.DataRowState.Modified>. Значение <xref:System.Data.DataRow.RowState%2A> свойство для первой строки остается <xref:System.Data.DataRowState.Unchanged>. В таблице данных теперь выглядит следующим образом:

```sql
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Modified)     c400         Nancy Buchanan    Preferred
```

Теперь в приложении вызывается `Update` метод для передачи набора данных в базу данных. Метод в свою очередь проверяет каждую строку. Для первой строки метод передает без инструкции SQL в базу данных, так как этой строки не изменилась со времени ее извлечения из базы данных.

Во второй строке, однако `Update` метод автоматически вызывается команда правильные данные и передает их в базу данных. Особый синтаксис инструкции SQL зависят от диалекта SQL, который поддерживается в базовом хранилище данных. Но общие черты передаваемая инструкция SQL заслуживают внимания:

- Передаваемая инструкция SQL является инструкцией UPDATE. Адаптер знает, как использовать инструкции UPDATE, так как значение <xref:System.Data.DataRow.RowState%2A> свойство <xref:System.Data.DataRowState.Modified>.

- Передаваемая инструкция SQL включает предложение WHERE, указывающее, что целевой объект инструкции UPDATE является строкой, где `CustomerID = 'c400'`. Эта часть инструкции SELECT выбирает нужную строку всех остальных поскольку `CustomerID` является первичным ключом целевой таблицы. Сведения о предложении WHERE является производным от первоначальной версии записи (`DataRowVersion.Original`), в случае изменения значений, которые необходимы для идентификации строки.

- Передаваемая инструкция SQL включает в себя предложение SET для установки новых значений измененных столбцов.

   > [!NOTE]
   > Если TableAdapter `UpdateCommand` свойство было присвоено имя хранимой процедуры, адаптер создает инструкцию SQL. Вместо этого он вызывает хранимую процедуру с соответствующими параметрами, переданный.

## <a name="pass-parameters"></a>Передача параметров

Параметры обычно используются для передачи значений для записей, которые будут обновлены в базе данных. Когда TableAdapter `Update` метод выполняет инструкцию UPDATE, ему необходимо заполнить значения параметров. Он получает эти значения из `Parameters` сбор данных для соответствующей команды данных — в этом случае `UpdateCommand` объекта в TableAdapter.

Если вы использовали средства Visual Studio для создания адаптера обработки данных, `UpdateCommand` объект содержит коллекцию параметров, соответствующих каждому шаблону параметра в инструкции.

<xref:System.Data.SqlClient.SqlParameter.SourceColumn%2A?displayProperty=fullName> Свойства каждого параметра указывает на столбец в таблице данных. Например `SourceColumn` свойство для `au_id` и `Original_au_id` устанавливается на любой столбец в таблице данных содержит идентификатор автора. Когда адаптера `Update` выполнения метода, он считывает автор идентификатор из записи, которая обновляется и заполняет значения в инструкции.

В инструкции UPDATE необходимо указать и новые значения (те, которые будут записаны в запись), а также, старые значения (таким образом, запись может находиться в базе данных). Есть, таким образом, два параметра для каждого значения: один для предложения SET, а другой — для предложения WHERE. Оба параметра чтение данных из записи, которая обновляется, но получают разные версии значений столбца, на основе параметра <xref:System.Data.SqlClient.SqlParameter.SourceVersion> свойство. Параметр для предложения SET получает текущую версию, и параметр в предложении WHERE Получает исходную версию.

> [!NOTE]
> Можно также задать значения `Parameters` коллекции самостоятельно в коде, который вы обычно выполняете в обработчик событий для адаптера данных <xref:System.Data.DataTable.RowChanging> событий.

## <a name="see-also"></a>См. также

- [Инструменты для работы с наборами данных в Visual Studio](../data-tools/dataset-tools-in-visual-studio.md)
- [Создание и настройка адаптеров таблиц](create-and-configure-tableadapters.md)
- [Обновление данных с помощью адаптера таблицы](../data-tools/update-data-by-using-a-tableadapter.md)
- [Привязка элементов управления к данным в Visual Studio](../data-tools/bind-controls-to-data-in-visual-studio.md)
- [Проверка данных](validate-data-in-datasets.md)
- [Практическое: Добавление, изменение и удаление сущностей (службы данных WCF)](/dotnet/framework/data/wcf/how-to-add-modify-and-delete-entities-wcf-data-services)