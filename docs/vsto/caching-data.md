---
title: Кэширование данных
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data caching [Office development in Visual Studio], about caching data
- data [Office development in Visual Studio], caching
- data caching [Office development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: c6e0f6d7fcf9920ddb8861712b7c5f8bf04506fc
ms.sourcegitcommit: d0425b6b7d4b99e17ca6ac0671282bc718f80910
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2019
ms.locfileid: "56616772"
---
# <a name="cache-data"></a>Кэширование данных
  Вы можете кэшировать объекты данных в настройке уровня документа, таким образом, чтобы данные может осуществляться автономно или без открытия Microsoft Office Word или Microsoft Office Excel. Для кэширования объекта, объект должен иметь тип данных, который соответствует определенным требованиям. Многие общие типы данных в .NET Framework этим требованиям, включая <xref:System.String>, <xref:System.Data.DataSet>, и <xref:System.Data.DataTable>.

 [!INCLUDE[appliesto_alldoc](../vsto/includes/appliesto-alldoc-md.md)]

 Чтобы добавить объект в кэш данных двумя способами:

- Чтобы добавить объект в кэш данных, при сборке решения, примените <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute> атрибут объявления объекта. Дополнительные сведения см. в разделе [Как Кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).

- Чтобы программным способом добавить объект в кэш данных во время выполнения, используйте `StartCaching` метода ведущего элемента, такого как `ThisDocument` или `ThisWorkbook` классы. Дополнительные сведения см. в разделе [Как Программное кэширование источника данных в документах Office](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md).

  После добавления объекта в кэш данных, можно использовать и изменять кэшированные данные без запуска Word или Excel. Дополнительные сведения см. в разделе [доступа к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).

## <a name="requirements-for-data-objects-to-be-cached"></a>Требования для кэшируемых объектов данных
 Чтобы кэшировать объект данных в решении, объект должен удовлетворять следующим требованиям:

- Быть чтение и запись открытое поле или свойство ведущего элемента, например `ThisDocument` или `ThisWorkbook` классы.

- Не быть индексатором или другие свойства с параметрами.

  Кроме того, объект данных должен быть сериализуем методом <xref:System.Xml.Serialization.XmlSerializer> класс, который означает, что тип объекта должен иметь следующие характеристики:

- Быть открытым.

- Иметь открытый конструктор без параметров.

- Не выполнять код, требующий дополнительных привилегий безопасности.

- Предоставляют только чтение и запись открытые свойства (другие свойства будут игнорироваться).

- Предоставляет многомерные массивы (вложенные массивы допускаются).

- Не возвращайте интерфейсы из свойств и полей.

- Реализует <xref:System.Collections.IDictionary> если коллекция.

  При кэшировании объекта данных, [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] сериализует объект в XML-строку, которая хранится в *пользовательской XML-части* в документе. Дополнительные сведения см. в разделе [Общие сведения о частях XML настраиваемого](../vsto/custom-xml-parts-overview.md).

## <a name="cached-data-size-limits"></a>Ограничения на размер кэшированных данных
 Существуют некоторые ограничения на объем данных, которые можно добавить в кэш данных в документе и размер каждого отдельного объекта в кэше данных. Если превысить эти ограничения, приложение может неожиданно закрыться при сохранении данных в кэш данных.

 Чтобы избежать этих ограничений, выполните следующие рекомендации:

- Не добавляйте в кэш данных любого объекта, размер которых превышает 10 МБ.

- Не добавляйте более чем 100 МБ данных в кэш данных в одном документе.

  Это приблизительные значения. Точные ограничения зависят от нескольких факторов, включая доступной оперативной памяти и количество выполняемых процессов.

## <a name="control-the-behavior-of-cached-objects"></a>Управлять поведением кэшированных объектов
 Чтобы получить больший контроль над поведением кэшированный объект, можно реализовать <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType> интерфейса для типа кэшированного объекта. Например можно реализовать этот интерфейс, если вы хотите управлять, как пользователь получает уведомление при изменении объекта. Примеры кода, демонстрирующие способы реализации <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType>, см. в разделе `ControlCollection` в пример динамических элементов управления Excel и Word пример динамических элементов управления в [примеры разработки решений Office и пошаговые руководства](../vsto/office-development-samples-and-walkthroughs.md).

## <a name="persist-changes-to-cached-data-in-password-protected-documents"></a>Сохранение изменений к кэшированным данным в документах, защищенный паролем
 Если вы кэшировать объекты данных в документе, защищенном паролем, изменения кэшированных данных не сохраняются. Можно сохранить изменения в кэшированных данных путем переопределения двух методов. Переопределить эти методы, чтобы временно удалить защиту при сохранении документа, а затем повторно применить защиту после сохранения операция завершена.

 Дополнительные сведения см. в разделе [Как Кэширование данных в документе, защищенном паролем](../vsto/how-to-cache-data-in-a-password-protected-document.md).

## <a name="prevent-data-loss-when-adding-null-values-to-the-data-cache"></a>Предотвратить потерю данных при добавлении в кэш данных значения null
 При добавлении объектов в кэш данных, все кэшированные объекты должны быть инициализированы, отличному от**null** значение перед сохранении и закрытии документа. Если кэшированный объект имеет **null** значение при сохранении и закрытии документа [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] будут автоматически удалены все кэшированные объекты из кэша данных.

 При добавлении объекта с **null** значение для кэширования данных с помощью <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute> атрибут во время разработки, можно использовать <xref:Microsoft.VisualStudio.Tools.Applications.ServerDocument> объектов класса для инициализации кэшированных данных, перед открытием документа. Это полезно, если вы хотите инициализировать кэшированных данных на сервере без установленного перед конечным пользователем открыт документ Word или Excel. Дополнительные сведения см. в разделе [доступа к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).

## <a name="see-also"></a>См. также
- [Практическое руководство. Кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md)
- [Практическое руководство. Программное кэширование источника данных в документах Office](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md)
- [Практическое руководство. Кэширование данных в документе, защищенном паролем](../vsto/how-to-cache-data-in-a-password-protected-document.md)
- [Пошаговое руководство: Создайте отношение основной/подробности, с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md)
