---
title: Пошаговое руководство. сложная привязка данных в проекте уровня документа
description: Узнайте, как можно привязать несколько ячеек в листе Microsoft Excel к полям в базе данных SQL Server Northwind.
ms.custom: SEO-VS-2020
titleSuffix: ''
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data [Office development in Visual Studio], binding data
- complex data [Office development in Visual Studio]
- multiple column data binding [Office development in Visual Studio]
- data binding [Office development in Visual Studio], multiple columns
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: 2dc5708da09074c7d973336958c9e89c16bf9da6
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99927669"
---
# <a name="walkthrough-complex-data-binding-in-a-document-level-project"></a>Пошаговое руководство. сложная привязка данных в проекте уровня документа
  В этом пошаговом руководстве демонстрируются основы сложной привязки данных в проекте уровня документа. Можно привязать несколько ячеек в Microsoft Office листе Excel к полям базы данных SQL Server Northwind.

 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]

 В этом пошаговом руководстве описаны следующие задачи:

- Добавление источника данных в проект книги.

- Добавление элементов управления с привязкой к данным на лист.

- Сохранение изменений данных обратно в базу данных.

  [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения этого пошагового руководства требуются следующие компоненты:

- [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]

- [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].

- Доступ к серверу с помощью образца базы данных Northwind SQL Server.

- Разрешения на чтение и запись в базу данных SQL Server.

## <a name="create-a-new-project"></a>Создание нового проекта
 Первым шагом является создание проекта книги Excel.

### <a name="to-create-a-new-project"></a>Создание нового проекта

1. Создайте проект книги Excel с именем **Моя сложная привязка данных**. В мастере выберите **создать новый документ**.

     Дополнительные сведения см. в разделе [How to: Create Office Projects in Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).

     Visual Studio откроет новую книгу Excel в конструкторе и добавит проект " **сложная привязка данных** " в **Обозреватель решений**.

## <a name="create-the-data-source"></a>Создание источника данных
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.

### <a name="to-create-the-data-source"></a>Создание источника данных

1. Если окно **Источники данных** не отображается, отобразите его с помощью команды **Просмотреть**  >  **другие**  >  **Источники данных** Windows в строке меню.

2. Выберите команду **Добавить новый источник данных** , чтобы запустить **Мастер настройки источника данных**.

3. Выберите **база данных** и нажмите кнопку **Далее**.

4. Выберите подключение данных к образцу базы данных Northwind SQL Server или добавьте новое соединение с помощью кнопки **создать подключение** .

5. После выбора или создания соединения нажмите кнопку **Далее**.

6. Снимите флажок сохранить соединение, если он установлен, а затем нажмите кнопку **Далее**.

7. Разверните узел **таблицы** в окне **объекты базы данных** .

8. Установите флажок рядом с таблицей **Employees** .

9. Нажмите кнопку **Готово**.

   Мастер добавит таблицу **Employees** в окно **Источники данных** . Он также добавляет в проект типизированный набор данных, видимый в **Обозреватель решений**.

## <a name="add-controls-to-the-worksheet"></a>Добавление элементов управления на лист
 При открытии книги на листе отобразится таблица **Employees** . Пользователи смогут вносить изменения в данные, а затем сохранять эти изменения обратно в базу данных, нажимая кнопку.

 Чтобы автоматически привязать лист к таблице, можно добавить <xref:Microsoft.Office.Tools.Excel.ListObject> элемент управления в лист из окна **Источники данных** . Чтобы предоставить пользователю возможность сохранять изменения, добавьте <xref:System.Windows.Forms.Button> элемент управления из **панели элементов**.

#### <a name="to-add-a-list-object"></a>Добавление объекта List

1. Убедитесь, что в конструкторе Visual Studio открыта книга " **Мои сложные данные Binding.xlsx** " с отображаемым **Лист1** .

2. Откройте окно **Источники данных** и выберите узел **сотрудники** .

3. Щелкните появившуюся стрелку раскрывающегося списка.

4. В раскрывающемся списке выберите элемент **ListObject** .

5. Перетащите таблицу **Employees** в ячейку **A6**.

     <xref:Microsoft.Office.Tools.Excel.ListObject>Элемент управления с именем `EmployeesListObject` создается в ячейке **A6**. В то же время в <xref:System.Windows.Forms.BindingSource> `EmployeesBindingSource` проект добавляются именованный, адаптер таблицы и <xref:System.Data.DataSet> экземпляр. Элемент управления привязан к <xref:System.Windows.Forms.BindingSource> , который, в свою очередь, привязан к <xref:System.Data.DataSet> экземпляру.

### <a name="to-add-a-button"></a>Добавление кнопки

1. На вкладке **Общие элементы управления** **панели элементов** добавьте <xref:System.Windows.Forms.Button> элемент управления в ячейку **a4** листа.

   Следующим шагом является добавление текста к кнопке при открытии листа.

## <a name="initialize-the-control"></a>Инициализация элемента управления
 Добавьте текст к кнопке в <xref:Microsoft.Office.Tools.Excel.Worksheet.Startup> обработчике событий.

### <a name="to-initialize-the-control"></a>Инициализация элемента управления

1. В **Обозреватель решений** щелкните правой кнопкой мыши **Лист1. vb** или **Sheet1.CS** и выберите в контекстном меню пункт **Просмотреть код** .

2. Добавьте следующий код в метод, `Sheet1_Startup` чтобы задать текст для b `utton` .

    [!code-csharp[Trin_VstcoreDataExcel#8](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#8)]
    [!code-vb[Trin_VstcoreDataExcel#8](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#8)]

3. Только для C# добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> события в `Sheet1_Startup` метод.

    [!code-csharp[Trin_VstcoreDataExcel#9](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#9)]

   Теперь добавьте код, обрабатывающий <xref:System.Windows.Forms.Control.Click> событие кнопки.

## <a name="save-changes-to-the-database"></a>Сохранение изменений в базе данных
 Все изменения, внесенные в данные, существуют только в локальном наборе данных до тех пор, пока они не будут явно сохранены в базе данных.

### <a name="to-save-changes-to-the-database"></a>Сохранение изменений в базе данных

1. Добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> события `button` и добавьте следующий код, чтобы зафиксировать все изменения, внесенные в набор данных, обратно в базу данных.

     [!code-csharp[Trin_VstcoreDataExcel#10](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#10)]
     [!code-vb[Trin_VstcoreDataExcel#10](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#10)]

## <a name="test-the-application"></a>Тестирование приложения
 Теперь можно протестировать книгу, чтобы убедиться, что данные отображаются должным образом, и что вы можете управлять данными в объекте списка.

### <a name="to-test-the-data-binding"></a>Проверка привязки данных

- Нажмите клавишу **F5**.

     Убедитесь, что при открытии книги объект списка заполняется данными из таблицы **Employees** .

### <a name="to-modify-data"></a>Изменение данных

1. Щелкните ячейку **B7**, которая должна содержать имя **Белова**.

2. Введите имя **Андерсон (** и нажмите клавишу **Ввод**.

### <a name="to-modify-a-column-header"></a>Изменение заголовка столбца

1. Щелкните ячейку, содержащую заголовок столбца **LastName**.

2. Введите **Last Name**, включая пробел между двумя словами, и нажмите клавишу **Ввод**.

### <a name="to-save-data"></a>Сохранение данных

1. Нажмите кнопку **сохранить** на листе.

2. Выйдите из Excel. При появлении запроса на сохранение внесенных изменений нажмите кнопку **нет** .

3. Нажмите клавишу **F5** , чтобы снова запустить проект.

     Объект списка заполняется данными из таблицы **Employees** .

4. Обратите внимание, что имя в ячейке **B7** по-прежнему **Андерсон (**, то есть изменение данных, внесенное и сохраненное в базе данных. Заголовок столбца **LastName** изменен обратно на первоначальную форму без пробелов, так как заголовок столбца не привязан к базе данных, и изменения, внесенные в лист, не были сохранены.

### <a name="to-add-new-rows"></a>Добавление новых строк

1. Выберите ячейку внутри объекта списка.

    В нижней части списка появится новая строка со звездочкой ( **\*** ) в первой ячейке новой строки.

2. Добавьте следующие сведения в пустую строку.

   |EmployeeID|LastName|FirstName|Название|
   |----------------|--------------|---------------|-----------|
   |10|Ito|Shu|Sales Manager|

### <a name="to-delete-rows"></a>Удаление строк

- Щелкните правой кнопкой мыши число 16 (строка 16) в дальней левой части листа и выберите команду **Удалить**.

### <a name="to-sort-the-rows-in-the-list"></a>Сортировка строк в списке

1. Выберите ячейку внутри списка.

     Кнопки со стрелками отображаются в заголовке каждого столбца.

2. Нажмите кнопку со стрелкой в заголовке столбца **Last Name (фамилия** ).

3. Щелкните **Сортировать по возрастанию**.

     Строки сортируются в алфавитном порядке по фамилиям.

### <a name="to-filter-information"></a>Фильтрация сведений

1. Выберите ячейку внутри списка.

2. В заголовке столбца **заголовок** нажмите кнопку со стрелкой.

3. Щелкните **торговый представителя**.

     В списке отображаются только те строки, которые имеют **торгового представителя** в столбце **Title** .

4. Снова нажмите кнопку со стрелкой в заголовке столбца **заголовок** .

5. Щелкните **(все)**.

     Фильтрация будет удалена, и отобразятся все строки.

## <a name="next-steps"></a>Дальнейшие действия
 В этом пошаговом руководстве показаны основные принципы привязки таблицы в базе данных к объекту списка. Ниже приводятся некоторые из возможных последующих задач.

- Кэшировать данные, чтобы их можно было использовать в автономном режиме. Дополнительные сведения см. в разделе [как кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).

- Разверните решение. Дополнительные сведения см. в разделе [развертывание решения Office](../vsto/deploying-an-office-solution.md).

- Создание связи "основной/подробности" между полем и таблицей. Дополнительные сведения см. в разделе [Пошаговое руководство. Создание связи с основными сведениями с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md).

## <a name="see-also"></a>См. также раздел
- [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)
- [Данные в решениях Office](../vsto/data-in-office-solutions.md)
- [Пошаговое руководство. Простая привязка данных в проекте уровня документа](../vsto/walkthrough-simple-data-binding-in-a-document-level-project.md)
