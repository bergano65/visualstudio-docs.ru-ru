---
title: Развертывание решения Office с помощью ClickOnce
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, deploying solutions
- ClickOnce deployment [Office development in Visual Studio], deploying solutions
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: 940cf70047437c8aa3182121e8b1585b448018f8
ms.sourcegitcommit: 1fc6ee928733e61a1f42782f832ead9f7946d00c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2019
ms.locfileid: "60060745"
---
# <a name="deploy-an-office-solution-by-using-clickonce"></a>Развертывание решения Office с помощью ClickOnce
  Решение Office можно развернуть быстрее, если использовать ClickOnce. При публикации обновлений решение автоматически обнаруживает и устанавливает их. Однако для использования ClickOnce необходимо устанавливать решение отдельно для каждого пользователя компьютера. Таким образом, следует с помощью установщика Windows (*.msi*) Если несколько пользователей будут запускать решение на одном компьютере.

## <a name="in-this-topic"></a>Содержание раздела

- [Публикация решения](#Publish)

- [Выбор способа предоставления доверия решению](#Trust)

- [Помощь пользователям при установке решения](#Helping)

- [Размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)](#Put)

- [Размещение документа решения на сервере, на котором выполняется SharePoint (только для настроек уровня документа)](#SharePoint)

- [Создание пользовательского установщика](#Custom)

- [Публикация обновления](#Update)

- [Изменение расположения установки решения](#Location)

- [Откат решения к более ранней версии](#Roll)

  Дополнительные сведения о развертывании решения Office путем создания файла установщика Windows, см. в разделе [развертывание решения Office с помощью установщика Windows](../vsto/deploying-an-office-solution-by-using-windows-installer.md).

## <a name="Publish"></a> Публикация решения
 Можно опубликовать решение с помощью **мастера публикации** или **конструктор проектов**. В этой процедуре вы будете использовать **конструктор проектов** так, как он предоставляет полный набор параметров публикации. См. в разделе [мастер публикации &#40;разработка решений Office в Visual Studio&#41;](../vsto/publish-wizard-office-development-in-visual-studio.md).

#### <a name="to-publish-the-solution"></a>Публикация решения

1. В **обозревателе решений**, выберите узел, который совпадает с именем проекта.

2. В строке меню выберите **проекта**, *имя_проекта* **свойства**.

3. В **конструктор проектов**, выберите **публикации** вкладка, на следующем рисунке показан.

    ![На вкладку "Публикация" в конструкторе проектов](../vsto/media/vsto-publishtab.png "вкладке «publish» в конструкторе проектов")

4. В **расположение папки публикации (FTP-сервер или путь к файлу)** введите путь к папке, которую **конструктор проектов** копируемые файлы решения.

    Можно ввести путь любого из следующих типов.

   - Локальный путь (например, *C:\FolderName\FolderName*).

   - Соглашения об универсальных именах (UNC) путь к папке в сети (например,  *\\\ServerName\FolderName*).

   - Относительный путь (например, *PublishFolder\\*, — это папка, в которой проект публикуется по умолчанию).

5. В **URL-адрес папки установки** введите полный путь к папке, где конечные пользователи смогут найти решение.

    Если вы еще не знаю, расположение, ничего не вводите в это поле. По умолчанию ClickOnce ищет обновления в папке, из которой пользователи устанавливают решение.

6. Нажмите кнопку **Необходимые компоненты** .

7. В **предварительные требования** диалоговое окно, убедитесь, что **создать программу установки для необходимых компонентов** установлен флажок.

8. В **выберите устанавливаемые необходимые компоненты** выберите флажки для **установщик Windows версии 4.5** и соответствующий пакет .NET Framework.

    Например если решение предназначено [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)], установите флажки для **установщик Windows версии 4.5** и **Microsoft .NET Framework 4.5 Full**.

9. Если решение предназначено для .NET Framework 4.5, также выберите **Visual Studio 2010 Tools for Office Runtime** "флажок".

    > [!NOTE]
    >  По умолчанию этот флажок не отображается. Чтобы отобразить этот флажок, необходимо создать пакет начального загрузчика. См. в разделе [Создание пакета начального загрузчика для Office 2013 VSTO Add-in with Visual Studio 2012](create-vsto-add-ins-for-office-by-using-visual-studio.md).

10. В разделе **укажите место установки для необходимых компонентов**, выберите один из вариантов, которые отображаются, а затем выберите **ОК** кнопки.

     В таблице ниже представлено описание каждого из этих параметров.

    |Параметр|Описание|
    |------------|-----------------|
    |**Скачать необходимые компоненты с веб-сайта поставщика компонентов**|Пользователю будет предложено загрузить и установить эти необходимые компоненты у поставщика.|
    |**Скачать необходимые компоненты с местоположения моего приложения**|Необходимое программное обеспечение устанавливается вместе с решением. Если выбран этот параметр, Visual Studio копирует все пакеты необходимых компонентов в расположение публикации автоматически. Чтобы этот параметр действовал, пакеты необходимых компонентов должны находиться на компьютере разработки.|
    |**Скачать необходимые компоненты из следующего места**|Visual Studio скопирует все пакеты необходимых компонентов в указанное расположение и установит их вместе с решением.|

     См. в разделе [одноименном диалоговом окне](../ide/reference/prerequisites-dialog-box.md).

11. Выберите **обновления** "Кнопка", укажите частоту каждого конечного пользователя надстройки VSTO и настроек проверять наличие обновлений, а затем выберите **ОК** кнопки.

    > [!NOTE]
    >  При развертывании с помощью компакт-ДИСК или съемный накопитель, выберите **никогда не проверять наличие обновлений** переключатель.

     Сведения о том, как опубликовать обновление, см. в разделе [опубликовать обновление](#Update).

12. Выберите **параметры** "Кнопка", проверьте параметры в **параметры** диалоговое окно, а затем кнопку **ОК** кнопки.

13. Выберите **Опубликовать сейчас** кнопки.

     Visual Studio добавить следующие папки и файлы в папку публикации, указанную ранее в этой процедуре.

    - **Файлы приложения** папки.

    - Программа установки.

    - Манифест развертывания, указывающий на манифест развертывания для последней версии.

      **Файлы приложения** папка содержит вложенную папку для каждой публикуемой версии. Каждая вложенная папка для конкретной версии содержит следующие файлы.

    - Манифест приложения.

    - Манифест развертывания.

    - Сборки настройки.

      На следующем рисунке показана структура папки публикации для надстройки VSTO Outlook.

      ![Структура папки публикации](../vsto/media/publishfolderstructure.png "структура папки публикации")

    > [!NOTE]
    >  ClickOnce добавляет *.deploy* расширения к сборкам, чтобы защищенная установка Internet Information Services (IIS) не блокировала файлы из-за небезопасного расширения. Когда пользователь устанавливает решение, ClickOnce удалит *.deploy* расширения.

14. Скопируйте файлы решения в папку установки, указанную ранее в этой процедуре.

## <a name="Trust"></a> Выбор способа предоставления доверия решению
 Прежде чем решение можно будет запускать на компьютерах пользователей, необходимо предоставить доверие. В противном случае пользователи должны будут ответить на запрос о доверии при установке решения. Чтобы предоставить доверие решению, подпишите манифест с помощью сертификата, который определяет известного и надежного издателя. См. в разделе [доверие, подписание манифестов приложения и развертывания решения](../vsto/granting-trust-to-office-solutions.md#Signing).

 Если вы развертываете настройки уровня документа и поместить его в папку на компьютере пользователя или предоставлении доступа к документу на сайте SharePoint, убедитесь, что Office доверяет расположению документа. См. в разделе [предоставления доверия к документам](../vsto/granting-trust-to-documents.md).

## <a name="Helping"></a> Помощь пользователям при установке решения
 Пользователи могут установить решение, запустив программу установки, открытия манифеста развертывания, или во время настройки уровня документа, открыть документ напрямую. Рекомендуемым способом является установка решения пользователями с помощью программы установки. Другие два способа не гарантируют, что необходимое программное обеспечение устанавливается. Если пользователям необходимо открывать документ из расположения установки, они должны добавить это расположение в список надежных расположений в центре управления безопасностью приложения Office.

### <a name="opening-the-document-of-a-document-level-customization"></a>Открытие документа настройки уровня документа
 Пользователи могут открывать документы настройки уровня документа непосредственно из папки установки или путем копирования документа на локальный компьютер и открытия этой копии.

 Рекомендуется открывать копии документов на компьютерах пользователей, чтобы несколько пользователей не пытались открывать один и тот же экземпляр документа одновременно. Чтобы обеспечить выполнение этого правила, можно настроить программу установки таким образом, чтобы она копировала документ на компьютеры пользователей. См. в разделе [размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)](#Put).

### <a name="install-the-solution-by-opening-the-deployment-manifest-from-an-iis-website"></a>Установка решения путем открытия манифеста развертывания из веб-сайта IIS
 Пользователи могут установить решение Office путем открытия манифеста развертывания из Интернета. Однако защищенная установка Internet Information Services (IIS) будет блокировать файлы, имеющие *.vsto* расширения. Тип MIME должен быть определен в IIS перед развертыванием решения Office с использованием IIS.

##### <a name="to-add-the-vsto-mime-type-to-iis-60"></a>Добавление типа MIME .vsto в IIS 6.0

1. На сервере, на котором работает IIS 6.0, выберите **запустить** > **все программы** > **Администрирование**  >   **Internet Information Services (IIS) Manager**.

2. Выберите имя компьютера, **веб-сайтов** папку или веб-сайт, который вы настраиваете.

3. В строке меню выберите **действие** > **свойства**.

4. На **заголовки HTTP** вкладке, выберите **типы MIME** кнопки.

5. В **типы MIME** окно, выберите **New** кнопки.

6. В **тип MIME** окне введите **.vsto** расширением, введите **application/x-ms-vsto** как MIME введите, а затем применить новые параметры.

    > [!NOTE]
    >  Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Необходимо очистить кэш диска браузера и снова попытаться открыть *.vsto* файл еще раз.

##### <a name="to-add-the-vsto-mime-type-to-iis-70"></a>Добавление типа MIME .vsto в IIS 7,0

1. На сервере, на котором работает IIS 7.0, выберите **запустить** > **все программы** > **стандартные**.

2. Откройте контекстное меню для **командной**, а затем выберите **Запуск от имени администратора.**

3. В **откройте** введите следующий путь и затем выберите **ОК** кнопки.

    ```cmd
    %windir%\system32\inetsrv
    ```

4. Введите следующую команду, а затем примените новые параметры.

    ```cmd
    set config /section:staticContent /+[fileExtension='.vsto',mimeType='application/x-ms-vsto']
    ```

    > [!NOTE]
    >  Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Необходимо очистить кэш диска браузера и снова попытаться открыть *.vsto* файл еще раз.

## <a name="Put"></a> Размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)
 Можно скопировать документа решения на компьютере конечного пользователя для их путем создания действия после развертывания. Таким образом, пользователю не нужно вручную копировать документ из расположения установки на компьютер после установки решения. Необходимо будет создать класс, который определяет действие после развертывания, создания и публикации решения, изменить манифест приложения и повторно подписать манифест приложения и развертывания.

 В следующих процедурах предполагается, что имя проекта является **ExcelWorkbook** и что решение публикуется в созданный папку с именем **C:\publish** на компьютере.

### <a name="create-a-class-that-defines-the-post-deployment-action"></a>Создание класса, определяющего действие, выполняемое после развертывания

1. В строке меню выберите **файл** > **добавить** > **новый проект**.

2. В **Добавление нового проекта** отображаемое в диалоговом окне **установленные шаблоны** панели выберите **Windows** папки.

3. В **шаблоны** панели выберите **библиотеки классов** шаблона.

4. В **имя** введите **FileCopyPDA**, а затем выберите **ОК** кнопки.

5. В **обозревателе решений**, выберите **FileCopyPDA** проекта.

6. В строке меню выберите **Проект** > **Добавить ссылку**.

7. На **.NET** вкладку, добавьте ссылки на `Microsoft.VisualStudio.Tools.Applications.Runtime` и `Microsoft.VisualStudio.Tools.Applications.ServerDocument`.

8. Переименуйте класс в `FileCopyPDA`, а затем замените содержимое файла следующим кодом. Этот код выполняет следующие задачи:

   - Копирует документ на рабочий стол пользователя.

   - Изменяет свойства _AssemblyLocation с относительным путем на полный путь к манифесту развертывания.

   - Удаляет файл, когда пользователь удаляет решение.

     [!code-vb[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/VisualBasic/trin_excelworkbookpda/filecopypda/class1.vb#7)]
     [!code-csharp[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/CSharp/trin_excelworkbookpda/filecopypda/class1.cs#7)]

### <a name="build-and-publish-the-solution"></a>Сборка и публикация решения

1. В **обозревателе решений**, откройте контекстное меню для **FileCopyPDA** проекта, а затем выберите **построения**.

2. Откройте контекстное меню для **ExcelWorkbook** проекта, а затем выберите **построения**.

3. Откройте контекстное меню для **ExcelWorkbook** проекта, а затем выберите **добавить ссылку**.

4. В **добавить ссылку** диалоговое окно, выберите **проекты** вкладке, выберите **FileCopyPDA**и нажмите кнопку **ОК** кнопки.

5. В **обозревателе решений**, выберите **ExcelWorkbook** проекта.

6. В строке меню выберите **проекта** > **новую папку**.

7. Ввод **данных**, а затем выберите **ввод** ключ.

8. В **обозревателе решений**, выберите **данных** папки.

9. В строке меню выберите **проекта** > **добавить существующий элемент**.

10. В **добавить существующий элемент** диалоговом окне обзора в выходной каталог для **ExcelWorkbook** проекта, выберите **ExcelWorkbook.xlsx** файл, а затем выберите  **Добавление** кнопки.

11. В **обозревателе решений** выберите **ExcelWorkbook.xlsx** файла.

12. В **свойства** измените **действие при построении** свойства **содержимого** и **Копировать в выходной каталог** свойства  **Копировать более позднюю версию**.

     По завершении этих шагов проект будет выглядеть.

     ![Структура действия после развертывания проекта. ](../vsto/media/vsto-postdeployment.png "Структура действия после развертывания проекта.")

13. Публикация **ExcelWorkbook** проекта.

### <a name="modify-the-application-manifest"></a>Изменение манифеста приложения

1. Откройте каталог решения, **c:\publish**, с помощью **проводнике**.

2. Откройте **файлы приложения** папку, а затем откройте папку, соответствующую последней опубликованной версии решения.

3. Откройте **ExcelWorkbook.dll.manifest** файл в текстовом редакторе, таком как Блокнот.

4. После элемента `</vstav3:update>` добавьте следующий код. Для атрибута класса элемента `<vstav3:entryPoint>` используйте следующий синтаксис: *ИмяПространстваИмен.ИмяКласса*. В следующем примере имя класса совпадает с именем пространства имен, поэтому имя точки входа будет иметь вид `FileCopyPDA.FileCopyPDA`.

    ```xml
    <vstav3:postActions>
      <vstav3:postAction>
        <vstav3:entryPoint
          class="FileCopyPDA.FileCopyPDA">
          <assemblyIdentity
            name="FileCopyPDA"
            version="1.0.0.0"
            language="neutral"
            processorArchitecture="msil" />
        </vstav3:entryPoint>
        <vstav3:postActionData>
        </vstav3:postActionData>
      </vstav3:postAction>
    </vstav3:postActions>
    ```

### <a name="re-sign-the-application-and-deployment-manifests"></a>Повторное подписывание манифестов приложения и развертывания

1. В **%USERPROFILE%\Documents\Visual Studio 2013\Projects\ExcelWorkbook\ExcelWorkbook** папки, Копировать **ExcelWorkbook_TemporaryKey.pfx** файл сертификата и вставьте его в  *PublishFolder* **\Application Files\ExcelWorkbook**\__MostRecentPublishedVersion_ папки.

2. Откройте командную строку Visual Studio, а затем перейдите в каталог **c:\publish\Application Files\ExcelWorkbook**\__MostRecentPublishedVersion_ папку (например, **c:\publish\Application Files\ExcelWorkbook_1_0_0_4**).

3. Подпишите обновленный манифест приложения с помощью следующей команды:

    ```cmd
    mage -sign ExcelWorkbook.dll.manifest -certfile ExcelWorkbook_TemporaryKey.pfx
    ```

     Появится сообщение "ExcelWorkbook.dll.manifest успешно подписан".

4. Изменить на **c:\publish** папки и затем обновления и развертывания входа манифеста, выполнив следующую команду:

    ```cmd
    mage -update ExcelWorkbook.vsto -appmanifest "Application Files\Ex
    celWorkbookMostRecentVersionNumber>\ExcelWorkbook.dll.manifest" -certfile "Application Files\ExcelWorkbookMostRecentVersionNumber>\ExcelWorkbook_TemporaryKey.pfx"
    ```

    > [!NOTE]
    >  В предыдущем примере замените MostRecentVersionNumber номер версии последней опубликованной версии решения (например, **1_0_0_4**).

     Появится сообщение "ExcelWorkbook.vsto успешно подписан".

5. Копировать *ExcelWorkbook.vsto* файл **c:\publish\Application Files\ExcelWorkbook**\__MostRecentVersionNumber_ каталога.

## <a name="SharePoint"></a> Размещение документа решения на сервере, на котором выполняется SharePoint (только для настроек уровня документа)
 Настройки уровня документа можно публиковать для пользователей с помощью SharePoint. Когда пользователь открывает документ с сайта SharePoint, среда выполнения автоматически устанавливает решение на локальном компьютере пользователя из общей сетевой папки. После локальной установки решения настройка продолжит работать, даже если документ будет скопирован в другое место, например на рабочий стол.

#### <a name="to-put-the-document-on-a-server-thats-running-sharepoint"></a>Размещение документа на сервере с SharePoint

1. Добавьте документ решения в библиотеку документов на сайте SharePoint.

2. Воспользуйтесь одним из следующих подходов, выполнив соответствующие инструкции.

    - С помощью средства настройки Office добавьте сервер с SharePoint в центр управления безопасностью в Word или Excel на всех компьютерах пользователей.

         См. в разделе [политики безопасности и параметры в Office 2010](http://go.microsoft.com/fwlink/?LinkId=99227).

    - Убедитесь, что каждый пользователь выполнил следующие действия.

        1. На локальном компьютере, откройте Word или Excel, выберите **файл** вкладке, а затем выберите **параметры** кнопки.

        2. В **Центр управления безопасностью** диалоговое окно, выберите **надежные расположения** кнопки.

        3. Выберите **Разрешить надежные расположения в моей сети (не рекомендуется)** , а затем нажать **добавить новое расположение** кнопки.

        4. В **путь** введите URL-адрес библиотеки документов SharePoint, которая содержит загруженный документ (например, *http://SharePointServerName/TeamName/ProjectName/DocumentLibraryName*).

             Не следует добавлять имя веб-страницы по умолчанию, такие как *default.aspx* или *AllItems.aspx*.

        5. Выберите **всем вложенным папкам, также являются доверенными** , а затем нажать **ОК** кнопки.

             Когда пользователь откроет документ с сайта SharePoint, будут установлены настройки. Пользователь может скопировать документ себе на рабочий стол. Настройка все равно будет работать, поскольку свойства в документе указывают на сетевое расположение документа.

## <a name="Custom"></a> Создание пользовательского установщика
 Можно создать пользовательский установщик для решения Office, а не с помощью программы установки, который создается автоматически при публикации решения. Например можно использовать знак в скрипте для запуска установки, или можно использовать пакетный файл для установки решения без участия пользователя. Эти сценарии оптимальны, если все необходимые компоненты уже установлены на компьютерах пользователей.

 В рамках пользовательского процесса установки вызовите средство установки решений Office (*VSTOInstaller.exe*), который по умолчанию устанавливается в следующем расположении:

 *%CommonProgramFiles%\Microsoft shared\VSTO\10.0\VSTOInstaller.exe*

 Если это средство в этом расположении, можно использовать **находится в другой Runtime Setup\v4\InstallerPath** или **Setup\v4 HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VSTO среды выполнения \InstallerPath** раздел реестра, чтобы найти путь к нему.

 Можно использовать следующие параметры с *VSTOinstaller.exe*.

| Параметр | Определение |
|------------------| - |
| /Install или /I | Установка решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере, в общей папке с именем по универсальным правилам именования (UNC). Можно указать локальный путь (*C:\FolderName\PublishFolder*), относительный путь (*публикации\\*), или полный путь (*\\\ServerName\ Имя папки* или http://<em>ServerName/FolderName</em>). |
| /Uninstall или /U | Удаление решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере к общей папке UNC. Можно указать локальный путь (*c:\FolderName\PublishFolder*), относительный путь (*публикации\\*), или полный путь (*\\\ServerName\ Имя папки* или http://<em>ServerName/FolderName</em>). |
| /Silent или /S | Установка или удаление без запроса ввода данных пользователем и без отображения сообщений. Если требуется запрос о доверии, настройка не установлены или обновлены. |
| /Help или /? | Отображение справочных сведений. |

 При запуске *VSTOinstaller.exe*, могут отображаться следующие коды ошибок.

|Код ошибки|Определение|
|----------------|----------------|
|0|Решение было успешно установлено или удалено, или появилась справка VSTOInstaller.|
|-100|Один или несколько параметров командной строки недопустимы или заданы более одного раза. Чтобы получить дополнительные сведения, введите «vstoinstaller /?» или см. в разделе [создать пользовательский установщик для решения ClickOnce Office](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e).|
|-101|Один или несколько параметров командной строки являются недопустимыми. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-200|URI-адрес манифеста развертывания является недопустимой. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-201|Не удалось установить решение, так как манифест развертывания недействителен. См. в разделе [манифесты развертывания для решений Office](../vsto/deployment-manifests-for-office-solutions.md).|
|-202|Не удалось установить решение, так как Visual Studio Tools для Office раздел манифеста приложения является недопустимым. См. в разделе [манифесты приложений для решений Office](../vsto/application-manifests-for-office-solutions.md).|
|-203|Не удалось установить решение, так как произошла ошибка загрузки. Проверьте URI-адрес манифеста развертывания или расположение файла в сети и повторите попытку.|
|-300|Не удалось установить решение, так как возникло исключение безопасности. См. в разделе [решений Office, защита](../vsto/securing-office-solutions.md).|
|-400|Не удалось установить решение.|
|-401|Не удалось удалить решение.|
|-500|Операция была отменена, поскольку решение не может быть установлено или удалено или не удалось загрузить манифест развертывания.|

## <a name="Update"></a> Публикация обновления
 Чтобы обновить решение, опубликуйте его раз с помощью **конструктор проектов** или **мастера публикации**, а затем скопируйте обновленное решение в папку установки. При копировании файлов в папку установки убедитесь, что предыдущие файлы перезаписываются.

 В следующий раз решение проверяет обновления, он найдет и загрузка новой версии автоматически.

## <a name="Location"></a> Изменение расположения установки решения
 Путь установки можно добавлять и изменять после публикации решения. При необходимости можно изменить путь установки по одной из следующих причин:

- путь установки неизвестен на момент компиляции программы установки;

- файлы решения копируются в другое расположение;

- изменились имя или адрес сервера, на котором размещены файлы установки.

  Чтобы изменить путь установки решения, необходимо обновить программу установки, после чего пользователи должны запустить ее. Для настроек уровня документа пользователи должны также обновить свойство в своем документе, чтобы оно указывало на новое расположение.

> [!NOTE]
>  Если вы не хотите просить пользователей обновлять их свойства документа, можно предложить им получить обновленный документ из места установки по.

#### <a name="to-change-the-installation-path-in-the-setup-program"></a>Изменение пути установки в программе установки

1. Откройте **командной** окна, а затем перейдите к папке установки.

2. Запустите программу установки с параметром `/url`, который принимает новый путь установки в строковом формате.

    В следующем примере показано, как изменить путь к папке установки на расположение на веб-сайте компании Fabrikam, но вместо URL-адреса можно подставить любой путь:

   ```cmd
   setup.exe /url="http://www.fabrikam.com/newlocation"
   ```

   > [!NOTE]
   >  Если появляется сообщение о том, что подпись исполняемого файла станет недействительной, это означает, что сертификат, с помощью которого было подписано решение, стал недействительным, а издатель неизвестен. В результате пользователям необходимо будет подтвердить, что они доверяют источнику решения, прежде чем они смогут установить его.

   > [!NOTE]
   >  Чтобы просмотреть текущее значение URL-адреса, выполните команду `setup.exe /url`.

   Для настроек уровня документа пользователям необходимо открыть документ и затем измените значение его свойства _AssemblyLocation. Ниже описано, как пользователи могут выполнить эту задачу.

#### <a name="to-update-the-assemblylocation-property-in-a-document"></a>Обновление свойства _AssemblyLocation в документе

1. На **файл** вкладке, выберите **Info**, показанной на рисунке ниже.

     ![Вкладка сведений в Excel](../vsto/media/vsto-infotab.png "вкладка сведений в Excel")

2. В **свойства** выберите **дополнительные свойства**, показанной на рисунке ниже.

     ![Дополнительные свойства в Excel. ](../vsto/media/vsto-advanceddocumentproperties.png "Дополнительные свойства в Excel.")

3. На **Custom** вкладке **свойства** выберите _AssemblyLocation, как показано на следующем рисунке.

     ![Свойство AssemblyLocation. ](../vsto/media/vsto-assemblylocationproperty.png "Свойство AssemblyLocation.")

     **Значение** поле содержит идентификатор манифеста развертывания.

4. Перед идентификатором введите полный путь к документу и вертикальную черту в формате *путь*|*идентификатор* (например, *File://ServerName/ Имя_папки/имя_файла | 74744e4b-e4d6-41eb-84f7-ad20346fe2d9*.

     Дополнительные сведения о формате идентификатора см. в разделе [Общие сведения о свойствах пользовательского документа](../vsto/custom-document-properties-overview.md).

5. Выберите **ОК** кнопку, а затем сохраните и закройте документ.

6. Чтобы установить решение в указанном расположении, запустите программу установки без параметра "/url".

## <a name="Roll"></a> Откат решения к более ранней версии
 При откате решения пользователи возвращаются к более ранней версии этого решения.

#### <a name="to-roll-back-a-solution"></a>Откат решения

1. Откройте расположение установки решения.

2. Папку публикации верхнего уровня, удалите манифест развертывания ( *.vsto* файла).

3. Найдите вложенную папку версии, к которой требуется вернуться.

4. Скопируйте манифест развертывания из этой папки в папку публикации верхнего уровня.

     Например, чтобы откатить это решение, которое называется **OutlookAddIn1** от версии 1.0.0.1 к версии 1.0.0.0, скопируйте файл **OutlookAddIn1.vsto** из **OutlookAddIn1_1_0_0_0** папки. Вставьте файл верхнего уровня в папку, перезаписывая манифест развертывания для публикации **OutlookAddIn1_1_0_0_1** , уже существует.

     На следующем рисунке показана структура папок публикации для данного примера.

     ![Структура папки публикации](../vsto/media/publishfolderstructure.png "структура папки публикации")

     Когда пользователь в следующий раз откроет приложение или настроенный документ, будет обнаружено изменение манифеста развертывания. Предыдущая версия решения Office будет запущена из кэша ClickOnce.

> [!NOTE]
>  Локальные данные сохраняются только для одной предыдущей версии решения. При откате на две версии, локальные данные не сохраняются. Дополнительные сведения о локальных данных см. в разделе [доступ к локальным и удаленным данным в приложениях ClickOnce](../deployment/accessing-local-and-remote-data-in-clickonce-applications.md).

## <a name="see-also"></a>См. также

- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
- [Публикация решений Office](../vsto/deploying-an-office-solution-by-using-clickonce.md)
- [Практическое руководство. Публикация решения Office с помощью ClickOnce](https://msdn.microsoft.com/2b6c247e-bc04-4ce4-bb64-c4e79bb3d5b8)
- [Практическое руководство. Установка решения ClickOnce Office](https://msdn.microsoft.com/14702f48-9161-4190-994c-78211fe18065)
- [Практическое руководство. Публикация решения Office уровня документа на сервере SharePoint с помощью ClickOnce](https://msdn.microsoft.com/2408e809-fb78-42a1-9152-00afa1522e58)
- [Создание пользовательского установщика для решения office ClickOnce](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e)