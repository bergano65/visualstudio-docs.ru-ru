---
title: Развертывание решения Office с помощью ClickOnce
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, deploying solutions
- ClickOnce deployment [Office development in Visual Studio], deploying solutions
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: d69e50551f664ab3f3e987f0d113285f50d1315d
ms.sourcegitcommit: dcbb876a5dd598f2538e62e1eabd4dc98595b53a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2019
ms.locfileid: "72986130"
---
# <a name="deploy-an-office-solution-by-using-clickonce"></a>Развертывание решения Office с помощью ClickOnce
  Решение Office можно развернуть быстрее, если использовать ClickOnce. При публикации обновлений решение автоматически обнаруживает и устанавливает их. Однако для использования ClickOnce необходимо устанавливать решение отдельно для каждого пользователя компьютера. Поэтому следует рассмотреть возможность использования установщик Windows ( *. msi*), если решение на одном компьютере будет выполняться более чем одним пользователем.

## <a name="in-this-topic"></a>Содержание раздела

- [Публикация решения](#Publish)

- [Выбор способа предоставления доверия решению](#Trust)

- [Помогите пользователям установить решение](#Helping)

- [Размещение документа решения на компьютере конечного пользователя (только настройки на уровне документа)](#Put)

- [Размещение документа решения на сервере под управлением SharePoint (только настройки на уровне документа)](#SharePoint)

- [Создание пользовательского установщика](#Custom)

- [Публикация обновления](#Update)

- [Изменение расположения установки решения](#Location)

- [Откат решения до более ранней версии](#Roll)

  Дополнительные сведения о развертывании решения Office путем создания файла установщик Windows см. в статье [развертывание решения Office с помощью установщик Windows](../vsto/deploying-an-office-solution-by-using-windows-installer.md).

## <a name="Publish"></a>Публикация решения
 Вы можете опубликовать решение с помощью **мастера публикации** или **конструктора проектов**. В этой процедуре вы будете использовать **Конструктор проектов** , так как он предоставляет полный набор вариантов публикации. См. раздел [Разработка решений Office в мастере &#40;публикации в Visual Studio&#41;](../vsto/publish-wizard-office-development-in-visual-studio.md).

#### <a name="to-publish-the-solution"></a>Публикация решения

1. В **Обозреватель решений**выберите узел с именем для своего проекта.

2. В строке меню выберите Project, *имя_проекта* **Properties (свойства** **проекта**).

3. В **конструкторе проектов**перейдите на вкладку **Публикация** , которая показана на следующем рисунке.

    ![Вкладка публикация в конструкторе проектов](../vsto/media/vsto-publishtab.png "Вкладка публикации в конструкторе проектов")

4. В поле **расположение папки публикации (FTP-сервер или путь к файлу)** введите путь к папке, в которую необходимо скопировать файлы решения в **конструкторе проектов** .

    Можно ввести путь любого из следующих типов.

   - Локальный путь (например, *к:\фолдернаме\фолдернаме*).

   - Путь в формате UNC к папке в сети (например, *\\\сервернаме\фолдернаме*).

   - Относительный путь (например, *публишфолдер\\* , представляющий собой папку, в которую проект публикуется по умолчанию).

5. В поле **URL-адрес папки установки** введите полный путь к расположению, где конечные пользователи найдут ваше решение.

    Если вы еще не знакомы с местоположением, не вводите ничего в это поле. По умолчанию ClickOnce ищет обновления в папке, из которой пользователи устанавливают решение.

6. Нажмите кнопку **Необходимые компоненты** .

7. Убедитесь, что в диалоговом окне **необходимые** компоненты установлен флажок **создать программу установки для необходимых компонентов** .

8. В списке **выберите необходимые компоненты для установки** установите флажки для **установщик Windows 4,5** и соответствующего пакета .NET Framework.

    Например, если решение предназначено для [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)], установите флажки для **установщик Windows 4,5** и **Microsoft .NET Framework 4,5 Full**.

9. Если решение предназначено для .NET Framework 4,5, также установите флажок **средства Visual Studio 2010 для среды выполнения Office** .

    > [!NOTE]
    > По умолчанию этот флажок не отображается. Чтобы отобразить этот флажок, необходимо создать пакет начального загрузчика. См. статью [Создание пакета начального загрузчика для надстройки VSTO Office 2013 с помощью Visual Studio 2012](create-vsto-add-ins-for-office-by-using-visual-studio.md).

10. В разделе **укажите расположение установки для необходимых компонентов**выберите один из параметров, которые будут отображаться, а затем нажмите кнопку **ОК** .

     В таблице ниже представлено описание каждого из этих параметров.

    |Параметр|Описание|
    |------------|-----------------|
    |**Скачать необходимые компоненты с веб-сайта поставщика компонентов**|Пользователю будет предложено загрузить и установить эти необходимые компоненты у поставщика.|
    |**Скачать необходимые компоненты с местоположения моего приложения**|Необходимое программное обеспечение устанавливается вместе с решением. Если выбран этот параметр, Visual Studio копирует все пакеты необходимых компонентов в расположение публикации автоматически. Чтобы этот параметр действовал, пакеты необходимых компонентов должны находиться на компьютере разработки.|
    |**Скачать необходимые компоненты из следующего места**|Visual Studio скопирует все пакеты необходимых компонентов в указанное расположение и установит их вместе с решением.|

     См. [диалоговое окно необходимые компоненты](../ide/reference/prerequisites-dialog-box.md).

11. Нажмите кнопку **обновления** , укажите, как часто требуется надстройка VSTO для каждого конечного пользователя или настройка для проверки обновлений, а затем нажмите кнопку **ОК** .

    > [!NOTE]
    > При развертывании с помощью компакт-диска или съемного носителя выберите переключатель **не проверять обновления** .

     Сведения о публикации обновления см. в разделе [Публикация обновления](#Update).

12. Нажмите кнопку **Параметры** , просмотрите параметры в диалоговом окне **Параметры** , а затем нажмите кнопку **ОК** .

13. Нажмите кнопку **Опубликовать сейчас** .

     Visual Studio добавить следующие папки и файлы в папку публикации, указанную ранее в этой процедуре.

    - Папка **файлов приложения** .

    - Программа установки.

    - Манифест развертывания, указывающий на манифест развертывания для последней версии.

      Папка **Application Files** содержит вложенную папку для каждой опубликованной версии. Каждая вложенная папка для конкретной версии содержит следующие файлы.

    - Манифест приложения.

    - Манифест развертывания.

    - Сборки настройки.

      На следующем рисунке показана структура папки публикации для надстройки VSTO Outlook.

      ![Структура папки публикации](../vsto/media/publishfolderstructure.png "Структура папки публикации")

    > [!NOTE]
    > ClickOnce добавляет расширение *. deploy* в сборки, чтобы защищенная установка службы IIS (IIS) не блокировала файлы из-за небезопасного расширения. Когда пользователь устанавливает решение, ClickOnce удаляет расширение *. deploy* .

14. Скопируйте файлы решения в папку установки, указанную ранее в этой процедуре.

## <a name="Trust"></a>Выбор способа предоставления доверия решению
 Прежде чем решение можно будет запускать на компьютерах пользователей, необходимо предоставить доверие. В противном случае пользователи должны будут ответить на запрос о доверии при установке решения. Чтобы предоставить доверие решению, подпишите манифест с помощью сертификата, который определяет известного и надежного издателя. См. раздел [доверие к решению путем подписания манифестов приложения и развертывания](../vsto/granting-trust-to-office-solutions.md#Signing).

 Если выполняется развертывание настройки на уровне документа и требуется поместить документ в папку на компьютере пользователя или сделать документ доступным на сайте SharePoint, убедитесь, что Office доверяет расположению документа. См. раздел [Предоставление доверия документам](../vsto/granting-trust-to-documents.md).

## <a name="Helping"></a>Помогите пользователям установить решение
 Пользователи могут установить решение, запустив программу установки, открыв манифест развертывания или во время настройки на уровне документа, открыв документ напрямую. Рекомендуемым способом является установка решения пользователями с помощью программы установки. Два других подхода не гарантируют, что необходимое программное обеспечение установлено. Если пользователям необходимо открывать документ из расположения установки, они должны добавить это расположение в список надежных расположений в центре управления безопасностью приложения Office.

### <a name="opening-the-document-of-a-document-level-customization"></a>Открытие документа настройки уровня документа
 Пользователи могут открывать документы настройки уровня документа непосредственно из папки установки или путем копирования документа на локальный компьютер и открытия этой копии.

 Рекомендуется открывать копии документов на компьютерах пользователей, чтобы несколько пользователей не пытались открывать один и тот же экземпляр документа одновременно. Чтобы обеспечить выполнение этого правила, можно настроить программу установки таким образом, чтобы она копировала документ на компьютеры пользователей. См. раздел [Размещение документа решения на компьютере конечного пользователя (только настройки на уровне документа)](#Put).

### <a name="install-the-solution-by-opening-the-deployment-manifest-from-an-iis-website"></a>Установите решение, открыв манифест развертывания с веб-сайта IIS.
 Пользователи могут установить решение Office путем открытия манифеста развертывания из Интернета. Однако защищенная установка службы IIS (IIS) будет блокировать файлы с расширением *VSTO* . Тип MIME должен быть определен в IIS перед развертыванием решения Office с использованием IIS.

##### <a name="to-add-the-vsto-mime-type-to-iis-60"></a>Добавление типа MIME .vsto в IIS 6.0

1. На сервере IIS 6,0 выберите **пуск** > **все программы** > **средства администрирования** >  **службы IIS (IIS) Manager**.

2. Выберите имя компьютера, папку **веб-сайтов** или веб-сайт, который вы настраиваете.

3. В строке меню выберите **действие** > **свойства**.

4. На вкладке **заголовки HTTP** нажмите кнопку **типы MIME** .

5. В окне **типы MIME** нажмите кнопку **создать** .

6. В окне **тип MIME** введите **. VSTO** в качестве расширения, введите **Application/x-MS-VSTO** в качестве типа MIME, а затем примените новые параметры.

    > [!NOTE]
    > Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Затем необходимо очистить кэш диска браузера, а затем снова попытаться открыть *VSTO* файл.

##### <a name="to-add-the-vsto-mime-type-to-iis-70"></a>Добавление типа MIME .vsto в IIS 7,0

1. На сервере, где работает IIS 7,0, выберите **пуск** > **все программы** > **Аксессуары**.

2. Откройте контекстное меню **командной строки**и выберите **Запуск от имени администратора.**

3. В поле **Открыть** введите следующий путь, а затем нажмите кнопку **ОК** .

    ```cmd
    %windir%\system32\inetsrv
    ```

4. Введите следующую команду, а затем примените новые параметры.

    ```cmd
    set config /section:staticContent /+[fileExtension='.vsto',mimeType='application/x-ms-vsto']
    ```

    > [!NOTE]
    > Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Затем необходимо очистить кэш диска браузера, а затем снова попытаться открыть *VSTO* файл.

## <a name="Put"></a>Размещение документа решения на компьютере конечного пользователя (только настройки на уровне документа)
 Вы можете скопировать документ решения на компьютер конечного пользователя, создав действие, выполняемое после развертывания. Таким образом, пользователю не придется вручную копировать документ из расположения установки на компьютер после установки решения. Вам потребуется создать класс, который определяет действие, выполняемое после развертывания, выполнить сборку и публикацию решения, изменить манифест приложения и повторно подписать манифест приложения и развертывания.

 В следующих процедурах предполагается, что имя проекта — **ExcelWorkbook** , а решение публикуется в созданной папке с именем **C:\publish** на компьютере.

### <a name="create-a-class-that-defines-the-post-deployment-action"></a>Создание класса, определяющего действие, выполняемое после развертывания

1. В строке меню последовательно выберите пункты **файл**  > **Добавить**  > **Новый проект**.

2. В диалоговом окне **Добавление нового проекта** в области **Установленные шаблоны** выберите папку **Windows** .

3. В области **шаблоны** выберите шаблон **Библиотека классов** .

4. В поле **имя** введите **филекопипда**, а затем нажмите кнопку **ОК** .

5. В **Обозреватель решений**выберите проект **филекопипда** .

6. В строке меню выберите **Проект** > **Добавить ссылку**.

7. На вкладке **.NET** добавьте ссылки на `Microsoft.VisualStudio.Tools.Applications.Runtime` и `Microsoft.VisualStudio.Tools.Applications.ServerDocument`.

8. Переименуйте класс в `FileCopyPDA`, а затем замените содержимое файла следующим кодом. Этот код выполняет следующие задачи:

   - Копирует документ на рабочий стол пользователя.

   - Изменяет свойство _AssemblyLocation с относительного пути на полный путь к манифесту развертывания.

   - Удаляет файл, когда пользователь удаляет решение.

     [!code-vb[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/VisualBasic/trin_excelworkbookpda/filecopypda/class1.vb#7)]
     [!code-csharp[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/CSharp/trin_excelworkbookpda/filecopypda/class1.cs#7)]

### <a name="build-and-publish-the-solution"></a>Сборка и публикация решения

1. В **Обозреватель решений**откройте контекстное меню проекта **филекопипда** и выберите пункт **Сборка**.

2. Откройте контекстное меню проекта **ExcelWorkbook** и выберите пункт **Сборка**.

3. Откройте контекстное меню проекта **ExcelWorkbook** и выберите команду **Добавить ссылку**.

4. В диалоговом окне **Добавление ссылки** выберите вкладку **проекты** , выберите **филекопипда**, а затем нажмите кнопку **ОК** .

5. В **Обозреватель решений**выберите проект **ExcelWorkbook** .

6. В строке меню выберите **проект** > **создать папку**.

7. Введите **данные**, а затем нажмите клавишу **Ввод** .

8. В **Обозреватель решений**выберите папку **данных** .

9. В строке меню выберите **проект** > **Добавить существующий элемент**.

10. В диалоговом окне **Добавление существующего элемента** перейдите к выходному каталогу проекта **ExcelWorkbook** , выберите файл **ExcelWorkbook. xlsx** , а затем нажмите кнопку **Добавить** .

11. В **Обозреватель решений** выберите файл **ExcelWorkbook. xlsx** .

12. В окне **Свойства** измените свойство **действие сборки** на **содержимое** , а свойство **Копировать в выходной каталог** — на копировать, **если новее**.

     После выполнения этих действий проект будет выглядеть примерно так, как показано на следующем рисунке.

     ![Структура проекта действия, выполняемого после развертывания.](../vsto/media/vsto-postdeployment.png "Структура проекта в действии после развертывания.")

13. Опубликуйте проект **ExcelWorkbook** .

### <a name="modify-the-application-manifest"></a>Изменение манифеста приложения

1. Откройте каталог решения **c:\publish**с помощью **проводника**.

2. Откройте папку **файлы приложения** , а затем откройте папку, соответствующую последней опубликованной версии решения.

3. Откройте файл **ExcelWorkbook. dll. manifest** в текстовом редакторе, например в блокноте.

4. После элемента `</vstav3:update>` добавьте следующий код. Для атрибута Class элемента `<vstav3:entryPoint>` используйте следующий синтаксис: "самое" *. ClassName*. В следующем примере имя класса совпадает с именем пространства имен, поэтому имя точки входа будет иметь вид `FileCopyPDA.FileCopyPDA`.

    ```xml
    <vstav3:postActions>
      <vstav3:postAction>
        <vstav3:entryPoint
          class="FileCopyPDA.FileCopyPDA">
          <assemblyIdentity
            name="FileCopyPDA"
            version="1.0.0.0"
            language="neutral"
            processorArchitecture="msil" />
        </vstav3:entryPoint>
        <vstav3:postActionData>
        </vstav3:postActionData>
      </vstav3:postAction>
    </vstav3:postActions>
    ```

### <a name="re-sign-the-application-and-deployment-manifests"></a>Повторное подписывание манифестов приложения и развертывания

1. В папке **%UserProfile%\Documents\Visual Studio 2013 \ прожектс\ексцелворкбук\ексцелворкбук** скопируйте файл сертификата **ExcelWorkbook_TemporaryKey. pfx** и вставьте его в *публишфолдер* **\Application Files \ Папка ExcelWorkbook**\__мострецентпублишедверсион_ .

2. Откройте командную строку Visual Studio, а затем измените каталоги на папку **К:\публиш\аппликатион филес\ексцелворкбук**\__мострецентпублишедверсион_ (например, **к:\публиш\аппликатион Files\ExcelWorkbook_1_0_0 _4**).

3. Подпишите обновленный манифест приложения с помощью следующей команды:

    ```cmd
    mage -sign ExcelWorkbook.dll.manifest -certfile ExcelWorkbook_TemporaryKey.pfx
    ```

     Появится сообщение "ExcelWorkbook.dll.manifest успешно подписан".

4. Перейдите в папку **c:\publish** , а затем обновите и подпишите манифест развертывания, выполнив следующую команду:

    ```cmd
    mage -update ExcelWorkbook.vsto -appmanifest "Application Files\Ex
    celWorkbookMostRecentVersionNumber>\ExcelWorkbook.dll.manifest" -certfile "Application Files\ExcelWorkbookMostRecentVersionNumber>\ExcelWorkbook_TemporaryKey.pfx"
    ```

    > [!NOTE]
    > В предыдущем примере замените Мострецентверсионнумбер на номер версии последней опубликованной версии решения (например, **1_0_0_4**).

     Появится сообщение "ExcelWorkbook.vsto успешно подписан".

5. Скопируйте файл *ExcelWorkbook. VSTO* в каталог **К:\публиш\аппликатион филес\ексцелворкбук**\__мострецентверсионнумбер_ .

## <a name="SharePoint"></a>Размещение документа решения на сервере под управлением SharePoint (только настройки на уровне документа)
 Настройки уровня документа можно публиковать для пользователей с помощью SharePoint. Когда пользователь открывает документ с сайта SharePoint, среда выполнения автоматически устанавливает решение на локальном компьютере пользователя из общей сетевой папки. После локальной установки решения настройка продолжит работать, даже если документ будет скопирован в другое место, например на рабочий стол.

#### <a name="to-put-the-document-on-a-server-thats-running-sharepoint"></a>Размещение документа на сервере с SharePoint

1. Добавьте документ решения в библиотеку документов на сайте SharePoint.

2. Воспользуйтесь одним из следующих подходов, выполнив соответствующие инструкции.

    - С помощью средства настройки Office добавьте сервер с SharePoint в центр управления безопасностью в Word или Excel на всех компьютерах пользователей.

         См. раздел [политики и параметры безопасности в Office 2010](/previous-versions/office/office-2010/cc178946(v=office.14)).

    - Убедитесь, что каждый пользователь выполнил следующие действия.

        1. На локальном компьютере откройте Word или Excel, перейдите на вкладку **файл** и нажмите кнопку **Параметры** .

        2. В диалоговом окне **центр управления безопасностью** нажмите кнопку **Надежные расположения** .

        3. Установите флажок **Разрешить надежные расположения в моей сети (не рекомендуется)** , а затем нажмите кнопку **Добавить новое расположение** .

        4. В поле **путь** введите URL-адрес библиотеки документов SharePoint, содержащей Отправленный документ (например, *http://SharePointServerName/TeamName/ProjectName/DocumentLibraryName* ).

             Не добавляйте имя веб-страницы по умолчанию, например *Default. aspx* или *AllItems. aspx*.

        5. Установите флажок **также доверять вложенным папкам** , а затем нажмите кнопку **ОК** .

             Когда пользователь откроет документ с сайта SharePoint, будут установлены настройки. Пользователь может скопировать документ себе на рабочий стол. Настройка все равно будет работать, поскольку свойства в документе указывают на сетевое расположение документа.

## <a name="Custom"></a>Создание пользовательского установщика
 Вы можете создать пользовательский установщик для решения Office вместо использования программы установки, созданной при публикации решения. Например, можно использовать сценарий входа для запуска установки или использовать пакетный файл для установки решения без взаимодействия с пользователем. Эти сценарии оптимальны, если все необходимые компоненты уже установлены на компьютерах пользователей.

 В процессе пользовательской установки вызовите средство установщика для решений Office (*встоинсталлер. exe*), которое по умолчанию устанавливается в следующем расположении:

 *%COMMONPROGRAMFILES%\Microsoft shared\VSTO\10.0\VSTOInstaller.exe*

 Если средство не находится в этом расположении, можно использовать реестр Setup\v4\InstallerPath среды выполнения **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VSTO Runtime Setup\v4\InstallerPath** или **HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VSTO** Key, чтобы найти путь к этому инструменту.

 С *встоинсталлер. exe*можно использовать следующие параметры.

| Параметр | Определение |
|------------------| - |
| /Install или /I | Установка решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере, в общей папке с именем по универсальным правилам именования (UNC). Можно указать локальный путь (*к:\фолдернаме\публишфолдер*), относительный путь ( *\\публикации* ) или полное расположение ( *\\\Сервернаме\фолдернаме* или http://<em>ServerName/имя_папки</em>). |
| /Uninstall или /U | Удаление решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере к общей папке UNC. Можно указать локальный путь (*к:\фолдернаме\публишфолдер*), относительный путь ( *\\публикации* ) или полное расположение ( *\\\Сервернаме\фолдернаме* или http://<em>ServerName/имя_папки</em>). |
| /Silent или /S | Установка или удаление без запроса ввода данных пользователем и без отображения сообщений. Если требуется запрос о доверии, настройка не устанавливается или не обновляется. |
| /Help или /? | Отображение справочных сведений. |

 При запуске *встоинсталлер. exe*могут появиться следующие коды ошибок.

|Код ошибки|Определение|
|----------------|----------------|
|0|Решение было успешно установлено или удалено, или появилась справка VSTOInstaller.|
|-100|Один или несколько параметров командной строки являются недопустимыми или заданы несколько раз. Для получения дополнительных сведений введите «встоинсталлер/?». или см. раздел [Создание пользовательского установщика для решения ClickOnce Office](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e).|
|-101|Один или несколько параметров командной строки являются недопустимыми. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-200|Недопустимый URI манифеста развертывания. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-201|Не удалось установить решение, так как манифест развертывания является недопустимым. См. раздел [манифесты развертывания для решений Office](../vsto/deployment-manifests-for-office-solutions.md).|
|-202|Не удалось установить решение, так как раздел Инструменты Visual Studio для Office манифеста приложения является недопустимым. См. раздел [манифесты приложений для решений Office](../vsto/application-manifests-for-office-solutions.md).|
|-203|Не удалось установить решение, так как произошла ошибка скачивания. Проверьте URI-адрес манифеста развертывания или расположение файла в сети и повторите попытку.|
|-300|Не удалось установить решение, так как произошло исключение безопасности. См. раздел [безопасные решения Office](../vsto/securing-office-solutions.md).|
|-400|Не удалось установить решение.|
|-401|Не удалось удалить решение.|
|-500|Операция была отменена, поскольку решение не может быть установлено или удалено или не удалось загрузить манифест развертывания.|

## <a name="Update"></a>Публикация обновления
 Чтобы обновить решение, опубликуйте его снова с помощью **конструктора проектов** или **мастера публикации**, а затем скопируйте обновленное решение в папку установки. При копировании файлов в папку установки убедитесь, что предыдущие файлы перезаписываются.

 В следующий раз, когда решение будет проверять наличие обновления, оно обнаружит и загрузит новую версию автоматически.

## <a name="Location"></a>Изменение расположения установки решения
 Путь установки можно добавлять и изменять после публикации решения. При необходимости можно изменить путь установки по одной из следующих причин:

- путь установки неизвестен на момент компиляции программы установки;

- файлы решения копируются в другое расположение;

- изменились имя или адрес сервера, на котором размещены файлы установки.

  Чтобы изменить путь установки решения, необходимо обновить программу установки, после чего пользователи должны запустить ее. Для настроек уровня документа пользователи должны также обновить свойство в своем документе, чтобы оно указывало на новое расположение.

> [!NOTE]
> Если вы не хотите запрашивать у пользователей обновление свойств документа, можно попросить пользователей получить обновленный документ из расположения установки.

#### <a name="to-change-the-installation-path-in-the-setup-program"></a>Изменение пути установки в программе установки

1. Откройте окно **командной строки** , а затем измените каталоги на папку установки.

2. Запустите программу установки с параметром `/url`, который принимает новый путь установки в строковом формате.

    В следующем примере показано, как изменить путь к папке установки на расположение на веб-сайте компании Fabrikam, но вместо URL-адреса можно подставить любой путь:

   ```cmd
   setup.exe /url="http://www.fabrikam.com/newlocation"
   ```

   > [!NOTE]
   > Если появляется сообщение о том, что подпись исполняемого файла станет недействительной, это означает, что сертификат, с помощью которого было подписано решение, стал недействительным, а издатель неизвестен. В результате пользователям необходимо будет подтвердить, что они доверяют источнику решения, прежде чем они смогут установить его.

   > [!NOTE]
   > Чтобы просмотреть текущее значение URL-адреса, выполните команду `setup.exe /url`.

   Для настроек на уровне документа пользователи должны открыть документ, а затем обновить его свойство _AssemblyLocation. Ниже описано, как пользователи могут выполнить эту задачу.

#### <a name="to-update-the-_assemblylocation-property-in-a-document"></a>Обновление свойства _AssemblyLocation в документе

1. На вкладке **файл** выберите **сведения**, показанные на следующем рисунке.

     ![Вкладка "сведения" в Excel](../vsto/media/vsto-infotab.png "Вкладка сведений в Excel")

2. В списке **Свойства** выберите **Дополнительные свойства**, показанные на следующем рисунке.

     ![Дополнительные свойства в Excel.](../vsto/media/vsto-advanceddocumentproperties.png "Дополнительные свойства в Excel.")

3. На вкладке **Настраиваемый** в списке **свойства** выберите значение _AssemblyLocation, как показано на следующем рисунке.

     ![Свойство AssemblyLocation.](../vsto/media/vsto-assemblylocationproperty.png "Свойство AssemblyLocation.")

     Поле **значение** содержит идентификатор манифеста развертывания.

4. Перед идентификатором введите полный путь к документу, а затем строку в формате *путь*|*идентификатор* (например, *File://servername/foldername/filename|74744e4b-e4d6-41eb-84f7-ad20346fe2d9*.

     Дополнительные сведения о том, как форматировать этот идентификатор, см. в разделе [Общие сведения о пользовательских свойствах документа](../vsto/custom-document-properties-overview.md).

5. Нажмите кнопку **ОК** , а затем сохраните и закройте документ.

6. Чтобы установить решение в указанном расположении, запустите программу установки без параметра "/url".

## <a name="Roll"></a>Откат решения до более ранней версии
 При откате решения пользователи возвращаются к более ранней версии этого решения.

#### <a name="to-roll-back-a-solution"></a>Откат решения

1. Откройте расположение установки решения.

2. В папке публикации верхнего уровня удалите манифест развертывания ( *VSTO* -файл).

3. Найдите вложенную папку версии, к которой требуется вернуться.

4. Скопируйте манифест развертывания из этой папки в папку публикации верхнего уровня.

     Например, чтобы выполнить откат решения, которое называется **OutlookAddIn1** из версии 1.0.0.1 в версию 1.0.0.0, скопируйте файл **OutlookAddIn1. VSTO** из папки **OutlookAddIn1_1_0_0_0** . Вставьте файл в папку публикации верхнего уровня, перезаписав манифест развертывания, относящийся к версии, для **OutlookAddIn1_1_0_0_1** , который уже существовал.

     На следующем рисунке показана структура папок публикации для данного примера.

     ![Структура папки публикации](../vsto/media/publishfolderstructure.png "Структура папки публикации")

     Когда пользователь в следующий раз откроет приложение или настроенный документ, будет обнаружено изменение манифеста развертывания. Предыдущая версия решения Office будет запущена из кэша ClickOnce.

> [!NOTE]
> Локальные данные сохраняются только для одной предыдущей версии решения. Если выполнить откат двух версий, локальные данные не будут сохранены. Дополнительные сведения о локальных данных см. [в разделе доступ к локальным и удаленным данным в приложениях ClickOnce](../deployment/accessing-local-and-remote-data-in-clickonce-applications.md).

## <a name="see-also"></a>См. также

- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
- [Публикация решений Office](../vsto/deploying-an-office-solution-by-using-clickonce.md)
- [Инструкции. Публикация решения Office с помощью ClickOnce](https://msdn.microsoft.com/2b6c247e-bc04-4ce4-bb64-c4e79bb3d5b8)
- [Руководство. Установка решения ClickOnce для Office](https://msdn.microsoft.com/14702f48-9161-4190-994c-78211fe18065)
- [Инструкции. Публикация решения Office на уровне документа на сервере SharePoint с помощью ClickOnce](https://msdn.microsoft.com/2408e809-fb78-42a1-9152-00afa1522e58)
- [Создание пользовательского установщика для решения ClickOnce Office](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e)