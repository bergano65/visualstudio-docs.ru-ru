---
title: Конкретные вопросы безопасности для решений Office
description: Узнайте, как функции безопасности, предоставляемые Microsoft .NET Framework и Microsoft Office, могут помочь защитить решения Office от угроз безопасности.
ms.custom: SEO-VS-2020
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- troubleshooting Office development in Visual Studio, security
- trusted code [Office development in Visual Studio]
- blocked code [Office development in Visual Studio]
- Outlook [Office development in Visual Studio], object model guard
- malicious code [Office development in Visual Studio]
- Outlook object model guard [Office development in Visual Studio]
- security [Office development in Visual Studio], troubleshooting
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: 57b330884ef6638e5c853cfb5670e3552aca46cc
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99940830"
---
# <a name="specific-security-considerations-for-office-solutions"></a>Конкретные вопросы безопасности для решений Office
  Средства безопасности, предоставляемые Microsoft .NET Framework и Microsoft Office, помогают защитить решения Office от различных угроз безопасности. В этом разделе описываются некоторые из этих угроз и даются рекомендации по защите от них. Здесь также приводятся сведения о влиянии параметров безопасности Microsoft Office на решения Office.

 [!INCLUDE[appliesto_all](../vsto/includes/appliesto-all-md.md)]

## <a name="trusted-code-is-repurposed-in-a-new-malicious-document"></a>Доверенный код передается в новом вредоносном документе
 Злоумышленник может получить доверенный код, предназначенный для одной конкретной цели, например для загрузки личных сведений в заявление о приеме на работу, и использовать его в другом документе, например в учетной ведомости. Код не знает, что исходный документ не запущен, и может открыть доступ к другим процессам, таким как раскрытие личных сведений или выполнение кода с повышенными правами, при открытии другим пользователем. Кроме того, злоумышленник может изменить данные в листе таким образом, что при отправке в жертву он неожиданно ведет себя. Изменяя значения, формулы или характеристики представления листа, связанного с кодом, злоумышленник может атаковать другого пользователя путем отправки измененного файла. Также возможно получение пользователями доступа к сведениям, которые они не должны видеть, в результате изменений значений в листе.

 Поскольку расположение сборки и расположение документа должны иметь достаточные основания для выполнения, такую атаку непросто осуществить. Например, документы во вложениях электронной почты или на ненадежных серверах интрасети не имеют достаточных разрешений на выполнение.

 Чтобы такая атака была возможна, сам код должен быть написан таким образом, чтобы он мог принимать решения на основе потенциально ненадежных данных. Примером является создания листа со скрытой ячейкой, содержащей имя сервера базы данных. Пользователь преобразует лист в ASPX-страницу, которая пытается подключиться к серверу с помощью проверки подлинности SQL и жестко заданного пароля SA. Злоумышленник может заменить содержимое скрытой ячейки именем другого компьютера и получить пароль SA. Чтобы избежать этой проблемы, не следует жестко кодировать пароли; кроме того, перед получением доступа к серверу следует всегда проверять идентификаторы серверов по внутреннему списку серверов, которые заведомо правильные.

### <a name="recommendations"></a>Рекомендации

- Всегда проверяйте ввод и данные, поступили ли они от пользователя, документа, базы данных, веб-службы или любого другого источника.

- С осторожностью предоставляйте некоторые типы функциональности, такие как получение привилегированных данных от имени пользователя и помещение их на незащищенные листы.

- В зависимости от типа приложения может быть целесообразно удостоверяться, что исходный документ запущен, до выполнения любого кода. Например, проверяйте, выполняется ли код из документа, хранящегося в известном, безопасном расположении.

- Может быть полезно отображать предупреждение при открытии документа, если приложение выполняет какие-либо привилегированные действия. Например, можно создать экран-заставку или окно запуска, сообщающее, что приложение получит доступ к личным сведениям, и пользователь должен будет выбрать продолжение или отмену. Если конечный пользователь получит такое предупреждение из кажущегося безобидным документа, он сможет выйти из приложения, прежде чем что-либо будет повреждено.

## <a name="code-is-blocked-by-the-outlook-object-model-guard"></a>Код заблокирован защитой объектной модели Outlook
 Microsoft Office может запретить коду использовать определенные свойства, методы и объекты в объектной модели. Благодаря ограничению доступа к этим объектам Outlook помогает предотвратить использование объектной модели червями и вирусами в целях защиты от вредоносного по. Эта функция безопасности называется системой безопасности объектной модели Outlook. Если надстройка VSTO пытается использовать ограниченное свойство или метод при включенной системе безопасности объектной модели, Outlook отображает предупреждение системы безопасности, позволяющее пользователю прерывать операцию, или позволяет пользователю предоставлять доступ к свойству или методу в течение ограниченного периода времени. Если пользователь останавливает операцию, надстройки VSTO Outlook, созданные с помощью решений Office в Visual Studio, будут создавать исключение <xref:System.Runtime.InteropServices.COMException>.

 Система безопасности объектной модели может по-разному влиять на надстройки VSTO, в зависимости от того, используется ли Outlook с Microsoft Exchange Server.

- Если Outlook не используется с Exchange, администратор может включать или отключать систему безопасности объектной модели для всех надстроек VSTO на компьютере.

- Если Outlook используется с Exchange, администратор может включать или отключать систему безопасности объектной модели для всех надстроек VSTO на компьютере, а также может указать, что определенные надстройки VSTO могут выполняться без задействования системы безопасности объектной модели. Администраторы также могут изменять поведение системы безопасности объектной модели в некоторых областях объектной модели. Например, администраторы могут автоматически разрешать надстройкам VSTO отправлять электронную почту программным способом, даже если включено защитой объектной модели.

  Начиная с Outlook 2007 поведение объектной модели было изменено, чтобы улучшить взаимодействие с пользователем и разработчиком, продолжая поддерживать безопасность Outlook. Дополнительные сведения см. [в разделе изменения безопасности кода в Outlook 2007](/previous-versions/office/developer/office-2007/bb226709(v=office.12)).

### <a name="minimize-object-model-guard-warnings"></a>Предупреждение об уменьшении защиты объектной модели
 Чтобы избежать излишних предупреждений системы безопасности при использовании ограниченных свойств и методов, убедитесь, что ваша надстройка VSTO получает объекты Outlook из поля `Application` класса `ThisAddIn` в проекте. Дополнительные сведения об этом поле см. в разделе [программное добавление надстроек VSTO](../vsto/programming-vsto-add-ins.md).

 Система безопасности объектной модели считает надежными только объекты Outlook, полученные из этого объекта. Напротив, объекты, полученные из нового объекта `Microsoft.Office.Interop.Outlook.Application`, не считаются надежными, и ограниченные свойства и методы будут вызывать появление предупреждений системы безопасности объектной модели, если она включена.

 Следующий пример кода отображает предупреждение системы безопасности, если система безопасности объектной модели включена. Свойство `To` класса `Microsoft.Office.Interop.Outlook.MailItem` ограничивается системой безопасности объектной модели. `Microsoft.Office.Interop.Outlook.MailItem`Объект не является доверенным, так как код получает его из объекта `Microsoft.Office.Interop.Outlook.Application` , созданного с помощью оператора **New** , вместо того чтобы получать его из `Application` поля.

 [!code-csharp[Trin_VstcoreOutlookSecurity#1](../vsto/codesnippet/CSharp/Trin_VstcoreOutlookSecurity/ThisAddIn.cs#1)]
 [!code-vb[Trin_VstcoreOutlookSecurity#1](../vsto/codesnippet/VisualBasic/Trin_VstcoreOutlookSecurity/ThisAddIn.vb#1)]

 В следующем примере кода показано, как использовать свойство Restricted для `Microsoft.Office.Interop.Outlook.MailItem` объекта, который является доверенным для системы безопасности объектной модели. Код использует доверенное поле `Application` для получения `Microsoft.Office.Interop.Outlook.MailItem`.

 [!code-csharp[Trin_VstcoreOutlookSecurity#2](../vsto/codesnippet/CSharp/Trin_VstcoreOutlookSecurity/ThisAddIn.cs#2)]
 [!code-vb[Trin_VstcoreOutlookSecurity#2](../vsto/codesnippet/VisualBasic/Trin_VstcoreOutlookSecurity/ThisAddIn.vb#2)]

> [!NOTE]
> Если Outlook используется с Exchange, получение всех объектов Outlook из `ThisAddIn.Application` не гарантирует, что надстройка VSTO будет иметь доступ ко всей объектной модели Outlook. Например, если администратор Exchange настраивает Outlook для автоматического запрета всех попыток доступа к сведениям об адресе с помощью объектной модели Outlook, то Outlook не разрешает доступ к свойству To из предыдущего примера кода, даже если в примере кода используется доверенное `ThisAddIn.Application` поле.

### <a name="specify-which-add-ins-to-trust-when-using-exchange"></a>Укажите, какие надстройки следует доверять при использовании Exchange
 При использовании Outlook с Exchange администраторы могут указать, что определенные надстройки VSTO могут выполняться без участия системы безопасности объектной модели. Надстройки VSTO Outlook, созданные с помощью решений Office в Visual Studio, не могут быть доверенными по отдельности; они могут быть доверенными только как группа.

 Outlook доверяет надстройке VSTO на основе хэш-кода в библиотеке DLL точки входа надстройки VSTO. Все надстройки VSTO для Outlook, предназначенные для, [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] используют одну и ту же DLL-библиотеку точек входа (*VSTOLoader.dll*). Это означает, что если администратор доверяет любой надстройке VSTO, которая нацелена на [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] Запуск, не используя систему безопасности объектной модели, все другие надстройки VSTO, предназначенные для, [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] также являются доверенными. Дополнительные сведения об указании конкретных доверенных надстроек VSTO, которым разрешается выполняться без системы безопасности объектной модели, см. в разделе [Выбор метода, используемого Outlook для управления функциями антивирусной защиты](/previous-versions/office/office-2007-resource-kit/cc179194(v=office.12)).

## <a name="permission-changes-do-not-take-effect-immediately"></a>Изменения разрешений вступают в силу не сразу.
 Если администратор настраивает разрешения для документа или сборки, пользователи должны закрыть и перезапустить все приложения Office, чтобы изменения вступили в силу.

 Кроме того, применение новых разрешений могут запрещать другие приложения, размещающие приложения Microsoft Office. При изменении политик безопасности пользователи должны выйти из всех приложений, использующих Office, как размещенных, так и автономных.

## <a name="trust-center-settings-in-the-microsoft-office-system-do-not-affect-add-ins-or-document-level-customizations"></a>Параметры центра управления безопасностью в Microsoft Officeной системе не влияют на надстройки или настройки на уровне документа
 Пользователи могут запретить загрузку надстроек VSTO, установив соответствующий параметр в **центре управления безопасностью**. Тем не менее эти параметры доверия не влияют на надстройки VSTO и настройки уровня документа, созданные с помощью решений Office в Visual Studio.

 Если пользователь запрещает загрузку настройки VSTO с помощью **центра управления безопасностью**, не будут загружаться следующие типы надстроек VSTO:

- управляемые и неуправляемые надстройки VSTO модели COM;

- управляемые и неуправляемые смарт-документы;

- управляемые и неуправляемые надстройки VSTO автоматизации;

- управляемые и неуправляемые компоненты данных в режиме реального времени.

  Следующие процедуры показывают, каким образом пользователи могут использовать **центр управления безопасностью** для ограничения загрузки надстроек VSTO в Microsoft [!INCLUDE[Office_15_short](../vsto/includes/office-15-short-md.md)] и Microsoft Office 2010. Эти процедуры не влияют на надстройки VSTO и настройки, созданные с помощью средств разработки Office в Visual Studio.

#### <a name="to-disable-vsto-add-ins-in-microsoft-office-2010-and-microsoft-office_15_short-applications"></a>Отключение надстроек VSTO в приложениях Microsoft Office 2010 и Microsoft [!INCLUDE[Office_15_short](../vsto/includes/office-15-short-md.md)]

1. Перейдите на вкладку **Файл** .

2. Нажмите кнопку *Параметры* **имя_приложения** .

3. В области категорий нажмите **Центр управления безопасностью**.

4. В области сведений нажмите **Параметры центра управления безопасностью**.

5. В области категорий нажмите **Надстройки**.

6. В области сведений установите флажок **Все надстройки приложений должны быть подписаны надежными издателями** или **Отключить все надстройки приложений**.

## <a name="see-also"></a>См. также раздел
- [Безопасные решения Office](../vsto/securing-office-solutions.md)
