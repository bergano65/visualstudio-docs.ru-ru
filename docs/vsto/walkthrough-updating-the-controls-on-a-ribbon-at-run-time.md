---
title: "Пошаговое руководство: Обновление элементов управления на ленте во время выполнения | Документы Microsoft"
ms.custom: 
ms.date: 02/02/2017
ms.reviewer: 
ms.suite: 
ms.technology: office-development
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- controls [Office development in Visual Studio], Ribbon
- Ribbon [Office development in Visual Studio], controls
- updating Ribbon controls
- Ribbon [Office development in Visual Studio], dynamic menu
- dynamic menus [Office development in Visual Studio]
- Ribbon [Office development in Visual Studio], updating
ms.assetid: ed80790f-3f95-47e4-8a41-872588a8ca07
caps.latest.revision: "51"
author: gewarren
ms.author: gewarren
manager: ghogen
ms.workload: office
ms.openlocfilehash: 9ca505ff6e61962cd360a3f8413a69abe92e377f
ms.sourcegitcommit: 32f1a690fc445f9586d53698fc82c7debd784eeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="walkthrough-updating-the-controls-on-a-ribbon-at-run-time"></a>Пошаговое руководство. Обновление элементов управления на ленте во время выполнения
  В этом пошаговом руководстве показано, как использовать объектную модель ленты для обновления элементов управления на ленте после загрузки ленты в приложение Office.  
  
 [!INCLUDE[appliesto_ribbon](../vsto/includes/appliesto-ribbon-md.md)]  
  
 В данном примере данные извлекаются из примера базы данных Northwind (Борей) для заполнения поля со списком и меню в Microsoft Office Outlook. Элементы, выбираемые в этих элементах управления, автоматически заполнить поля, такие как **для** и **субъекта** в сообщении электронной почты.  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Создание нового проекта надстройки Outlook VSTO  
  
-   Разработка пользовательской группы ленты  
  
-   Добавление пользовательской группы на встроенную вкладку  
  
-   Обновление элементов управления на ленте во время выполнения  
  
> [!NOTE]  
>  Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).  
  
## <a name="prerequisites"></a>Предварительные требования  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   Microsoft Outlook  
  
## <a name="creating-a-new-outlook-vsto-add-in-project"></a>Создание нового проекта надстройки Outlook VSTO  
 Сначала создайте проект надстройки Outlook VSTO.  
  
#### <a name="to-create-a-new-outlook-vsto-add-in-project"></a>Порядок создания нового проекта надстройки Outlook VSTO  
  
1.  В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], создайте проект надстройки Outlook VSTO с именем **Ribbon_Update_At_Runtime**.  
  
2.  В диалоговом окне **Создание проекта** выберите **Создать каталог для решения**.  
  
3.  Сохраните проект в каталоге проекта по умолчанию.  
  
     Дополнительные сведения см. в разделе [How to: Create Office Projects in Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
## <a name="designing-a-custom-ribbon-group"></a>Разработка пользовательской группы ленты  
 Лента для этого примера будет отображаться при составлении пользователем нового сообщения электронной почты. Чтобы создать пользовательскую группу для ленты, сначала добавьте элемент ленты в свой проект, а затем создайте группу в конструкторе лент. Эта пользовательская группа позволит создавать последующие сообщения электронной почты для пользователей путем подстановки имен и журналов заказов из базы данных.  
  
#### <a name="to-design-a-custom-group"></a>Порядок создания пользовательской группы  
  
1.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
2.  В диалоговом окне **Добавление нового элемента** выберите элемент **Лента (визуальный конструктор)**.  
  
3.  Измените имя новой ленты на **CustomerRibbon**, а затем нажмите кнопку **добавить**.  
  
     **CustomerRibbon.cs** или **CustomerRibbon.vb** файл откроется в конструкторе лент и отображает вкладку по умолчанию и группы.  
  
4.  Щелкните конструктор лент, чтобы выбрать его.  
  
5.  В **свойства** окно, щелкните стрелку раскрывающегося списка рядом с **RibbonType** , а затем щелкните **Microsoft.Outlook.Mail.Compose**.  
  
     Это обеспечивает отображение ленты, когда пользователь создает новое сообщение электронной почты в Outlook.  
  
6.  В конструкторе лент щелкните **Group1** для ее выделения.  
  
7.  В **свойства** задайте **метка** для **покупки заказчика**.  
  
8.  Из **элементы управления ленты Office** вкладке **элементов**, перетащите **ComboBox** на **покупки заказчика** группы.  
  
9. Нажмите кнопку **ComboBox1** для ее выделения.  
  
10. В **свойства** задайте **метка** для **клиентов**.  
  
11. Из **элементы управления ленты Office** вкладке **элементов**, перетащите **меню** на **покупки заказчика** группы.  
  
12. В **свойства** задайте **метка** для **приобретенный продукт**.  
  
13. Задать **динамическое** для **true**.  
  
     Это позволит добавлять и удалять элементы управления в меню во время выполнения после загрузки ленты в приложение Office.  
  
## <a name="adding-the-custom-group-to-a-built-in-tab"></a>Добавление пользовательской группы на встроенную вкладку  
 Встроенная вкладка — это вкладка, которая уже имеется на ленте проводника или инспектора Outlook. В этой процедуре вы сможете добавить пользовательскую группу на встроенную вкладку, а затем указать положение этой группы на вкладке.  
  
#### <a name="to-add-the-custom-group-to-a-built-in-tab"></a>Порядок добавления пользовательской группы на встроенную вкладку  
  
1.  Нажмите кнопку **TabAddins (встроенная)** tab, чтобы выбрать его.  
  
2.  В **свойства** окна, разверните **ControlId** , а затем установите **OfficeId** для **TabNewMailMessage**.  
  
     Это добавляет **покупки заказчика** группа **сообщений** вкладки ленты, которая появляется в новое сообщение.  
  
3.  Нажмите кнопку **покупки заказчика** группу, чтобы выделить его.  
  
4.  В **свойства** окна, разверните **позиции** свойства, щелкните стрелку раскрывающегося списка рядом с **меню** , а затем щелкните  **BeforeOfficeId**.  
  
5.  Задать **OfficeId** свойства **значение GroupClipboard**.  
  
     Это размещает **покупки заказчика** группы перед **буфер обмена** группы **сообщений** вкладки.  
  
## <a name="creating-the-data-source"></a>Создание источника данных  
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.  
  
#### <a name="to-create-the-data-source"></a>Создание источника данных  
  
1.  В меню **Данные** выберите команду **Добавить новый источник данных**.  
  
     Запустится **мастер настройки источника данных**.  
  
2.  Выберите **базы данных**, а затем нажмите кнопку **Далее**.  
  
3.  Выберите **Dataset**, а затем нажмите кнопку **Далее**.  
  
4.  Выберите подключение к данным для Microsoft SQL Server Compact 4.0 образца базы данных "Борей" или добавьте новое подключение с помощью **новое подключение** кнопки.  
  
5.  После выбора или создания подключения нажмите кнопку **Далее**.  
  
6.  Нажмите кнопку **Далее** , чтобы сохранить строку подключения.  
  
7.  На **Выбор объектов базы данных** разверните **таблиц**.  
  
8.  Установите флажок рядом с каждой из следующих таблиц.  
  
    1.  **Клиенты**  
  
    2.  **Сведения о заказе**  
  
    3.  **Заказы**  
  
    4.  **Продукты**  
  
9. Нажмите кнопку **Готово**.  
  
## <a name="updating-controls-in-the-custom-group-at-run-time"></a>Обновление элементов управления в пользовательской группе во время выполнения  
 Используйте объектную модель ленты для выполнения следующих задач.  
  
-   Добавление имен клиентов в **клиентов** поле со списком.  
  
-   Добавление элементов управления меню и кнопки для **приобретенные продукты** проданных меню, соответствующие заказы на продажу и продуктов.  
  
-   Заполнение To, темы и текст поля новых почтовых сообщений с помощью данных из **клиентов** поле со списком и **приобретенные продукты** меню.  
  
#### <a name="to-update-controls-in-the-custom-group-by-using-the-ribbon-object-model"></a>Порядок обновления элементов управления в пользовательской группе с помощью объектной модели ленты  
  
1.  В меню **Проект** щелкните команду **Добавить ссылку**.  
  
2.  В **добавить ссылку** диалоговое окно, нажмите кнопку **.NET** выберите **System.Data.Linq** сборки, а затем щелкните **ОК**.  
  
     Эта сборка содержит классы для использования запросов LINQ (Language-Integrated Queries). Запросы LINQ будут использоваться для заполнения элементов управления в пользовательской группе данными из базы данных Northwind.  
  
3.  В **обозревателе решений**, нажмите кнопку **CustomerRibbon.cs** или **CustomerRibbon.vb** для ее выделения.  
  
4.  На **представление** меню, нажмите кнопку **кода**.  
  
     Файл кода ленты открывается в редакторе кода.  
  
5.  Добавьте следующие операторы в начало файла кода ленты. Эти операторы обеспечивают легкий доступ к пространствам имен LINQ и к пространству имен основной сборки взаимодействия Outlook.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#1](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#1)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#1](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#1)]  
  
6.  Добавьте следующий код в класс CustomerRibbon. Этот код объявляет таблицу данных и адаптеры таблиц, которые будут использоваться для хранения информации из таблиц «Заказчики», «Заказы», «Сведения о заказе» и «Продукт» базы данных Northwind.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#2](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#2)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#2](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#2)]  
  
7.  Добавьте следующий блок кода в класс `CustomerRibbon`. Этот код добавляет три вспомогательных метода, создающих элементы управления на ленте во время выполнения.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#3](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#3)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#3](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#3)]  
  
8.  Замените обработчик событий `CustomerRibbon_Load` следующим кодом. Этот код использует запрос LINQ для выполнения следующих задач.  
  
    -   Заполнение **клиентов** поле со списком с помощью идентификатора и имени 20 заказчиков в базе данных Northwind.  
  
    -   Вызов вспомогательного метода `PopulateSalesOrderInfo`. Этот метод обновляет **ProductsPurchased** меню с номера заказов на продажу, которые относятся к выбранному заказчику.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#4](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#4)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#4](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#4)]  
  
9. Добавьте следующий код в класс `CustomerRibbon`. Этот код использует запросы LINQ для выполнения следующих задач.  
  
    -   Добавление подменю в **ProductsPurchased** меню для каждого заказа на продажу, относящиеся к выбранному клиенту.  
  
    -   Добавление кнопок в каждое подменю для продуктов, относящихся к заказу на продажу.  
  
    -   Добавление обработчиков событий для каждой кнопки.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#6](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#6)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#6](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#6)]  
  
10. В **обозревателе решений**, дважды щелкните файл кода ленты.  
  
     Открывается конструктор лент.  
  
11. В конструкторе лент дважды щелкните **клиентов** поле со списком.  
  
     В редакторе кода открывается файл кода ленты и появляется обработчик событий `ComboBox1_TextChanged`.  
  
12. Замените обработчик событий `ComboBox1_TextChanged` следующим кодом. Этот код выполняет следующие задачи:  
  
    -   Вызов вспомогательного метода `PopulateSalesOrderInfo`. Этот метод обновляет **приобретенные продукты** меню с заказами, которые относятся к выбранному клиенту.  
  
    -   Вызов вспомогательного метода `PopulateMailItem` и передача текущего текста, представляющего собой имя выбранного заказчика. Этот метод заполняет To, темы и текст поля новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#5](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#5)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#5](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#5)]  
  
13. Добавьте следующий обработчик событий нажатия кнопки Click в класс `CustomerRibbon`. Этот код добавляет имя выбранных продуктов в поле текста новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#8](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#8)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#8](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#8)]  
  
14. Добавьте следующий код в класс `CustomerRibbon`. Этот код выполняет следующие задачи:  
  
    -   Заполняет поле Кому новых почтовых сообщений, используя адрес электронной почты текущего выбранного заказчика.  
  
    -   Добавляет текст в поле темы и текст поля новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#7](../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs#7)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#7](../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb#7)]  
  
## <a name="testing-the-controls-in-the-custom-group"></a>Тестирование элементов управления в пользовательской группе  
 При открытии новой почтовой формы в Outlook, пользовательская группа с именем **покупки заказчика** отображается на **сообщений** ленты.  
  
 Чтобы создать дальнейшее сообщение электронной почты для заказчика, выберите заказчика, а затем приобретенные им продукты. Элементы управления в **покупки заказчика** обновляются во время выполнения с помощью данных из базы данных Northwind.  
  
#### <a name="to-test-the-controls-in-the-custom-group"></a>Порядок тестирования элементов управления в пользовательской группе  
  
1.  Нажмите клавишу F5 для запуска проекта.  
  
     Запускается Outlook.  
  
2.  В Outlook на **файл** последовательно выберите пункты **New**, а затем нажмите кнопку **почтовое сообщение**.  
  
     Происходят следующие действия:  
  
    -   Откроется новое окно инспектора сообщений электронной почты.  
  
    -   На **сообщение** вкладку на ленте, **покупки заказчика** группа появляется перед **буфер обмена** группы.  
  
    -   **Клиентов** поле со списком в группе обновляется именами заказчиков в базе данных Northwind.  
  
3.  На **сообщение** ленты в **покупки заказчика** группу, выберите заказчика из **клиентов** поле со списком.  
  
     Происходят следующие действия:  
  
    -   **Приобретенные продукты** меню обновляется для отображения всех заказов для выбранного клиента.  
  
    -   Каждое подменю заказов на продажу обновится и будет показывать продукты, приобретенные в рамках данного заказа.  
  
    -   Адрес электронной почты выбранного заказчика добавляется **для** строки сообщения электронной почты, темы и текст сообщения электронной почты будет подставлен текст.  
  
4.  Нажмите кнопку **покупки продуктов** меню, выберите любой заказ на продажу и нажмите кнопку продукта из заказа на продажу.  
  
     Имя продукта добавляется в тело сообщения электронной почты.  
  
## <a name="next-steps"></a>Следующие шаги  
 Дополнительные сведения о настройке пользовательского интерфейса Office см. в следующих разделах:  
  
-   Добавление пользовательского интерфейса на основе контекста к настройкам уровня документа. Дополнительные сведения см. в разделе [Actions Pane Overview](../vsto/actions-pane-overview.md).  
  
-   Расширение стандартной или пользовательской формы Microsoft Office Outlook. Дополнительные сведения см. в разделе [Пошаговое руководство: разработка области формы Outlook](../vsto/walkthrough-designing-an-outlook-form-region.md).  
  
-   Добавление настраиваемой области задач в Outlook. Дополнительные сведения см. в разделе [настраиваемых панелей задач](../vsto/custom-task-panes.md).  
  
## <a name="see-also"></a>См. также  
 [Accessing the Ribbon at Run Time](../vsto/accessing-the-ribbon-at-run-time.md)   
 [Обзор ленты](../vsto/ribbon-overview.md)   
 [Встроенные в язык запроса (LINQ)](/dotnet/csharp/linq/index)   
 [Как: работа с настройкой ленты](../vsto/how-to-get-started-customizing-the-ribbon.md)   
 [Конструктор лент](../vsto/ribbon-designer.md)   
 [Пошаговое руководство: Создание настраиваемой вкладки с помощью конструктора лент](../vsto/walkthrough-creating-a-custom-tab-by-using-the-ribbon-designer.md)   
 [Общие сведения о модели объектов ленты](../vsto/ribbon-object-model-overview.md)   
 [Настройка ленты для Outlook](../vsto/customizing-a-ribbon-for-outlook.md)   
 [Как: изменение положения вкладки на ленте](../vsto/how-to-change-the-position-of-a-tab-on-the-ribbon.md)   
 [Как: Настройка встроенной вкладки](../vsto/how-to-customize-a-built-in-tab.md)   
 [Как: Добавление элементов управления в представление Backstage](../vsto/how-to-add-controls-to-the-backstage-view.md)   
 [Как: экспорт ленты из конструктора лент в XML-ленты](../vsto/how-to-export-a-ribbon-from-the-ribbon-designer-to-ribbon-xml.md)   
 [Практическое руководство. Просмотр ошибок пользовательского интерфейса надстройки](../vsto/how-to-show-add-in-user-interface-errors.md)  
  
  