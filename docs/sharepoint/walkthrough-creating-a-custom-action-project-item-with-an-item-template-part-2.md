---
title: Создание элемента проекта настраиваемого действия с помощью шаблона элемента, часть 2
ms.date: 02/02/2017
ms.topic: how-to
helpviewer_keywords:
- project items [SharePoint development in Visual Studio], creating template wizards
- SharePoint project items, creating template wizards
- SharePoint development in Visual Studio, defining new project item types
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: c96546f85b21ee0ca8a559059a16158b743cb915
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "86016099"
---
# <a name="walkthrough-create-a-custom-action-project-item-with-an-item-template-part-2"></a>Пошаговое руководство. Создание элемента проекта настраиваемого действия с помощью шаблона элемента, часть 2
  После определения пользовательского типа элемента проекта SharePoint и связывания его с шаблоном элемента в Visual Studio может также потребоваться создать мастер для шаблона. С помощью мастера можно получать сведения от пользователей, когда они используют шаблон для добавления нового экземпляра элемента проекта в проект. Собранные сведения можно использовать для инициализации элемента проекта.

 В этом пошаговом руководстве вы добавите мастер в элемент проекта настраиваемого действия, как показано в [разделе Пошаговое руководство. Создание элемента проекта настраиваемого действия с помощью шаблона элемента, часть 1](../sharepoint/walkthrough-creating-a-custom-action-project-item-with-an-item-template-part-1.md). Когда пользователь добавляет элемент проекта настраиваемого действия в проект SharePoint, мастер собирает сведения о настраиваемом действии (например, его расположение и URL-адрес для перехода к, когда пользователь выбирает его) и добавляет эти сведения в файл *Elements.xml* в новом элементе проекта.

 В этом пошаговом руководстве описаны следующие задачи.

- Создание мастера для пользовательского типа элемента проекта SharePoint, связанного с шаблоном элемента.

- Определение пользовательского пользовательского интерфейса мастера, который напоминает встроенные мастера для элементов проектов SharePoint в Visual Studio.

- Использование заменяемых параметров для инициализации файлов проектов SharePoint с данными, собранными в мастере.

- Отладка и тестирование мастера.

> [!NOTE]
> Вы можете скачать пример из [GitHub](https://github.com/SharePoint/PnP/tree/master/Samples/Workflow.Activities) , в котором показано, как создавать пользовательские действия для рабочего процесса.

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения этого пошагового руководства необходимо сначала создать решение Кустомактионпрожектитем, выполнив [Пошаговое руководство: создание элемента проекта настраиваемого действия с шаблоном элемента, часть 1](../sharepoint/walkthrough-creating-a-custom-action-project-item-with-an-item-template-part-1.md).

 Кроме того, для выполнения этого пошагового руководства на компьютере разработчика потребуются следующие компоненты:

- Поддерживаемые выпуски Windows, SharePoint и Visual Studio.

- Пакет SDK для Visual Studio. В этом пошаговом руководстве используется шаблон **проекта VSIX** в пакете SDK для создания пакета VSIX для развертывания элемента проекта. Дополнительные сведения см. [в разделе Расширение инструментов SharePoint в Visual Studio](../sharepoint/extending-the-sharepoint-tools-in-visual-studio.md).

  Знания следующих концепций полезны, но не требуются для выполнения этого пошагового руководства.

- Мастера для шаблонов проектов и элементов в Visual Studio. Дополнительные сведения см. [в разделе руководство. Использование мастеров с шаблонами проектов](../extensibility/how-to-use-wizards-with-project-templates.md) и <xref:Microsoft.VisualStudio.TemplateWizard.IWizard> интерфейсом.

- Настраиваемые действия в SharePoint. Дополнительные сведения см. в разделе [настраиваемое действие](/previous-versions/office/developer/sharepoint-2010/ms458635(v=office.14)).

## <a name="create-the-wizard-project"></a>Создание проекта мастера
 Для выполнения этого пошагового руководства необходимо добавить проект в решение Кустомактионпрожектитем, созданное в [разделе Пошаговое руководство. Создание элемента проекта настраиваемого действия с помощью шаблона элемента, часть 1](../sharepoint/walkthrough-creating-a-custom-action-project-item-with-an-item-template-part-1.md). Будет реализован <xref:Microsoft.VisualStudio.TemplateWizard.IWizard> интерфейс и определен пользовательский интерфейс мастера в этом проекте.

#### <a name="to-create-the-wizard-project"></a>Создание проекта мастера

1. В Visual Studio откройте решение Кустомактионпрожектитем.

2. В **Обозреватель решений**откройте контекстное меню узла решения, выберите **Добавить**, а затем выберите **Новый проект**.

3. В диалоговом окне **Новый проект** разверните узлы **Visual C#** или **Visual Basic** , а затем выберите узел **Windows** .

4. В верхней части диалогового окна **Новый проект** убедитесь, что **.NET Framework 4,5** выбран в списке версий .NET Framework.

5. Выберите шаблон проекта **Библиотека пользовательского элемента управления WPF** , присвойте проекту имя **итемтемплатевизард**, а затем нажмите кнопку **ОК** .

     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] Добавляет проект **итемтемплатевизард** в решение.

6. Удалите элемент UserControl1 из проекта.

## <a name="configure-the-wizard-project"></a>Настройка проекта мастера
 Перед созданием мастера необходимо добавить в проект Windows Presentation Foundation окно (WPF), файл кода и ссылки на сборку.

#### <a name="to-configure-the-wizard-project"></a>Настройка проекта мастера

1. В **Обозреватель решений**откройте контекстное меню в узле проекта **итемтемплатевизард** и выберите пункт **Свойства**.

2. В **конструкторе проектов**убедитесь, что для целевой платформы задано значение .NET Framework 4,5.

     Для проектов Visual C# это значение можно задать на вкладке **приложение** . Для проектов Visual Basic это значение можно задать на вкладке **Компиляция** . Дополнительные сведения см. в разделе [инструкции. Назначение версии .NET Framework](../ide/visual-studio-multi-targeting-overview.md).

3. В проекте **итемтемплатевизард** добавьте в проект элемент **Window (WPF)** , а затем назовите элемент **визардвиндов**.

4. Добавьте два файла кода с именами Кустомактионвизард и strings.

5. Откройте контекстное меню проекта **итемтемплатевизард** и выберите команду **Добавить ссылку**.

6. В диалоговом окне **Диспетчер ссылок — итемтемплатевизард** в узле **сборки** выберите узел **расширения** .

7. Установите флажки рядом со следующими сборками, а затем нажмите кнопку **ОК** :

    - EnvDTE

    - Microsoft. VisualStudio. Shell. 11.0

    - Microsoft.VisualStudio.TemplateWizardInterface

8. В **Обозреватель решений**в папке **References** для проекта итемтемплатевизард выберите ссылку **EnvDTE** .

9. В окне **Свойства** измените значение свойства **Внедрить типы взаимодействия** на **false**.

## <a name="define-the-default-location-and-id-strings-for-custom-actions"></a>Определение строк расположения и идентификатора по умолчанию для настраиваемых действий
 Каждое пользовательское действие имеет расположение и идентификатор, указанные в `GroupID` `Location` атрибутах и `CustomAction` элемента в файле *Elements.xml* . На этом шаге вы определите некоторые из допустимых строк для этих атрибутов в проекте Итемтемплатевизард. По завершении этого пошагового руководства эти строки записываются в файл *Elements.xml* в элементе проекта настраиваемого действия, когда пользователи указывают расположение и идентификатор в мастере.

 Для простоты этот пример поддерживает только подмножество доступных мест и идентификаторов по умолчанию. Полный список см. в разделе [расположения и идентификаторы настраиваемых действий по умолчанию](/previous-versions/office/developer/sharepoint-2010/bb802730(v=office.14)).

#### <a name="to-define-the-default-location-and-id-strings"></a>Определение строк расположения и идентификатора по умолчанию

1. открыт.

2. В проекте **итемтемплатевизард** замените код в файле кода строк следующим кодом.

     [!code-csharp[SPExtensibility.ProjectItem.CustomAction#6](../sharepoint/codesnippet/CSharp/customactionprojectitem/itemtemplatewizard/strings.cs#6)]
     [!code-vb[SPExtensibility.ProjectItem.CustomAction#6](../sharepoint/codesnippet/VisualBasic/customactionprojectitem/itemtemplatewizard/strings.vb#6)]

## <a name="create-the-wizard-ui"></a>Создание пользовательского интерфейса мастера
 Добавьте XAML, чтобы определить пользовательский интерфейс мастера, и добавьте код для привязки некоторых элементов управления в мастере к строкам ИДЕНТИФИКАТОРов. Создаваемый Мастер напоминает встроенный мастер для проектов SharePoint в Visual Studio.

#### <a name="to-create-the-wizard-ui"></a>Создание пользовательского интерфейса мастера

1. В проекте **итемтемплатевизард** откройте контекстное меню для файла **визардвиндов. XAML** и выберите **Открыть** , чтобы открыть окно в конструкторе.

2. В представлении XAML замените текущий код XAML следующим кодом XAML. XAML определяет пользовательский интерфейс, включающий заголовок, элементы управления для указания поведения настраиваемого действия и кнопки навигации в нижней части окна.

    > [!NOTE]
    > После добавления этого кода в проекте возникнут ошибки компиляции. Эти ошибки исчезнут при добавлении кода в последующих шагах.

     [!code-xml[SPExtensibility.ProjectItem.CustomAction#9](../sharepoint/codesnippet/Xaml/customactionprojectitem/itemtemplatewizard/wizardwindow.xaml#9)]

    > [!NOTE]
    > Окно, созданное в этом XAML, является производным от <xref:Microsoft.VisualStudio.PlatformUI.DialogWindow> базового класса. При добавлении пользовательского диалогового окна WPF в Visual Studio рекомендуется создать производное диалоговое окно от этого класса, чтобы обеспечить единообразное оформление с помощью других диалоговых окон в Visual Studio и избежать проблем, которые могут возникнуть в противном случае с модальными диалоговыми окнами. Дополнительные сведения см. в разделе [Создание модальных диалоговых окон и управление ими](../extensibility/creating-and-managing-modal-dialog-boxes.md).

3. Если вы занимаетесь разработкой проекта Visual Basic, удалите `ItemTemplateWizard` пространство имен из `WizardWindow` имени класса в `x:Class` атрибуте `Window` элемента. Этот элемент находится в первой строке XAML. Когда все будет готово, первая строка должна выглядеть следующим образом:

    ```xml
    <Window x:Class="WizardWindow"
    ```

4. В файле кода программной части файла Визардвиндов. XAML замените текущий код следующим кодом.

     [!code-vb[SPExtensibility.ProjectItem.CustomAction#7](../sharepoint/codesnippet/VisualBasic/customactionprojectitem/itemtemplatewizard/wizardwindow.xaml.vb#7)]
     [!code-csharp[SPExtensibility.ProjectItem.CustomAction#7](../sharepoint/codesnippet/CSharp/customactionprojectitem/itemtemplatewizard/wizardwindow.xaml.cs#7)]

## <a name="implement-the-wizard"></a>Реализация мастера
 Определите функциональные возможности мастера, реализовав <xref:Microsoft.VisualStudio.TemplateWizard.IWizard> интерфейс.

#### <a name="to-implement-the-wizard"></a>Реализация мастера

1. В проекте **итемтемплатевизард** откройте файл кода **кустомактионвизард** , а затем замените текущий код в этом файле следующим кодом:

     [!code-csharp[SPExtensibility.ProjectItem.CustomAction#8](../sharepoint/codesnippet/CSharp/customactionprojectitem/itemtemplatewizard/customactionwizard.cs#8)]
     [!code-vb[SPExtensibility.ProjectItem.CustomAction#8](../sharepoint/codesnippet/VisualBasic/customactionprojectitem/itemtemplatewizard/customactionwizard.vb#8)]

## <a name="checkpoint"></a>Контрольная точка
 На этом этапе в пошаговом руководстве весь код для мастера теперь находится в проекте. Выполните сборку проекта, чтобы убедиться, что компиляция выполняется без ошибок.

#### <a name="to-build-your-project"></a>Построение проекта

1. В строке меню последовательно выберите **Сборка** > **Собрать решение**.

## <a name="associate-the-wizard-with-the-item-template"></a>Связывание мастера с шаблоном элемента
 После реализации мастера необходимо связать его с шаблоном элемента **настраиваемого действия** , выполнив три основных шага:

1. Подпишите сборку мастера строгим именем.

2. Получите маркер открытого ключа для сборки мастера.

3. Добавьте ссылку на сборку мастера в VSTEMPLATE-файле для шаблона **настраиваемого элемента действия** .

#### <a name="to-sign-the-wizard-assembly-with-a-strong-name"></a>Подписывание сборки мастера строгим именем

1. В **Обозреватель решений**откройте контекстное меню в узле проекта **итемтемплатевизард** и выберите пункт **Свойства**.

2. На вкладке **Подпись** установите флажок **Подписать сборку**.

3. В списке **выберите файл ключа строгого имени** выберите **\<New...>** .

4. В диалоговом окне **Создание ключа строгого имени** введите имя, снимите флажок **защитить файл ключа паролем** и нажмите кнопку **ОК** .

5. В строке меню последовательно выберите **Сборка** > **Собрать решение**.

#### <a name="to-get-the-public-key-token-for-the-wizard-assembly"></a>Получение токена открытого ключа для сборки мастера

1. В окне командной строки Visual Studio выполните следующую команду, заменив *пастовизардассембли* на полный путь к созданной сборке ItemTemplateWizard.dll для проекта итемтемплатевизард на компьютере разработчика.

    ```xml
    sn.exe -T PathToWizardAssembly
    ```

     Токен открытого ключа для сборки *ItemTemplateWizard.dll* записывается в окно командной строки Visual Studio.

2. Не закрывайте окно командной строки Visual Studio. Для выполнения следующей процедуры потребуется токен открытого ключа.

#### <a name="to-add-a-reference-to-the-wizard-assembly-in-the-vstemplate-file"></a>Добавление ссылки на сборку мастера в VSTEMPLATE-файле

1. В **Обозреватель решений**разверните узел проекта **ItemTemplate** , а затем откройте файл *ItemTemplate. vstemplate* .

2. Рядом с концом файла добавьте следующий `WizardExtension` элемент между `</TemplateContent>` `</VSTemplate>` тегами и. Замените значение *йоуртокен* `PublicKeyToken` атрибута на маркер открытого ключа, полученный в предыдущей процедуре.

    ```xml
    <WizardExtension>
      <Assembly>ItemTemplateWizard, Version=1.0.0.0, Culture=neutral, PublicKeyToken=YourToken</Assembly>
      <FullClassName>ItemTemplateWizard.CustomActionWizard</FullClassName>
    </WizardExtension>
    ```

     Дополнительные сведения об `WizardExtension` элементе см. в разделе [визардекстенсион element &#40;Visual Studio templates&#41;](../extensibility/wizardextension-element-visual-studio-templates.md).

3. Сохраните и закройте файл.

## <a name="add-replaceable-parameters-to-the-elementsxml-file-in-the-item-template"></a>Добавление заменяемых параметров в файл *Elements.xml* в шаблоне элемента
 Добавьте несколько заменяемых параметров в файл *Elements.xml* в проекте ItemTemplate. Эти параметры инициализируются в `PopulateReplacementDictionary` методе `CustomActionWizard` класса, который был определен ранее. Когда пользователь добавляет в проект элемент проекта настраиваемого действия, Visual Studio автоматически заменяет эти параметры в файле *Elements.xml* в новом элементе проекта значениями, указанными в мастере.

 Заменяемый параметр — это маркер, который начинается и заканчивается знаком доллара ($). В дополнение к определению собственных заменяемых параметров можно использовать встроенные параметры, определяемые системой проектов SharePoint и инициализирующие их. Дополнительные сведения см. в разделе [заменяемые параметры](../sharepoint/replaceable-parameters.md).

#### <a name="to-add-replaceable-parameters-to-the-elementsxml-file"></a>Добавление заменяемых параметров в файл *Elements.xml*

1. В проекте ItemTemplate замените содержимое файла *Elements.xml* следующим XML-кодом.

    ```xml
    <?xml version="1.0" encoding="utf-8" ?>
    <Elements Id="$guid8$" xmlns="http://schemas.microsoft.com/sharepoint/">
      <CustomAction Id="$IdValue$"
                    GroupId="$GroupIdValue$"
                    Location="$LocationValue$"
                    Sequence="1000"
                    Title="$TitleValue$"
                    Description="$DescriptionValue$" >
        <UrlAction Url="$UrlValue$"/>
      </CustomAction>
    </Elements>
    ```

     Новый XML-файл изменяет значения `Id` атрибутов,, `GroupId` `Location` , `Description` и `Url` на заменяемые параметры.

2. Сохраните и закройте файл.

## <a name="add-the-wizard-to-the-vsix-package"></a>Добавление мастера в пакет VSIX
 В файле source. extension. vsixmanifest в проекте VSIX добавьте ссылку на проект мастера, чтобы она была развернута с помощью пакета VSIX, содержащего элемент проекта.

#### <a name="to-add-the-wizard-to-the-vsix-package"></a>Добавление мастера в пакет VSIX

1. В **Обозреватель решений**откройте контекстное меню из файла **source. extension. vsixmanifest** в проекте кустомактионпрожектитем, а затем нажмите кнопку **Открыть** , чтобы открыть файл в редакторе манифестов.

2. В редакторе манифестов перейдите на вкладку **активы** и нажмите кнопку **создать** .

     Откроется диалоговое окно **Добавление нового ресурса** .

3. В списке **тип** выберите **Microsoft. VisualStudio. Assembly**.

4. В списке **источник** выберите **проект в текущем решении**.

5. В списке **проект** выберите **итемтемплатевизард**, а затем нажмите кнопку **ОК** .

6. В строке меню выберите **Сборка**  >  **сборка решения**и убедитесь, что решение компилируется без ошибок.

## <a name="test-the-wizard"></a>Тестирование мастера
 Теперь все готово для тестирования мастера. Сначала начните отладку решения Кустомактионпрожектитем в экспериментальном экземпляре Visual Studio. Затем протестируйте мастер для элемента проекта настраиваемого действия в проекте SharePoint в экспериментальном экземпляре Visual Studio. Наконец, создайте и запустите проект SharePoint, чтобы убедиться, что настраиваемое действие работает должным образом.

#### <a name="to-start-to-debug-the-solution"></a>Запуск отладки решения

1. Перезапустите Visual Studio с учетными данными администратора, а затем откройте решение Кустомактионпрожектитем.

2. В проекте Итемтемплатевизард откройте файл кода Кустомактионвизард, а затем добавьте точку останова в первую строку кода в `RunStarted` методе.

3. В строке меню выберите **Отладка**  >  **исключений**.

4. В диалоговом окне **исключения** убедитесь, что сняты **порождаемые** и **необработанные** флажки для **исключений среды** CLR, а затем нажмите кнопку **ОК** .

5. Запустите отладку, нажав клавишу **F5** , или в строке меню выберите **Отладка**  >  **начать отладку**.

     Visual Studio устанавливает расширение в%UserProfile%\AppData\Local\Microsoft\VisualStudio\11.0Exp\Extensions\Contoso\Custom Action Project Item\1.0 и запускает экспериментальный экземпляр Visual Studio. Вы протестируете элемент проекта в этом экземпляре Visual Studio.

#### <a name="to-test-the-wizard-in-visual-studio"></a>Тестирование мастера в Visual Studio

1. В экспериментальном экземпляре Visual Studio в строке меню выберите **файл**  >  **создать**  >  **проект**.

2. Разверните узел **Visual C#** или **Visual Basic** (в зависимости от языка, поддерживаемого шаблоном элемента), разверните узел **SharePoint** , а затем выберите узел **2010** .

3. В списке шаблонов проектов выберите **проект SharePoint 2010**, назовите проект **кустомактионвизардтест**, а затем нажмите кнопку **ОК** .

4. В **мастере настройки SharePoint**введите URL-адрес сайта, который требуется использовать для отладки, а затем нажмите кнопку **Готово** .

5. В **Обозреватель решений**откройте контекстное меню узла проекта, выберите **Добавить**, а затем выберите **новый элемент**.

6. В диалоговом окне **Добавление нового элемента — кустомитемвизардтест** разверните узел **SharePoint** , а затем узел **2010** .

7. В списке элементов проекта выберите элемент **настраиваемое действие** , а затем нажмите кнопку **Добавить** .

8. Убедитесь, что код в другом экземпляре Visual Studio остановлен в точке останова, заданной ранее в `RunStarted` методе.

9. Продолжайте отладку проекта, нажав клавишу **F5** , или в строке меню выберите пункт **Отладка**  >  **продолжить**.

     Откроется окно Мастер настройки SharePoint.

10. В разделе **Расположение**нажмите кнопку **изменить параметр списка** .

11. В списке **идентификатор группы** выберите **связь**.

12. В поле **название** введите **Центр разработчиков SharePoint**.

13. В поле  **Описание** введите, чтобы **Открыть веб-сайт центра разработчиков SharePoint**.

14. В поле **URL-адрес** введите **https://docs.microsoft.com/sharepoint/dev/** , а затем нажмите кнопку **Готово** .

     Visual Studio добавит элемент с именем **CustomAction1** в проект и откроет файл *Elements.xml* в редакторе. Убедитесь, что *Elements.xml* содержит значения, указанные в мастере.

#### <a name="to-test-the-custom-action-in-sharepoint"></a>Тестирование настраиваемого действия в SharePoint

1. В экспериментальном экземпляре Visual Studio нажмите клавишу **F5** или в строке меню выберите **Отладка**  >  **начать отладку**.

     Настраиваемое действие упаковывается и развертывается на сайте SharePoint, указанном в свойстве **URL-адрес сайта** проекта, и веб-браузер открывается на странице этого сайта по умолчанию.

    > [!NOTE]
    > Если откроется диалоговое окно **Отладка скрипта отключено** , нажмите кнопку **Да** .

2. В области списки сайта SharePoint выберите ссылку **задачи** .

     Откроется страница **задачи — все задачи** .

3. На вкладке **список средства** на ленте выберите вкладку **Список** , а затем в группе **Параметры** выберите **Параметры списка**.

     Откроется страница **Параметры списка** .

4. Под заголовком **подключения** в верхней части страницы выберите ссылку **Центр разработчиков SharePoint** , убедитесь, что браузер открывает веб-сайт https://docs.microsoft.com/sharepoint/dev/ , а затем закройте браузер.

## <a name="cleaning-up-the-development-computer"></a>Очистка компьютера разработки
 После завершения тестирования элемента проекта удалите шаблон элемента проекта из экспериментального экземпляра Visual Studio.

#### <a name="to-clean-up-the-development-computer"></a>Очистка компьютера разработки

1. В экспериментальном экземпляре Visual Studio в строке меню выберите **инструменты**  >  **расширения и обновления**.

     Появится диалоговое окно **Расширения и обновления**.

2. В списке расширений выберите расширение **элемента проекта настраиваемого действия** , а затем нажмите кнопку **Удалить** .

3. В появившемся диалоговом окне нажмите кнопку **Да** , чтобы подтвердить удаление расширения, а затем нажмите кнопку **Перезагрузить сейчас** для завершения удаления.

4. Закройте оба экземпляра Visual Studio (экспериментальный экземпляр и экземпляр Visual Studio, в котором открыто решение Кустомактионпрожектитем).

## <a name="see-also"></a>См. также раздел
- [Пошаговое руководство. Создание элемента проекта настраиваемого действия с помощью шаблона элемента, часть 1](../sharepoint/walkthrough-creating-a-custom-action-project-item-with-an-item-template-part-1.md)
- [Определение пользовательских типов элементов проектов SharePoint](../sharepoint/defining-custom-sharepoint-project-item-types.md)
- [Создание шаблонов элементов и проектов для элементов проектов SharePoint](../sharepoint/creating-item-templates-and-project-templates-for-sharepoint-project-items.md)
- [Справочник по схеме шаблонов Visual Studio](../extensibility/visual-studio-template-schema-reference.md)
- [Практическое руководство. Использование мастеров для шаблонов проекта](../extensibility/how-to-use-wizards-with-project-templates.md)
- [Расположения и идентификаторы настраиваемых действий по умолчанию](/previous-versions/office/developer/sharepoint-2010/bb802730(v=office.14))
