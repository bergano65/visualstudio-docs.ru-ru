---
title: Пошаговое руководство. Импорт рабочего процесса для повторного использования в SharePoint Designer | Документация Майкрософт
titleSuffix: ''
description: В этом пошаговом руководстве вы импортируете рабочий процесс с возможностью повторного использования, созданный в SharePoint Designer, в проект рабочего процесса SharePoint для Visual Studio.
ms.custom: SEO-VS-2020
ms.date: 02/02/2017
ms.topic: how-to
f1_keywords:
- VS.SharePointTools.WSPImport.ImportWF
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- SharePoint development in Visual Studio, importing reusable workflows
- reusable workflows [SharePoint development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: d4c12626550e36acc1a135258750f2d96ac5e81d
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99952594"
---
# <a name="walkthrough-import-a-sharepoint-designer-reusable-workflow"></a>Пошаговое руководство. Импорт рабочего процесса для повторного использования в SharePoint Designer

  В этом пошаговом руководстве показано, как импортировать рабочий процесс с возможностью повторного использования, созданный в SharePoint Designer 2010, в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] проект рабочего процесса SharePoint.

 Рабочие процессы, созданные в SharePoint Designer или *декларативные рабочие процессы*, состоят из [!INCLUDE[TLA2#tla_xml](../sharepoint/includes/tla2sharptla-xml-md.md)] инструкций, а не кода. В SharePoint Designer 2010 представлены *многократно используемые рабочие процессы*, которые являются переносимыми декларативными рабочими процессами, которые могут использоваться различными списками на сайтах SharePoint.

 Рабочие процессы, созданные в [!INCLUDE[vs_dev11_long](../sharepoint/includes/vs-dev11-long-md.md)] , такие как последовательные и конечные рабочие процессы, называются *рабочими процессами кода*. Рабочие процессы кода состоят из XML-файлов и модулей кода, в которых пользователи могут настраивать поведение рабочего процесса.

 Visual Studio позволяет импортировать рабочие процессы с возможностью повторного использования, созданные в SharePoint Designer 2010, и преобразовывать их в рабочие процессы с кодом, используемые на сайтах SharePoint.

 В этом пошаговом руководстве описаны следующие задачи.

- Создание простого, повторно используемого рабочего процесса в SharePoint Designer.

- Экспорт рабочего процесса для повторного использования SharePoint Designer в *WSP* -файл и в SharePoint.

- Импорт *WSP* -файла в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] с помощью проекта Импорт рабочего процесса для повторного использования.

- Изменение рабочего процесса путем добавления кода.

- Использование импортированного рабочего процесса на сайте SharePoint.

  [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения этого пошагового руководства требуются следующие компоненты:

- Поддерживаемые выпуски [!INCLUDE[TLA#tla_win](../sharepoint/includes/tlasharptla-win-md.md)] и SharePoint.

- приведенному.

- Microsoft [!INCLUDE[TLA2#tla_office](../sharepoint/includes/tla2sharptla-office-md.md)] SharePoint Designer 2010.

## <a name="create-target-sharepoint-subsites"></a>Создать целевые дочерние сайты SharePoint
 Сначала вы создадите два новых дочерних сайта SharePoint: один для размещения рабочих процессов с возможностью повторного использования из SharePoint Designer, другой для размещения преобразованных рабочих процессов.

#### <a name="to-create-sharepoint-subsites"></a>Создание дочерних узлов SharePoint

1. В SharePoint Designer 2010 в строке меню выберите **файл**  >  **создать пустой веб-сайт**.

2. В диалоговом окне **новый пустой веб-сайт** перейдите на сайт SharePoint, на котором нужно создать рабочий процесс, или используйте значение http://<em>SystemName</em>/, а затем нажмите кнопку **ОК** .

    Откроется домашняя страница.

3. В разделе **дочерние сайты** нажмите кнопку **создать** .

4. В диалоговом окне **создать** выберите **Шаблоны SharePoint** в списке в левой области и выберите **сайт группы** в списке в правой области.

5. В поле **укажите расположение веб-сайта** замените **дочерний узел** Word в URL-адресе на **SPD1**, а затем нажмите кнопку **ОК** .

    При этом новый дочерний сайт откроется в SharePoint Designer. Закройте этот экземпляр SharePoint Designer и вернитесь к первому экземпляру (сайту верхнего уровня).

6. Повторите шаги 3-5, чтобы создать второй дочерний сайт, на этот раз заменив **дочерний узел** Word на [!INCLUDE[TLA2#tla_url](../sharepoint/includes/tla2sharptla-url-md.md)] **SPD2**.

## <a name="create-a-sharepoint-designer-reusable-workflow"></a>Создание рабочего процесса для повторного использования SharePoint Designer
 Так как SharePoint не содержит повторно используемых рабочих процессов, которые можно использовать в этом примере, вы создадите его. В этом простом рабочем процессе, когда пользователь вводит в список задач новую задачу с указанным заголовком, задача назначается этому пользователю.

#### <a name="to-create-a-sharepoint-designer-reusable-workflow"></a>Создание рабочего процесса для повторного использования в SharePoint Designer

1. В разделе **дочерние сайты** выберите сайт **SPD1** , чтобы изменить его.

2. На ленте нажмите кнопку **Рабочий процесс для повторного использования** .

     Откроется мастер создания рабочего процесса для повторного использования.

3. В поле **имя** введите **Рабочий процесс SPD Task**.

4. В списке **тип содержимого** выберите **задача**, а затем нажмите кнопку **ОК** .

     Рабочий процесс откроется в конструкторе рабочих процессов SharePoint Designer.

5. В конструкторе рабочих процессов выберите Шаг 1, а затем на ленте нажмите кнопку **условие** .

6. В списке условий выберите **значение, если поле текущего элемента равно value**.

     На этом шаге добавляется условие с именем, **Если поле имеет значение**.

7. В условии **Если поле равно значению** выберите ссылку на **поле** .

8. В списке значений выберите **заголовок**.

9. В условии **If поле равно значению** выберите ссылку **значение** .

10. В поле введите **Новая задача**.

     Инструкция Condition теперь считывает, **Если текущий элемент: заголовок совпадает с новой задачей**.

11. Выберите строку под оператором Condition, а затем на ленте нажмите кнопку **действие** .

12. В списке действий выберите **задать поле в текущем элементе**.

13. В действии **задать поле для значения** выберите ссылку на **поле** , а затем в списке выберите значение **назначено**.

14. В действии **задать поле для значения** выберите ссылку **значение** , а затем в списке существующих пользователей и групп выберите **пользователь, создавший элемент**.

15. Нажмите кнопку **Добавить** , а затем нажмите кнопку **ОК** .

     Теперь инструкция действия считывает **Кому назначено Set к текущему элементу: CreatedBy**.

## <a name="save-and-deploy-the-reusable-workflow"></a>Сохранение и развертывание рабочего процесса для повторного использования
 Поскольку [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] может импортировать только *WSP* -файлы, необходимо сохранить рабочий процесс с возможностью повторного использования как файл *WSP* и развернуть его в SharePoint перед импортом в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] .

> [!IMPORTANT]
> Если при выполнении следующей процедуры возникает ошибка времени выполнения, необходимо выполнить процедуру в системе, которая имеет доступ к сайту SharePoint.

#### <a name="to-save-and-deploy-the-reusable-workflow"></a>Сохранение и развертывание рабочего процесса для повторного использования

1. В верхней части SharePoint Designer нажмите кнопку **сохранить** , чтобы сохранить ход выполнения, а затем нажмите кнопку **опубликовать** , чтобы развернуть рабочий процесс на сайте SharePoint **SPD1** .

2. В области навигации выберите объект **рабочие процессы** .

3. В разделе **Рабочий процесс для повторного использования** выберите **Рабочий процесс для задачи SPD**.

4. На ленте нажмите кнопку **Сохранить как шаблон** , чтобы сохранить рабочий процесс в виде *WSP* -файла.

5. Откройте сайт SharePoint **SPD1** в браузере, чтобы просмотреть *WSP* -файл в SharePoint.

6. На панели быстрого запуска выберите ссылку **библиотеки** .

7. В разделе **библиотеки документов** выберите ссылку **ресурсы сайта** .

     Файл **рабочего процесса для задачи SPD** указан вместе с другими ресурсами сайта.

8. В списке файлов выберите имя этого файла

9. В диалоговом окне **Загрузка файла** нажмите кнопку **сохранить** , чтобы сохранить *WSP* файл в локальной системе.

## <a name="import-the-wsp-file-into-visual-studio"></a>Импорт WSP файла в Visual Studio
 Импортируйте *WSP* -файл в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] , используя проект Импорт рабочего процесса для повторного использования. Этот проект преобразует рабочий процесс из повторно используемого декларативного рабочего процесса в рабочий процесс кода. После преобразования рабочего процесса вы будете использовать код для изменения его поведения.

#### <a name="to-import-a-workflow-from-a-wsp-file-and-modify-it"></a>Импорт рабочего процесса из WSP-файла и его изменение

1. В в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] строке меню выберите **файл**  >  **создать**  >  **проект**.

2. В диалоговом окне **Новый проект** разверните узел **SharePoint** в разделе **Visual C#** или **Visual Basic**, а затем выберите узел **2010** .

3. В области **шаблоны** выберите шаблон **рабочего процесса импорт повторно используемого экземпляра SharePoint 2010** , оставьте имя проекта **WorkflowImportProject1**, а затем нажмите кнопку **ОК** .

    Откроется окно Мастер настройки SharePoint.

4. На странице **Укажите сайт и уровень безопасности для отладки** введите [!INCLUDE[TLA2#tla_url](../sharepoint/includes/tla2sharptla-url-md.md)] для второго дочернего сайта SharePoint, созданного ранее: http://<em>System Name</em>/SPD2.

5. В разделе **что такое уровень доверия для этого решения SharePoint?** выберите параметр **Развернуть как решение фермы** , а затем нажмите кнопку **Далее** .

    Дополнительные сведения о решениях "песочницы" и "ферма" см. в статье [рекомендации по изолированным решениям](../sharepoint/sandboxed-solution-considerations.md).

6. На странице **Указание нового источника проекта** перейдите к расположению в системе, где ранее был сохранен *WSP* -файл, откройте файл и нажмите кнопку **Далее** .

   > [!NOTE]
   > Нажмите кнопку **Готово** , чтобы импортировать все доступные элементы в *WSP* File.

    Отобразится список повторно используемых рабочих процессов, доступных для импорта.

7. В поле **выберите импортируемые элементы** выберите рабочий процесс для **рабочего процесса SPD** , а затем нажмите кнопку **Готово** .

    После завершения операции импорта создается проект с именем **WorkflowImportProject1** , содержащий рабочий процесс с именем **SPD_Workflow_TestFT**. В этой папке находится файл определения рабочего процесса *Elements.xml* и файл конструктора рабочих процессов (*. XOML*). Конструктор содержит два файла: файл правил (. rules) и файл кода программной части ( *CS* или *VB* в зависимости от языка программирования проекта).

8. В **Обозреватель решений** удалите папку **Другие импортированные файлы** .

9. В файле *Elements.xml* удалите `InstantiationURL="_layouts/IniErkflIP.sspx"` .

10. В **Обозреватель решений** выберите **WorkflowImportProject1**, а затем в строке меню выберите **проект**  >  **Назначить запускаемым проектом** , чтобы задать **WorkflowImportProject1** в качестве автозапускаемого элемента.

     Этот список отображается сразу же при отладке проекта.

11. Поскольку шаблон " **Импорт повторно используемого рабочего процесса SharePoint 2010** " не импортирует значения свойств взаимосвязей для импортированного рабочего процесса, необходимо ввести их. Для этого выполните следующие действия.

    1. В **Обозреватель решений** выберите узел **SPD_Workflow_TestFT** .

    2. Нажмите кнопку с многоточием (![ASP.net Mobile Designer](../sharepoint/media/mwellipsis.gif "Эллипс конструктора ASP.NET для мобильных устройств")) рядом с одним из свойств списка, например свойство **Target List** .

    3. Заполните поля отсутствующие значения в мастере настройки SharePoint, а затем нажмите кнопку **Готово** .

12. Выберите XOML-файл, а затем в строке меню выберите   >  **конструктор** представлений, чтобы просмотреть импортированный рабочий процесс в конструкторе рабочих процессов.

13. В узле **Windows Workflow v 3.0** **панели элементов** выполните одно из следующих действий.

    - Откройте контекстное меню действия **Code** и выберите команду **Копировать**. В конструкторе рабочих процессов откройте контекстное меню для строки под действием **SequenceActivity1** и выберите **Вставить**.

    - Перетащите действие **Code** с **панели элементов** в конструктор рабочих процессов и подключите его к строке под действием **SequenceActivity1** .

      В конструктор рабочих процессов добавляется действие с именем **CodeActivity1**. В этом действии вы добавите действие кода, которое создает объявление в списке извещений, когда пользователь запускает рабочий процесс.

14. Выполните одно из следующих действий.

    - Дважды щелкните **CodeActivity1** , чтобы создать обработчик событий и просмотреть код.

    - В окне **Свойства** для **CodeActivity1** задайте для свойства **ExecuteCode** значение **codeActivity_ExecuteCode**.

15. Добавьте следующий фрагмент в существующие директивы **using** или **Imports** :

     [!code-csharp[SP_SPDWFImport#1](../sharepoint/codesnippet/CSharp/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.cs#1)]
     [!code-vb[SP_SPDWFImport#1](../sharepoint/codesnippet/VisualBasic/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.vb#1)]

16. Замените на `codeActivity1_ExecuteCode` следующий:

     [!code-csharp[SP_SPDWFImport#2](../sharepoint/codesnippet/CSharp/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.cs#2)]
     [!code-vb[SP_SPDWFImport#2](../sharepoint/codesnippet/VisualBasic/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.vb#2)]

## <a name="deploy-the-project-and-associate-the-workflow"></a>Развертывание проекта и связывание рабочего процесса
 Затем запустите WorkflowImportProject1, чтобы развернуть его на сайте SharePoint, а затем свяжите рабочий процесс с списком задач, чтобы просмотреть и протестировать измененный, преобразованный рабочий процесс.

#### <a name="to-deploy-the-project-and-associate-the-workflow"></a>Развертывание проекта и связывание рабочего процесса

1. В выберите [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] клавишу **F5** , чтобы запустить и развернуть проект преобразованного рабочего процесса.

2. На панели быстрого запуска выберите ссылку **задачи** , чтобы отобразить список задачи.

3. На вкладке **список средств** нажмите кнопку **элементы** , а затем нажмите кнопку **создать элемент** .

     Откроется диалоговое окно **задачи — создать элемент** .

4. В поле **название** введите **Новая задача**, а затем нажмите кнопку **сохранить** .

5. На вкладке **список средств** нажмите кнопку **Список** , а затем нажмите кнопку **список параметров** .

     Откроется страница **Параметры списка** .

6. В разделе **разрешения и управление** выберите ссылку **Параметры рабочего процесса** .

     Откроется страница **Параметры рабочего процесса** .

7. Выберите ссылку **Добавить рабочий процесс** .

8. В списке **Рабочий процесс** выберите **WorkflowImportProject1-SPD Workflow Test**.

9. В поле **имя** введите **SPD Workflow Test**, а затем нажмите кнопку **ОК** .

10. На панели быстрого запуска выберите список **задачи** .

11. Щелкните стрелку рядом с полем **Новая задача**, а затем в списке выберите **рабочие процессы**.

12. В разделе **Запуск нового рабочего процесса** выберите ссылку для **тестового рабочего процесса SPD**, а затем нажмите кнопку **запустить** , чтобы запустить рабочий процесс.

    > [!NOTE]
    > Кроме того, можно выполнить автоматическое связывание рабочего процесса со списком, запустив мастер параметров рабочего процесса и установив для рабочего процесса автоматическое связывание.

     Обратите внимание, что рабочий процесс выполняет два действия: Ваше имя отображается в **Кому назначено** столбце задачи, а объявление отображается в списке **Announcements** .

## <a name="see-also"></a>См. также раздел
- [Импорт элементов с существующего сайта SharePoint](../sharepoint/importing-items-from-an-existing-sharepoint-site.md)
- [Разработка решений SharePoint](../sharepoint/developing-sharepoint-solutions.md)
- [Создание многократно используемых элементов управления для веб-частей или страниц приложений](../sharepoint/creating-reusable-controls-for-web-parts-or-application-pages.md)
